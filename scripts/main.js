(function(){(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.5.2";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else{var o=x.keys(e);for(var i=0,s=o.length;i<s;i++)if(t.call(r,e[o[i]],o[i],e)===n)return}};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?void 0:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r},x.sample=function(e,t,n){return arguments.length<2||n?e[x.random(e.length-1)]:x.shuffle(e).slice(0,Math.max(0,t))};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var L=function(e){return function(t,n,r){var i={},s=n==null?x.identity:k(n);return T(t,function(n,o){var u=s.call(r,n,o,t);e(i,u,n)}),i}};x.groupBy=L(function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)}),x.indexBy=L(function(e,t,n){e[t]=n}),x.countBy=L(function(e,t){x.has(e,t)?e[t]++:e[t]=1}),x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return t&&x.every(e,x.isArray)?a.apply(n,e):(T(e,function(e){x.isArray(e)||x.isArguments(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n)};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e);for(var n=0;n<e;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(S&&e.bind===S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:new Date,o=null,s=e.apply(r,i)};return function(){var f=new Date;!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0?(clearTimeout(o),o=null,u=f,s=e.apply(r,i)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},x.debounce=function(e,t,n){var r,i,s,o,u;return function(){s=this,i=arguments,o=new Date;var a=function(){var f=new Date-o;f<t?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i)))},f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i)),u}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){var t=x.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},x.pairs=function(e){var t=x.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},x.invert=function(e){var t={},n=x.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var a=0,l=!0;if(i=="[object Array]"){a=e.length,l=a==t.length;if(l)while(a--)if(!(l=M(e[a],t[a],n,r)))break}else{for(var c in e)if(x.has(e,c)){a++;if(!(l=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(l){for(c in t)if(x.has(t,c)&&!(a--))break;l=!a}}return n.pop(),r.pop(),l};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(Math.max(0,e));for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),typeof define=="function"&&define.amd&&define("underscore",[],function(){return x})}).call(this),define("jquery",[],function(){return jQuery||{}}),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="1.1.0";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender||e.$,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=o.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,a,f,c,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,f=o.length;a<f;a++){e=o[a];if(s=this._events[e]){this._events[e]=r=[];if(t||n)for(c=0,h=s.length;c<h;c++)i=s[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},stopListening:function(e,t,n){var r=this._listeningTo;if(!r)return this;var i=!t&&!n;!n&&typeof t=="object"&&(n=this),e&&((r={})[e._listenId]=e);for(var s in r)e=r[s],e.off(t,n,this),(i||u.isEmpty(e._events))&&delete this._listeningTo[s];return this}},f=/\s+/,l=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(f.test(n)){var s=n.split(f);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},c=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(e,t){a[t]=function(t,n,r){var i=this._listeningTo||(this._listeningTo={}),s=t._listenId||(t._listenId=u.uniqueId("l"));return i[s]=t,!r&&typeof n=="object"&&(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,u.extend(o,a);var p=o.Model=function(e,t){var n=e||{};t||(t={}),this.cid=u.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=u.defaults({},n,u.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};u.extend(p.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},F(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t,n=u.extend({validate:!0},n);if(r&&!n.wait){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=u.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var a=this,f=n.success;return n.success=function(e){a.attributes=o;var t=a.parse(e,n);n.wait&&(t=u.extend(r||{},t));if(u.isObject(t)&&!a.set(t,n))return!1;f&&f(a,e,n),a.trigger("sync",a,e,n)},F(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew())return e.success(),!1;F(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||j();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},u.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,u.extend(t,{validationError:n})),!1):!0}});var d=["keys","values","pairs","invert","pick","omit"];u.each(d,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),u[e].apply(u,t)}});var v=o.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))},m={add:!0,remove:!0,merge:!0},g={add:!0,remove:!1};u.extend(v.prototype,a,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){return this.set(e,u.extend({merge:!1},t,g))},remove:function(e,t){var n=!u.isArray(e);e=n?[e]:u.clone(e),t||(t={});var r,i,s,o;for(r=0,i=e.length;r<i;r++){o=e[r]=this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byId[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return n?e[0]:e},set:function(e,t){t=u.defaults({},t,m),t.parse&&(e=this.parse(e,t));var n=!u.isArray(e);e=n?e?[e]:[]:u.clone(e);var r,i,s,o,a,f,l,c=t.at,h=this.model,d=this.comparator&&c==null&&t.sort!==!1,v=u.isString(this.comparator)?this.comparator:null,g=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!d&&w&&S?[]:!1;for(r=0,i=e.length;r<i;r++){a=e[r],a instanceof p?s=o=a:s=a[h.prototype.idAttribute];if(f=this.get(s))S&&(b[f.cid]=!0),E&&(a=a===o?o.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),d&&!l&&f.hasChanged(v)&&(l=!0)),e[r]=f;else if(w){o=e[r]=this._prepareModel(a,t);if(!o)continue;g.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o)}x&&x.push(f||o)}if(S){for(r=0,i=this.length;r<i;++r)b[(o=this.models[r]).cid]||y.push(o);y.length&&this.remove(y,t)}if(g.length||x&&x.length){d&&(l=!0),this.length+=g.length;if(c!=null)for(r=0,i=g.length;r<i;r++)this.models.splice(c+r,0,g[r]);else{x&&(this.models.length=0);var T=x||g;for(r=0,i=T.length;r<i;r++)this.models.push(T[r])}}l&&this.sort({silent:!0});if(!t.silent){for(r=0,i=g.length;r<i;r++)(o=g[r]).trigger("add",o,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return n?e[0]:e},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),e=this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,u.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,u.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return i.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e.id]||this._byId[e.cid]||this._byId[e]},at:function(e){return this.models[e]},where:function(e,t){return u.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return u.invoke(this.models,"get",e)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},F(this,e),this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t=t?u.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(y,function(e){v.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var b=["groupBy","countBy","sortBy"];u.each(b,function(e){v.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var w=o.View=function(e){this.cid=u.uniqueId("view"),e||(e={}),u.extend(this,u.pick(e,S)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},E=/^(\S+)\s*(.*)$/,S=["model","collection","el","id","attributes","className","tagName","events"];u.extend(w.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)continue;var r=t.match(E),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}}),o.sync=function(e,t,n){var r=T[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||j()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1),i.type==="PATCH"&&x&&(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,a,n),a};var x=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var N=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,L=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(N.prototype,a,{initialize:function(){},route:function(e,t,n){u.isRegExp(e)||(e=this._routeToRegExp(e)),u.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var r=this;return o.history.route(e,function(i){var s=r._extractParameters(e,i);n&&n.apply(r,s),r.trigger.apply(r,["route:"+t].concat(s)),r.trigger("route",t,s),o.history.trigger("route",r,t,s)}),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;this.routes=u.result(this,"routes");var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(A,"\\$&").replace(C,"(?:$1)?").replace(k,function(e,t){return t?e:"([^/]+)"}).replace(L,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return u.map(n,function(e){return e?decodeURIComponent(e):null})}});var O=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,_=/^\/+|\/+$/g,D=/msie [\w.]+/,P=/\/$/,H=/[?#].*$/;O.started=!1,u.extend(O.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(P,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(M,"")},start:function(e){if(O.started)throw new Error("Backbone.history has already been started");O.started=!0,this.options=u.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=D.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(_,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search))}if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),O.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),u.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!O.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(H,"");if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new O;var B=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};p.extend=v.extend=N.extend=w.extend=O.extend=B;var j=function(){throw new Error('A "url" property or function must be specified')},F=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),define("backbone",["underscore","jquery"],function(e){return function(){var t,n;return t||e.Backbone}}(this)),function(e,t){if(typeof define=="function"&&define.amd)define("backbone.wreqr",["backbone","underscore"],function(e,n){return t(e,n)});else if(typeof exports!="undefined"){var n=require("backbone"),r=require("underscore");module.exports=t(n,r)}else t(e.Backbone,e._)}(this,function(e,t){"use strict";var n=e.Wreqr,r=e.Wreqr={};return e.Wreqr.VERSION="1.3.1",e.Wreqr.noConflict=function(){return e.Wreqr=n,this},r.Handlers=function(e,t){var n=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,n){var r=null;t.isObject(e)&&!t.isFunction(e)&&(r=e.context,e=e.callback),this.setHandler(n,e,r)},this)},setHandler:function(e,t,n){var r={callback:t,context:n};this._wreqrHandlers[e]=r,this.trigger("handler:add",e,t,n)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(!t)return;return function(){var e=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,e)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),n}(e,t),r.CommandStorage=function(){var n=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(n.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var n=this.getCommands(e);n.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),n}(),r.Commands=function(e){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var n=Array.prototype.slice.call(arguments);e.Handlers.prototype.constructor.apply(this,n)},execute:function(e,t){e=arguments[0],t=Array.prototype.slice.call(arguments,1),this.hasHandler(e)?this.getHandler(e).apply(this,t):this.storage.addCommand(e,t)},_executeCommands:function(e,n,r){var i=this.storage.getCommands(e);t.each(i.instances,function(e){n.apply(r,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var n,r=e.storageType||this.storageType;t.isFunction(r)?n=new r:n=r,this.storage=n}})}(r),r.RequestResponse=function(e){return e.Handlers.extend({request:function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);if(this.hasHandler(e))return this.getHandler(e).apply(this,t)}})}(r),r.EventAggregator=function(e,t){var n=function(){};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events),n}(e,t),r.Channel=function(n){var r=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(r.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,n,r){if(!n)return;r=r||this;var i=e==="vent"?"on":"setHandler";t.each(n,function(n,s){this[e][i](s,t.bind(n,r))},this)}}),r}(r),r.radio=function(e){var n=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(n.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var n=this._channels[t];return n||(n=new e.Channel(t),this._channels[t]=n),n},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(r[e],function(t){this[e][t]=i(this,e,t)},this)},this)}});var r={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},i=function(e,t,n){return function(r){var i=e._getChannel(r)[t],s=Array.prototype.slice.call(arguments,1);return i[n].apply(i,s)}};return new n}(r),e.Wreqr}),function(e,t){if(typeof define=="function"&&define.amd)define("backbone.babysitter",["backbone","underscore"],function(e,n){return t(e,n)});else if(typeof exports!="undefined"){var n=require("backbone"),r=require("underscore");module.exports=t(n,r)}else t(e.Backbone,e._)}(this,function(e,t){"use strict";var n=e.ChildViewContainer;return e.ChildViewContainer=function(e,t){var n=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(n.prototype,{add:function(e,t){var n=e.cid;return this._views[n]=e,e.model&&(this._indexByModel[e.model.cid]=n),t&&(this._indexByCustom[t]=n),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var n=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){if(e===n)return delete this._indexByCustom[t],!0},this),delete this._views[n],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,n){t.each(this._views,function(r){t.isFunction(r[e])&&r[e].apply(r,n||[])})},_updateLength:function(){this.length=t.size(this._views)}});var r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return t.each(r,function(e){n.prototype[e]=function(){var n=t.values(this._views),r=[n].concat(t.toArray(arguments));return t[e].apply(t,r)}}),n}(e,t),e.ChildViewContainer.VERSION="0.1.4",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=n,this},e.ChildViewContainer}),function(e,t){if(typeof define=="function"&&define.amd)define("backbone.marionette",["backbone","underscore","backbone.wreqr","backbone.babysitter"],function(n,r){return e.Marionette=t(e,n,r)});else if(typeof exports!="undefined"){var n=require("backbone"),r=require("underscore"),i=require("backbone.wreqr"),s=require("backbone.babysitter");module.exports=t(e,n,r)}else e.Marionette=t(e,e.Backbone,e._)}(this,function(e,t,n){"use strict";function o(e,t){var n=new Error(e);throw n.name=t||"Error",n}var r=e.Marionette,i=t.Marionette={};i.VERSION="2.1.0",i.noConflict=function(){return e.Marionette=r,this},i.Deferred=t.$.Deferred;var s=Array.prototype.slice;return i.extend=t.Model.extend,i.getOption=function(e,t){if(!e||!t)return;var n;return e.options&&e.options[t]!==undefined?n=e.options[t]:n=e[t],n},i.proxyGetOption=function(e){return i.getOption(this,e)},i.normalizeMethods=function(e){var t={};return n.each(e,function(e,r){n.isFunction(e)||(e=this[e]);if(!e)return;t[r]=e},this),t},i.normalizeUIKeys=function(e,t){if(typeof e=="undefined")return;return n.each(n.keys(e),function(n){var r=/@ui\.[a-zA-Z_$0-9]*/g;n.match(r)&&(e[n.replace(r,function(e){return t[e.slice(4)]})]=e[n],delete e[n])}),e},i.actAsCollection=function(e,t){var r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];n.each(r,function(r){e[r]=function(){var e=n.values(n.result(this,t)),i=[e].concat(n.toArray(arguments));return n[r].apply(n,i)}})},i.triggerMethod=function(){function t(e,t,n){return n.toUpperCase()}var e=/(^|:)(\w)/gi,r=function(r){var i="on"+r.replace(e,t),s=this[i],o;return n.isFunction(s)&&(o=s.apply(this,n.tail(arguments))),n.isFunction(this.trigger)&&this.trigger.apply(this,arguments),o};return r}(),i.MonitorDOMRefresh=function(e){function r(e){e._isShown=!0,s(e)}function i(e){e._isRendered=!0,s(e)}function s(e){e._isShown&&e._isRendered&&o(e)&&n.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}function o(n){return t.$.contains(e,n.el)}return function(e){e.listenTo(e,"show",function(){r(e)}),e.listenTo(e,"render",function(){i(e)})}}(document.documentElement),function(e){function t(e,t,r,i){var s=i.split(/\s+/);n.each(s,function(n){var i=e[n];i||o('Method "'+n+'" was configured as an event handler, but does not exist.'),e.listenTo(t,r,i)})}function r(e,t,n,r){e.listenTo(t,n,r)}function i(e,t,r,i){var s=i.split(/\s+/);n.each(s,function(n){var i=e[n];e.stopListening(t,r,i)})}function s(e,t,n,r){e.stopListening(t,n,r)}function u(e,t,r,i,s){if(!t||!r)return;n.isFunction(r)&&(r=r.call(e)),n.each(r,function(r,o){n.isFunction(r)?i(e,t,o,r):s(e,t,o,r)})}e.bindEntityEvents=function(e,n,i){u(e,n,i,r,t)},e.unbindEntityEvents=function(e,t,n){u(e,t,n,s,i)},e.proxyBindEntityEvents=function(t,n){return e.bindEntityEvents(this,t,n)},e.proxyUnbindEntityEvents=function(t,n){return e.unbindEntityEvents(this,t,n)}}(i),i.Callbacks=function(){this._deferred=i.Deferred(),this._callbacks=[]},n.extend(i.Callbacks.prototype,{add:function(e,t){var r=n.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),r.then(function(n){t&&(n.context=t),e.call(n.context,n.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=i.Deferred(),this._callbacks=[],n.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),i.Controller=function(e){this.options=e||{},n.isFunction(this.initialize)&&this.initialize(this.options)},i.Controller.extend=i.extend,n.extend(i.Controller.prototype,t.Events,{destroy:function(){var e=s.call(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.triggerMethod.apply(this,["destroy"].concat(e)),this.stopListening(),this.off(),this},triggerMethod:i.triggerMethod,getOption:i.proxyGetOption}),i.Object=function(e){this.options=n.extend({},n.result(this,"options"),e),this.initialize(this.options)},i.Object.extend=i.extend,n.extend(i.Object.prototype,{initialize:function(){},destroy:function(){this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening()},triggerMethod:i.triggerMethod,getOption:i.proxyGetOption,bindEntityEvents:i.proxyBindEntityEvents,unbindEntityEvents:i.proxyUnbindEntityEvents}),n.extend(i.Object.prototype,t.Events),i.Region=function(e){this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el,this.el||o('An "el" must be specified for a region.',"NoElError"),this.$el=this.getEl(this.el);if(this.initialize){var n=s.apply(arguments);this.initialize.apply(this,n)}},n.extend(i.Region,{buildRegion:function(e,t){if(n.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(n.isFunction(e))return this._buildRegionFromRegionClass(e);o("Improper region configuration type. Please refer to http://marionettejs.com/docs/marionette.region.html#region-configuration-types")},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,r){var i=e.regionClass||r,s=n.omit(e,"selector","regionClass");e.selector&&!s.el&&(s.el=e.selector);var o=new i(s);return e.parentEl&&(o.getEl=function(r){if(n.isObject(r))return t.$(r);var i=e.parentEl;return n.isFunction(i)&&(i=i()),i.find(r)}),o},_buildRegionFromRegionClass:function(e){return new e}}),n.extend(i.Region.prototype,t.Events,{show:function(e,t){this._ensureElement();var r=t||{},i=e!==this.currentView,s=!!r.preventDestroy,o=!!r.forceShow,u=!!this.currentView,a=!s&&i;a&&this.empty();var f=i||o;return f?(e.once("destroy",n.bind(this.empty,this)),e.render(),u&&this.triggerMethod("before:swap",e),this.triggerMethod("before:show",e),n.isFunction(e.triggerMethod)?e.triggerMethod("before:show"):this.triggerMethod.call(e,"before:show"),this.attachHtml(e),this.currentView=e,u&&this.triggerMethod("swap",e),this.triggerMethod("show",e),n.isFunction(e.triggerMethod)?e.triggerMethod("show"):this.triggerMethod.call(e,"show"),this):this},_ensureElement:function(){n.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),(!this.$el||this.$el.length===0)&&o('An "el" '+this.$el.selector+" must exist in DOM")},getEl:function(e){return t.$(e)},attachHtml:function(e){this.el.innerHTML="",this.el.appendChild(e.el)},empty:function(){var e=this.currentView;if(!e)return;return this.triggerMethod("before:empty",e),this._destroyView(),this.triggerMethod("empty",e),delete this.currentView,this},_destroyView:function(){var e=this.currentView;e.destroy&&!e.isDestroyed?e.destroy():e.remove&&e.remove()},attachView:function(e){return this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this},getOption:i.proxyGetOption,triggerMethod:i.triggerMethod}),i.Region.extend=i.extend,i.RegionManager=function(e){var t=e.Controller.extend({constructor:function(t){this._regions={},e.Controller.call(this,t)},addRegions:function(e,t){n.isFunction(e)&&(e=e.apply(this,arguments));var r={};return n.each(e,function(e,i){n.isString(e)&&(e={selector:e}),e.selector&&(e=n.defaults({},e,t));var s=this.addRegion(i,e);r[i]=s},this),r},addRegion:function(t,r){var i,s=n.isObject(r),o=n.isString(r),u=!!r.selector;return o||s&&u?i=e.Region.buildRegion(r,e.Region):n.isFunction(r)?i=e.Region.buildRegion(r,e.Region):i=r,this.triggerMethod("before:add:region",t,i),this._store(t,i),this.triggerMethod("add:region",t,i),i},get:function(e){return this._regions[e]},getRegions:function(){return n.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return n.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return n.each(e,function(e){e.empty()},this),e},destroy:function(){return this.removeRegions(),e.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]=t,this._setLength()},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete this._regions[e],this._setLength(),this.triggerMethod("remove:region",e,t)},_setLength:function(){this.length=n.size(this._regions)}});return e.actAsCollection(t.prototype,"_regions"),t}(i),i.TemplateCache=function(e){this.templateId=e},n.extend(i.TemplateCache,{templateCaches:{},get:function(e){var t=this.templateCaches[e];return t||(t=new i.TemplateCache(e),this.templateCaches[e]=t),t.load()},clear:function(){var e,t=s.call(arguments),n=t.length;if(n>0)for(e=0;e<n;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),n.extend(i.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(e),this.compiledTemplate},loadTemplate:function(e){var n=t.$(e).html();return(!n||n.length===0)&&o('Could not find template: "'+e+'"',"NoTemplateError"),n},compileTemplate:function(e){return n.template(e)}}),i.Renderer={render:function(e,t){e||o("Cannot render the template since its false, null or undefined.","TemplateNotFoundError");var n;return typeof e=="function"?n=e:n=i.TemplateCache.get(e),n(t)}},i.View=t.View.extend({constructor:function(e){n.bindAll(this,"render"),this.options=n.extend({},n.result(this,"options"),n.isFunction(e)?e.call(this):e),this.events=this.normalizeUIKeys(n.result(this,"events")),n.isObject(this.behaviors)&&new i.Behaviors(this),t.View.apply(this,arguments),i.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,s.call(arguments,1))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return n.isFunction(t)&&(t=t.call(this)),n.extend(e,t)},normalizeUIKeys:function(e){var t=n.result(this,"ui"),r=n.result(this,"_uiBindings");return i.normalizeUIKeys(e,r||t)},configureTriggers:function(){if(!this.triggers)return;var e={},t=this.normalizeUIKeys(n.result(this,"triggers"));return n.each(t,function(t,r){var i=n.isObject(t),s=i?t.event:t;e[r]=function(e){if(e){var n=e.preventDefault,r=e.stopPropagation,o=i?t.preventDefault:n,u=i?t.stopPropagation:r;o&&n&&n.apply(e),u&&r&&r.apply(e)}var a={view:this,model:this.model,collection:this.collection};this.triggerMethod(s,a)}},this),e},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),this},_delegateDOMEvents:function(e){e=e||this.events,n.isFunction(e)&&(e=e.call(this)),e=this.normalizeUIKeys(e);var r={},i=n.result(this,"behaviorEvents")||{},s=this.configureTriggers();n.extend(r,i,e,s),t.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){var e=s.call(arguments);return t.View.prototype.undelegateEvents.apply(this,e),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),this},onShowCalled:function(){},_ensureViewIsIntact:function(){if(this.isDestroyed){var e=new Error("Cannot use a view thats already been destroyed.");throw e.name="ViewDestroyedError",e}},destroy:function(){if(this.isDestroyed)return;var e=s.call(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.remove(),this},bindUIElements:function(){if(!this.ui)return;this._uiBindings||(this._uiBindings=this.ui);var e=n.result(this,"_uiBindings");this.ui={},n.each(n.keys(e),function(t){var n=e[t];this.ui[t]=this.$(n)},this)},unbindUIElements:function(){if(!this.ui||!this._uiBindings)return;n.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings},triggerMethod:i.triggerMethod,normalizeMethods:i.normalizeMethods,getOption:i.proxyGetOption,bindEntityEvents:i.proxyBindEntityEvents,unbindEntityEvents:i.proxyUnbindEntityEvents}),i.ItemView=i.View.extend({constructor:function(){i.View.apply(this,arguments)},serializeData:function(){var e={};return this.model?e=n.partial(this.serializeModel,this.model).apply(this,arguments):this.collection&&(e={items:n.partial(this.serializeCollection,this.collection).apply(this,arguments)}),e},serializeCollection:function(e){return e.toJSON.apply(e,s.call(arguments,1))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(e===!1)return;e||o("Cannot render the template since it is null or undefined.","UndefinedTemplateError");var t=this.serializeData();t=this.mixinTemplateHelpers(t);var n=i.Renderer.render(e,t,this);return this.attachElContent(n),this},attachElContent:function(e){return this.$el.html(e),this},destroy:function(){if(this.isDestroyed)return;return i.View.prototype.destroy.apply(this,arguments)}}),i.CollectionView=i.View.extend({childViewEventPrefix:"childview",constructor:function(e){var t=e||{};this.sort=n.isUndefined(t.sort)?!0:t.sort,this._initChildViewStorage(),i.View.apply(this,arguments),this._initialEvents(),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&n.invoke(this._bufferedChildren,"triggerMethod","before:show")},_triggerShowBufferedChildren:function(){this._isShown&&(n.each(this._bufferedChildren,function(e){n.isFunction(e.triggerMethod)?e.triggerMethod("show"):i.triggerMethod.call(e,"show")}),this._bufferedChildren=[])},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e){this.destroyEmptyView();var t=this.getChildView(e),n=this.collection.indexOf(e);this.addChild(e,t,n)},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},onShowCalled:function(){this.children.each(function(e){n.isFunction(e.triggerMethod)?e.triggerMethod("show"):i.triggerMethod.call(e,"show")})},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.triggerMethod("render",this),this},resortView:function(){this.render()},_sortViews:function(){var e=this.collection.find(function(e,t){var n=this.children.findByModel(e);return!n||n._index!==t},this);e&&this.resortView()},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this))},showCollection:function(){var e;this.collection.each(function(t,n){e=this.getChildView(t),this.addChild(t,e,n)},this)},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var n=new t.Model;this.addEmptyView(n,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.destroyChildren(),delete this._showingEmptyView)},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var r=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");n.isFunction(r)&&(r=r.call(this));var i=this.buildChildView(e,t,r);this._isShown&&this.triggerMethod.call(i,"before:show"),this.children.add(i),this.renderChildView(i,-1),this._isShown&&this.triggerMethod.call(i,"show")},getChildView:function(e){var t=this.getOption("childView");return t||o('A "childView" must be specified',"NoChildViewError"),t},addChild:function(e,t,r){var i=this.getOption("childViewOptions");n.isFunction(i)&&(i=i.call(this,e,r));var s=this.buildChildView(e,t,i);return this._updateIndices(s,!0,r),this._addChildView(s,r),s},_updateIndices:function(e,t,n){if(!this.sort)return;t?(e._index=n,this.children.each(function(t){t._index>=e._index&&t._index++})):this.children.each(function(t){t._index>=e._index&&t._index--})},_addChildView:function(e,t){this.proxyChildEvents(e),this.triggerMethod("before:add:child",e),this.children.add(e),this.renderChildView(e,t),this._isShown&&!this.isBuffering&&(n.isFunction(e.triggerMethod)?e.triggerMethod("show"):i.triggerMethod.call(e,"show")),this.triggerMethod("add:child",e)},renderChildView:function(e,t){return e.render(),this.attachHtml(this,e,t),e},buildChildView:function(e,t,r){var i=n.extend({model:e},r);return new t(i)},removeChildView:function(e){return e&&(this.triggerMethod("before:remove:child",e),e.destroy?e.destroy():e.remove&&e.remove(),this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1)),e},isEmpty:function(e){return!this.collection||this.collection.length===0},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},attachHtml:function(e,t,n){e.isBuffering?(e.elBuffer.appendChild(t.el),e._bufferedChildren.push(t)):e._insertBefore(t,n)||e._insertAfter(t)},_insertBefore:function(e,t){var n,r=this.sort&&t<this.children.length-1;return r&&(n=this.children.find(function(e){return e._index===t+1})),n?(n.$el.before(e.el),!0):!1},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){if(this.isDestroyed)return;return this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),i.View.prototype.destroy.apply(this,arguments)},destroyChildren:function(){var e=this.children.map(n.identity);return this.children.each(this.removeChildView,this),this.checkEmpty(),e},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var r=s.call(arguments),i=r[0],o=this.normalizeMethods(n.result(this,"childEvents"));r[0]=t+":"+i,r.splice(1,0,e),typeof o!="undefined"&&n.isFunction(o[i])&&o[i].apply(this,r.slice(1)),this.triggerMethod.apply(this,r)},this)}}),i.CompositeView=i.CollectionView.extend({constructor:function(){i.CollectionView.apply(this,arguments)},_initialEvents:function(){this.once("render",function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))})},getChildView:function(e){var t=this.getOption("childView")||this.constructor;return t||o('A "childView" must be specified',"NoChildViewError"),t},serializeData:function(){var e={};return this.model&&(e=n.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this.isRendered=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this.triggerMethod("render",this),this},_renderChildren:function(){this.isRendered&&i.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),n=i.Renderer.render(t,e,this);this.attachElContent(n),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){var n=this.getChildViewContainer(e);n.append(t)},_insertAfter:function(e){var t=this.getChildViewContainer(this);t.append(e.el)},getChildViewContainer:function(e){if("$childViewContainer"in e)return e.$childViewContainer;var t,r=i.getOption(e,"childViewContainer");if(r){var s=n.isFunction(r)?r.call(e):r;s.charAt(0)==="@"&&e.ui?t=e.ui[s.substr(4)]:t=e.$(s),t.length<=0&&o('The specified "childViewContainer" was not found: '+e.childViewContainer,"ChildViewContainerMissingError")}else t=e.$el;return e.$childViewContainer=t,t},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),i.LayoutView=i.ItemView.extend({regionClass:i.Region,constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),i.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),i.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.regionManager.destroy(),i.ItemView.prototype.destroy.apply(this,arguments))},addRegion:function(e,t){this.triggerMethod("before:region:add",e);var n={};return n[e]=t,this._buildRegions(n)[e]},addRegions:function(e){return this.regions=n.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return this.triggerMethod("before:region:remove",e),delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t=this,n={regionClass:this.getOption("regionClass"),parentEl:function(){return t.$el}};return this.regionManager.addRegions(e,n)},_initializeRegions:function(e){var t;this._initRegionManager(),n.isFunction(this.regions)?t=this.regions(e):t=this.regions||{};var r=this.getOption.call(e,"regions");n.isFunction(r)&&(r=r.call(this,e)),n.extend(t,r),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.emptyRegions(),this.regionManager.each(function(e){e.reset()})},getRegionManager:function(){return new i.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})}}),i.Behavior=function(e,t){function n(t,n){this.view=n,this.defaults=e.result(this,"defaults")||{},this.options=e.extend({},this.defaults,t),this.$=function(){return this.view.$.apply(this.view,arguments)},this.initialize.apply(this,arguments)}return e.extend(n.prototype,t.Events,{initialize:function(){},destroy:function(){this.stopListening()},triggerMethod:i.triggerMethod,getOption:i.proxyGetOption,bindEntityEvents:i.proxyBindEntityEvents,unbindEntityEvents:i.proxyUnbindEntityEvents}),n.extend=i.extend,n}(n,t),i.Behaviors=function(e,t){function n(e,i){i=n.parseBehaviors(e,i||t.result(e,"behaviors")),n.wrap(e,i,t.keys(r))}var r={setElement:function(e,n){return e.apply(this,t.tail(arguments,2)),t.each(n,function(e){e.$el=this.$el,e.el=this.el},this),this},destroy:function(e,n){var r=t.tail(arguments,2);return e.apply(this,r),t.invoke(n,"destroy",r),this},bindUIElements:function(e,n){e.apply(this),t.invoke(n,e)},unbindUIElements:function(e,n){e.apply(this),t.invoke(n,e)},triggerMethod:function(e,n){var r=t.tail(arguments,2);e.apply(this,r),t.each(n,function(t){e.apply(t,r)})},delegateEvents:function(n,r){var i=t.tail(arguments,2);return n.apply(this,i),t.each(r,function(t){e.bindEntityEvents(t,this.model,e.getOption(t,"modelEvents")),e.bindEntityEvents(t,this.collection,e.getOption(t,"collectionEvents"))},this),this},undelegateEvents:function(n,r){var i=t.tail(arguments,2);return n.apply(this,i),t.each(r,function(t){e.unbindEntityEvents(t,this.model,e.getOption(t,"modelEvents")),e.unbindEntityEvents(t,this.collection,e.getOption(t,"collectionEvents"))},this),this},behaviorEvents:function(n,r){var i={},s=t.result(this,"ui");return t.each(r,function(n,r){var o={},u=t.clone(t.result(n,"events"))||{},a=t.result(n,"ui"),f=t.extend({},s,a);u=e.normalizeUIKeys(u,f),t.each(t.keys(u),function(e){var i=(new Array(r+2)).join(" "),s=e+i,a=t.isFunction(u[e])?u[e]:n[u[e]];o[s]=t.bind(a,n)}),i=t.extend(i,o)}),i}};return t.extend(n,{behaviorsLookup:function(){throw new Error("You must define where your behaviors are stored.See https://github.com/marionettejs/backbone.marionette/blob/master/docs/marionette.behaviors.md#behaviorslookup")},getBehaviorClass:function(e,r){return e.behaviorClass?e.behaviorClass:t.isFunction(n.behaviorsLookup)?n.behaviorsLookup.apply(this,arguments)[r]:n.behaviorsLookup[r]},parseBehaviors:function(e,r){return t.chain(r).map(function(r,i){var s=n.getBehaviorClass(r,i),o=new s(r,e),u=n.parseBehaviors(e,t.result(o,"behaviors"));return[o].concat(u)}).flatten().value()},wrap:function(e,n,i){t.each(i,function(i){e[i]=t.partial(r[i],e[i],n)})}}),n}(i,n),i.AppRouter=t.Router.extend({constructor:function(e){t.Router.apply(this,arguments),this.options=e||{};var n=this.getOption("appRoutes"),r=this._getController();this.processAppRoutes(r,n),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var n=this._getController();this._addAppRoute(n,e,t)},_processOnRoute:function(e,t){var r=n.invert(this.getOption("appRoutes"))[e];n.isFunction(this.onRoute)&&this.onRoute(e,r,t)},processAppRoutes:function(e,t){if(!t)return;var r=n.keys(t).reverse();n.each(r,function(n){this._addAppRoute(e,n,t[n])},this)},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,r){var i=e[r];i||o('Method "'+r+'" was not found on the controller'),this.route(t,r,n.bind(i,e))},getOption:i.proxyGetOption}),i.Application=function(e){this._initializeRegions(e),this._initCallbacks=new i.Callbacks,this.submodules={},n.extend(this,e),this._initChannel()},n.extend(i.Application.prototype,t.Events,{execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var n=i.Module.getClass(t),r=s.call(arguments);return r.unshift(this),n.create.apply(n,r)},getRegionManager:function(){return new i.RegionManager},_initializeRegions:function(e){var t=n.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var r=i.getOption(e,"regions");return n.isFunction(r)&&(r=r.call(this,e)),n.extend(t,r),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this.listenTo(this._regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this._regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this._regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_initChannel:function(){this.channelName=n.result(this,"channelName")||"global",this.channel=n.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=n.result(this,"vent")||this.channel.vent,this.commands=n.result(this,"commands")||this.channel.commands,this.reqres=n.result(this,"reqres")||this.channel.reqres},triggerMethod:i.triggerMethod,getOption:i.proxyGetOption}),i.Application.extend=i.extend,i.Module=function(e,t,r){this.moduleName=e,this.options=n.extend({},this.options,r),this.initialize=r.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,this.startWithParent=!0,n.isFunction(this.initialize)&&this.initialize(e,t,this.options)},i.Module.extend=i.extend,n.extend(i.Module.prototype,t.Events,{initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){if(this._isInitialized)return;n.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e)},stop:function(){if(!this._isInitialized)return;this._isInitialized=!1,this.triggerMethod("before:stop"),n.each(this.submodules,function(e){e.stop()}),this._finalizerCallbacks.run(undefined,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop")},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,r){if(!e)return;var s=n.flatten([this,this.app,t,i,t.$,n,r]);e.apply(this,s)},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new i.Callbacks,this._finalizerCallbacks=new i.Callbacks},triggerMethod:i.triggerMethod}),n.extend(i.Module,{create:function(e,t,r){var i=e,o=s.call(arguments);o.splice(0,3),t=t.split(".");var u=t.length,a=[];return a[u-1]=r,n.each(t,function(t,n){var s=i;i=this._getModule(s,t,e,r),this._addModuleDefinition(s,i,a[n],o)},this),i},_getModule:function(e,t,r,i,s){var o=n.extend({},i),u=this.getClass(i),a=e[t];return a||(a=new u(t,r,o),e[t]=a,e.submodules[t]=a),a},getClass:function(e){var t=i.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,n,r){var i=this._getDefine(n),s=this._getStartWithParent(n,t);i&&t.addDefinition(i,r),this._addStartWithParent(e,t,s)},_getStartWithParent:function(e,t){var r;return n.isFunction(e)&&e.prototype instanceof i.Module?(r=t.constructor.prototype.startWithParent,n.isUndefined(r)?!0:r):n.isObject(e)?(r=e.startWithParent,n.isUndefined(r)?!0:r):!0},_getDefine:function(e){return!n.isFunction(e)||e.prototype instanceof i.Module?n.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,n){t.startWithParent=t.startWithParent&&n;if(!t.startWithParent||!!t.startWithParentIsConfigured)return;t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)})}}),i}),define("REM/router/router",["backbone","underscore"],function(e,t){"use strict";return e.Router.extend({routes:{xchart:"xchart",hzbarchart:"hzbarchart",treemap:"treemap","dataworld-choropletenkaart":"dataworld-choro","dataworld-population":"dataworld-population","dataworld-africa-potable-water":"dataworld-africa-potable-water",sewage:"sewage",bewegingskaart:"bewegingskaart"}})}),!function(e){"use strict";e(function(){e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},n;for(n in t)if(e.style[n]!==undefined)return t[n]}();return e&&{end:e}}()})}(window.jQuery),!function(e){"use strict";var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function s(){i.trigger("closed").remove()}var n=e(this),r=n.attr("data-target"),i;r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),i=e(r),t&&t.preventDefault(),i.length||(i=n.hasClass("alert")?n:n.parent()),i.trigger(t=e.Event("close"));if(t.isDefaultPrevented())return;i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.on(e.support.transition.end,s):s()};var r=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("alert");i||r.data("alert",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=r,this},e(document).on("click.alert.data-api",t,n.prototype.close)}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.button.defaults,n)};t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text",r.resetText||n.data("resetText",n[i]()),n[i](r[e]||this.options[e]),setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active"),this.$element.toggleClass("active")};var n=e.fn.button;e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s=typeof n=="object"&&n;i||r.data("button",i=new t(this,s)),n=="toggle"?i.toggle():n&&i.setState(n)})},e.fn.button.defaults={loadingText:"loading..."},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=n,this},e(document).on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle")})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},getActiveIndex:function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},to:function(t){var n=this.getActiveIndex(),r=this;if(t>this.$items.length-1||t<0)return;return this.sliding?this.$element.one("slid",function(){r.to(t)}):n==t?this.pause().cycle():this.slide(t>n?"next":"prev",e(this.$items[t]))},pause:function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),clearInterval(this.interval),this.interval=null,this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",a=this,f;this.sliding=!0,s&&this.pause(),i=i.length?i:this.$element.find(".item")[u](),f=e.Event("slide",{relatedTarget:i[0],direction:o});if(i.hasClass("active"))return;this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var t=e(a.$indicators.children()[a.getActiveIndex()]);t&&t.addClass("active")}));if(e.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(f);if(f.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),this.$element.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger("slid")},0)})}else{this.$element.trigger(f);if(f.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}};var n=e.fn.carousel;e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=e.extend({},e.fn.carousel.defaults,typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;i||r.data("carousel",i=new t(this,s)),typeof n=="number"?i.to(n):o?i[o]():s.interval&&i.pause().cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=n,this},e(document).on("click.carousel.data-api","[data-slide], [data-slide-to]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=e.extend({},i.data(),n.data()),o;i.carousel(s),(o=n.attr("data-slide-to"))&&i.data("carousel").pause().to(o).cycle(),t.preventDefault()})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.collapse.defaults,n),this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var e=this.$element.hasClass("width");return e?"width":"height"},show:function(){var t,n,r,i;if(this.transitioning||this.$element.hasClass("in"))return;t=this.dimension(),n=e.camelCase(["scroll",t].join("-")),r=this.$parent&&this.$parent.find("> .accordion-group > .in");if(r&&r.length){i=r.data("collapse");if(i&&i.transitioning)return;r.collapse("hide"),i||r.data("collapse",null)}this.$element[t](0),this.transition("addClass",e.Event("show"),"shown"),e.support.transition&&this.$element[t](this.$element[0][n])},hide:function(){var t;if(this.transitioning||!this.$element.hasClass("in"))return;t=this.dimension(),this.reset(this.$element[t]()),this.transition("removeClass",e.Event("hide"),"hidden"),this.$element[t](0)},reset:function(e){var t=this.dimension();return this.$element.removeClass("collapse")[t](e||"auto")[0].offsetWidth,this.$element[e!==null?"addClass":"removeClass"]("collapse"),this},transition:function(t,n,r){var i=this,s=function(){n.type=="show"&&i.reset(),i.transitioning=0,i.$element.trigger(r)};this.$element.trigger(n);if(n.isDefaultPrevented())return;this.transitioning=1,this.$element[t]("in"),e.support.transition&&this.$element.hasClass("collapse")?this.$element.one(e.support.transition.end,s):s()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var n=e.fn.collapse;e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("collapse"),s=e.extend({},e.fn.collapse.defaults,r.data(),typeof n=="object"&&n);i||r.data("collapse",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.collapse.defaults={toggle:!0},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=n,this},e(document).on("click.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i).data("collapse")?"toggle":n.data();n[e(i).hasClass("in")?"addClass":"removeClass"]("collapsed"),e(i).collapse(s)})}(window.jQuery),!function(e){"use strict";function r(){e(".dropdown-backdrop").remove(),e(t).each(function(){i(e(this)).removeClass("open")})}function i(t){var n=t.attr("data-target"),r;n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,"")),r=n&&e(n);if(!r||!r.length)r=t.parent();return r}var t="[data-toggle=dropdown]",n=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};n.prototype={constructor:n,toggle:function(t){var n=e(this),s,o;if(n.is(".disabled, :disabled"))return;return s=i(n),o=s.hasClass("open"),r(),o||("ontouchstart"in document.documentElement&&e('<div class="dropdown-backdrop"/>').insertBefore(e(this)).on("click",r),s.toggleClass("open")),n.focus(),!1},keydown:function(n){var r,s,o,u,a,f;if(!/(38|40|27)/.test(n.keyCode))return;r=e(this),n.preventDefault(),n.stopPropagation();if(r.is(".disabled, :disabled"))return;u=i(r),a=u.hasClass("open");if(!a||a&&n.keyCode==27)return n.which==27&&u.find(t).focus(),r.click();s=e("[role=menu] li:not(.divider):visible a",u);if(!s.length)return;f=s.index(s.filter(":focus")),n.keyCode==38&&f>0&&f--,n.keyCode==40&&f<s.length-1&&f++,~f||(f=0),s.eq(f).focus()}};var s=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("dropdown");i||r.data("dropdown",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.dropdown.Constructor=n,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.dropdown.data-api",r).on("click.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api",t,n.prototype.toggle).on("keydown.dropdown.data-api",t+", [role=menu]",n.prototype.keydown)}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n);if(this.isShown||n.isDefaultPrevented())return;this.isShown=!0,this.escape(),this.backdrop(function(){var n=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1),t.enforceFocus(),n?t.$element.one(e.support.transition.end,function(){t.$element.focus().trigger("shown")}):t.$element.focus().trigger("shown")})},hide:function(t){t&&t.preventDefault();var n=this;t=e.Event("hide"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]!==e.target&&!t.$element.has(e.target).length&&t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){t.which==27&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n),t.hideModal()})},hideModal:function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.$backdrop.click(this.options.backdrop=="static"?e.proxy(this.$element[0].focus,this.$element[0]):e.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in");if(!t)return;i?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t):t()):t&&t()}};var n=e.fn.modal;e.fn.modal=function(n){return this.each(function(){var r=e(this),i=r.data("modal"),s=e.extend({},e.fn.modal.defaults,r.data(),typeof n=="object"&&n);i||r.data("modal",i=new t(this,s)),typeof n=="string"?i[n]():s.show&&i.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=n,this},e(document).on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s).one("hide",function(){n.focus()})})}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s,o,u,a;this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,o=this.options.trigger.split(" ");for(a=o.length;a--;)u=o[a],u=="click"?this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this)):u!="manual"&&(i=u=="hover"?"mouseenter":"focus",s=u=="hover"?"mouseleave":"blur",this.$element.on(i+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,e.proxy(this.leave,this)));this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,this.$element.data(),t),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var n=e.fn[this.type].defaults,r={},i;this._options&&e.each(this._options,function(e,t){n[e]!=t&&(r[e]=t)},this),i=e(t.currentTarget)[this.type](r).data(this.type);if(!i.options.delay||!i.options.delay.show)return i.show();clearTimeout(this.timeout),i.hoverState="in",this.timeout=setTimeout(function(){i.hoverState=="in"&&i.show()},i.options.delay.show)},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!n.options.delay||!n.options.delay.hide)return n.hide();n.hoverState="out",this.timeout=setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide)},show:function(){var t,n,r,i,s,o,u=e.Event("show");if(this.hasContent()&&this.enabled){this.$element.trigger(u);if(u.isDefaultPrevented())return;t=this.tip(),this.setContent(),this.options.animation&&t.addClass("fade"),s=typeof this.options.placement=="function"?this.options.placement.call(this,t[0],this.$element[0]):this.options.placement,t.detach().css({top:0,left:0,display:"block"}),this.options.container?t.appendTo(this.options.container):t.insertAfter(this.$element),n=this.getPosition(),r=t[0].offsetWidth,i=t[0].offsetHeight;switch(s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}this.applyPlacement(o,s),this.$element.trigger("shown")}},applyPlacement:function(e,t){var n=this.tip(),r=n[0].offsetWidth,i=n[0].offsetHeight,s,o,u,a;n.offset(e).addClass(t).addClass("in"),s=n[0].offsetWidth,o=n[0].offsetHeight,t=="top"&&o!=i&&(e.top=e.top+i-o,a=!0),t=="bottom"||t=="top"?(u=0,e.left<0&&(u=e.left*-2,e.left=0,n.offset(e),s=n[0].offsetWidth,o=n[0].offsetHeight),this.replaceArrow(u-r+s,s,"left")):this.replaceArrow(o-i,o,"top"),a&&n.offset(e)},replaceArrow:function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function i(){var t=setTimeout(function(){n.off(e.support.transition.end).detach()},500);n.one(e.support.transition.end,function(){clearTimeout(t),n.detach()})}var t=this,n=this.tip(),r=e.Event("hide");this.$element.trigger(r);if(r.isDefaultPrevented())return;return n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?i():n.detach(),this.$element.trigger("hidden"),this},fixTitle:function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var t=this.$element[0];return e.extend({},typeof t.getBoundingClientRect=="function"?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e},tip:function(){return this.$tip=this.$tip||e(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(t){var n=t?e(t.currentTarget)[this.type](this._options).data(this.type):this;n.tip().hasClass("in")?n.hide():n.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var n=e.fn.tooltip;e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s=typeof n=="object"&&n;i||r.data("tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},e.fn.tooltip.noConflict=function(){return e.fn.tooltip=n,this}}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;return e=(typeof n.content=="function"?n.content.call(t[0]):n.content)||t.attr("data-content"),e},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var n=e.fn.popover;e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s=typeof n=="object"&&n;i||r.data("popover",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),e.fn.popover.noConflict=function(){return e.fn.popover=n,this}}(window.jQuery),!function(e){"use strict";function t(t,n){var r=e.proxy(this.process,this),i=e(t).is("body")?e(window):e(t),s;this.options=e.extend({},e.fn.scrollspy.defaults,n),this.$scrollElement=i.on("scroll.scroll-spy.data-api",r),this.selector=(this.options.target||(s=e(t).attr("href"))&&s.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=e("body"),this.refresh(),this.process()}t.prototype={constructor:t,refresh:function(){var t=this,n;this.offsets=e([]),this.targets=e([]),n=this.$body.find(this.selector).map(function(){var n=e(this),r=n.data("target")||n.attr("href"),i=/^#\w/.test(r)&&e(r);return i&&i.length&&[[i.position().top+(!e.isWindow(t.$scrollElement.get(0))&&t.$scrollElement.scrollTop()),r]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},process:function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget,o;if(e>=n)return s!=(o=i.last()[0])&&this.activate(o);for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])},activate:function(t){var n,r;this.activeTarget=t,e(this.selector).parent(".active").removeClass("active"),r=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',n=e(r).parent("li").addClass("active"),n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate")}};var n=e.fn.scrollspy;e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("scrollspy"),s=typeof n=="object"&&n;i||r.data("scrollspy",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.defaults={offset:10},e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=n,this},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s,o;r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;i=n.find(".active:last a")[0],o=e.Event("show",{relatedTarget:i}),t.trigger(o);if(o.isDefaultPrevented())return;s=e(r),this.activate(t.parent("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o(),i.removeClass("in")}};var n=e.fn.tab;e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=n,this},e(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=e(this.options.menu),this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:t.top+t.height,left:t.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){var n;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(n=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,n?this.process(n):this)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var t=[],n=[],r=[],i;while(i=e.shift())i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?n.push(i):r.push(i):t.push(i);return t.concat(n,r)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("focus",e.proxy(this.focus,this)).on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this)).on("mouseleave","li",e.proxy(this.mouseleave,this))},eventSupported:function(e){var t=e in this.$element;return t||(this.$element.setAttribute(e,"return;"),t=typeof this.$element[e]=="function"),t},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()},keydown:function(t){this.suppressKeyPressRepeat=~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},focus:function(e){this.focused=!0},blur:function(e){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(e){e.stopPropagation(),e.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(t){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")},mouseleave:function(e){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var n=e.fn.typeahead;e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n=="object"&&n;i||r.data("typeahead",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e.fn.typeahead.noConflict=function(){return e.fn.typeahead=n,this},e(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;n.typeahead(n.data())})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.options=e.extend({},e.fn.affix.defaults,n),this.$window=e(window).on("scroll.affix.data-api",e.proxy(this.checkPosition,this)).on("click.affix.data-api",e.proxy(function(){setTimeout(e.proxy(this.checkPosition,this),1)},this)),this.$element=e(t),this.checkPosition()};t.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var t=e(document).height(),n=this.$window.scrollTop(),r=this.$element.offset(),i=this.options.offset,s=i.bottom,o=i.top,u="affix affix-top affix-bottom",a;typeof i!="object"&&(s=o=i),typeof o=="function"&&(o=i.top()),typeof s=="function"&&(s=i.bottom()),a=this.unpin!=null&&n+this.unpin<=r.top?!1:s!=null&&r.top+this.$element.height()>=t-s?"bottom":o!=null&&n<=o?"top":!1;if(this.affixed===a)return;this.affixed=a,this.unpin=a=="bottom"?r.top-n:null,this.$element.removeClass(u).addClass("affix"+(a?"-"+a:""))};var n=e.fn.affix;e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("affix"),s=typeof n=="object"&&n;i||r.data("affix",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.affix.Constructor=t,e.fn.affix.defaults={offset:0},e.fn.affix.noConflict=function(){return e.fn.affix=n,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),t.affix(n)})})}(window.jQuery),define("bootstrap",["jquery"],function(){});var Mustache;(function(e){typeof module!="undefined"&&typeof module.exports!="undefined"?module.exports=e:typeof define=="function"?define("mustache",e):Mustache=e})(function(){function u(e,t){return RegExp.prototype.test.call(e,t)}function a(e){return!u(r,e)}function c(e){var t=e.replace(l,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)});return'"'+t+'"'}function h(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function d(e){return String(e).replace(/[&<>"'\/]/g,function(e){return p[e]})}function v(e){this.string=e,this.tail=e,this.pos=0}function m(e,t){this.view=e,this.parent=t,this.clearCache()}function g(){this.clearCache()}function y(e,t){var n=['""'],r,i,s;for(var o=0,u=e.length;o<u;++o){r=e[o];switch(r.type){case"#":case"^":i=r.type==="#"?"_section":"_inverted",n.push("r."+i+"("+c(r.value)+", c, function (c, r) {\n"+"  "+y(r.tokens,!0)+"\n"+"})");break;case"{":case"&":case"name":s=r.type==="name"?"true":"false",n.push("r._name("+c(r.value)+", c, "+s+")");break;case">":n.push("r._partial("+c(r.value)+", c)");break;case"text":n.push(c(r.value))}}return n="return "+n.join(" + ")+";",t?n:new Function("c, r",n)}function b(e){if(e.length!==2)throw new Error("Invalid tags: "+e.join(" "));return[new RegExp(h(e[0])+"\\s*"),new RegExp("\\s*"+h(e[1]))]}function w(e){var t=[],n=t,r=[],i,s;for(var o=0;o<e.length;++o){i=e[o];switch(i.type){case"#":case"^":i.tokens=[],r.push(i),n.push(i),n=i.tokens;break;case"/":if(r.length===0)throw new Error("Unopened section: "+i.value);s=r.pop();if(s.value!==i.value)throw new Error("Unclosed section: "+s.value);r.length>0?n=r[r.length-1].tokens:n=t;break;default:n.push(i)}}s=r.pop();if(s)throw new Error("Unclosed section: "+s.value);return t}function E(e){var t;for(var n=0;n<e.length;++n){var r=e[n];t&&t.type==="text"&&r.type==="text"?(t.value+=r.value,e.splice(n--,1)):t=r}}function S(r,u){u=u||e.tags;var f=b(u),l=new v(r),c=[],p=[],d=!1,m=!1,g=function(){if(d&&!m)while(p.length)c.splice(p.pop(),1);else p=[];d=!1,m=!1},y,S,x;while(!l.eos()){S=l.scanUntil(f[0]);if(S)for(var T=0,N=S.length;T<N;++T)x=S.charAt(T),a(x)?p.push(c.length):m=!0,c.push({type:"text",value:x}),x==="\n"&&g();if(!l.scan(f[0]))break;d=!0,y=l.scan(o)||"name",l.scan(t);if(y==="=")S=l.scanUntil(i),l.scan(i),l.scanUntil(f[1]);else if(y==="{"){var C=new RegExp("\\s*"+h("}"+u[1]));S=l.scanUntil(C),l.scan(s),l.scanUntil(f[1])}else S=l.scanUntil(f[1]);if(!l.scan(f[1]))throw new Error("Unclosed tag at "+l.pos);c.push({type:y,value:S});if(y==="name"||y==="{"||y==="&")m=!0;y==="="&&(u=S.split(n),f=b(u))}return E(c),w(c)}function T(){x.clearCache()}function N(e,t){return x.compile(e,t)}function C(e,t,n){return x.compilePartial(e,t,n)}function k(e,t,n){if(n)for(var r in n)C(r,n[r]);return x.render(e,t)}var e={};e.name="mustache.js",e.version="0.6.0",e.tags=["{{","}}"],e.parse=S,e.clearCache=T,e.compile=N,e.compilePartial=C,e.render=k,e.Scanner=v,e.Context=m,e.Renderer=g,e.to_html=function(e,t,n,r){var i=k(e,t,n);if(typeof r!="function")return i;r(i)};var t=/\s*/,n=/\s+/,r=/\S/,i=/\s*=/,s=/\s*\}/,o=/#|\^|\/|>|\{|&|=|!/,f=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},l=/[\x00-\x2F\x3A-\x40\x5B-\x60\x7B-\xFF\u2028\u2029]/gm,p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};e.escape=d,v.prototype.eos=function(){return this.tail===""},v.prototype.scan=function(e){var t=this.tail.match(e);return t&&t.index===0?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},v.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},m.make=function(e){return e instanceof m?e:new m(e)},m.prototype.clearCache=function(){this._cache={}},m.prototype.push=function(e){return new m(e,this)},m.prototype.lookup=function(e){var t=this._cache[e];if(!t){if(e===".")t=this.view;else{var n=this;while(n){if(e.indexOf(".")>0){var r=e.split("."),i=0;t=n.view;while(t&&i<r.length)t=t[r[i++]]}else t=n.view[e];if(t!=null)break;n=n.parent}}this._cache[e]=t}return typeof t=="function"&&(t=t.call(this.view)),t},g.prototype.clearCache=function(){this._cache={},this._partialCache={}},g.prototype.compile=function(e,t){typeof e=="string"&&(e=S(e,t));var n=y(e),r=this;return function(e){return n(m.make(e),r)}},g.prototype.compilePartial=function(e,t,n){return this._partialCache[e]=this.compile(t,n),this._partialCache[e]},g.prototype.render=function(e,t){var n=this._cache[e];return n||(n=this.compile(e),this._cache[e]=n),n(t)},g.prototype._section=function(e,t,n){var r=t.lookup(e);switch(typeof r){case"object":if(f(r)){var i="";for(var s=0,o=r.length;s<o;++s)i+=n(t.push(r[s]),this);return i}return r?n(t.push(r),this):"";case"function":var u=n(t,this),a=this,l=function(e){return a.render(e,t)};return r.call(t.view,u,l)||"";default:if(r)return n(t,this)}return""},g.prototype._inverted=function(e,t,n){var r=t.lookup(e);return!r||f(r)&&r.length===0?n(t,this):""},g.prototype._partial=function(e,t){var n=this._partialCache[e];return n?n(t):""},g.prototype._name=function(t,n,r){var i=n.lookup(t);typeof i=="function"&&(i=i.call(n.view));var s=i==null?"":String(i);return r?e.escape(s):s};var x=new g;return e}()),this.recline=this.recline||{},this.recline.Backend=this.recline.Backend||{},this.recline.Backend.CSV=this.recline.Backend.CSV||{},function(e){"use strict";function o(e){return e.charAt(e.length-1)!=="\n"?e:e.substring(0,e.length-1)}e.__type__="csv";var t=typeof jQuery!="undefined"&&jQuery.Deferred||_.Deferred;e.fetch=function(n){var r=new t;if(n.file){var i=new FileReader,s=n.encoding||"UTF-8";i.onload=function(t){var i=e.parseCSV(t.target.result,n);r.resolve({records:i,metadata:{filename:n.file.name},useMemoryStore:!0})},i.onerror=function(e){alert("Failed to load file. Code: "+e.target.error.code)},i.readAsText(n.file,s)}else if(n.data){var o=e.parseCSV(n.data,n);r.resolve({records:o,useMemoryStore:!0})}else n.url&&jQuery.get(n.url).done(function(t){var i=e.parseCSV(t,n);r.resolve({records:i,useMemoryStore:!0})});return r.promise()},e.parseCSV=function(e,t){e=o(e);var t=t||{},i=t.trim===!1?!1:!0,u=t.delimiter||",",a=t.quotechar||'"',f="",l=!1,c=!1,h="",p=[],d=[],v,m;m=function(e){return c!==!0&&(e===""?e=null:i===!0&&(e=s(e)),n.test(e)?e=parseInt(e,10):r.test(e)&&(e=parseFloat(e,10))),e};for(v=0;v<e.length;v+=1)f=e.charAt(v),l!==!1||f!==u&&f!=="\n"?f!==a?h+=f:l?e.charAt(v+1)===a?(h+=a,v+=1):l=!1:(l=!0,c=!0):(h=m(h),p.push(h),f==="\n"&&(d.push(p),p=[]),h="",c=!1);return h=m(h),p.push(h),d.push(p),t.skipInitialRows&&(d=d.slice(t.skipInitialRows)),d},e.serializeCSV=function(e,t){var n=null;if(e instanceof Array)n=e;else{n=[];var r=_.pluck(e.fields,"id");n.push(r),_.each(e.records,function(e,t){var i=_.map(r,function(t){return e[t]});n.push(i)})}var t=t||{},s=t.delimiter||",",o=t.quotechar||'"',u="",a="",f="",l="",c,h,p;p=function(e){return e===null?e="":typeof e=="string"&&i.test(e)?e=o+e+o:typeof e=="number"&&(e=e.toString(10)),e};for(c=0;c<n.length;c+=1){u=n[c];for(h=0;h<u.length;h+=1)a=p(u[h]),h===u.length-1?(f+=a,l+=f+"\n",f=""):f+=a+s,a=""}return l};var n=/^\d+$/,r=/^\d*\.\d+$|^\d+\.\d*$/,i=/^\s|\s$|,|"|\n/,s=function(){return String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}()}(this.recline.Backend.CSV),this.recline=this.recline||{},this.recline.Backend=this.recline.Backend||{},this.recline.Backend.DataProxy=this.recline.Backend.DataProxy||{},function(e){"use strict";e.__type__="dataproxy",e.dataproxy_url="//jsonpdataproxy.appspot.com",e.timeout=5e3;var t=typeof jQuery!="undefined"&&jQuery.Deferred||_.Deferred;e.fetch=function(r){var i={url:r.url,"max-results":r.size||r.rows||1e3,type:r.format||""},s=jQuery.ajax({url:e.dataproxy_url,data:i,dataType:"jsonp"}),o=new t;return n(s).done(function(e){e.error&&o.reject(e.error),o.resolve({records:e.data,fields:e.fields,useMemoryStore:!0})}).fail(function(e){o.reject(e)}),o.promise()};var n=function(n){var r=new t,i=setTimeout(function(){r.reject({message:"Request Error: Backend did not respond after "+e.timeout/1e3+" seconds"})},e.timeout);return n.done(function(e){clearTimeout(i),r.resolve(e)}).fail(function(e){clearTimeout(i),r.reject(e)}),r.promise()}}(this.recline.Backend.DataProxy),this.recline=this.recline||{},this.recline.Backend=this.recline.Backend||{},this.recline.Backend.ElasticSearch=this.recline.Backend.ElasticSearch||{},function(e,t){"use strict";t.__type__="elasticsearch";var n=typeof jQuery!="undefined"&&jQuery.Deferred||_.Deferred;t.Wrapper=function(e,t){var n=this;this.endpoint=e,this.options=_.extend({dataType:"json"},t),this.mapping=function(){var e=n.endpoint+"/_mapping",t=r({url:e,dataType:this.options.dataType});return t},this.get=function(e){var t=this.endpoint+"/"+e;return r({url:t,dataType:"json"})},this.upsert=function(e){var t=JSON.stringify(e);return url=this.endpoint,e.id&&(url+="/"+e.id),r({url:url,type:"POST",data:t,dataType:"json"})},this.remove=function(e){return url=this.endpoint,url+="/"+e,r({url:url,type:"DELETE",dataType:"json"})},this._normalizeQuery=function(e){var t=this,n=e&&e.toJSON?e.toJSON():_.extend({},e),r={constant_score:{query:{}}};return n.q?r.constant_score.query={query_string:{query:n.q}}:r.constant_score.query={match_all:{}},n.filters&&n.filters.length&&(r.constant_score.filter={and:[]},_.each(n.filters,function(e){r.constant_score.filter.and.push(t._convertFilter(e))})),r},this._normalizeSort=function(e){var t=_.map(e,function(e){var t={},n=_.clone(e);return delete n.field,t[e.field]=n,t});return t},this._convertFilter=function(e){var t={};return t[e.type]={},e.type==="term"?t.term[e.field]=e.term.toLowerCase():e.type==="geo_distance"&&(t.geo_distance[e.field]=e.point,t.geo_distance.distance=e.distance,t.geo_distance.unit=e.unit),t},this.query=function(e){var t=e&&e.toJSON?e.toJSON():_.extend({},e);t.query=this._normalizeQuery(e),delete t.q,delete t.filters,t.sort&&t.sort.length>0&&(t.sort=this._normalizeSort(t.sort));var n={source:JSON.stringify(t)},i=this.endpoint+"/_search",s=r({url:i,data:n,dataType:this.options.dataType});return s}},t.esOptions={},t.fetch=function(e){var r=new t.Wrapper(e.url,t.esOptions),i=new n;return r.mapping().done(function(e){if(!e){i.reject({message:"Elastic Search did not return a mapping"});return}var t=_.keys(e)[0],n=_.map(e[t].properties,function(e,t){return e.id=t,e});i.resolve({fields:n})}).fail(function(e){i.reject(e)}),i.promise()},t.save=function(e,r){var i=new t.Wrapper(r.url,t.esOptions);if(e.creates.length+e.updates.length+e.deletes.length>1){var s=new n;return msg="Saving more than one item at a time not yet supported",alert(msg),s.reject(msg),s.promise()}if(e.creates.length>0)return i.upsert(e.creates[0]);if(e.updates.length>0)return i.upsert(e.updates[0]);if(e.deletes.length>0)return i.remove(e.deletes[0].id)},t.query=function(e,r){var i=new n,s=new t.Wrapper(r.url,t.esOptions),o=s.query(e);return o.done(function(e){var t={total:e.hits.total};t.hits=_.map(e.hits.hits,function(e){return!("id"in e._source)&&e._id&&(e._source.id=e._id),e._source}),e.facets&&(t.facets=e.facets),i.resolve(t)}).fail(function(e){var t={title:"Failed: "+e.status+" code",message:e.responseText};i.reject(t)}),i.promise()};var r=function(t,n){var r={};n&&(r={beforeSend:function(e){_.each(n,function(t,n){e.setRequestHeader(n,t)})}});var t=_.extend(r,t);return e.ajax(t)}}(jQuery,this.recline.Backend.ElasticSearch),this.recline=this.recline||{},this.recline.Backend=this.recline.Backend||{},this.recline.Backend.GDocs=this.recline.Backend.GDocs||{},function(e){"use strict";e.__type__="gdocs";var t=typeof jQuery!="undefined"&&jQuery.Deferred||_.Deferred;e.fetch=function(n){var r=new t,i=e.getGDocsAPIUrls(n.url);return function(){var e=new t;return jQuery.getJSON(i.spreadsheet,function(t){e.resolve({spreadsheetTitle:t.feed.title.$t})}),e.promise()}().then(function(t){jQuery.getJSON(i.worksheet,function(n){var i=e.parseData(n),s=_.map(i.fields,function(e){return{id:e}});r.resolve({metadata:{title:t.spreadsheetTitle+" :: "+i.worksheetTitle,spreadsheetTitle:t.spreadsheetTitle,worksheetTitle:i.worksheetTitle},records:i.records,fields:s,useMemoryStore:!0})})}),r.promise()},e.parseData=function(e,t){var t=t||{},n=t.colTypes||{},r={fields:[],records:[]},i=e.feed.entry||[],s,o,u=/^([\d\.\-]+)\%$/;for(s in i[0])/^gsx/.test(s)&&(o=s.substr(4),r.fields.push(o));return r.records=_.map(i,function(e){var t={};return _.each(r.fields,function(r){var i="gsx$"+r,s=e[i].$t,o;n[r]==="percent"&&u.test(s)&&(o=u.exec(s)[1],s=parseFloat(o)/100),t[r]=s}),t}),r.worksheetTitle=e.feed.title.$t,r},e.getGDocsAPIUrls=function(e){var t=/.*spreadsheet\/ccc?.*key=([^#?&+]+)[^#]*(#gid=([\d]+).*)?/,n=e.match(t),r,i,s;return n?(r=n[1],i=parseInt(n[3],10)+1,isNaN(i)&&(i=1),s={worksheet:"https://spreadsheets.google.com/feeds/list/"+r+"/"+i+"/public/values?alt=json",spreadsheet:"https://spreadsheets.google.com/feeds/worksheets/"+r+"/public/basic?alt=json"}):(r=e.split("/")[5],i=1,s={worksheet:"https://spreadsheets.google.com/feeds/list/"+r+"/"+i+"/public/values?alt=json",spreadsheet:"https://spreadsheets.google.com/feeds/worksheets/"+r+"/public/basic?alt=json"}),s}}(this.recline.Backend.GDocs),this.recline=this.recline||{},this.recline.Backend=this.recline.Backend||{},this.recline.Backend.Memory=this.recline.Backend.Memory||{},function(e){"use strict";e.__type__="memory";var t=typeof jQuery!="undefined"&&jQuery.Deferred||_.Deferred;e.Store=function(e,n){var r=this;this.records=e,this.data=this.records,n?this.fields=n:e&&(this.fields=_.map(e[0],function(e,t){return{id:t,type:"string"}})),this.update=function(e){_.each(r.records,function(t,n){e.id===t.id&&(r.records[n]=e)})},this.remove=function(e){var t=_.reject(r.records,function(t){return e.id===t.id});this.records=t},this.save=function(e,n){var r=this,i=new t;return _.each(e.updates,function(e){r.update(e)}),_.each(e.deletes,function(e){r.remove(e)}),i.resolve(),i.promise()},this.query=function(e){var n=new t,r=e.size||this.records.length,i=e.from||0,s=this.records;s=recline.Data.Filters.applyFiltersOnData(e.filters,s,this.fields),s=this._applyFreeTextQuery(s,e),_.each(e.sort,function(e){var t=e.field;s=_.sortBy(s,function(e){var n=e[t];return n}),e.order=="desc"&&s.reverse()});var o=recline.Data.Faceting.computeFacets(s,e),u={total:s.length,hits:s.slice(i,i+r),facets:o};return n.resolve(u),n.promise()},this._applyFilters=function(e,t){function u(e){var t=o[e.field].type||"string";return s[t]}function a(e,t){var n=u(t),r=n(e[t.field]),i=n(t.term);return r===i}function f(e,t){var n=t.start===null||t.start==="",r=t.stop===null||t.stop==="",i=u(t),s=i(e[t.field]),o=i(t.start),a=i(t.stop);return(!n||!r)&&s===""?!1:(n||s>=o)&&(r||s<=a)}function l(){}var n=t.filters,i={term:a,range:f,geo_distance:l},s={integer:function(e){return parseFloat(e,10)},"float":function(e){return parseFloat(e,10)},number:function(e){return parseFloat(e,10)},string:function(e){return e.toString()},date:function(e){return moment(e).valueOf()},datetime:function(e){return(new Date(e)).valueOf()}},o={};return _.each(r.fields,function(e){o[e.id]=e}),_.filter(e,function(e){var t=_.map(n,function(t){return i[t.type](e,t)});return _.all(t,_.identity)})},this._applyFreeTextQuery=function(e,t){if(t.q){var n=t.q.split(" "),i=_.map(n,function(e){return new RegExp(e.toLowerCase())});e=_.filter(e,function(e){var t=!0;return _.each(i,function(n){var i=!1;_.each(r.fields,function(t){var r=e[t.id];r!==null&&r!==undefined?r=r.toString():r="",i=i||n.test(r.toLowerCase())}),t=t&&i}),t})}return e},this.computeFacets=function(e,t){var n={};return t.facets?(_.each(t.facets,function(e,t){n[t]=(new recline.Model.Facet({id:t})).toJSON(),n[t].termsall={}}),_.each(e,function(e){_.each(t.facets,function(t,r){var i=t.terms.field,s=e[i],o=n[r];s?o.termsall[s]=o.termsall[s]?o.termsall[s]+1:1:o.missing=o.missing+1})}),_.each(t.facets,function(e,t){var r=n[t],i=_.map(r.termsall,function(e,t){return{term:t,count:e}});r.terms=_.sortBy(i,function(e){return-e.count}),r.terms=r.terms.slice(0,10)}),n):n}}}(this.recline.Backend.Memory),this.recline=this.recline||{},this.recline.Data=this.recline.Data||{},function(e){e.Faceting={},e.Faceting.computeFacets=function(e,t){var n=this,r={};return t.facets?(_.each(t.facets,function(e,t){r[t]=(new recline.Model.Facet({id:t})).toJSON(),r[t].termsall={}}),_.each(e,function(e){_.each(t.facets,function(t,n){var i=t.terms.field,s=e[i],o=r[n];s!=null&&typeof s!="undefined"?o.termsall[s]?(o.termsall[s].records.push(e),o.termsall[s].count=o.termsall[s].count+1):o.termsall[s]={count:1,value:s,records:[e]}:o.missing=o.missing+1})}),n.updateDistinctFieldsForFaceting(t),_.each(t.facets,function(e,t){var i=r[t],s=_.difference(n.distinctFieldsValues[t],_.map(i.termsall,function(e){return e.value}));_.each(s,function(e){i.termsall[e]={count:0,value:e,records:[]}})}),_.each(t.facets,function(e,t){var n=r[t],i=_.map(n.termsall,function(e,t){return{term:e.value,count:e.count,records:e.records}});n.terms=_.sortBy(i,function(e){return-e.count})}),r):r},e.Faceting.updateDistinctFieldsForFaceting=function(e){var t=this;this.distinctFieldsValues==null&&(this.distinctFieldsValues={});var n=[];_.each(e.facets,function(e,r){e.terms.all_terms&&t.distinctFieldsValues[r]==null&&n.push(r)}),n.length>0&&(_.each(n,function(e){t.distinctFieldsValues[e]=[]}),_.each(t.data,function(e){_.each(n,function(n){t.distinctFieldsValues[n].push(e[n])})})),_.each(n,function(e){t.distinctFieldsValues[e]=_.uniq(t.distinctFieldsValues[e])})}}(this.recline.Data),this.recline=this.recline||{},this.recline.Data=this.recline.Data||{},function(e){e.Filters={},e.Filters.applyFiltersOnData=function(e,t,n){return _.filter(t,function(t){var r=_.map(e,function(e){return recline.Data.Filters._isNullFilter[e.type](e)||recline.Data.Filters._filterFunctions[e.type](t,e,n)});return _.all(r,_.identity)})},e.Filters.applyFiltersOnRecords=function(e,t,n){return _.filter(t.models,function(t){var r=_.map(e,function(e){return recline.Data.Filters._isNullFilter[e.type](e)||recline.Data.Filters._filterFunctions[e.type](t.toJSON(),e,n.toJSON())});return _.all(r,_.identity)})},e.Filters.applySelectionsOnRecord=function(e,t,n){_.each(t,function(t){t.setRecordSelection(!1),_.each(e,function(e){!recline.Data.Filters._isNullFilter[e.type](e)&&recline.Data.Filters._filterFunctions[e.type](t.attributes,e,n)&&t.setRecordSelection(!0)})})},e.Filters._getDataParser=function(e,t){var n={},r;t.models?r=t.models:r=t,_.each(r,function(e){n[e.id]=e});var i=n[e.field],s="string";if(i==null)throw"data.filters.js: Warning could not find field "+e.field+" for dataset ";return i.attributes?s=i.attributes.type:i.type&&(s=i.type),recline.Data.Filters._dataParsers[s]},e.Filters._isNullFilter={term:function(e){return e["term"]==null},range:function(e){return e["start"]==null||e["stop"]==null},list:function(e){return e["list"]==null},termAdvanced:function(e){return e["term"]==null}},this._applyFilters=function(e,t){function o(e){var t=s[e.field].type||"string";return i[t]}var n=t.filters,r={term:term,range:range,geo_distance:geo_distance},i={integer:function(e){return parseFloat(e,10)},"float":function(e){return parseFloat(e,10)},string:function(e){return e.toString()},date:function(e){return(new Date(e)).valueOf()},datetime:function(e){return(new Date(e)).valueOf()}},s={};return _.each(self.fields,function(e){s[e.id]=e}),_.filter(e,function(e){var t=_.map(n,function(t){return r[t.type](e,t)});return _.all(t,_.identity)})},e.Filters._filterFunctions={term:function(e,t,n){var r=recline.Data.Filters._getDataParser(t,n),i=r(e[t.field]),s=r(t.term);return i===s},range:function(e,t,n){var r=t.start==null||t.start==="",i=t.stop==null||t.stop==="",s=recline.Data.Filters._getDataParser(t,n),o=s(e[t.field]),u=s(t.start),a=s(t.stop);return(!r||!i)&&o===""?!1:(r||o>=u)&&(i||o<=a)},list:function(e,t,n){var r=recline.Data.Filters._getDataParser(t,n),i=r(e[t.field]),s=t.list;return _.each(s,function(e,t){s[t]=r(e)}),_.contains(s,i)},termAdvanced:function(e,t,n){var r=recline.Data.Filters._getDataParser(t,n),i=r(e[t.field]),s=r(t.term),o=t.operator,u={ne:function(e,t){return e!==t},eq:function(e,t){return e===t},lt:function(e,t){return e<t},lte:function(e,t){return e<=t},gt:function(e,t){return e>t},gte:function(e,t){return e>=t},bw:function(e,t){return _.contains(t,e)},like:function(e,t){return e.indexOf(t)>=0},rlike:function(e,t){return e.indexOf(t)==0},llike:function(e,t){return e.indexOf(t)>0}};return u[o](i,s)}},e.Filters._dataParsers={integer:function(e){return parseFloat(e,10)},"float":function(e){return parseFloat(e,10)},string:function(e){return e?e.toString():null},date:function(e){return(new Date(e)).valueOf()},datetime:function(e){return(new Date(e)).valueOf()},number:function(e){return parseFloat(e,10)}}}(this.recline.Data),this.recline=this.recline||{},this.recline.Data=this.recline.Data||{},function(my){my.Transform={},my.Transform.evalFunction=function(funcString){try{eval("var editFunc = "+funcString)}catch(e){return{errorMessage:e+""}}return editFunc},my.Transform.previewTransform=function(e,t,n){var r=[],i=my.Transform.mapDocs($.extend(!0,{},e),t);for(var s=0;s<i.docs.length;s++){var o=e[s],u=i.docs[s];u||(u={}),n?r.push({before:o[n],after:u[n]}):r.push({before:o,after:u})}return r},my.Transform.mapDocs=function(e,t){var n=[],r=[],i=[],s=_.map(e,function(e){try{var s=t(_.clone(e))}catch(o){i.push(e);return}return s===null?(s={_deleted:!0},n.push(s),r.push(e)):s&&!_.isEqual(s,e)&&n.push(s),s});return{updates:n,docs:s,deletes:r,failed:i}},my.Transform.getFieldHash=function(e){return e?isNaN(e)?recline.Data.Transform.hashCode(e):Number(e):"0"},my.Transform.hashCode=function(e){var t=0,n,r;if(e.length==0)return t;for(n=0;n<e.length;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t&=t;return t}}(this.recline.Data),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(e,t){t===undefined&&(t=0),t<0&&(t+=this.length),t<0&&(t=0);for(var n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1}),"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(e,t){t===undefined&&(t=this.length-1),t<0&&(t+=this.length),t>this.length-1&&(t=this.length-1);for(t++;t-->0;)if(t in this&&this[t]===e)return t;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;n<r;n++)n in this&&e.call(t,this[n],n,this)}),"map"in Array.prototype||(Array.prototype.map=function(e,t){var n=new Array(this.length);for(var r=0,i=this.length;r<i;r++)r in this&&(n[r]=e.call(t,this[r],r,this));return n}),"filter"in Array.prototype||(Array.prototype.filter=function(e,t){var n=[],r;for(var i=0,s=this.length;i<s;i++)i in this&&e.call(t,r=this[i],i,this)&&n.push(r);return n}),"every"in Array.prototype||(Array.prototype.every=function(e,t){for(var n=0,r=this.length;n<r;n++)if(n in this&&!e.call(t,this[n],n,this))return!1;return!0}),"some"in Array.prototype||(Array.prototype.some=function(e,t){for(var n=0,r=this.length;n<r;n++)if(n in this&&e.call(t,this[n],n,this))return!0;return!1}),this.recline=this.recline||{},this.recline.Model=this.recline.Model||{},function(e){"use strict";var t=typeof jQuery!="undefined"&&jQuery.Deferred||_.Deferred;e.Dataset=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){var t=this;_.bindAll(this,"query"),this.backend=null,this.get("backend")?this.backend=this._backendFromString(this.get("backend")):this.get("records")&&(this.backend=recline.Backend.Memory),this.fields=new e.FieldList,this.records=new e.RecordList,this._changes={deletes:[],updates:[],creates:[]},this.facets=new e.FacetList,this.recordCount=null,this.queryState=new e.Query,this.queryState.bind("change facet:add",function(){t.query()});var t=this;t.records.bind("add",function(e){t._changes.creates.push(e.toJSON()),t.recordCount=t.records.models.length}),this._store=this.backend,this.backend==recline.Backend.Memory&&this.fetch()},fetch:function(){function r(t){var r=e.get("fields")||t.fields,i=e._normalizeRecordsAndFields(t.records,r);t.useMemoryStore&&(e._store=new recline.Backend.Memory.Store(i.records,i.fields)),e.set(t.metadata),e.fields.reset(i.fields),e.attributes.renderer&&_.each(e.fields.models,function(t){t.renderer=e.attributes.renderer}),e.query().done(function(){n.resolve(e)}).fail(function(e){n.reject(e)})}var e=this,n=new t;return this.backend!==recline.Backend.Memory?this.backend.fetch(this.toJSON()).done(r).fail(function(e){n.reject(e)}):r({records:this.get("records"),fields:this.get("fields"),useMemoryStore:!0}),n.promise()},_normalizeRecordsAndFields:function(e,t){!t&&e&&e.length>0&&(e[0]instanceof Array?(t=e[0],e=e.slice(1)):t=_.map(_.keys(e[0]),function(e){return{id:e}}));if(t&&t.length>0&&(t[0]===null||typeof t[0]!="object")){var n={};t=_.map(t,function(e,t){e===null?e="":e=e.toString();var r=e.replace(/^\s+|\s+$/g,"");r===""&&(r="_noname_",e=r);while(r in n)n[e]+=1,r=e+n[e];return e in n||(n[e]=0),{id:r}})}return e&&e.length>0&&e[0]instanceof Array&&(e=_.map(e,function(e){var n={};return _.each(t,function(t,r){n[t.id]=e[r]}),n})),{fields:t,records:e}},save:function(){var e=this;return this._store.save(this._changes,this.toJSON())},query:function(e){var n=this,r=new t;this.trigger("query:start"),e&&this.queryState.set(e,{silent:!0});var i=this.queryState.toJSON();return this._store.query(i,this.toJSON()).done(function(e){n._handleQueryResult(e),n.trigger("query:done"),r.resolve(n.records)}).fail(function(e){n.trigger("query:fail",e),r.reject(e)}),r.promise()},_handleQueryResult:function(t){var n=this;n.recordCount=t.total;var r=_.map(t.hits,function(t){var r=new e.Record(t);return r.fields=n.fields,r.bind("change",function(e){n._changes.updates.push(e.toJSON())}),r.bind("destroy",function(e){n._changes.deletes.push(e.toJSON())}),r});n.records.reset(r);if(t.facets){var i=_.map(t.facets,function(t,n){return t.id=n,new e.Facet(t)});n.facets.reset(i)}},toTemplateJSON:function(){var e=this.toJSON();return e.recordCount=this.recordCount,e.fields=this.fields.toJSON(),e},getFieldsSummary:function(){var n=this,r=new e.Query;r.set({size:0}),this.fields.each(function(e){r.addFacet(e.id)});var i=new t;return this._store.query(r.toJSON(),this.toJSON()).done(function(t){t.facets&&_.each(t.facets,function(t,r){t.id=r;var i=new e.Facet(t);n.fields.get(r).facets.reset(i)}),i.resolve(t)}),i.promise()},recordSummary:function(e){return e.summary()},_backendFromString:function(e){var t=null;return recline&&recline.Backend&&_.each(_.keys(recline.Backend),function(n){n.toLowerCase()===e.toLowerCase()&&(t=recline.Backend[n])}),t}}),e.Record=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){_.bindAll(this,"getFieldValue")},getFieldValue:function(e){var t=this.getFieldValueUnrendered(e);return e&&!_.isUndefined(e.renderer)&&(t=e.renderer(t,e,this.toJSON())),t},getFieldValueUnrendered:function(e){if(!e)return"";var t=this.get(e.id);return e.deriver&&(t=e.deriver(t,e,this)),t},summary:function(e){var t=this,n='<div class="recline-record-summary">';return this.fields.each(function(e){e.id!="id"&&(n+='<div class="'+e.id+'"><strong>'+e.get("label")+"</strong>: "+t.getFieldValue(e)+"</div>")}),n+="</div>",n},fetch:function(){},save:function(){},destroy:function(){this.trigger("destroy",this)}}),e.RecordList=Backbone.Collection.extend({constructor:function(){Backbone.Collection.prototype.constructor.apply(this,arguments)},model:e.Record}),e.Field=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},defaults:{label:null,type:"string",format:null,is_derived:!1},initialize:function(t,n){if("0"in t)throw new Error("Looks like you did not pass a proper hash with id to Field constructor");this.attributes.label===null&&this.set({label:this.id}),this.attributes.type.toLowerCase()in this._typeMap&&(this.attributes.type=this._typeMap[this.attributes.type.toLowerCase()]),n&&(this.renderer=n.renderer,this.deriver=n.deriver),this.renderer||(this.renderer=this.defaultRenderers[this.get("type")]),this.facets=new e.FacetList},_typeMap:{text:"string","double":"number","float":"number",numeric:"number","int":"integer",datetime:"date-time",bool:"boolean",timestamp:"date-time",json:"object"},defaultRenderers:{object:function(e,t,n){return JSON.stringify(e)},geo_point:function(e,t,n){return JSON.stringify(e)},number:function(e,t,n){var r=t.get("format");return r==="percentage"?e+"%":e},string:function(e,t,n){var r=t.get("format");if(r==="markdown"){if(typeof Showdown!="undefined"){var i=new Showdown.converter;return out=i.makeHtml(e),out}return e}return r=="plain"?e:(e&&typeof e=="string"&&(e=e.replace(/(https?:\/\/[^ ]+)/g,'<a href="$1">$1</a>')),e)}}}),e.FieldList=Backbone.Collection.extend({constructor:function(){Backbone.Collection.prototype.constructor.apply(this,arguments)},model:e.Field}),e.Query=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},defaults:function(){return{size:100,from:0,q:"",facets:{},filters:[]}},_filterTemplates:{term:{type:"term",field:"",term:""},range:{type:"range",start:"",stop:""},geo_distance:{type:"geo_distance",distance:10,unit:"km",point:{lon:0,lat:0}}},addFilter:function(e){var t=JSON.parse(JSON.stringify(e));_.keys(e).length<=3&&(t=_.defaults(t,this._filterTemplates[e.type]));var n=this.get("filters");n.push(t),this.trigger("change:filters:new-blank")},updateFilter:function(e,t){},removeFilter:function(e){var t=this.get("filters");t.splice(e,1),this.set({filters:t}),this.trigger("change")},addFacet:function(e){var t=this.get("facets");if(_.contains(_.keys(t),e))return;t[e]={terms:{field:e}},this.set({facets:t},{silent:!0}),this.trigger("facet:add",this)},addHistogramFacet:function(e){var t=this.get("facets");t[e]={date_histogram:{field:e,interval:"day"}},this.set({facets:t},{silent:!0}),this.trigger("facet:add",this)}}),e.Facet=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},defaults:function(){return{_type:"terms",total:0,other:0,missing:0,terms:[]}}}),e.FacetList=Backbone.Collection.extend({constructor:function(){Backbone.Collection.prototype.constructor.apply(this,arguments)},model:e.Facet}),e.ObjectState=Backbone.Model.extend({}),Backbone.sync=function(e,t,n){return t.backend.sync(e,t,n)}}(this.recline.Model),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";t.Flot=Backbone.View.extend({template:'     <div class="recline-flot">       <div class="panel graph" style="display: block;">         <div class="js-temp-notice alert alert-block">           <h3 class="alert-heading">Hey there!</h3>           <p>There\'s no graph here yet because we don\'t know what fields you\'d like to see plotted.</p>           <p>Please tell us by <strong>using the menu on the right</strong> and a graph will automatically appear.</p>         </div>       </div>     </div> ',initialize:function(e){var n=this;this.graphColors=["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],_.bindAll(this,"render","redraw","_toolTip","_xaxisLabel"),this.needToRedraw=!1,this.listenTo(this.model,"change",this.render),this.listenTo(this.model.fields,"reset add",this.render),this.listenTo(this.model.records,"reset add",this.redraw);var r=_.extend({group:null,series:[],graphType:"lines-and-points"},e.state);this.state=new recline.Model.ObjectState(r),this.previousTooltipPoint={x:null,y:null},this.editor=new t.FlotControls({model:this.model,state:this.state.toJSON()}),this.listenTo(this.editor.state,"change",function(){n.state.set(n.editor.state.toJSON()),n.redraw()}),this.elSidebar=this.editor.$el},render:function(){var e=this,t=this.model.toTemplateJSON(),n=Mustache.render(this.template,t);return this.$el.html(n),this.$graph=this.$el.find(".panel.graph"),this.$graph.on("plothover",this._toolTip),this},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.apply(this,arguments)},redraw:function(){var t=!jQuery.expr.filters.hidden(this.el);if(!t||this.model.records.length===0){this.needToRedraw=!0;return}if(this.state.get("group")&&this.state.get("series")){var n=this.createSeries(),r=this.getGraphOptions(this.state.attributes.graphType,n[0].data.length);this.plot=e.plot(this.$graph,n,r)}},show:function(){this.needToRedraw&&this.redraw()},_toolTip:function(t,n,r){if(r){if(this.previousTooltipPoint.x!==r.dataIndex||this.previousTooltipPoint.y!==r.seriesIndex){this.previousTooltipPoint.x=r.dataIndex,this.previousTooltipPoint.y=r.seriesIndex,e("#recline-flot-tooltip").remove();var i=r.datapoint[0].toFixed(2),s=r.datapoint[1].toFixed(2);this.state.attributes.graphType==="bars"&&(i=r.datapoint[1].toFixed(2),s=r.datapoint[0].toFixed(2));var o=_.template("<%= group %> = <%= x %>, <%= series %> = <%= y %>",{group:this.state.attributes.group,x:this._xaxisLabel(i),series:r.series.label,y:s}),u,a;this.state.attributes.graphType==="bars"?(u=r.pageX+15,a=r.pageY-10):this.state.attributes.graphType==="columns"?(u=r.pageX+15,a=r.pageY):(u=r.pageX+10,a=r.pageY-20),e('<div id="recline-flot-tooltip">'+o+"</div>").css({top:a,left:u}).appendTo("body").fadeIn(200)}}else e("#recline-flot-tooltip").remove(),this.previousTooltipPoint.x=null,this.previousTooltipPoint.y=null},_xaxisLabel:function(e){return this._groupFieldIsDateTime()?e=(new Date(parseFloat(e))).toLocaleDateString():this.xvaluesAreIndex&&(e=parseInt(e,10),e=this.model.records.models[e].get(this.state.attributes.group)),e},getGraphOptions:function(e,t){var n=this,r=n._groupFieldIsDateTime(),i={};r||(i.tickFormatter=function(e){var t=n._xaxisLabel(e)||"";return typeof t!="string"&&(t=t.toString()),n.state.attributes.graphType!=="bars"&&t.length>10&&(t=t.slice(0,10)+"..."),t});if(this.xvaluesAreIndex){var s=Math.min(this.model.records.length,15),o=this.model.records.length/s,u=[];for(var a=0;a<s;a++)u.push(parseInt(a*o,10));i.ticks=u}else r&&(i.mode="time");var f={};f.autoscale=!0,f.autoscaleMargin=.02;var l={};l.position="ne";var c={};c.hoverable=!0,c.clickable=!0,c.borderColor="#aaaaaa",c.borderWidth=1;var h={lines:{legend:l,colors:this.graphColors,lines:{show:!0},xaxis:i,yaxis:f,grid:c},points:{legend:l,colors:this.graphColors,points:{show:!0,hitRadius:5},xaxis:i,yaxis:f,grid:c},"lines-and-points":{legend:l,colors:this.graphColors,points:{show:!0,hitRadius:5},lines:{show:!0},xaxis:i,yaxis:f,grid:c},bars:{legend:l,colors:this.graphColors,lines:{show:!1},xaxis:f,yaxis:i,grid:c,bars:{show:!0,horizontal:!0,shadowSize:0,align:"center",barWidth:.8}},columns:{legend:l,colors:this.graphColors,lines:{show:!1},xaxis:i,yaxis:f,grid:c,bars:{show:!0,horizontal:!1,shadowSize:0,align:"center",barWidth:.8}}};return n.state.get("graphOptions")?_.extend(h[e],n.state.get("graphOptions")):h[e]},_groupFieldIsDateTime:function(){var e=this.model.fields.get(this.state.attributes.group),t=e.get("type"),n=t==="date"||t==="date-time"||t==="time";return n},createSeries:function(){var e=this;e.xvaluesAreIndex=!1;var t=[],n=e.model.fields.get(e.state.attributes.group),r=e._groupFieldIsDateTime();return _.each(this.state.attributes.series,function(i){var s=[],o=e.model.fields.get(i).get("label");_.each(e.model.records.models,function(t,o){var u=t.getFieldValue(n);if(r){var a=moment(String(u));a.isValid()&&(u=a.toDate().getTime())}else typeof u=="string"&&(u=parseFloat(u),isNaN(u)&&(u=o,e.xvaluesAreIndex=!0));var f=e.model.fields.get(i),l=t.getFieldValue(f);e.state.attributes.graphType=="bars"?s.push([l,u]):s.push([u,l])}),t.push({data:s,label:o,hoverable:!0})}),t}}),t.FlotControls=Backbone.View.extend({className:"editor",template:'   <div class="editor">     <form class="form-stacked">       <div class="clearfix">         <label>Graph Type</label>         <div class="input editor-type">           <select>           <option value="lines-and-points">Lines and Points</option>           <option value="lines">Lines</option>           <option value="points">Points</option>           <option value="bars">Bars</option>           <option value="columns">Columns</option>           </select>         </div>         <label>Group Column (Axis 1)</label>         <div class="input editor-group">           <select>           <option value="">Please choose ...</option>           {{#fields}}           <option value="{{id}}">{{label}}</option>           {{/fields}}           </select>         </div>         <div class="editor-series-group">         </div>       </div>       <div class="editor-buttons">         <button class="btn editor-add">Add Series</button>       </div>       <div class="editor-buttons editor-submit" comment="hidden temporarily" style="display: none;">         <button class="editor-save">Save</button>         <input type="hidden" class="editor-id" value="chart-1" />       </div>     </form>   </div> ',templateSeriesEditor:'     <div class="editor-series js-series-{{seriesIndex}}">       <label>Series <span>{{seriesName}} (Axis 2)</span>         [<a href="#remove" class="action-remove-series">Remove</a>]       </label>       <div class="input">         <select>         {{#fields}}         <option value="{{id}}">{{label}}</option>         {{/fields}}         </select>       </div>     </div>   ',events:{"change form select":"onEditorSubmit","click .editor-add":"_onAddSeries","click .action-remove-series":"removeSeries"},initialize:function(e){var t=this;_.bindAll(this,"render"),this.listenTo(this.model.fields,"reset add",this.render),this.state=new recline.Model.ObjectState(e.state),this.render()},render:function(){var e=this,t=this.model.toTemplateJSON(),n=Mustache.render(this.template,t);this.$el.html(n),this.state.get("graphType")&&this._selectOption(".editor-type",this.state.get("graphType")),this.state.get("group")&&this._selectOption(".editor-group",this.state.get("group"));var r=[""];return this.state.get("series").length>0&&(r=this.state.get("series")),_.each(r,function(t,n){e.addSeries(n),e._selectOption(".editor-series.js-series-"+n,t)}),this},_selectOption:function(t,n){var r=this.$el.find(t+" select > option");r&&r.each(function(t){if(this.value==n)return e(this).attr("selected","selected"),!1})},onEditorSubmit:function(t){var n=this.$el.find(".editor-group select"),r=this,i=this.$el.find(".editor-series select"),s=i.map(function(){return e(this).val()}),o={series:e.makeArray(s),group:this.$el.find(".editor-group select").val(),graphType:this.$el.find(".editor-type select").val()};this.state.set(o)},addSeries:function(e){var t=_.extend({seriesIndex:e,seriesName:String.fromCharCode(e+64+1)},this.model.toTemplateJSON()),n=Mustache.render(this.templateSeriesEditor,t);return this.$el.find(".editor-series-group").append(n),this},_onAddSeries:function(e){e.preventDefault(),this.addSeries(this.state.get("series").length)},removeSeries:function(t){t.preventDefault();var n=e(t.target);n.parent().parent().remove(),this.onEditorSubmit()}})}(jQuery,recline.View),this.recline=this.recline||{},this.recline.View=this.recline.View||{},this.recline.View.Graph=this.recline.View.Flot,this.recline.View.GraphControls=this.recline.View.FlotControls,this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";t.Grid=Backbone.View.extend({tagName:"div",className:"recline-grid-container",initialize:function(e){var t=this;_.bindAll(this,"render","onHorizontalScroll"),this.listenTo(this.model.records,"add reset remove",this.render),this.tempState={};var n=_.extend({hiddenFields:[]},e.state);this.state=new recline.Model.ObjectState(n)},events:{},setColumnSort:function(e){var t=[{}];t[0][this.tempState.currentColumn]={order:e},this.model.query({sort:t})},hideColumn:function(){var e=this.state.get("hiddenFields");e.push(this.tempState.currentColumn),this.state.set({hiddenFields:e}),this.state.trigger("change"),this.render()},showColumn:function(t){var n=_.without(this.state.get("hiddenFields"),e(t.target).data("column"));this.state.set({hiddenFields:n}),this.render()},onHorizontalScroll:function(t){var n=e(t.target).scrollLeft();this.$el.find(".recline-grid thead tr").scrollLeft(n)},template:'     <div class="table-container">     <table class="recline-grid table-striped table-condensed" cellspacing="0">       <thead class="fixed-header">         <tr>           {{#fields}}             <th class="column-header {{#hidden}}hidden{{/hidden}}" data-field="{{id}}" style="width: {{width}}px; max-width: {{width}}px; min-width: {{width}}px;" title="{{label}}">               <span class="column-header-name">{{label}}</span>             </th>           {{/fields}}           <th class="last-header" style="width: {{lastHeaderWidth}}px; max-width: {{lastHeaderWidth}}px; min-width: {{lastHeaderWidth}}px; padding: 0; margin: 0;"></th>         </tr>       </thead>       <tbody class="scroll-content"></tbody>     </table>     </div>   ',toTemplateJSON:function(){var e=this,t=this.model.toJSON();return t.notEmpty=this.fields.length>0,t.fields=this.fields.map(function(e){return e.toJSON()}),t.lastHeaderWidth=this.scrollbarDimensions.width-2,t},render:function(){var n=this;this.fields=new recline.Model.FieldList(this.model.fields.filter(function(e){return _.indexOf(n.state.get("hiddenFields"),e.id)==-1})),this.scrollbarDimensions=this.scrollbarDimensions||this._scrollbarSize();var r=this.fields.length,i=n.$el.width()-20-10*r-this.scrollbarDimensions.width,s=parseInt(Math.max(50,i/r),10),o=Math.max(i-r*s,0);this.fields.each(function(e,t){t===0?e.set({width:s+o}):e.set({width:s})});var u=Mustache.render(this.template,this.toTemplateJSON());this.$el.html(u),this.model.records.forEach(function(r){var i=e("<tr />");n.$el.find("tbody").append(i);var s=new t.GridRow({model:r,el:i,fields:n.fields});s.render()});var a=this.$el.find("tbody")[0];return a.scrollHeight<=a.offsetHeight&&this.$el.find("th.last-header").hide(),this.$el.find(".recline-grid").toggleClass("no-hidden",n.state.get("hiddenFields").length===0),this.$el.find(".recline-grid tbody").scroll(this.onHorizontalScroll),this},_scrollbarSize:function(){var t=e("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body"),n={width:t.width()-t[0].clientWidth+1,height:t.height()-t[0].clientHeight};return t.remove(),n}}),t.GridRow=Backbone.View.extend({initialize:function(e){_.bindAll(this,"render"),this._fields=e.fields,this.listenTo(this.model,"change",this.render)},template:'       {{#cells}}       <td data-field="{{field}}" style="width: {{width}}px; max-width: {{width}}px; min-width: {{width}}px;">         <div class="data-table-cell-content">           <a href="javascript:{}" class="data-table-cell-edit" title="Edit this cell">&nbsp;</a>           <div class="data-table-cell-value">{{{value}}}</div>         </div>       </td>       {{/cells}}     ',events:{"click .data-table-cell-edit":"onEditClick","click .data-table-cell-editor .okButton":"onEditorOK","click .data-table-cell-editor .cancelButton":"onEditorCancel"},toTemplateJSON:function(){var e=this,t=this.model,n=this._fields.map(function(e){return{field:e.id,width:e.get("width"),value:t.getFieldValue(e)}});return{id:this.id,cells:n}},render:function(){this.$el.attr("data-id",this.model.id);var e=Mustache.render(this.template,this.toTemplateJSON());return this.$el.html(e),this},cellEditorTemplate:'     <div class="menu-container data-table-cell-editor">       <textarea class="data-table-cell-editor-editor" bind="textarea">{{value}}</textarea>       <div id="data-table-cell-editor-actions">         <div class="data-table-cell-editor-action">           <button class="okButton btn primary">Update</button>           <button class="cancelButton btn danger">Cancel</button>         </div>       </div>     </div>   ',onEditClick:function(t){var n=this.$el.find(".data-table-cell-editor-editor");n.length>0&&n.parents(".data-table-cell-value").html(n.text()).siblings(".data-table-cell-edit").removeClass("hidden"),e(t.target).addClass("hidden");var r=e(t.target).siblings(".data-table-cell-value");r.data("previousContents",r.text());var i=Mustache.render(this.cellEditorTemplate,{value:r.text()});r.html(i)},onEditorOK:function(t){var n=this,r=e(t.target),i=r.parents("tr").attr("data-id"),s=r.parents("td").attr("data-field"),o=r.parents(".data-table-cell-editor").find(".data-table-cell-editor-editor").val(),u={};u[s]=o,this.model.set(u),this.trigger("recline:flash",{message:"Updating row...",loader:!0}),this.model.save().then(function(e){this.trigger("recline:flash",{message:"Row updated successfully",category:"success"})}).fail(function(){this.trigger("recline:flash",{message:"Error saving row",category:"error",persist:!0})})},onEditorCancel:function(t){var n=e(t.target).parents(".data-table-cell-value");n.html(n.data("previousContents")).siblings(".data-table-cell-edit").removeClass("hidden")}})}(jQuery,recline.View),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";t.Map=Backbone.View.extend({template:'     <div class="recline-map">       <div class="panel map"></div>     </div> ',latitudeFieldNames:["lat","latitude"],longitudeFieldNames:["lon","longitude"],geometryFieldNames:["geojson","geom","the_geom","geometry","spatial","location","geo","lonlat"],initialize:function(e){var n=this;this.visible=!0,this.mapReady=!1,this.map=null,this.uid=e.id||""+(new Date).getTime()+Math.floor(Math.random()*1e4);var r=_.extend({geomField:null,lonField:null,latField:null,autoZoom:!0,cluster:!1},e.state);this.state=new recline.Model.ObjectState(r),this._clusterOptions={zoomToBoundsOnClick:!0,maxClusterRadius:80,singleMarkerMode:!1,skipDuplicateAddTesting:!0,animateAddingMarkers:!1},this.listenTo(this.model.fields,"change",function(){n._setupGeometryField(),n.render()}),this.listenTo(this.model.records,"add",function(e){n.redraw("add",e)}),this.listenTo(this.model.records,"change",function(e){n.redraw("remove",e),n.redraw("add",e)}),this.listenTo(this.model.records,"remove",function(e){n.redraw("remove",e)}),this.listenTo(this.model.records,"reset",function(){n.redraw("reset")}),this.menu=new t.MapMenu({model:this.model,state:this.state.toJSON()}),this.listenTo(this.menu.state,"change",function(){n.state.set(n.menu.state.toJSON()),n.redraw()}),this.listenTo(this.state,"change",function(){n.redraw()}),this.elSidebar=this.menu.$el},infobox:function(e){var t="";for(var n in e.attributes)if(!this.state.get("geomField")||n!=this.state.get("geomField"))t+="<div><strong>"+n+"</strong>: "+e.attributes[n]+"</div>";return t},geoJsonLayerOptions:{pointToLayer:function(e,t){var n=new L.Marker(t);return n.bindPopup(e.properties.popupContent),this.markers.addLayer(n),n},onEachFeature:function(e,t){e.properties&&e.properties.popupContent&&t.bindPopup(e.properties.popupContent)}},render:function(){var e=this,t=Mustache.render(this.template,this.model.toTemplateJSON());return this.$el.html(t),this.$map=this.$el.find(".panel.map"),this.redraw(),this},redraw:function(e,t){var n=this;e=e||"refresh",n._geomReady()||n._setupGeometryField(),n.mapReady||n._setupMap();if(this._geomReady()&&this.mapReady){this.map.removeLayer(this.features),this.map.removeLayer(this.markers);var r=0;this.features.eachLayer(function(){r++}),e=="refresh"||e=="reset"?(this.features.clearLayers(),this.map.removeLayer(this.markers),this.markers=new L.MarkerClusterGroup(this._clusterOptions),this._add(this.model.records.models)):e=="add"&&t?this._add(t):e=="remove"&&t&&this._remove(t);var i=0;this.features.eachLayer(function(){i++});var s=i-r>0;if(!this.state.get("cluster")&&i>64&&s){this.state.set({cluster:!0});return}this.state.get("cluster")?this.map.addLayer(this.markers):this.map.addLayer(this.features),this.state.get("autoZoom")&&(this.visible?this._zoomToFeatures():this._zoomPending=!0)}},show:function(){this.map&&(this.map.invalidateSize(),this._zoomPending&&this.state.get("autoZoom")&&(this._zoomToFeatures(),this._zoomPending=!1)),this.visible=!0},hide:function(){this.visible=!1},_geomReady:function(){return Boolean(this.state.get("geomField")||this.state.get("latField")&&this.state.get("lonField"))},_add:function(e){var t=this;e instanceof Array||(e=[e]);var n=0,r=0;_.every(e,function(e){n+=1;var i=t._getGeometryFromRecord(e);if(typeof i=="undefined"||i===null)return!0;if(i instanceof Object){i.properties={popupContent:t.infobox(e),cid:e.cid};try{t.features.addData(i)}catch(s){r+=1;var o="Wrong geometry value";s.message&&(o+=" ("+s.message+")"),r<=10&&t.trigger("recline:flash",{message:o,category:"error"})}}else r+=1,r<=10&&t.trigger("recline:flash",{message:"Wrong geometry value",category:"error"});return!0})},_remove:function(e){var t=this;e instanceof Array||(e=[e]),_.each(e,function(e){for(var n in t.features._layers)t.features._layers[n].feature.properties.cid==e.cid&&t.features.removeLayer(t.features._layers[n])})},_getGeometryFromRecord:function(t){if(this.state.get("geomField")){var n=t.get(this.state.get("geomField"));if(typeof n=="string")try{n=e.parseJSON(n)}catch(r){}if(typeof n=="string"){n=n.replace("(","").replace(")","");var i=n.split(","),s=parseFloat(i[0]),o=parseFloat(i[1]);return!isNaN(o)&&!isNaN(parseFloat(s))?{type:"Point",coordinates:[o,s]}:null}return n&&_.isArray(n)?{type:"Point",coordinates:[n[0],n[1]]}:n&&n.lat?{type:"Point",coordinates:[n.lon||n.lng,n.lat]}:n}if(this.state.get("lonField")&&this.state.get("latField")){var o=t.get(this.state.get("lonField")),s=t.get(this.state.get("latField"));if(!isNaN(parseFloat(o))&&!isNaN(parseFloat(s)))return{type:"Point",coordinates:[o,s]}}return null},_setupGeometryField:function(){this._geomReady()||(this.state.set({geomField:this._checkField(this.geometryFieldNames),latField:this._checkField(this.latitudeFieldNames),lonField:this._checkField(this.longitudeFieldNames)}),this.menu.state.set(this.state.toJSON()))},_checkField:function(e){var t,n=this.model.fields.pluck("id");for(var r=0;r<e.length;r++)for(var i=0;i<n.length;i++)if(n[i].toLowerCase()==e[r].toLowerCase())return n[i];return null},_zoomToFeatures:function(){var e=this.features.getBounds();e&&e.getNorthEast()&&e.getSouthWest()?this.map.fitBounds(e):this.map.setView([0,0],2)},_setupMap:function(){var e=this;this.map=new L.Map(this.$map.get(0));var t="http://otile{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",n='Map data &copy; 2011 OpenStreetMap contributors, Tiles Courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">',r=new L.TileLayer(t,{maxZoom:18,attribution:n,subdomains:"1234"});this.map.addLayer(r),this.markers=new L.MarkerClusterGroup(this._clusterOptions),this.geoJsonLayerOptions.pointToLayer=_.bind(this.geoJsonLayerOptions.pointToLayer,this),this.features=new L.GeoJSON(null,this.geoJsonLayerOptions),this.map.setView([0,0],2),this.mapReady=!0},_selectOption:function(t,n){var r=e("."+t+" > select > option");r&&r.each(function(t){if(this.value==n)return e(this).attr("selected","selected"),!1})}}),t.MapMenu=Backbone.View.extend({className:"editor",template:'     <form class="form-stacked">       <div class="clearfix">         <div class="editor-field-type">             <label class="radio">               <input type="radio" id="editor-field-type-latlon" name="editor-field-type" value="latlon" checked="checked"/>               Latitude / Longitude fields</label>             <label class="radio">               <input type="radio" id="editor-field-type-geom" name="editor-field-type" value="geom" />               GeoJSON field</label>         </div>         <div class="editor-field-type-latlon">           <label>Latitude field</label>           <div class="input editor-lat-field">             <select>             <option value=""></option>             {{#fields}}             <option value="{{id}}">{{label}}</option>             {{/fields}}             </select>           </div>           <label>Longitude field</label>           <div class="input editor-lon-field">             <select>             <option value=""></option>             {{#fields}}             <option value="{{id}}">{{label}}</option>             {{/fields}}             </select>           </div>         </div>         <div class="editor-field-type-geom" style="display:none">           <label>Geometry field (GeoJSON)</label>           <div class="input editor-geom-field">             <select>             <option value=""></option>             {{#fields}}             <option value="{{id}}">{{label}}</option>             {{/fields}}             </select>           </div>         </div>       </div>       <div class="editor-buttons">         <button class="btn editor-update-map">Update</button>       </div>       <div class="editor-options" >         <label class="checkbox">           <input type="checkbox" id="editor-auto-zoom" value="autozoom" checked="checked" />           Auto zoom to features</label>         <label class="checkbox">           <input type="checkbox" id="editor-cluster" value="cluster"/>           Cluster markers</label>       </div>       <input type="hidden" class="editor-id" value="map-1" />     </form>   ',events:{"click .editor-update-map":"onEditorSubmit","change .editor-field-type":"onFieldTypeChange","click #editor-auto-zoom":"onAutoZoomChange","click #editor-cluster":"onClusteringChange"},initialize:function(e){var t=this;_.bindAll(this,"render"),this.listenTo(this.model.fields,"change",this.render),this.state=new recline.Model.ObjectState(e.state),this.listenTo(this.state,"change",this.render),this.render()},render:function(){var e=this,t=Mustache.render(this.template,this.model.toTemplateJSON());return this.$el.html(t),this._geomReady()&&this.model.fields.length&&(this.state.get("geomField")?(this._selectOption("editor-geom-field",this.state.get("geomField")),this.$el.find("#editor-field-type-geom").attr("checked","checked").change()):(this._selectOption("editor-lon-field",this.state.get("lonField")),this._selectOption("editor-lat-field",this.state.get("latField")),this.$el.find("#editor-field-type-latlon").attr("checked","checked").change())),this.state.get("autoZoom")?this.$el.find("#editor-auto-zoom").attr("checked","checked"):this.$el.find("#editor-auto-zoom").removeAttr("checked"),this.state.get("cluster")?this.$el.find("#editor-cluster").attr("checked","checked"):this.$el.find("#editor-cluster").removeAttr("checked"),this},_geomReady:function(){return Boolean(this.state.get("geomField")||this.state.get("latField")&&this.state.get("lonField"))},onEditorSubmit:function(e){return e.preventDefault(),this.$el.find("#editor-field-type-geom").attr("checked")?this.state.set({geomField:this.$el.find(".editor-geom-field > select > option:selected").val(),lonField:null,latField:null}):this.state.set({geomField:null,lonField:this.$el.find(".editor-lon-field > select > option:selected").val(),latField:this.$el.find(".editor-lat-field > select > option:selected").val()}),!1},onFieldTypeChange:function(e){e.target.value=="geom"?(this.$el.find(".editor-field-type-geom").show(),this.$el.find(".editor-field-type-latlon").hide()):(this.$el.find(".editor-field-type-geom").hide(),this.$el.find(".editor-field-type-latlon").show())},onAutoZoomChange:function(e){this.state.set({autoZoom:!this.state.get("autoZoom")})},onClusteringChange:function(e){this.state.set({cluster:!this.state.get("cluster")})},_selectOption:function(t,n){var r=this.$el.find("."+t+" > select > option");r&&r.each(function(t){if(this.value==n)return e(this).attr("selected","selected"),!1})}})}(jQuery,recline.View),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";t.MultiView=Backbone.View.extend({template:'   <div class="recline-data-explorer">     <div class="alert-messages"></div>         <div class="header clearfix">       <div class="navigation">         <div class="btn-group" data-toggle="buttons-radio">         {{#views}}         <a href="#{{id}}" data-view="{{id}}" class="btn">{{label}}</a>         {{/views}}         </div>       </div>       <div class="recline-results-info">         <span class="doc-count">{{recordCount}}</span> records      </div>       <div class="menu-right">         <div class="btn-group" data-toggle="buttons-checkbox">           {{#sidebarViews}}           <a href="#" data-action="{{id}}" class="btn">{{label}}</a>           {{/sidebarViews}}         </div>       </div>       <div class="query-editor-here" style="display:inline;"></div>     </div>     <div class="data-view-sidebar"></div>     <div class="data-view-container"></div>   </div>   ',events:{"click .menu-right a":"_onMenuClick","click .navigation a":"_onSwitchView"},initialize:function(e){var n=this;this._setupState(e.state),e.views?this.pageViews=e.views:this.pageViews=[{id:"grid",label:"Grid",view:new t.SlickGrid({model:this.model,state:this.state.get("view-grid")})},{id:"graph",label:"Graph",view:new t.Graph({model:this.model,state:this.state.get("view-graph")})},{id:"map",label:"Map",view:new t.Map({model:this.model,state:this.state.get("view-map")})},{id:"timeline",label:"Timeline",view:new t.Timeline({model:this.model,state:this.state.get("view-timeline")})}],e.sidebarViews?this.sidebarViews=e.sidebarViews:this.sidebarViews=[{id:"filterEditor",label:"Filters",view:new t.FilterEditor({model:this.model})},{id:"fieldsView",label:"Fields",view:new t.Fields({model:this.model})}],this.render(),this._bindStateChanges(),this._bindFlashNotifications(),this.state.get("readOnly")&&this.setReadOnly(),this.state.get("currentView")?this.updateNav(this.state.get("currentView")):this.updateNav(this.pageViews[0].id),this._showHideSidebar(),this.listenTo(this.model,"query:start",function(){n.notify({loader:!0,persist:!0})}),this.listenTo(this.model,"query:done",function(){n.clearNotifications(),n.$el.find(".doc-count").text(n.model.recordCount||"Unknown")}),this.listenTo(this.model,"query:fail",function(e){n.clearNotifications();var t="";typeof e=="string"?t=e:typeof e=="object"?(e.title&&(t=e.title+": "),e.message&&(t+=e.message)):t="There was an error querying the backend",n.notify({message:t,category:"error",persist:!0})}),this.model.queryState.set(n.state.get("query"),{silent:!0})},setReadOnly:function(){this.$el.addClass("recline-read-only")},render:function(){var e=this.model.toTemplateJSON();e.views=this.pageViews,e.sidebarViews=this.sidebarViews;var t=Mustache.render(this.template,e);this.$el.html(t);var n=this.$el.find(".data-view-container"),r=this.$el.find(".data-view-sidebar");_.each(this.pageViews,function(e,t){e.view.render(),n.append(e.view.el),e.view.elSidebar&&r.append(e.view.elSidebar)}),_.each(this.sidebarViews,function(e){this["$"+e.id]=e.view.$el,r.append(e.view.el)},this),this.pager=new recline.View.Pager({model:this.model.queryState}),this.$el.find(".recline-results-info").after(this.pager.el),this.queryEditor=new recline.View.QueryEditor({model:this.model.queryState}),this.$el.find(".query-editor-here").append(this.queryEditor.el)},remove:function(){_.each(this.pageViews,function(e){e.view.remove()}),_.each(this.sidebarViews,function(e){e.view.remove()}),this.pager.remove(),this.queryEditor.remove(),Backbone.View.prototype.remove.apply(this,arguments)},_showHideSidebar:function(){var t=this.$el.find(".data-view-sidebar"),n=t.children().filter(function(){return e(this).css("display")!="none"}).length;n>0?t.show():t.hide()},updateNav:function(e){this.$el.find(".navigation a").removeClass("active");var t=this.$el.find('.navigation a[data-view="'+e+'"]');t.addClass("active"),_.each(this.pageViews,function(t,n){t.id===e?(t.view.$el.show(),t.view.elSidebar&&t.view.elSidebar.show()):(t.view.$el.hide(),t.view.elSidebar&&t.view.elSidebar.hide(),t.view.hide&&t.view.hide())}),this._showHideSidebar(),_.each(this.pageViews,function(t,n){t.id===e&&t.view.show&&t.view.show()})},_onMenuClick:function(t){t.preventDefault();var n=e(t.target).attr("data-action");this["$"+n].toggle(),this._showHideSidebar()},_onSwitchView:function(t){t.preventDefault();var n=e(t.target).attr("data-view");this.updateNav(n),this.state.set({currentView:n})},_setupState:function(e){var n=this,r=t.parseHashQueryString(),i=r.reclineQuery;i=i?JSON.parse(i):n.model.queryState.toJSON();var s=r["view-graph"]||r.graph;s=s?JSON.parse(s):{};var o=_.extend({query:i,"view-graph":s,backend:this.model.backend.__type__,url:this.model.get("url"),dataset:this.model.toJSON(),currentView:null,readOnly:!1},e);this.state=new recline.Model.ObjectState(o)},_bindStateChanges:function(){var e=this;this.listenTo(this.model.queryState,"change",function(){e.state.set({query:e.model.queryState.toJSON()})}),_.each(this.pageViews,function(t){if(t.view.state&&t.view.state.bind){var n={};n["view-"+t.id]=t.view.state.toJSON(),e.state.set(n),e.listenTo(t.view.state,"change",function(){var n={};n["view-"+t.id]=t.view.state.toJSON(),e.state.set(n,{silent:!0}),e.state.trigger("change")})}})},_bindFlashNotifications:function(){var e=this;_.each(this.pageViews,function(t){e.listenTo(t.view,"recline:flash",function(t){e.notify(t)})})},notify:function(t){var n=_.extend({message:"Loading",category:"warning",loader:!1},t),r;n.loader?r='         <div class="alert alert-info alert-loader">           {{message}}           <span class="notification-loader">&nbsp;</span>         </div>':r='         <div class="alert alert-{{category}} fade in" data-alert="alert"><a class="close" data-dismiss="alert" href="#"></a>           {{message}}         </div>';var i=e(Mustache.render(r,n));i=e(i).appendTo(e(".recline-data-explorer .alert-messages")),t.persist||setTimeout(function(){e(i).fadeOut(1e3,function(){e(this).remove()})},1e3)},clearNotifications:function(){var t=e(".recline-data-explorer .alert-messages .alert");t.fadeOut(1500,function(){e(this).remove()})}}),t.MultiView.restore=function(e){var n;e.backend==="memory"?n={backend:"memory",records:[{stub:"this is a stub dataset because we do not restore memory datasets"}]}:n=_.extend({url:e.url,backend:e.backend},e.dataset);var r=new recline.Model.Dataset(n),i=new t.MultiView({model:r,state:e});return i};var n=/^([^?]+)(\?.*)?/;t.parseHashUrl=function(e){var t=n.exec(e);return t===null?{}:{path:t[1],query:t[2]||""}},t.parseQueryString=function(e){if(!e)return{};var t={},n,r=function(e){return unescape(e.replace(/\+/g," "))},i=/([^&=]+)=?([^&]*)/g;e&&e.length&&e[0]==="?"&&(e=e.slice(1));while(n=i.exec(e))t[r(n[1])]=r(n[2]);return t},t.parseHashQueryString=function(){var e=t.parseHashUrl(window.location.hash).query;return t.parseQueryString(e)},t.composeQueryString=function(t){var n="?",r=[];return e.each(t,function(e,t){typeof t=="object"&&(t=JSON.stringify(t)),r.push(e+"="+encodeURIComponent(t))}),n+=r.join("&"),n},t.getNewHashForQueryString=function(e){var n=t.composeQueryString(e);return window.location.hash?window.location.hash.split("?")[0].slice(1)+n:n},t.setHashQueryString=function(e){window.location.hash=t.getNewHashForQueryString(e)}}(jQuery,recline.View),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";t.SlickGrid=Backbone.View.extend({initialize:function(e){var t=this;this.$el.addClass("recline-slickgrid"),_.bindAll(this,"render","onRecordChanged"),this.listenTo(this.model.records,"add remove reset",this.render),this.listenTo(this.model.records,"change",this.onRecordChanged);var n=_.extend({hiddenColumns:[],columnsOrder:[],columnsSort:{},columnsWidth:[],columnsEditor:[],options:{},fitColumns:!1},e.state);this.state=new recline.Model.ObjectState(n),this._slickHandler=new Slick.EventHandler},events:{},onRecordChanged:function(e){if(!this.grid)return;var t=this.grid.getData().getModelRow(e);this.grid.invalidateRow(t),this.grid.getData().updateItem(e,t),this.grid.render()},render:function(){function u(t){var n={};return e.model.fields.each(function(e){n[e.id]=t.getFieldValueUnrendered(e)}),n}function a(){var e=[],t=[];this.push=function(n,r){e.push(n),t.push(r)},this.getLength=function(){return t.length},this.getItem=function(e){return t[e]},this.getItemMetadata=function(e){return{}},this.getModel=function(t){return e[t]},this.getModelRow=function(t){return _.indexOf(e,t)},this.updateItem=function(n,r){t[r]=u(n),e[r]=n}}var e=this,t=_.extend({enableCellNavigation:!0,enableColumnReorder:!0,explicitInitialization:!0,syncColumnCellResize:!0,forceFitColumns:this.state.get("fitColumns")},e.state.get("gridOptions")),n=[],r=function(t,n,r,i,s){var o=e.model.fields.get(i.id);return o.renderer?o.renderer(r,o,s):r};_.each(this.model.fields.toJSON(),function(t){var i={id:t.id,name:t.label,field:t.id,sortable:!0,minWidth:80,formatter:r},s=_.find(e.state.get("columnsWidth"),function(e){return e.column===t.id});s&&(i.width=s.width);var o=_.find(e.state.get("columnsEditor"),function(e){return e.column===t.id});o&&(i.editor=o.editor),n.push(i)});var i=_.filter(n,function(t){return _.indexOf(e.state.get("hiddenColumns"),t.id)===-1});this.state.get("columnsOrder")&&this.state.get("columnsOrder").length>0&&(i=i.sort(function(t,n){return _.indexOf(e.state.get("columnsOrder"),t.id)>_.indexOf(e.state.get("columnsOrder"),n.id)?1:-1}),n=n.sort(function(t,n){return _.indexOf(e.state.get("columnsOrder"),t.id)>_.indexOf(e.state.get("columnsOrder"),n.id)?1:-1}));var s=[];for(var o=n.length-1;o>=0;o--)_.indexOf(_.pluck(i,"id"),n[o].id)===-1&&s.push(n.splice(o,1)[0]);n=n.concat(s);var f=new a;this.model.records.each(function(e){f.push(e,u(e))}),this.grid=new Slick.Grid(this.el,f,i,t);var l=this.model.queryState.get("sort");if(l){var c=l[0].field,h=l[0].order!=="desc";this.grid.setSortColumn(c,h)}this._slickHandler.subscribe(this.grid.onSort,function(t,n){var r=n.sortAsc?"asc":"desc",i=[{field:n.sortCol.field,order:r}];e.model.query({sort:i})}),this._slickHandler.subscribe(this.grid.onColumnsReordered,function(t,n){e.state.set({columnsOrder:_.pluck(e.grid.getColumns(),"id")})}),this.grid.onColumnsResized.subscribe(function(t,n){var r=n.grid.getColumns(),i=n.grid.getOptions().defaultColumnWidth,s=[];_.each(r,function(e){e.width!=i&&s.push({column:e.id,width:e.width})}),e.state.set({columnsWidth:s})}),this._slickHandler.subscribe(this.grid.onCellChange,function(e,t){var n=t.grid,r=f.getModel(t.row),i=n.getColumns()[t.cell].id,s={};s[i]=t.item[i],r.set(s)});var p=new Slick.Controls.ColumnPicker(n,this.grid,_.extend(t,{state:this.state}));return e.visible?(e.grid.init(),e.rendered=!0):e.rendered=!1,this},remove:function(){this._slickHandler.unsubscribeAll(),Backbone.View.prototype.remove.apply(this,arguments)},show:function(){this.rendered||(this.grid||this.render(),this.grid.init(),this.rendered=!0),this.visible=!0},hide:function(){this.visible=!1}})}(jQuery,recline.View),function(e){function t(t,n,r){function u(){n.onHeaderContextMenu.subscribe(a),r=e.extend({},o,r),i=e('<ul class="dropdown-menu slick-contextmenu" style="display:none;position:absolute;z-index:20;" />').appendTo(document.body),i.bind("mouseleave",function(t){e(this).fadeOut(r.fadeSpeed)}),i.bind("click",f)}function a(o,u){o.preventDefault(),i.empty(),s=[];var a,f;for(var l=0;l<t.length;l++)a=e("<li />").appendTo(i),f=e('<input type="checkbox" style="float:left" />').data("column-id",t[l].id).attr("id","slick-column-vis-"+t[l].id),s.push(f),n.getColumnIndex(t[l].id)!==null&&f.attr("checked","checked"),f.appendTo(a),e("<label />").html(t[l].name).attr("for","slick-column-vis-"+t[l].id).appendTo(a);e("<li/>").addClass("divider").appendTo(i),a=e("<li />").data("option","autoresize").appendTo(i),f=e('<input type="checkbox" />').data("option","autoresize").attr("id","slick-option-autoresize"),f.appendTo(a),e("<label />").text("Force fit columns").attr("for","slick-option-autoresize").appendTo(a),n.getOptions().forceFitColumns&&f.attr("checked","checked"),i.css("top",o.pageY-10).css("left",o.pageX-10).fadeIn(r.fadeSpeed)}function f(i){var o;if(e(i.target).data("option")==="autoresize"){var u;e(i.target).is("li")?(o=e(i.target).find("input").first(),u=!o.is(":checked"),o.attr("checked",u)):u=i.target.checked,u?(n.setOptions({forceFitColumns:!0}),n.autosizeColumns()):n.setOptions({forceFitColumns:!1}),r.state.set({fitColumns:u});return}if(e(i.target).is("li")&&!e(i.target).hasClass("divider")||e(i.target).is("input")){e(i.target).is("li")&&(o=e(i.target).find("input").first(),o.attr("checked",!o.is(":checked")));var a=[],f=[];e.each(s,function(n,r){e(this).is(":checked")?a.push(t[n]):f.push(t[n].id)});if(!a.length){e(i.target).attr("checked","checked");return}n.setColumns(a),r.state.set({hiddenColumns:f})}}var i,s,o={fadeSpeed:250};u()}e.extend(!0,window,{Slick:{Controls:{ColumnPicker:t}}})}(jQuery),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";typeof VMM!="undefined"&&(VMM.debug=!1),t.Timeline=Backbone.View.extend({template:'     <div class="recline-timeline">       <div id="vmm-timeline-id"></div>     </div>   ',startFieldNames:["date","startdate","start","start-date"],endFieldNames:["end","endDate"],elementId:"#vmm-timeline-id",initialize:function(e){var t=this;this.timeline=new VMM.Timeline,this._timelineIsInitialized=!1,this.listenTo(this.model.fields,"reset",function(){t._setupTemporalField()}),this.listenTo(this.model.records,"all",function(){t.reloadData()});var n=_.extend({startField:null,endField:null,timelineJSOptions:{}},e.state);this.state=new recline.Model.ObjectState(n),this._setupTemporalField()},render:function(){var t={},n=Mustache.render(this.template,t);this.$el.html(n),e(this.elementId).length>0&&this._initTimeline()},show:function(){this._timelineIsInitialized===!1&&this._initTimeline()},_initTimeline:function(){var e=this.$el.find(this.elementId),t=this._timelineJSON();this.timeline.init(t,this.elementId,this.state.get("timelineJSOptions")),this._timelineIsInitialized=!0},reloadData:function(){if(this._timelineIsInitialized){var e=this._timelineJSON();this.timeline.reload(e)}},convertRecord:function(e,t){return this._convertRecord(e,t)},_convertRecord:function(e,t){var n=this._parseDate(e.get(this.state.get("startField"))),r=this._parseDate(e.get(this.state.get("endField")));if(n){var i={startDate:n,endDate:r,headline:String(e.get("title")||""),text:e.get("description")||e.summary()};return i}return null},_timelineJSON:function(){var e=this,t={timeline:{type:"default",headline:"",date:[]}};this.model.records.each(function(n){var r=e.convertRecord(n,e.fields);r&&t.timeline.date.push(r)});if(t.timeline.date.length===0){var n={startDate:"2000,1,1",headline:"No data to show!"};t.timeline.date.push(n)}return t},_parseDate:function(t){if(!t)return null;var n=e.trim(t);return n=n.replace(/(\d)th/g,"$1"),n=n.replace(/(\d)st/g,"$1"),n=e.trim(n)?moment(n):null,n&&n.isValid()?n.toDate():null},_setupTemporalField:function(){this.state.set({startField:this._checkField(this.startFieldNames),endField:this._checkField(this.endFieldNames)})},_checkField:function(e){var t=this.model.fields.pluck("id");for(var n=0;n<e.length;n++)for(var r=0;r<t.length;r++)if(t[r].toLowerCase()==e[n].toLowerCase())return t[r];return null}})}(jQuery,recline.View),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";t.FacetViewer=Backbone.View.extend({className:"recline-facet-viewer",template:'     <div class="facets">       {{#facets}}       <div class="facet-summary" data-facet="{{id}}">         <h3>           {{id}}         </h3>         <ul class="facet-items">         {{#terms}}           <li><a class="facet-choice js-facet-filter" data-value="{{term}}" href="#{{term}}">{{term}} ({{count}})</a></li>         {{/terms}}         {{#entries}}           <li><a class="facet-choice js-facet-filter" data-value="{{time}}">{{term}} ({{count}})</a></li>         {{/entries}}         </ul>       </div>       {{/facets}}     </div>   ',events:{"click .js-facet-filter":"onFacetFilter"},initialize:function(e){_.bindAll(this,"render"),this.listenTo(this.model.facets,"all",this.render),this.listenTo(this.model.fields,"all",this.render),this.render()},render:function(){var e={fields:this.model.fields.toJSON()};e.facets=_.map(this.model.facets.toJSON(),function(e){return e._type==="date_histogram"&&(e.entries=_.map(e.entries,function(e){return e.term=(new Date(e.time)).toDateString(),e})),e});var t=Mustache.render(this.template,e);this.$el.html(t),this.model.facets.length>0?this.$el.show():this.$el.hide()},onHide:function(e){e.preventDefault(),this.$el.hide()},onFacetFilter:function(t){t.preventDefault();var n=e(t.target),r=n.closest(".facet-summary").attr("data-facet"),i=n.attr("data-value");this.model.queryState.addFilter({type:"term",field:r,term:i}),this.model.query()}})}(jQuery,recline.View),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";t.Fields=Backbone.View.extend({className:"recline-fields-view",template:'     <div class="accordion fields-list well">     <h3>Fields <a href="#" class="js-show-hide">+</a></h3>     {{#fields}}       <div class="accordion-group field">         <div class="accordion-heading">           <i class="icon-file"></i>           <h4>             {{label}}             <small>               {{type}}               <a class="accordion-toggle" data-toggle="collapse" href="#collapse{{id}}"> &raquo; </a>             </small>           </h4>         </div>         <div id="collapse{{id}}" class="accordion-body collapse">           <div class="accordion-inner">             {{#facets}}             <div class="facet-summary" data-facet="{{id}}">               <ul class="facet-items">               {{#terms}}                 <li class="facet-item"><span class="term">{{term}}</span> <span class="count">[{{count}}]</span></li>               {{/terms}}               </ul>             </div>             {{/facets}}             <div class="clear"></div>           </div>         </div>       </div>     {{/fields}}     </div>   ',initialize:function(e){var t=this;_.bindAll(this,"render"),this.listenTo(this.model.fields,"reset",function(e){t.model.fields.each(function(e){e.facets.unbind("all",t.render),e.facets.bind("all",t.render)}),t.model.getFieldsSummary(),t.render()}),this.$el.find(".collapse").collapse(),this.render()},render:function(){var e=this,t={fields:[]};this.model.fields.each(function(e){var n=e.toJSON();n.facets=e.facets.toJSON(),t.fields.push(n)});var n=Mustache.render(this.template,t);this.$el.html(n)}})}(jQuery,recline.View),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";t.FilterEditor=Backbone.View.extend({className:"recline-filter-editor well",template:'     <div class="filters">       <h3>Filters</h3>       <a href="#" class="js-add-filter">Add filter</a>       <form class="form-stacked js-add" style="display: none;">         <fieldset>           <label>Field</label>           <select class="fields">             {{#fields}}             <option value="{{id}}">{{label}}</option>             {{/fields}}           </select>           <label>Filter type</label>           <select class="filterType">             <option value="term">Value</option>             <option value="range">Range</option>             <option value="geo_distance">Geo distance</option>           </select>           <button type="submit" class="btn">Add</button>         </fieldset>       </form>       <form class="form-stacked js-edit">         {{#filters}}           {{{filterRender}}}         {{/filters}}         {{#filters.length}}         <button type="submit" class="btn">Update</button>         {{/filters.length}}       </form>     </div>   ',filterTemplates:{term:'       <div class="filter-{{type}} filter">         <fieldset>           <legend>             {{field}} <small>{{type}}</small>             <a class="js-remove-filter" href="#" title="Remove this filter" data-filter-id="{{id}}">&times;</a>           </legend>           <input type="text" value="{{term}}" name="term" data-filter-field="{{field}}" data-filter-id="{{id}}" data-filter-type="{{type}}" />         </fieldset>       </div>     ',range:'       <div class="filter-{{type}} filter">         <fieldset>           <legend>             {{field}} <small>{{type}}</small>             <a class="js-remove-filter" href="#" title="Remove this filter" data-filter-id="{{id}}">&times;</a>           </legend>           <label class="control-label" for="">From</label>           <input type="text" value="{{start}}" name="start" data-filter-field="{{field}}" data-filter-id="{{id}}" data-filter-type="{{type}}" />           <label class="control-label" for="">To</label>           <input type="text" value="{{stop}}" name="stop" data-filter-field="{{field}}" data-filter-id="{{id}}" data-filter-type="{{type}}" />         </fieldset>       </div>     ',geo_distance:'       <div class="filter-{{type}} filter">         <fieldset>           <legend>             {{field}} <small>{{type}}</small>             <a class="js-remove-filter" href="#" title="Remove this filter" data-filter-id="{{id}}">&times;</a>           </legend>           <label class="control-label" for="">Longitude</label>           <input type="text" value="{{point.lon}}" name="lon" data-filter-field="{{field}}" data-filter-id="{{id}}" data-filter-type="{{type}}" />           <label class="control-label" for="">Latitude</label>           <input type="text" value="{{point.lat}}" name="lat" data-filter-field="{{field}}" data-filter-id="{{id}}" data-filter-type="{{type}}" />           <label class="control-label" for="">Distance (km)</label>           <input type="text" value="{{distance}}" name="distance" data-filter-field="{{field}}" data-filter-id="{{id}}" data-filter-type="{{type}}" />         </fieldset>       </div>     '},events:{"click .js-remove-filter":"onRemoveFilter","click .js-add-filter":"onAddFilterShow","submit form.js-edit":"onTermFiltersUpdate","submit form.js-add":"onAddFilter"},initialize:function(){_.bindAll(this,"render"),this.listenTo(this.model.fields,"all",this.render),this.listenTo(this.model.queryState,"change change:filters:new-blank",this.render),this.render()},render:function(){var t=this,n=e.extend(!0,{},this.model.queryState.toJSON());n.filters=_.map(n.filters,function(e,t){return e.id=t,e}),n.fields=this.model.fields.toJSON(),n.filterRender=function(){return Mustache.render(t.filterTemplates[this.type],this)};var r=Mustache.render(this.template,n);this.$el.html(r)},onAddFilterShow:function(t){t.preventDefault();var n=e(t.target);n.hide(),this.$el.find("form.js-add").show()},onAddFilter:function(t){t.preventDefault();var n=e(t.target);n.hide();var r=n.find("select.filterType").val(),i=n.find("select.fields").val();this.model.queryState.addFilter({type:r,field:i})},onRemoveFilter:function(t){t.preventDefault();var n=e(t.target),r=n.attr("data-filter-id");this.model.queryState.removeFilter(r)},onTermFiltersUpdate:function(t){var n=this;t.preventDefault();var r=n.model.queryState.get("filters"),i=e(t.target);_.each(i.find("input"),function(t){var n=e(t),i=n.attr("data-filter-type"),s=n.attr("data-filter-field"),o=parseInt(n.attr("data-filter-id"),10),u=n.attr("name"),a=n.val();switch(i){case"term":r[o].term=a;break;case"range":r[o][u]=a;break;case"geo_distance":u==="distance"?r[o].distance=parseFloat(a):r[o].point[u]=parseFloat(a)}}),n.model.queryState.set({filters:r,from:0}),n.model.queryState.trigger("change")}})}(jQuery,recline.View),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";t.Pager=Backbone.View.extend({className:"recline-pager",template:'     <div class="pagination">       <ul>         <li class="prev action-pagination-update"><a href="">&laquo;</a></li>         <li class="active"><a><input name="from" type="text" value="{{from}}" /> &ndash; <input name="to" type="text" value="{{to}}" /> </a></li>         <li class="next action-pagination-update"><a href="">&raquo;</a></li>       </ul>     </div>   ',events:{"click .action-pagination-update":"onPaginationUpdate","change input":"onFormSubmit"},initialize:function(){_.bindAll(this,"render"),this.listenTo(this.model,"change",this.render),this.render()},onFormSubmit:function(e){e.preventDefault();var t=parseInt(this.$el.find('input[name="from"]').val()),n=parseInt(this.$el.find('input[name="to"]').val())-t;t=Math.max(t,0),n=Math.max(n,1),this.model.set({size:n,from:t})},onPaginationUpdate:function(t){t.preventDefault();var n=e(t.target),r=0;n.parent().hasClass("prev")?r=this.model.get("from")-Math.max(0,this.model.get("size")):r=this.model.get("from")+this.model.get("size"),r=Math.max(r,0),this.model.set({from:r})},render:function(){var e=this.model.toJSON();e.to=this.model.get("from")+this.model.get("size");var t=Mustache.render(this.template,e);this.$el.html(t)}})}(jQuery,recline.View),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";t.QueryEditor=Backbone.View.extend({className:"recline-query-editor",template:'     <form action="" method="GET" class="form-inline">       <div class="input-prepend text-query">         <span class="add-on"><i class="icon-search"></i></span>         <input type="text" name="q" value="{{q}}" class="span2" placeholder="Search data ..." class="search-query" />       </div>       <button type="submit" class="btn">Go &raquo;</button>     </form>   ',events:{"submit form":"onFormSubmit"},initialize:function(){_.bindAll(this,"render"),this.listenTo(this.model,"change",this.render),this.render()},onFormSubmit:function(e){e.preventDefault();var t=this.$el.find(".text-query input").val();this.model.set({q:t})},render:function(){var e=this.model.toJSON(),t=Mustache.render(this.template,e);this.$el.html(t)}})}(jQuery,recline.View),this.recline=this.recline||{},this.recline.View=this.recline.View||{},function(e,t){"use strict";t.ValueFilter=Backbone.View.extend({className:"recline-filter-editor well",template:'     <div class="filters">       <h3>Filters</h3>       <button class="btn js-add-filter add-filter">Add filter</button>       <form class="form-stacked js-add" style="display: none;">         <fieldset>           <label>Field</label>           <select class="fields">             {{#fields}}             <option value="{{id}}">{{label}}</option>             {{/fields}}           </select>           <button type="submit" class="btn">Add</button>         </fieldset>       </form>       <form class="form-stacked js-edit">         {{#filters}}           {{{filterRender}}}         {{/filters}}         {{#filters.length}}         <button type="submit" class="btn update-filter">Update</button>         {{/filters.length}}       </form>     </div>   ',filterTemplates:{term:'       <div class="filter-{{type}} filter">         <fieldset>           {{field}}           <a class="js-remove-filter" href="#" title="Remove this filter" data-filter-id="{{id}}">&times;</a>           <input type="text" value="{{term}}" name="term" data-filter-field="{{field}}" data-filter-id="{{id}}" data-filter-type="{{type}}" />         </fieldset>       </div>     '},events:{"click .js-remove-filter":"onRemoveFilter","click .js-add-filter":"onAddFilterShow","submit form.js-edit":"onTermFiltersUpdate","submit form.js-add":"onAddFilter"},initialize:function(){_.bindAll(this,"render"),this.listenTo(this.model.fields,"all",this.render),this.listenTo(this.model.queryState,"change change:filters:new-blank",this.render),this.render()},render:function(){var t=this,n=e.extend(!0,{},this.model.queryState.toJSON());n.filters=_.map(n.filters,function(e,t){return e.id=t,e}),n.fields=this.model.fields.toJSON(),n.filterRender=function(){return Mustache.render(t.filterTemplates.term,this)};var r=Mustache.render(this.template,n);this.$el.html(r)},updateFilter:function(t){var n=this,r=n.model.queryState.get("filters"),i=e(t),s=parseInt(i.attr("data-filter-id"),10),o=i.val();r[s].term=o},onAddFilterShow:function(t){t.preventDefault();var n=e(t.target);n.hide(),this.$el.find("form.js-add").show()},onAddFilter:function(t){t.preventDefault();var n=e(t.target);n.hide();var r=n.find("select.fields").val();this.model.queryState.addFilter({type:"term",field:r})},onRemoveFilter:function(t){t.preventDefault();var n=e(t.target),r=n.attr("data-filter-id");this.model.queryState.removeFilter(r)},onTermFiltersUpdate:function(t){var n=this;t.preventDefault();var r=n.model.queryState.get("filters"),i=e(t.target);_.each(i.find("input"),function(e){n.updateFilter(e)}),n.model.queryState.set({filters:r,from:0}),n.model.queryState.trigger("change")}})}(jQuery,recline.View),define("REM/vendor/recline/recline",function(){}),this.recline=this.recline||{},this.recline.Model=this.recline.Model||{},function(e){"use strict";var t=typeof jQuery!="undefined"&&jQuery.Deferred||_.Deferred;e.Dataset=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){var t=this;_.bindAll(this,"query"),this.backend=null,this.get("backend")?this.backend=this._backendFromString(this.get("backend")):this.get("records")&&(this.backend=recline.Backend.Memory),this.fields=new e.FieldList,this.records=new e.RecordList,this._changes={deletes:[],updates:[],creates:[]},this.facets=new e.FacetList,this.recordCount=null,this.queryState=new e.Query,this.queryState.bind("change facet:add",function(){t.query()});var t=this;t.records.bind("add",function(e){t._changes.creates.push(e.toJSON()),t.recordCount=t.records.models.length}),this._store=this.backend,this.backend==recline.Backend.Memory&&this.fetch()},fetch:function(){function r(t){var r=e.get("fields")||t.fields,i=e._normalizeRecordsAndFields(t.records,r);t.useMemoryStore&&(e._store=new recline.Backend.Memory.Store(i.records,i.fields)),e.set(t.metadata),e.fields.reset(i.fields),e.attributes.renderer&&_.each(e.fields.models,function(t){t.renderer=e.attributes.renderer}),e.query().done(function(){n.resolve(e)}).fail(function(e){n.reject(e)})}var e=this,n=new t;return this.backend!==recline.Backend.Memory?this.backend.fetch(this.toJSON()).done(r).fail(function(e){n.reject(e)}):r({records:this.get("records"),fields:this.get("fields"),useMemoryStore:!0}),n.promise()},_normalizeRecordsAndFields:function(e,t){!t&&e&&e.length>0&&(e[0]instanceof Array?(t=e[0],e=e.slice(1)):t=_.map(_.keys(e[0]),function(e){return{id:e}}));if(t&&t.length>0&&(t[0]===null||typeof t[0]!="object")){var n={};t=_.map(t,function(e,t){e===null?e="":e=e.toString();var r=e.replace(/^\s+|\s+$/g,"");r===""&&(r="_noname_",e=r);while(r in n)n[e]+=1,r=e+n[e];return e in n||(n[e]=0),{id:r}})}return e&&e.length>0&&e[0]instanceof Array&&(e=_.map(e,function(e){var n={};return _.each(t,function(t,r){n[t.id]=e[r]}),n})),{fields:t,records:e}},save:function(){var e=this;return this._store.save(this._changes,this.toJSON())},query:function(e){var n=this,r=new t;this.trigger("query:start"),e&&this.queryState.set(e,{silent:!0});var i=this.queryState.toJSON();return this._store.query(i,this.toJSON()).done(function(e){n._handleQueryResult(e),n.trigger("query:done"),r.resolve(n.records)}).fail(function(e){n.trigger("query:fail",e),r.reject(e)}),r.promise()},_handleQueryResult:function(t){var n=this;n.recordCount=t.total;var r=_.map(t.hits,function(t){var r=new e.Record(t);return r.fields=n.fields,r.bind("change",function(e){n._changes.updates.push(e.toJSON())}),r.bind("destroy",function(e){n._changes.deletes.push(e.toJSON())}),r});n.records.reset(r);if(t.facets){var i=_.map(t.facets,function(t,n){return t.id=n,new e.Facet(t)});n.facets.reset(i)}},toTemplateJSON:function(){var e=this.toJSON();return e.recordCount=this.recordCount,e.fields=this.fields.toJSON(),e},getFieldsSummary:function(){var n=this,r=new e.Query;r.set({size:0}),this.fields.each(function(e){r.addFacet(e.id)});var i=new t;return this._store.query(r.toJSON(),this.toJSON()).done(function(t){t.facets&&_.each(t.facets,function(t,r){t.id=r;var i=new e.Facet(t);n.fields.get(r).facets.reset(i)}),i.resolve(t)}),i.promise()},recordSummary:function(e){return e.summary()},_backendFromString:function(e){var t=null;return recline&&recline.Backend&&_.each(_.keys(recline.Backend),function(n){n.toLowerCase()===e.toLowerCase()&&(t=recline.Backend[n])}),t}}),e.Record=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){_.bindAll(this,"getFieldValue")},getFieldValue:function(e){var t=this.getFieldValueUnrendered(e);return e&&!_.isUndefined(e.renderer)&&(t=e.renderer(t,e,this.toJSON())),t},getFieldValueUnrendered:function(e){if(!e)return"";var t=this.get(e.id);return e.deriver&&(t=e.deriver(t,e,this)),t},summary:function(e){var t=this,n='<div class="recline-record-summary">';return this.fields.each(function(e){e.id!="id"&&(n+='<div class="'+e.id+'"><strong>'+e.get("label")+"</strong>: "+t.getFieldValue(e)+"</div>")}),n+="</div>",n},fetch:function(){},save:function(){},destroy:function(){this.trigger("destroy",this)}}),e.RecordList=Backbone.Collection.extend({constructor:function(){Backbone.Collection.prototype.constructor.apply(this,arguments)},model:e.Record}),e.Field=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},defaults:{label:null,type:"string",format:null,is_derived:!1},initialize:function(t,n){if("0"in t)throw new Error("Looks like you did not pass a proper hash with id to Field constructor");this.attributes.label===null&&this.set({label:this.id}),this.attributes.type.toLowerCase()in this._typeMap&&(this.attributes.type=this._typeMap[this.attributes.type.toLowerCase()]),n&&(this.renderer=n.renderer,this.deriver=n.deriver),this.renderer||(this.renderer=this.defaultRenderers[this.get("type")]),this.facets=new e.FacetList},_typeMap:{text:"string","double":"number","float":"number",numeric:"number","int":"integer",datetime:"date-time",bool:"boolean",timestamp:"date-time",json:"object"},defaultRenderers:{object:function(e,t,n){return JSON.stringify(e)},geo_point:function(e,t,n){return JSON.stringify(e)},number:function(e,t,n){var r=t.get("format");return r==="percentage"?e+"%":e},string:function(e,t,n){var r=t.get("format");if(r==="markdown"){if(typeof Showdown!="undefined"){var i=new Showdown.converter;return out=i.makeHtml(e),out}return e}return r=="plain"?e:(e&&typeof e=="string"&&(e=e.replace(/(https?:\/\/[^ ]+)/g,'<a href="$1">$1</a>')),e)}}}),e.FieldList=Backbone.Collection.extend({constructor:function(){Backbone.Collection.prototype.constructor.apply(this,arguments)},model:e.Field}),e.Query=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},defaults:function(){return{size:100,from:0,q:"",facets:{},filters:[]}},_filterTemplates:{term:{type:"term",field:"",term:""},range:{type:"range",start:"",stop:""},geo_distance:{type:"geo_distance",distance:10,unit:"km",point:{lon:0,lat:0}}},addFilter:function(e){var t=JSON.parse(JSON.stringify(e));_.keys(e).length<=3&&(t=_.defaults(t,this._filterTemplates[e.type]));var n=this.get("filters");n.push(t),this.trigger("change:filters:new-blank")},updateFilter:function(e,t){},removeFilter:function(e){var t=this.get("filters");t.splice(e,1),this.set({filters:t}),this.trigger("change")},addFacet:function(e){var t=this.get("facets");if(_.contains(_.keys(t),e))return;t[e]={terms:{field:e}},this.set({facets:t},{silent:!0}),this.trigger("facet:add",this)},addHistogramFacet:function(e){var t=this.get("facets");t[e]={date_histogram:{field:e,interval:"day"}},this.set({facets:t},{silent:!0}),this.trigger("facet:add",this)}}),e.Facet=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},defaults:function(){return{_type:"terms",total:0,other:0,missing:0,terms:[]}}}),e.FacetList=Backbone.Collection.extend({constructor:function(){Backbone.Collection.prototype.constructor.apply(this,arguments)},model:e.Facet}),e.ObjectState=Backbone.Model.extend({}),Backbone.sync=function(e,t,n){return t.backend.sync(e,t,n)}}(this.recline.Model),this.recline=this.recline||{},this.recline.Backend=this.recline.Backend||{},this.recline.Backend.Memory=this.recline.Backend.Memory||{},function(e){"use strict";e.__type__="memory";var t=typeof jQuery!="undefined"&&jQuery.Deferred||_.Deferred;e.Store=function(e,n){var r=this;this.records=e,this.data=this.records,n?this.fields=n:e&&(this.fields=_.map(e[0],function(e,t){return{id:t,type:"string"}})),this.update=function(e){_.each(r.records,function(t,n){e.id===t.id&&(r.records[n]=e)})},this.remove=function(e){var t=_.reject(r.records,function(t){return e.id===t.id});this.records=t},this.save=function(e,n){var r=this,i=new t;return _.each(e.updates,function(e){r.update(e)}),_.each(e.deletes,function(e){r.remove(e)}),i.resolve(),i.promise()},this.query=function(e){var n=new t,r=e.size||this.records.length,i=e.from||0,s=this.records;s=recline.Data.Filters.applyFiltersOnData(e.filters,s,this.fields),s=this._applyFreeTextQuery(s,e),_.each(e.sort,function(e){var t=e.field;s=_.sortBy(s,function(e){var n=e[t];return n}),e.order=="desc"&&s.reverse()});var o=recline.Data.Faceting.computeFacets(s,e),u={total:s.length,hits:s.slice(i,i+r),facets:o};return n.resolve(u),n.promise()},this._applyFilters=function(e,t){function u(e){var t=o[e.field].type||"string";return s[t]}function a(e,t){var n=u(t),r=n(e[t.field]),i=n(t.term);return r===i}function f(e,t){var n=t.start===null||t.start==="",r=t.stop===null||t.stop==="",i=u(t),s=i(e[t.field]),o=i(t.start),a=i(t.stop);return(!n||!r)&&s===""?!1:(n||s>=o)&&(r||s<=a)}function l(){}var n=t.filters,i={term:a,range:f,geo_distance:l},s={integer:function(e){return parseFloat(e,10)},"float":function(e){return parseFloat(e,10)},number:function(e){return parseFloat(e,10)},string:function(e){return e.toString()},date:function(e){return moment(e).valueOf()},datetime:function(e){return(new Date(e)).valueOf()}},o={};return _.each(r.fields,function(e){o[e.id]=e}),_.filter(e,function(e){var t=_.map(n,function(t){return i[t.type](e,t)});return _.all(t,_.identity)})},this._applyFreeTextQuery=function(e,t){if(t.q){var n=t.q.split(" "),i=_.map(n,function(e){return new RegExp(e.toLowerCase())});e=_.filter(e,function(e){var t=!0;return _.each(i,function(n){var i=!1;_.each(r.fields,function(t){var r=e[t.id];r!==null&&r!==undefined?r=r.toString():r="",i=i||n.test(r.toLowerCase())}),t=t&&i}),t})}return e},this.computeFacets=function(e,t){var n={};return t.facets?(_.each(t.facets,function(e,t){n[t]=(new recline.Model.Facet({id:t})).toJSON(),n[t].termsall={}}),_.each(e,function(e){_.each(t.facets,function(t,r){var i=t.terms.field,s=e[i],o=n[r];s?o.termsall[s]=o.termsall[s]?o.termsall[s]+1:1:o.missing=o.missing+1})}),_.each(t.facets,function(e,t){var r=n[t],i=_.map(r.termsall,function(e,t){return{term:t,count:e}});r.terms=_.sortBy(i,function(e){return-e.count}),r.terms=r.terms.slice(0,10)}),n):n}}}(this.recline.Backend.Memory),define("REM/vendor/recline/recline.dataset",function(){}),"use strict",define("REM/recline-extensions/recline-amd",["REM/vendor/recline/recline","REM/vendor/recline/recline.dataset"],function(){return recline}),define("REM/recline-extensions/data/data.fieldsutilities",["underscore","REM/recline-extensions/recline-amd"],function(e,t){t.Data=t.Data||{},t.Data.FieldsUtility=t.Data.FieldsUtility||{};var n=t.Data.FieldsUtility;return n.setFieldsAttributes=function(t,n,r){if(n.attributes.fieldLabels)for(var i=0;i<t.length;i++){var s=e.find(n.attributes.fieldLabels,function(e){return e.id==t[i].id});s!=null&&(t[i].label=s.label)}if(n.attributes.fieldsFormat){if(!n.attributes.fieldsFormat.length)throw"Wrong fieldsFormat parameter. Must be an array, not a single object!";e.each(n.attributes.fieldsFormat,function(n){var r=e.find(t,function(e){return n.id===e.id});r!=null&&(r.format=n.format)})}n.attributes.colorSchema&&e.each(n.attributes.colorSchema,function(n){var r=e.find(t,function(e){return n.field===e.id});r!=null&&(r.colorSchema=n.schema)}),n.attributes.shapeSchema&&e.each(n.attributes.shapeSchema,function(n){var r=e.find(t,function(e){return n.field===e.id});r!=null&&(r.shapeSchema=n.schema)})},n}),define("REM/recline-extensions/backend/backend.extensions.csv",["jquery","REM/recline-extensions/recline-amd"],function(e,t){t.Backend=t.Backend||{},t.Backend.CSV=t.Backend.CSV||{};var n=t.Backend.CSV;n.setFieldsAttributesCSV=function(e,t,n){if(t.attributes.fieldsType){if(!t.attributes.fieldsType.length)throw"Wrong fieldsType parameter. Must be an array, not a single object!";_.each(t.attributes.fieldsType,function(r){var i=_.find(e,function(e){return r.id===e.id});i!=null&&(typeof i.type=="undefined"||i.type==null)&&i.type!=r.type&&(i.type=r.type,t.backend.__type__=="csv"&&n&&i.type!="string"&&_.each(n,function(e){i.type=="date"?e[r.id]=new Date(e[r.id]):i.type=="integer"?e[r.id]=parseInt(e[r.id]):i.type=="number"&&(e[r.id]=parseFloat(e[r.id]))}))})}}}),define("REM/recline-extensions/model/model.extensions.all",["REM/recline-extensions/recline-amd","jquery","REM/recline-extensions/data/data.fieldsutilities","REM/recline-extensions/backend/backend.extensions.csv"],function(e,t){return e.Model.Query.prototype=t.extend(e.Model.Query.prototype,{defaults:function(){return{size:5e5,from:0,q:"",facets:{},filters:[]}},addFacetNoEvent:function(e){var t=this.get("facets");if(_.contains(_.keys(t),e))return;t[e]={terms:{field:e}},this.set({facets:t},{silent:!0})},removeFilterByFieldNoEvent:function(e){var t=this.get("filters");for(var n in t)t[n].field===e&&(t.splice(n,1),this.set({filters:t},{silent:!0}))},getFilterByFieldName:function(e){var t=_.find(this.get("filters"),function(t){return t.field==e});return t==-1?null:t},setFilter:function(e){if(e.remove)this.removeFilterByFieldNoEvent(e.field),delete e.remove;else{var t=this.get("filters"),n=!1;for(var r=0;r<t.length;r++)t[r].field==e.field&&(t[r]=e,n=!0);n||t.push(e)}},removeFilterByField:function(e){var t=this.get("filters");for(var n in t)t[n].field==e&&this.removeFilter(n)},clearFilter:function(e){var t=this.get("filters");for(var n in t)if(t[n].field==e){t[n].term=null,t[n].start=null,t[n].stop=null;break}},addSortCondition:function(e,t){var n=this.get("sort");n?n.push({field:e,order:t}):n=[{field:e,order:t}],this.attributes.sort=n,this.trigger("change:filters:sort")},setSortCondition:function(e){var t=this.get("sort");t?t.push(e):t=[e],this.attributes.sort=t},clearSortCondition:function(){this.attributes.sort=null},getSelections:function(){var e=this.get("selections");return e?e:(this.set({selections:[]},{silent:!0}),this.get("selections"))},getSelectionByFieldName:function(e){var t=_.find(this.get("selections"),function(t){return t.field==e});return t==-1?null:t},addSelection:function(e){var t=JSON.parse(JSON.stringify(e));_.keys(e).length<=3&&(t=_.extend(this._selectionTemplates[e.type],t));var n=this.getSelections();n.push(t),this.trigger("selection:change")},removeSelection:function(e){var t=this.getSelections();t.splice(e,1),this.set({selections:t},{silent:!0}),this.trigger("selection:change")},removeSelectionByField:function(e){var t=this.getSelections();for(var n in t)t[n].field==e&&this.removeSelection(n)},setSelection:function(e){if(e.remove)this.removeSelectionByField(e.field),delete e.remove;else{var t=this.getSelections(),n=!1;for(var r=0;r<t.length;r++)t[r].field==e.field&&(t[r]=e,n=!0);n||t.push(e)}this.trigger("selection:change")},isSelected:function(){return this.getSelections().length>0}}),e.Model.Dataset.prototype=t.extend(e.Model.Dataset.prototype,{initialize:function(){var t=e.Model.Dataset.prototype.initialize;return function(){t.call(this),_.bindAll(this,"applyRendererToFields"),_.bindAll(this,"selection"),_.bindAll(this,"applySelectionOnRecords"),this.queryState.bind("selection:change",this.selection),this.records.bind("reset",this.applySelectionOnRecords),this.fields.bind("reset",this.applyRendererToFields),this.get("initialState")&&this.get("initialState").setState(this)}}(),applyRendererToFields:function(){var e=this;e.attributes.renderer&&_.each(e.fields.models,function(t){t.renderer=e.attributes.renderer})},setColorSchema:function(){var e=this;_.each(e.attributes.colorSchema,function(t){var n=_.find(e.fields.models,function(e){return t.field===e.id});n!=null&&(n.attributes.colorSchema=t.schema)})},addStaticColorSchema:function(e,t){var n=this;n.attributes.colorSchema||(n.attributes.colorSchema=[]),n.attributes.colorSchema.push({schema:e,field:t}),n.fields.length>0&&n.setColorSchema(),n.fields.bind("reset",function(){n.setColorSchema()}),n.fields.bind("add",function(){n.setColorSchema()}),n.fields.bind("change",function(){n.setColorSchema()})},addCustomFilterLogic:function(e){this.attributes.customFilterLogic?this.attributes.customFilterLogic.push(e):this.attributes.customFilterLogic=[e]},getFacetByFieldId:function(e){return _.find(this.facets.models,function(t){return t.id==e})},toFullJSON:function(e){var t=this;return _.map(t.getRecords(e),function(n){var r={};return _.each(t.getFields(e).models,function(e){r[e.id]=n.getFieldValueUnrendered(e)}),r})},resetRecords:function(e){this.set({records:e},{silent:!0})},resetFields:function(e){this.set({fields:e},{silent:!0})},getRecords:function(t){var n=this;if(t==="filtered"||t==null)return n.records.models;if(n._store.data==null)throw"Model: unable to retrieve not filtered data, store can't provide data. Use a backend that use a memory store";n.queryState.get("sort")&&n.queryState.get("sort").length>0&&_.each(n.queryState.get("sort"),function(e){var t=e.field;n._store.data=_.sortBy(n._store.data,function(e){var n=e[t];return n}),e.order=="desc"&&typeof e.alreadySorted=="undefined"&&(n._store.data.reverse(),e.alreadySorted=!0)});var r=_.map(n._store.data,function(t){var r=new e.Model.Record(t);return r.fields=n.fields,r});return n.queryState.getSelections().length>0&&e.Data.Filters.applySelectionsOnRecord(n.queryState.get("selections"),r,n.fields),r},getFields:function(e){var t=this;return t.fields},_normalizeRecordsAndFields:function(){var t=e.Model.Dataset.prototype._normalizeRecordsAndFields;return function(n,r){var i=this,s=t.call(this,n,r);return i.backend.__type__=="csv"&&e.Backend.CSV.setFieldsAttributesCSV(s.fields,i,s.records),e.Data.FieldsUtility.setFieldsAttributes(s.fields,i),s}}(),selection:function(t){var n=this;this.trigger("selection:start"),t&&n.queryState.set(t,{silent:!0}),e.Data.Filters.applySelectionsOnRecord(n.queryState.getSelections(),n.records.models,n.fields),n.queryState.trigger("selection:done")},applySelectionOnRecords:function(){var t=this;this.queryState&&_.isFunction(this.queryState.getSelections)&&this.queryState.getSelections().length>0&&e.Data.Filters.applySelectionsOnRecord(t.queryState.getSelections(),t.records.models,t.fields)},setShapeSchema:function(){var e=this;_.each(e.attributes.shapeSchema,function(t){var n=_.find(e.fields.models,function(e){return t.field===e.id});n!=null&&(n.attributes.shapeSchema=t.schema)})},_handleQueryResult:function(t){var n=e.Model.Dataset.prototype._handleQueryResult;return function(t){var r=this;if(t.fields&&r.fields.length==0){e.Data.FieldsUtility.setFieldsAttributes(t.fields,r);var i;r.attributes.renderer&&(i={renderer:r.attributes.renderer}),r.fields.reset(t.fields,i)}var s=n.call(this,t);return t.facets&&_.each(t.facets,function(t,n){e.Data.ColorSchema.addColorsToTerms(t.id,t.terms,r.attributes.colorSchema),e.Data.ShapeSchema.addShapesToTerms(t.id,t.terms,r.attributes.shapeSchema)}),s}}(),query:function(t){var n=e.Model.Dataset.prototype.query;return function(e){var t=this;e&&this.queryState.set(e,{silent:!0});var r=this.queryState.toJSON(),i=!1;return _.each(t.attributes.customFilterLogic,function(e){e(r),i=!0}),e||i?n.call(this,r):n.call(this,e)}}()}),e.Model.Record.prototype=t.extend(e.Model.Record.prototype,{getFieldColor:function(e){return e.attributes.colorSchema?e.attributes.is_partitioned?e.attributes.colorSchema.getTwoDimensionalColor(e.attributes.partitionValue,this.getFieldValueUnrendered(e)):e.attributes.colorSchema.getColorFor(this.getFieldValueUnrendered(e)):null},isRecordSelected:function(){var e=this;return e.is_selected},setRecordSelection:function(e){var t=this;t.is_selected=e},getFieldShapeName:function(e){return e.attributes.shapeSchema?e.attributes.is_partitioned?e.attributes.shapeSchema.getShapeNameFor(e.attributes.partitionValue):e.attributes.shapeSchema.getShapeNameFor(this.getFieldValueUnrendered(e)):null},getFieldShape:function(t,n,r){if(!t.attributes.shapeSchema)return e.Template.Shapes.empty(null,r,n);var i,s=this.getFieldColor(t);return t.attributes.is_partitioned?i=t.attributes.partitionValue:i=this.getFieldValueUnrendered(t),t.attributes.shapeSchema.getShapeFor(i,s,n,r)}}),e.Model.Field.prototype=t.extend(e.Model.Field.prototype,{getColorForPartition:function(){return this.attributes.colorSchema?this.attributes.is_partitioned?this.attributes.colorSchema.getColorFor(this.attributes.partitionValue):this.attributes.colorSchema.getColorFor(this.attributes.id):null}}),e}),define("REM/recline-extensions/data/action",["jquery","REM/recline-extensions/recline-amd"],function(e,t){var n=t;return n.ActionUtility={},n.ActionUtility.doAction=function(e,t,n){var r=_.filter(e,function(e){var n=_.find(e.event,function(e){return e==t});return n!=-1?!0:!1});_.each(r,function(e){var t=e.mapping,r=[];_.each(t,function(t){if(n[t["srcField"]]==null&&e.action.attributes.filters[t.filter].type!="list")console.log("warn: sourceField: ["+t.srcField+"] not present in event data");else{var i={filter:t.filter,value:n[t.srcField]};r.push(i)}}),r.length>0&&e.action._internalDoAction(r)})},n.ActionUtility.getActiveFilters=function(e){var t=[];return _.each(e,function(e){_.each(e.mapping,function(n){var r=e.action.getActiveFilters(n.filter,n.srcField);r!=null&&r.length>0&&(t=_.union(t,r))})}),t},n.Action=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){},doAction:function(e,t){var n=[];t.forEach(function(t){var r=[];e.forEach(function(e){r.push(e.getFieldValueUnrendered({id:t.srcField}))}),n.push({filter:t.filter,value:r})}),this._internalDoAction(n)},doActionWithFacets:function(e,t,n,r){var i=[];n.forEach(function(n){if(typeof n.srcCtrlField=="undefined"||n.srcCtrlField==r){var s=[];e.forEach(function(e){e.records.forEach(function(e){var i=e[r];t.forEach(function(t){if(t==i||t&&i&&t.valueOf()==i.valueOf())_.contains(s,e[n.srcField])||s.push(e[n.srcField])})})}),i.push({filter:n.filter,value:s,origValueList:t})}}),this._internalDoAction(i)},doActionWithValues:function(e,t){var n=[];t.forEach(function(t){var r=[];_.each(e,function(r){r.field===t.srcField&&n.push({filter:t.filter,value:r.value,origValueList:e})})}),this._internalDoAction(n)},doActionWithValueArray:function(e,t,n){var r=[];t.forEach(function(t){t.srcField==n&&r.push({filter:t.filter,value:e})}),this._internalDoAction(r)},_internalDoAction:function(e){var t=this,n=this.attributes.filters,r=this.attributes.models,i=this.attributes.type,s=[];_.each(e,function(e){var r=n[e.filter];if(r==null)throw"Filter "+e.filter+" defined in actions data not configured for action ";r.name=e.filter;if(t.filters[r.type]==null)throw"Filter not implemented for type "+r.type;r.type=="range"&&e.value.length<2&&e.origValueList?s.push(t.filters[r.type](r,e.origValueList)):s.push(t.filters[r.type](r,e.value))}),_.each(i,function(e){_.each(r,function(n){var r=[];_.each(s,function(e){r.push(_.clone(e))});var i=!1;_.each(r,function(r){_.find(n.filters,function(e){return e==r.name})!=null&&(t.modelsAddFilterActions[e](n.model,r),i=!0)}),i&&t.modelsTriggerActions[e](n.model)})}),_.each(e,function(e){var t=n[e.filter];delete t.remove})},getActiveFilters:function(e,t){var n=this,r=this.attributes.models,i=this.attributes.type,s=this.attributes.filters,o=[];return _.each(i,function(i){_.each(r,function(r){var u=_.filter(r.filters,function(t){return t==e});_.each(u,function(e){var u=s[e];if(u!=null){var a=n.modelsGetFilter[i](r.model,u.field);a!=null&&(a.field=t,o.push(a))}})})}),o},modelsGetFilter:{filter:function(e,t){return e.queryState.getFilterByFieldName(t)},selection:function(e,t){throw"Action.js selection not implemented selection for selection"},sort:function(e,t){throw"Action.js sort not implemented selection for sort"}},modelsAddFilterActions:{filter:function(e,t){e.queryState.setFilter(t)},selection:function(e,t){e.queryState.setSelection(t)},sort:function(e,t){e.queryState.clearSortCondition(),e.queryState.setSortCondition(t)}},modelsTriggerActions:{filter:function(e){e.queryState.trigger("change")},selection:function(e){e.queryState.trigger("selection:change")},sort:function(e){e.queryState.trigger("change")}},filters:{term:function(e,t){if(t.length===0)e.term=null,e.remove=!0;else{if(t.length!==1)throw"Data passed for filtertype term not valid. Data lenght should be 1 or empty but is "+t.length;t[0]==null?e.remove=!0:e.term=t[0]}return e},termAdvanced:function(e,t){if(!e.operator)throw"Data passed for filtertype termAdvanced not valid. Operator clause is missing";if(t.length===0)e.term=null,e.remove=!0;else{if(t.length!==1)throw"Data passed for filtertype termAdvanced not valid. Data lenght should be 1 or empty but is "+t.length;t[0]==null?e.remove=!0:e.term=t[0]}return e},range:function(e,t){if(t.length===0)e.start=null,e.stop=null;else if(t[0]===null||t[1]===null)e.remove=!0;else{if(t.length!==2)throw"Data passed for filtertype range not valid. Data lenght should be 2 but is "+t.length;e.start=t[0],e.stop=t[1]}return e},list:function(e,t){return t===null?e.list=null:t.length===0?(e.remove=!0,e.list=[]):e.list=t,e},sort:function(e,t){if(t.length===0)e=null;else{if(t.length!=2)throw"Actions.js: invalid data length ["+t+"]";e.field=t[0],e.order=t[1]}return e}}}),n.Action}),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h={}.hasOwnProperty,p=function(e,t){function n(){this.constructor=e}for(var r in t)h.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};u=typeof exports!="undefined"&&exports!==null?exports:this,o=(f=u.chroma)!=null?f:u.chroma={},typeof module!="undefined"&&module!==null&&(module.exports=o),o.version="0.3.1",n=function(){function e(t,n,r,i){var s,o;s=this,t==null&&n==null&&r==null&&i==null&&(t=[255,0,255]),a(t)==="array"&&t.length===3&&(i==null&&(i=n),o=t,t=o[0],n=o[1],r=o[2]),a(t)==="string"?i="hex":i==null&&(i="rgb"),i==="rgb"?s.rgb=[t,n,r]:i==="hsl"?s.rgb=e.hsl2rgb(t,n,r):i==="hsv"?s.rgb=e.hsv2rgb(t,n,r):i==="hex"?s.rgb=e.hex2rgb(t):i==="lab"?s.rgb=e.lab2rgb(t,n,r):i==="hcl"?s.rgb=e.hcl2rgb(t,n,r):i==="hsi"&&(s.rgb=e.hsi2rgb(t,n,r))}return e.prototype.hex=function(){return e.rgb2hex(this.rgb)},e.prototype.toString=function(){return this.hex()},e.prototype.hsl=function(){return e.rgb2hsl(this.rgb)},e.prototype.hsv=function(){return e.rgb2hsv(this.rgb)},e.prototype.lab=function(){return e.rgb2lab(this.rgb)},e.prototype.hcl=function(){return e.rgb2hcl(this.rgb)},e.prototype.hsi=function(){return e.rgb2hsi(this.rgb)},e.prototype.interpolate=function(t,n,r){var i,s,o,u,f,l,c,h,p,d,v,m,g;h=this,r==null&&(r="rgb"),a(n)==="string"&&(n=new e(n));if(r==="hsl"||r==="hsv"||r==="hcl"||r==="hsi"){r==="hsl"?(m=h.hsl(),g=n.hsl()):r==="hsv"?(m=h.hsv(),g=n.hsv()):r==="hcl"?(m=h.hcl(),g=n.hcl()):r==="hsi"&&(m=h.hsi(),g=n.hsi()),o=m[0],d=m[1],l=m[2],u=g[0],v=g[1],c=g[2];if(!isNaN(o)&&!isNaN(u))u>o&&u-o>180?i=u-(o+360):u<o&&o-u>180?i=u+360-o:i=u-o,s=o+t*i;else if(!isNaN(o)){s=o;if(c===1||c===0)p=d}else if(!isNaN(u)){s=u;if(l===1||l===0)p=v}else s=void 0;return p==null&&(p=d+t*(v-d)),f=l+t*(c-l),new e(s,p,f,r)}if(r==="rgb")return m=h.rgb,g=n.rgb,new e(m[0]+t*(g[0]-m[0]),m[1]+t*(g[1]-m[1]),m[2]+t*(g[2]-m[2]),r);if(r==="lab")return m=h.lab(),g=n.lab(),new e(m[0]+t*(g[0]-m[0]),m[1]+t*(g[1]-m[1]),m[2]+t*(g[2]-m[2]),r);throw"color mode "+r+" is not supported"},e}(),n.hex2rgb=function(e){var t,n,r,i;if(!e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)){if(o.colors==null||!o.colors[e])throw"unknown color format: "+e;e=o.colors[e]}if(e.length===4||e.length===7)e=e.substr(1);return e.length===3&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),i=parseInt(e,16),r=i>>16,n=i>>8&255,t=i&255,[r,n,t]},n.rgb2hex=function(e,t,n){var r,i,s;return e!==void 0&&e.length===3&&(s=e,e=s[0],t=s[1],n=s[2]),i=e<<16|t<<8|n,r="000000"+i.toString(16).toUpperCase(),"#"+r.substr(r.length-6)},n.hsv2rgb=function(e,t,n){var r,i,s,o,u,f,l,c,h,p,d,v,m,g,y,b;a(e)==="array"&&e.length===3&&(p=e,e=p[0],t=p[1],u=p[2]),n*=255;if(t===0&&isNaN(e))c=s=r=n;else{e===360&&(e=0),e>360&&(e-=360),e<0&&(e+=360),e/=60,o=Math.floor(e),i=e-o,f=n*(1-t),l=n*(1-t*i),h=n*(1-t*(1-i));switch(o){case 0:d=[n,h,f],c=d[0],s=d[1],r=d[2];break;case 1:v=[l,n,f],c=v[0],s=v[1],r=v[2];break;case 2:m=[f,n,h],c=m[0],s=m[1],r=m[2];break;case 3:g=[f,l,n],c=g[0],s=g[1],r=g[2];break;case 4:y=[h,f,n],c=y[0],s=y[1],r=y[2];break;case 5:b=[n,f,l],c=b[0],s=b[1],r=b[2]}}return c=Math.round(c),s=Math.round(s),r=Math.round(r),[c,s,r]},n.rgb2hsv=function(e,t,n){var r,i,s,o,u,a,f;return e!==void 0&&e.length===3&&(f=e,e=f[0],t=f[1],n=f[2]),o=Math.min(e,t,n),s=Math.max(e,t,n),r=s-o,a=s/255,u=r/s,u===0?(i=void 0,u=0):(e===s&&(i=(t-n)/r),t===s&&(i=2+(n-e)/r),n===s&&(i=4+(e-t)/r),i*=60,i<0&&(i+=360)),[i,u,a]},n.hsl2rgb=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p;e!==void 0&&e.length===3&&(h=e,e=h[0],t=h[1],n=h[2]);if(t===0)u=s=r=n*255;else{l=[0,0,0],i=[0,0,0],f=n<.5?n*(1+t):n+t-n*t,a=2*n-f,e/=360,l[0]=e+1/3,l[1]=e,l[2]=e-1/3;for(o=c=0;c<=2;o=++c)l[o]<0&&(l[o]+=1),l[o]>1&&(l[o]-=1),6*l[o]<1?i[o]=a+(f-a)*6*l[o]:2*l[o]<1?i[o]=f:3*l[o]<2?i[o]=a+(f-a)*(2/3-l[o])*6:i[o]=a;p=[Math.round(i[0]*255),Math.round(i[1]*255),Math.round(i[2]*255)],u=p[0],s=p[1],r=p[2]}return[u,s,r]},n.rgb2hsl=function(e,t,n){var r,i,s,o,u,a;return e!==void 0&&e.length===3&&(a=e,e=a[0],t=a[1],n=a[2]),e/=255,t/=255,n/=255,o=Math.min(e,t,n),s=Math.max(e,t,n),i=(s+o)/2,s===o?(u=0,r=void 0):u=i<.5?(s-o)/(s+o):(s-o)/(2-s-o),e===s?r=(t-n)/(s-o):t===s?r=2+(n-e)/(s-o):n===s&&(r=4+(e-t)/(s-o)),r*=60,r<0&&(r+=360),[r,u,i]},n.lab2xyz=function(e,t,n){var r,i,s,o,u,f,l;return a(e)==="array"&&e.length===3&&(l=e,e=l[0],t=l[1],n=l[2]),r=function(e){return e>6/29?e*e*e:3*(6/29)*(6/29)*(e-4/29)},s=(e+.16)/1.16,i=[.96421,1,.82519],u=i[1]*r(s),o=i[0]*r(s+t/5),f=i[2]*r(s-n/2),[o,u,f]},n.xyz2rgb=function(e,t,n){var r,i,s,o,u,f,l,c,h,p;return a(e)==="array"&&e.length===3&&(h=e,e=h[0],t=h[1],n=h[2]),c=3.2406*e-1.5372*t-.4986*n,f=-0.9689*e+1.8758*t+.0415*n,i=.0557*e-.204*t+1.057*n,s=Math.min(c,f,i)<-0.001||Math.max(c,f,i)>1.001,s&&(c=c<0?0:c>1?1:c,f=f<0?0:f>1?1:f,i=i<0?0:i>1?1:i),s&&(p=[void 0,void 0,void 0],c=p[0],f=p[1],i=p[2]),o=function(e){var t;return t=.055,e<=.0031308?12.92*e:(1+t)*Math.pow(e,1/2.4)-t},l=Math.round(255*o(c)),u=Math.round(255*o(f)),r=Math.round(255*o(i)),[l,u,r]},n.lab2rgb=function(e,t,r){var i,s,o,u,a,f;return e!==void 0&&e.length===3&&(u=e,e=u[0],t=u[1],r=u[2]),e!==void 0&&e.length===3&&(a=e,e=a[0],t=a[1],r=a[2]),f=n.lab2xyz(e,t,r),i=f[0],s=f[1],o=f[2],n.xyz2rgb(i,s,o)},n.hcl2lab=function(e,t,n){var r,i,s,o,u,f,l;return a(e)==="array"&&e.length===3&&(l=e,e=l[0],t=l[1],n=l[2]),e/=360,i=6.283185307179586,r=n*.61+.09,o=i/6-e*i,f=(n*.311+.125)*t,s=Math.sin(o)*f,u=Math.cos(o)*f,[r,s,u]},n.hcl2rgb=function(e,t,r){var i,s,o,u;return u=n.hcl2lab(e,t,r),i=u[0],s=u[1],o=u[2],n.lab2rgb(i,s,o)},n.rgb2xyz=function(e,t,n){var r,i,s,o,u,a,f,l;return e!==void 0&&e.length===3&&(l=e,e=l[0],t=l[1],n=l[2]),i=function(e){var t;return t=.055,e<=.04045?e/12.92:Math.pow((e+t)/(1+t),2.4)},o=i(e/255),s=i(t/255),r=i(n/255),u=.4124*o+.3576*s+.1805*r,a=.2126*o+.7152*s+.0722*r,f=.0193*o+.1192*s+.9505*r,[u,a,f]},n.xyz2lab=function(e,t,n){var r,i,s,o,u,a;return e!==void 0&&e.length===3&&(a=e,e=a[0],t=a[1],n=a[2]),o=[.96421,1,.82519],s=function(e){return e>Math.pow(6/29,3)?Math.pow(e,1/3):7.787037037037035*e+4/29},u=1.16*s(t/o[1])-.16,r=5*(s(e/o[0])-s(t/o[1])),i=2*(s(t/o[1])-s(n/o[2])),[u,r,i]},n.rgb2lab=function(e,t,r){var i,s,o,u,a;return e!==void 0&&e.length===3&&(u=e,e=u[0],t=u[1],r=u[2]),a=n.rgb2xyz(e,t,r),i=a[0],s=a[1],o=a[2],n.xyz2lab(i,s,o)},n.lab2hcl=function(e,t,n){var r,i,s,o,u,f,l;return a(e)==="array"&&e.length===3&&(l=e,e=l[0],t=l[1],n=l[2]),r=e,e=(e-.09)/.61,u=Math.sqrt(t*t+n*n),f=u/(e*.311+.125),i=6.283185307179586,s=Math.atan2(t,n),o=(i/6-s)/i,o*=360,o<0&&(o+=360),[o,f,e]},n.rgb2hcl=function(e,t,r){var i,s,o,u;return a(e)==="array"&&e.length===3&&(o=e,e=o[0],t=o[1],r=o[2]),u=n.rgb2lab(e,t,r),s=u[0],i=u[1],r=u[2],n.lab2hcl(s,i,r)},n.rgb2hsi=function(e,t,n){var r,i,s,o,u,f;return a(e)==="array"&&e.length===3&&(f=e,e=f[0],t=f[1],n=f[2]),r=Math.PI*2,e/=255,t/=255,n/=255,o=Math.min(e,t,n),s=(e+t+n)/3,u=1-o/s,u===0?i=0:(i=(e-t+(e-n))/2,i/=Math.sqrt((e-t)*(e-t)+(e-n)*(t-n)),i=Math.acos(i),n>t&&(i=r-i),i/=r),[i*360,u,s]},n.hsi2rgb=function(e,t,n){var r,i,s,o,u,f,l;return a(e)==="array"&&e.length===3&&(l=e,e=l[0],t=l[1],n=l[2]),i=Math.PI*2,r=Math.PI/3,o=Math.cos,e<0&&(e+=360),e>360&&(e-=360),e/=360,e<1/3?(s=(1-t)/3,f=(1+t*o(i*e)/o(r-i*e))/3,u=1-(s+f)):e<2/3?(e-=1/3,f=(1-t)/3,u=(1+t*o(i*e)/o(r-i*e))/3,s=1-(f+u)):(e-=2/3,u=(1-t)/3,s=(1+t*o(i*e)/o(r-i*e))/3,f=1-(u+s)),f=n*f*3,u=n*u*3,s=n*s*3,[f*255,u*255,s*255]},o.Color=n,o.hsl=function(e,t,r){return new n(e,t,r,"hsl")},o.hsv=function(e,t,r){return new n(e,t,r,"hsv")},o.rgb=function(e,t,r){return new n(e,t,r,"rgb")},o.hex=function(e){return new n(e)},o.lab=function(e,t,r){return new n(e,t,r,"lab")},o.hcl=function(e,t,r){return new n(e,t,r,"hcl")},o.hsi=function(e,t,r){return new n(e,t,r,"hsi")},o.interpolate=function(e,t,r,i){return e==null||t==null?"#000":(a(e)==="string"&&(e=new n(e)),a(t)==="string"&&(t=new n(t)),e.interpolate(r,t,i))},r=function(){function e(e){var t,r,i,s,o,u,f,l,c,h,p,d;s=this,s.colors=i=(f=e.colors)!=null?f:["#ddd","#222"];for(t=o=0,l=i.length-1;0<=l?o<=l:o>=l;t=0<=l?++o:--o)r=i[t],a(r)==="string"&&(i[t]=new n(r));if(e.positions!=null)s.pos=e.positions;else{s.pos=[];for(t=u=0,c=i.length-1;0<=c?u<=c:u>=c;t=0<=c?++u:--u)s.pos.push(t/(i.length-1))}s.mode=(h=e.mode)!=null?h:"hsv",s.nacol=(p=e.nacol)!=null?p:"#ccc",s.setClasses((d=e.limits)!=null?d:[0,1]),s}return e.prototype.getColor=function(e){var t,n,r,i;return i=this,isNaN(e)?i.nacol:(i.classLimits.length>2?(t=i.getClass(e),n=t/(i.numClasses-1)):(n=r=(e-i.min)/(i.max-i.min),n=Math.min(1,Math.max(0,n))),i.fColor(n))},e.prototype.fColor=function(e){var t,n,r,i,s,u,a;i=this,n=i.colors;for(r=u=0,a=i.pos.length-1;0<=a?u<=a:u>=a;r=0<=a?++u:--u){s=i.pos[r];if(e<=s){t=n[r];break}if(e>=s&&r===i.pos.length-1){t=n[r];break}if(e>s&&e<i.pos[r+1]){e=(e-s)/(i.pos[r+1]-s),t=o.interpolate(n[r],n[r+1],e,i.mode);break}}return t},e.prototype.classifyValue=function(e){var t,n,r,i,s,o;return o=this,n=o.classLimits,n.length>2&&(s=n.length-1,t=o.getClass(e),e=n[t]+(n[t+1]-n[t])*.5,i=n[0],r=n[s-1],e=o.min+(e-i)/(r-i)*(o.max-o.min)),e},e.prototype.setClasses=function(e){var t;return e==null&&(e=[]),t=this,t.classLimits=t.limits=e,t.min=e[0],t.max=e[e.length-1],e.length===2?t.numClasses=0:t.numClasses=e.length-1},e.prototype.getClass=function(e){var t,n,r,i;i=this,n=i.classLimits;if(n!=null){r=n.length-1,t=0;while(t<r&&e>=n[t])t++;return t-1}return void 0},e.prototype.validValue=function(e){return!isNaN(e)},e}(),o.ColorScale=r,s=function(e){function t(e,n,r){e==null&&(e="#fe0000"),n==null&&(n="#feeeee"),r==null&&(r="hsl"),t.__super__.constructor.call(this,[e,n],[0,1],r)}return p(t,e),t}(r),o.Ramp=s,i=function(e){function t(e,n,r,i,s){var o;e==null&&(e="#d73027"),n==null&&(n="#ffffbf"),r==null&&(r="#1E6189"),i==null&&(i="mean"),s==null&&(s="hsl"),o=this,o.mode=s,o.center=i,t.__super__.constructor.call(this,[e,n,r],[0,.5,1],s)}return p(t,e),t.prototype.parseData=function(e,n){var r,i;return t.__super__.parseData.call(this,e,n),i=this,r=i.center,r==="median"?r=i.median:r==="mean"&&(r=i.mean),i.pos[1]=(r-i.min)/(i.max-i.min)},t}(r),o.Diverging=i,t=function(e){function t(e){var t;t=this,t.colors=e}return p(t,e),t.prototype.parseData=function(e,t){},t.prototype.getColor=function(e){var t;return t=this,t.colors.hasOwnProperty(e)?t.colors[e]:"#cccccc"},t.prototype.validValue=function(e){return this.colors.hasOwnProperty(e)},t}(r),o.Categories=t,e=function(e){function t(e){var t;t=this,t.name=e,t.setClasses(7),t}return p(t,e),t.prototype.getColor=function(e){var t,n;return n=this,t=n.getClass(e),n.name+" l"+n.numClasses+" c"+t},t}(r),o.CSSColors=e,(l=o.scales)==null&&(o.scales={}),o.scales.cool=function(){return new s(o.hsl(180,1,.9),o.hsl(250,.7,.4))},o.scales.hot=function(){return new r({colors:["#000000","#ff0000","#ffff00","#ffffff"],positions:[0,.25,.75,1],mode:"rgb"})},o.scales.BlWhOr=function(){return new i(o.hsl(30,1,.55),"#ffffff",new n(220,1,.55))},o.scales.GrWhPu=function(){return new i(o.hsl(120,.8,.4),"#ffffff",new n(280,.8,.4))},o.limits=function(e,t,n,r,i){var s,o,u,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht;t==null&&(t="equal"),n==null&&(n=7),r==null&&(r=null),i==null&&(i=null),y=Number.MAX_VALUE,g=Number.MAX_VALUE*-1,L=0,_=[],i==null&&(i=function(){return!0});if(a(e)==="array")if(a(e[0])!=="object"&&a(e[0])!=="array")for(D=0,j=e.length;D<j;D++)O=e[D],isNaN(O&&i(O))||_.push(Number(O));else for(P=0,F=e.length;P<F;P++)k=e[P],i(k)&&_.push(Number(k[r]));else if(a(e)==="object")for(d in e)O=e[d],a(O)==="object"&&a(r)==="string"?isNaN(O[r]&&i(O))||_.push(Number(O[r])):a(O)==="array"&&a(r)==="number"?isNaN(O[r]&&i(O))||_.push(Number(O[r])):a(O)==="number"&&(isNaN(O&&i(O))||_.push(Number(O)));for(H=0,I=_.length;H<I;H++){O=_[H];if(!!isNaN(O))continue;O<y&&(y=O),O>g&&(g=O),L+=O}_=_.sort(function(e,t){return e-t}),m=[],t.substr(0,1)==="c"&&(m.push(y),m.push(g));if(t.substr(0,1)==="e"){m.push(y);for(h=B=1,Y=n-1;1<=Y?B<=Y:B>=Y;h=1<=Y?++B:--B)m.push(y+h/n*(g-y));m.push(g)}else if(t.substr(0,1)==="q"){m.push(y);for(h=q=1,Z=n-1;1<=Z?q<=Z:q>=Z;h=1<=Z?++q:--q)x=_.length*h/n,T=Math.floor(x),T===x?m.push(_[T]):(N=x-T,m.push(_[T]*N+_[T+1]*(1-N)));m.push(g)}else if(t.substr(0,1)==="k"){w=_.length,s=Array(w),l=Array(n),C=!0,E=0,u=null,u=[],u.push(y);for(h=R=1,et=n-1;1<=et?R<=et:R>=et;h=1<=et?++R:--R)u.push(y+h/n*(g-y));u.push(g);while(C){for(p=U=0,tt=n-1;0<=tt?U<=tt:U>=tt;p=0<=tt?++U:--U)l[p]=0;for(h=z=0,nt=w-1;0<=nt?z<=nt:z>=nt;h=0<=nt?++z:--z){M=_[h],b=Number.MAX_VALUE;for(p=W=0,rt=n-1;0<=rt?W<=rt:W>=rt;p=0<=rt?++W:--W)c=Math.abs(u[p]-M),c<b&&(b=c,o=p);l[o]++,s[h]=o}S=Array(n);for(p=X=0,it=n-1;0<=it?X<=it:X>=it;p=0<=it?++X:--X)S[p]=null;for(h=ot=0,st=w-1;0<=st?ot<=st:ot>=st;h=0<=st?++ot:--ot)f=s[h],S[f]===null?S[f]=_[h]:S[f]+=_[h];for(p=ut=0,V=n-1;0<=V?ut<=V:ut>=V;p=0<=V?++ut:--ut)S[p]*=1/l[p];C=!1;for(p=at=0,$=n-1;0<=$?at<=$:at>=$;p=0<=$?++at:--at)if(S[p]!==u[h]){C=!0;break}u=S,E++,E>200&&(C=!1)}v={};for(p=ft=0,J=n-1;0<=J?ft<=J:ft>=J;p=0<=J?++ft:--ft)v[p]=[];for(h=lt=0,K=w-1;0<=K?lt<=K:lt>=K;h=0<=K?++lt:--lt)f=s[h],v[f].push(_[h]);A=[];for(p=ct=0,Q=n-1;0<=Q?ct<=Q:ct>=Q;p=0<=Q?++ct:--ct)A.push(v[p][0]),A.push(v[p][v[p].length-1]);A=A.sort(function(e,t){return e-t}),m.push(A[0]);for(h=ht=1,G=A.length-1;ht<=G;h=ht+=2)isNaN(A[h])||m.push(A[h])}return m},u=typeof exports!="undefined"&&exports!==null?exports:this,a=function(){var e,t,n,r,i;e={},i="Boolean Number String Function Array Date RegExp Undefined Null".split(" ");for(n=0,r=i.length;n<r;n++)t=i[n],e["[object "+t+"]"]=t.toLowerCase();return function(t){var n;return n=Object.prototype.toString.call(t),e[n]||"object"}}(),(c=u.type)==null&&(u.type=a),Array.max=function(e){return Math.max.apply(Math,e)},Array.min=function(e){return Math.min.apply(Math,e)}}.call(this),define("REM/vendor/chroma.js/chroma.min",function(e){return function(){var t,n;return t||e.chroma}}(this)),define("REM/recline-extensions/data/data.colors",["REM/recline-extensions/recline-amd","REM/vendor/chroma.js/chroma.min"],function(e,t){e.Data=e.Data||{},e.Data.Format=e.Format||{},e.Data.ColorSchema=e.ColorSchema||{};var n=e.Data;return n.ColorSchema=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){var e=this;if(this.attributes.data){var t=this.attributes.data;e._generateLimits(t)}else if(this.attributes.dataset)this.bindToDataset();else if(this.attributes.fields){var t=this.attributes.fields;this.attributes.type="scaleWithDistinctData",e._generateLimits(t)}if(this.attributes.twoDimensionalVariation)if(this.attributes.twoDimensionalVariation.data){var t=this.attributes.twoDimensionalVariation.data;e._generateVariationLimits(t)}else this.attributes.twoDimensionalVariation.dataset&&this.bindToVariationDataset()},bindToDataset:function(){var e=this;e.attributes.dataset.dataset.records.bind("reset",function(){e._generateFromDataset()}),e.attributes.dataset.dataset.fields.bind("reset",function(){e.attributes.dataset.dataset.setColorSchema(e.attributes.dataset.type)}),e.attributes.dataset.dataset.fields.bind("add",function(){e.attributes.dataset.dataset.setColorSchema(e.attributes.dataset.type)}),e.attributes.dataset.dataset.records.models.length>0&&e._generateFromDataset()},bindToVariationDataset:function(){var e=this;e.attributes.twoDimensionalVariation.dataset.dataset.records.bind("reset",function(){e._generateFromVariationDataset()}),e.attributes.twoDimensionalVariation.dataset.dataset.records.models.length>0&&e._generateFromVariationDataset()},setDataset:function(e,t,n){var r=this;e.attributes.colorSchema||(e.attributes.colorSchema=[]),r.attributes.fields?_.each(r.attributes.fields,function(t){e.attributes.colorSchema.push({schema:r,field:t})}):(r.attributes.dataset={dataset:e,field:t,type:n},e.attributes.colorSchema.push({schema:r,field:t}),r.bindToDataset()),e.setColorSchema(n)},setVariationDataset:function(e,t){var n=this;n.attributes.twoDimensionalVariation={dataset:{dataset:e,field:t}},n.bindToVariationDataset()},generateFromExternalDataset:function(e){var t=this,n=this.getRecordsArray(e);t._generateLimits(n)},_generateFromDataset:function(){var e=this,t=this.getRecordsArray(e.attributes.dataset);e._generateLimits(t)},_generateFromVariationDataset:function(){var e=this,t=this.getRecordsArray(e.attributes.twoDimensionalVariation.dataset);e._generateVariationLimits(t)},_generateLimits:function(e){var n=this;switch(this.attributes.type){case"scaleWithDataMinMax":n.schema=new t.ColorScale({colors:this.attributes.colors,limits:this.limits.minMax(e)});break;case"scaleWithDistinctData":n.schema=new t.ColorScale({colors:this.attributes.colors,limits:[0,1]}),n.limitsMapping=this.limits.distinct(e,n.oldLimitData),n.oldLimitData=e;break;case"fixedLimits":n.schema=new t.ColorScale({colors:this.attributes.colors,limits:this.attributes.limits});break;default:throw"data.colors.js: unknown or not defined properties type ["+this.attributes.type+"] possible values are [scaleWithDataMinMax,scaleWithDistinctData,fixedLimits]"}},getScaleType:function(){return this.attributes.type},getScaleLimits:function(){return this.schema.limits},_generateVariationLimits:function(e){var t=this;t.variationLimits=this.limits.minMax(e)},getColorFor:function(e){var n=this;if(this.schema==null&&!n.attributes.defaultColor)throw"data.colors.js: colorschema not yet initialized, datasource not fetched?";return n.limitsMapping?n.limitsMapping[e]!=null?this.schema.getColor(n.limitsMapping[e]):t.hex(n.attributes.defaultColor):n.schema?this.schema.getColor(e):t.hex(n.attributes.defaultColor)},getTwoDimensionalColor:function(e,n){if(this.schema==null)throw"data.colors.js: colorschema not yet initialized, datasource not fetched?";if(this.attributes.twoDimensionalVariation==null)return this.getColorFor(e);var r="#000000";this.attributes.twoDimensionalVariation.type=="toLight"&&(r="#ffffff");var i=this,s=new t.ColorScale({colors:[i.getColorFor(e),r],limits:i.variationLimits,mode:"hsl"});return s.getColor(n)},getRecordsArray:function(e){if(!e.dataset.fields.get(e.field))return;var t=[];if(e.dataset.isFieldPartitioned&&e.dataset.isFieldPartitioned(e.field)){var n=e.dataset.getPartitionedFields(e.field);_.each(e.dataset.getRecords(e.type),function(e){_.each(n,function(n){t.push(e.getFieldValueUnrendered(n))})})}else{var n=[e.field];_.each(e.dataset.getRecords(e.type),function(e){_.each(n,function(n){var r=e.fields.get(n);t.push(e.getFieldValueUnrendered(r))})})}return t},limits:{minMax:function(e){var t=[null,null];return e&&e.length==1?t=[0,e[0]]:_.each(e,function(e){t[0]==null?t[0]=e:t[0]=Math.min(t[0],e),t[1]==null?t[1]=e:t[1]=Math.max(t[1],e)}),t},distinct:function(){var e=function(e){var t=0,n,r,i;if(e.length===0)return t;for(n=0;n<e.length;n++)for(r=0;r<e[n].length;r++)i=e[n].charCodeAt(r),t=(t<<5)-t+i,t&=t;return t},t=function(){var e={},t=function(e){return e+e-1};return function(n){if(e[n])return e[n];var r=2;while(r<n)r=t(r);return e[n]=r,r}}(),n=function(e,t,n){return e/(n-1)},r={},i={},s={};return function(o,u){var a={},f={},l=[],c;o?o.sort(function(e,t){return e>t?1:t>e?-1:0}):o=[],u?u.sort(function(e,t){return e>t?1:t>e?-1:0}):u=[];var h=_.uniq(o,!0);h[0]==null&&(h=[]);var p=_.uniq(u,!0);p[0]==null&&(p=[]);var d=s[e(p)]||t(p.length),v=Math.max(t(h.length),d),m=0;v>d&&(d*2<v?p=[]:m=1),l=p.length?i[e(p)]:[];if(m==1&&p.length!==0)for(c=1;c<v;c+=2)l.push(c);if(p.length===0){c=0,_.each(h,function(e){v===1?a[e]=0:a[e]=n(c,h.length,v),f[e]=c,c++});for(c=h.length;c<v;c++)l.push(c)}else{var g,y,b=0,w=0,E=r[e(p)];c=0,g=0;while(!b&&!w)h[c]===p[g]?(c++,g++):h[c]<p[g]?c++:(l.push(E[p[g]]),g++),b=g>=p.length,w=c>=h.length;while(!b)l.push(E[p[g]]),g++,b=g>=p.length;c=0,g=0,b=0,w=0;while(!b&&!w)h[c]===p[g]?(y=E[p[g]]*Math.pow(2,m),f[h[c]]=y,a[h[c]]=n(y,h.length,v),c++,g++):h[c]<p[g]?(y=l.pop(),f[h[c]]=y,a[h[c]]=n(y,h.length,v),c++):g++,b=g>=p.length,w=c>=h.length;if(!w)for(;c<h.length;c++)y=l.pop(),f[h[c]]=y,a[h[c]]=n(y,h.length,v)}return r[e(h)]=f,i[e(h)]=l,s[e(h)]=v,a}}()}}),n.ColorSchema.addColorsToTerms=function(e,t,n){_.each(t,function(t){n&&_.each(n,function(n){n.field===e&&(t.color=n.schema.getColorFor(t.term))})})},n.ColorSchema}),define("REM/recline-extensions/data/data.faceting",["REM/recline-extensions/recline-amd"],function(e){e.Data=e.Data||{},e.Data.Format=e.Format||{},e.Data.Faceting=e.Faceting||{};var t=e.Data;return t.Faceting.computeFacets=function(t,n){var r=this,i={};return n.facets?(_.each(n.facets,function(t,n){i[n]=(new e.Model.Facet({id:n})).toJSON(),i[n].termsall={}}),_.each(t,function(e){_.each(n.facets,function(t,n){var r=t.terms.field,s=e[r],o=i[n];s!=null&&typeof s!="undefined"?o.termsall[s]?(o.termsall[s].records.push(e),o.termsall[s].count=o.termsall[s].count+1):o.termsall[s]={count:1,value:s,records:[e]}:o.missing=o.missing+1})}),r.updateDistinctFieldsForFaceting(n),_.each(n.facets,function(e,t){var n=i[t],s=_.difference(r.distinctFieldsValues[t],_.map(n.termsall,function(e){return e.value}));_.each(s,function(e){n.termsall[e]={count:0,value:e,records:[]}})}),_.each(n.facets,function(e,t){var n=i[t],r=_.map(n.termsall,function(e,t){return{term:e.value,count:e.count,records:e.records}});n.terms=_.sortBy(r,function(e){return-e.count})}),i):i},t.Faceting.updateDistinctFieldsForFaceting=function(e){var t=this;this.distinctFieldsValues==null&&(this.distinctFieldsValues={});var n=[];_.each(e.facets,function(e,r){e.terms.all_terms&&t.distinctFieldsValues[r]==null&&n.push(r)}),n.length>0&&(_.each(n,function(e){t.distinctFieldsValues[e]=[]}),_.each(t.data,function(e){_.each(n,function(n){t.distinctFieldsValues[n].push(e[n])})})),_.each(n,function(e){t.distinctFieldsValues[e]=_.uniq(t.distinctFieldsValues[e])})},t.Faceting}),define("REM/recline-extensions/data/data.filters",["jquery","REM/recline-extensions/recline-amd"],function(e,t){t.Data=t.Data||{};var n=t.Data;return n.Filters={},n.Filters.applyFiltersOnData=function(e,n,r){return _.filter(n,function(n){var i=_.map(e,function(e){return t.Data.Filters._isNullFilter[e.type](e)||t.Data.Filters._filterFunctions[e.type](n,e,r)});return _.all(i,_.identity)})},n.Filters.applyFiltersOnRecords=function(e,n,r){return _.filter(n.models,function(n){var i=_.map(e,function(e){return t.Data.Filters._isNullFilter[e.type](e)||t.Data.Filters._filterFunctions[e.type](n.toJSON(),e,r.toJSON())});return _.all(i,_.identity)})},n.Filters.applySelectionsOnRecord=function(e,n,r){_.each(n,function(n){n.setRecordSelection(!1),_.each(e,function(e){!t.Data.Filters._isNullFilter[e.type](e)&&t.Data.Filters._filterFunctions[e.type](n.attributes,e,r)&&n.setRecordSelection(!0)})})},n.Filters._getDataParser=function(e,n){var r={},i;n.models?i=n.models:i=n,_.each(i,function(e){r[e.id]=e});var s=r[e.field],o="string";if(s==null)throw"data.filters.js: Warning could not find field "+e.field+" for dataset ";return s.attributes?o=s.attributes.type:s.type&&(o=s.type),t.Data.Filters._dataParsers[o]},n.Filters._isNullFilter={term:function(e){return e["term"]==null},range:function(e){return e["start"]==null||e["stop"]==null},list:function(e){return e["list"]==null},termAdvanced:function(e){return e["term"]==null}},this._applyFilters=function(e,t){function o(e){var t=s[e.field].type||"string";return i[t]}var n=t.filters,r={term:term,range:range,geo_distance:geo_distance},i={integer:function(e){return parseFloat(e,10)},"float":function(e){return parseFloat(e,10)},string:function(e){return e.toString()},date:function(e){return(new Date(e)).valueOf()},datetime:function(e){return(new Date(e)).valueOf()}},s={};return _.each(self.fields,function(e){s[e.id]=e}),_.filter(e,function(e){var t=_.map(n,function(t){return r[t.type](e,t)});return _.all(t,_.identity)})},n.Filters._filterFunctions={term:function(e,n,r){var i=t.Data.Filters._getDataParser(n,r),s=i(e[n.field]),o=i(n.term);return s===o},range:function(e,n,r){var i=n.start==null||n.start==="",s=n.stop==null||n.stop==="",o=t.Data.Filters._getDataParser(n,r),u=o(e[n.field]),a=o(n.start),f=o(n.stop);return(!i||!s)&&u===""?!1:(i||u>=a)&&(s||u<=f)},list:function(e,n,r){var i=t.Data.Filters._getDataParser(n,r),s=i(e[n.field]),o=n.list;return _.each(o,function(e,t){o[t]=i(e)}),_.contains(o,s)},termAdvanced:function(e,n,r){var i=t.Data.Filters._getDataParser(n,r),s=i(e[n.field]),o=i(n.term),u=n.operator,a={ne:function(e,t){return e!==t},eq:function(e,t){return e===t},lt:function(e,t){return e<t},lte:function(e,t){return e<=t},gt:function(e,t){return e>t},gte:function(e,t){return e>=t},bw:function(e,t){return _.contains(t,e)},like:function(e,t){return e.indexOf(t)>=0},rlike:function(e,t){return e.indexOf(t)==0},llike:function(e,t){return e.indexOf(t)>0}};return a[u](s,o)}},n.Filters._dataParsers={integer:function(e){return parseFloat(e,10)},"float":function(e){return parseFloat(e,10)},string:function(e){return e?e.toString():null},date:function(e){return(new Date(e)).valueOf()},datetime:function(e){return(new Date(e)).valueOf()},number:function(e){return parseFloat(e,10)}},n.Filters}),function(e,t){function o(e){return!!(e===""||e&&e.charCodeAt&&e.substr)}function u(e){return i?i(e):s.call(e)==="[object Array]"}function a(e){return s.call(e)==="[object Object]"}function f(e,t){var n;e=e||{},t=t||{};for(n in t)t.hasOwnProperty(n)&&e[n]==null&&(e[n]=t[n]);return e}function l(e,t,n){var i=[],s,o;if(!e)return i;if(r&&e.map===r)return e.map(t,n);for(s=0,o=e.length;s<o;s++)i[s]=t.call(n,e[s],s,e);return i}function c(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e}function h(e){var t=n.settings.currency.format;return typeof e=="function"&&(e=e()),o(e)&&e.match("%v")?{pos:e,neg:e.replace("-","").replace("%v","-%v"),zero:e}:!e||!e.pos||!e.pos.match("%v")?o(t)?n.settings.currency.format={pos:t,neg:t.replace("%v","-%v"),zero:t}:t:e}var n={};n.version="0.3.2",n.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var r=Array.prototype.map,i=Array.isArray,s=Object.prototype.toString,p=n.unformat=n.parse=function(e,t){if(u(e))return l(e,function(e){return p(e,t)});e=e||0;if(typeof e=="number")return e;t=t||".";var n=new RegExp("[^0-9-"+t+"]",["g"]),r=parseFloat((""+e).replace(/\((.*)\)/,"-$1").replace(n,"").replace(t,"."));return isNaN(r)?0:r},d=n.toFixed=function(e,t){t=c(t,n.settings.number.precision);var r=Math.pow(10,t);return(Math.round(n.unformat(e)*r)/r).toFixed(t)},v=n.formatNumber=function(e,t,r,i){if(u(e))return l(e,function(e){return v(e,t,r,i)});e=p(e);var s=f(a(t)?t:{precision:t,thousand:r,decimal:i},n.settings.number),o=c(s.precision),h=e<0?"-":"",m=parseInt(d(Math.abs(e||0),o),10)+"",g=m.length>3?m.length%3:0;return h+(g?m.substr(0,g)+s.thousand:"")+m.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+s.thousand)+(o?s.decimal+d(Math.abs(e),o).split(".")[1]:"")},m=n.formatMoney=function(e,t,r,i,s,o){if(u(e))return l(e,function(e){return m(e,t,r,i,s,o)});e=p(e);var d=f(a(t)?t:{symbol:t,precision:r,thousand:i,decimal:s,format:o},n.settings.currency),g=h(d.format),y=e>0?g.pos:e<0?g.neg:g.zero;return y.replace("%s",d.symbol).replace("%v",v(Math.abs(e),c(d.precision),d.thousand,d.decimal))};n.formatColumn=function(e,t,r,i,s,d){if(!e)return[];var m=f(a(t)?t:{symbol:t,precision:r,thousand:i,decimal:s,format:d},n.settings.currency),g=h(m.format),y=g.pos.indexOf("%s")<g.pos.indexOf("%v")?!0:!1,b=0,w=l(e,function(e,t){if(u(e))return n.formatColumn(e,m);e=p(e);var r=e>0?g.pos:e<0?g.neg:g.zero,i=r.replace("%s",m.symbol).replace("%v",v(Math.abs(e),c(m.precision),m.thousand,m.decimal));return i.length>b&&(b=i.length),i});return l(w,function(e,t){return o(e)&&e.length<b?y?e.replace(m.symbol,m.symbol+(new Array(b-e.length+1)).join(" ")):(new Array(b-e.length+1)).join(" ")+e:e})},typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.accounting=n):typeof define=="function"&&define.amd?define("accounting",[],function(){return n}):(n.noConflict=function(r){return function(){return e.accounting=r,n.noConflict=t,n}}(e.accounting),e.accounting=n)}(this),d3=function(){function p(e){return e!=null&&!isNaN(e)}function v(e){return e.length}function g(e){var t=1;while(e*t%1)t*=10;return t}function y(e,t){try{for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}catch(r){e.prototype=t}}function b(){}function S(){}function x(e,t,n){return function(){var r=n.apply(t,arguments);return r===t?e:r}}function T(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.substring(1);for(var n=0,r=N.length;n<r;++n){var i=N[n]+t;if(i in e)return i}}function C(){}function k(){}function L(e){function r(){var n=t,r=-1,i=n.length,s;while(++r<i)(s=n[r].on)&&s.apply(this,arguments);return e}var t=[],n=new b;return r.on=function(r,i){var s=n.get(r),o;return arguments.length<2?s&&s.on:(s&&(s.on=null,t=t.slice(0,o=t.indexOf(s)).concat(t.slice(o+1)),n.remove(r)),i&&t.push(n.set(r,{on:i})),e)},r}function A(){e.event.preventDefault()}function O(){var t=e.event,n;while(n=t.sourceEvent)t=n;return t}function M(t){var n=new k,r=0,i=arguments.length;while(++r<i)n[arguments[r]]=L(n);return n.of=function(r,i){return function(s){try{var o=s.sourceEvent=e.event;s.target=t,e.event=s,n[s.type].apply(r,i)}finally{e.event=o}}},n}function P(e){return D(e,I),e}function q(e){return typeof e=="function"?e:function(){return H(e,this)}}function R(e){return typeof e=="function"?e:function(){return B(e,this)}}function z(t,n){function r(){this.removeAttribute(t)}function i(){this.removeAttributeNS(t.space,t.local)}function s(){this.setAttribute(t,n)}function o(){this.setAttributeNS(t.space,t.local,n)}function u(){var e=n.apply(this,arguments);e==null?this.removeAttribute(t):this.setAttribute(t,e)}function a(){var e=n.apply(this,arguments);e==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}return t=e.ns.qualify(t),n==null?t.local?i:r:typeof n=="function"?t.local?a:u:t.local?o:s}function W(e){return e.trim().replace(/\s+/g," ")}function X(t){return new RegExp("(?:^|\\s+)"+e.requote(t)+"(?:\\s+|$)","g")}function V(e){return e.trim().split(/^|\s+/)}function $(e,t){function r(){var r=-1;while(++r<n)e[r](this,t)}function i(){var r=-1,i=t.apply(this,arguments);while(++r<n)e[r](this,i)}e=V(e).map(J);var n=e.length;return typeof t=="function"?i:r}function J(e){var t=X(e);return function(n,r){if(i=n.classList)return r?i.add(e):i.remove(e);var i=n.getAttribute("class")||"";r?(t.lastIndex=0,t.test(i)||n.setAttribute("class",W(i+" "+e))):n.setAttribute("class",W(i.replace(t," ")))}}function K(e,t,n){function r(){this.style.removeProperty(e)}function i(){this.style.setProperty(e,t,n)}function s(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}return t==null?r:typeof t=="function"?s:i}function Q(e,t){function n(){delete this[e]}function r(){this[e]=t}function i(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}return t==null?n:typeof t=="function"?i:r}function G(t){return typeof t=="function"?t:(t=e.ns.qualify(t)).local?function(){return this.ownerDocument.createElementNS(t.space,t.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,t)}}function Y(e){return{__data__:e}}function Z(e){return function(){return F(this,e)}}function et(t){return arguments.length||(t=e.ascending),function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}}function tt(e,t){for(var n=0,r=e.length;n<r;n++)for(var i=e[n],s=0,o=i.length,u;s<o;s++)(u=i[s])&&t(u,s,n);return e}function nt(e){return D(e,rt),e}function it(e){var t,n;return function(r,i,s){var o=e[s].update,u=o.length,a;s!=n&&(n=s,t=0),i>=t&&(t=i+1);while(!(a=o[t])&&++t<u);return a}}function st(){var e=this.__transition__;e&&++e.active}function ut(t,r,i){function f(){var e=this[s];e&&(this.removeEventListener(t,e,e.$),delete this[s])}function l(){var e=u(r,n(arguments));f.call(this),this.addEventListener(t,this[s]=e,e.$=i),e._=r}function c(){var n=new RegExp("^__on([^.]+)"+e.requote(t)+"$"),r;for(var i in this)if(r=i.match(n)){var s=this[i];this.removeEventListener(r[1],s,s.$),delete this[i]}}var s="__on"+t,o=t.indexOf("."),u=ft;o>0&&(t=t.substring(0,o));var a=at.get(t);return a&&(t=a,u=lt),o?r?l:f:r?C:c}function ft(t,n){return function(r){var i=e.event;e.event=r,n[0]=this.__data__;try{t.apply(this,n)}finally{e.event=i}}}function lt(e,t){var n=ft(e,t);return function(e){var t=this,r=e.relatedTarget;(!r||r!==t&&!(r.compareDocumentPosition(t)&8))&&n.call(t,e)}}function pt(){var t=".dragsuppress-"+ ++ht,n="click"+t,r=e.select(s).on("touchmove"+t,A).on("dragstart"+t,A).on("selectstart"+t,A);if(ct){var o=i.style,u=o[ct];o[ct]="none"}return function(e){r.on(t,null),ct&&(o[ct]=u);if(e){function i(){r.on(n,null)}r.on(n,function(){A(),i()},!0),setTimeout(i,0)}}}function vt(t,n){n.changedTouches&&(n=n.changedTouches[0]);var r=t.ownerSVGElement||t;if(r.createSVGPoint){var i=r.createSVGPoint();if(dt<0&&(s.scrollX||s.scrollY)){r=e.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var o=r[0][0].getScreenCTM();dt=!o.f&&!o.e,r.remove()}return dt?(i.x=n.pageX,i.y=n.pageY):(i.x=n.clientX,i.y=n.clientY),i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var u=t.getBoundingClientRect();return[n.clientX-u.left-t.clientLeft,n.clientY-u.top-t.clientTop]}function xt(e){return e>0?1:e<0?-1:0}function Tt(e){return e>1?0:e<-1?mt:Math.acos(e)}function Nt(e){return e>1?yt:e<-1?-yt:Math.asin(e)}function Ct(e){return((e=Math.exp(e))-1/e)/2}function kt(e){return((e=Math.exp(e))+1/e)/2}function Lt(e){return((e=Math.exp(2*e))-1)/(e+1)}function At(e){return(e=Math.sin(e/2))*e}function Bt(){}function jt(e,t,n){return new Ft(e,t,n)}function Ft(e,t,n){this.h=e,this.s=t,this.l=n}function qt(e,t,n){function s(e){return e>360?e-=360:e<0&&(e+=360),e<60?r+(i-r)*e/60:e<180?i:e<240?r+(i-r)*(240-e)/60:r}function o(e){return Math.round(s(e)*255)}var r,i;return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)?0:t<0?0:t>1?1:t,n=n<0?0:n>1?1:n,i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i,on(o(e+120),o(e),o(e-120))}function Rt(e,t,n){return new Ut(e,t,n)}function Ut(e,t,n){this.h=e,this.c=t,this.l=n}function Wt(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),Xt(n,Math.cos(e*=Et)*t,Math.sin(e)*t)}function Xt(e,t,n){return new Vt(e,t,n)}function Vt(e,t,n){this.l=e,this.a=t,this.b=n}function Yt(e,t,n){var r=(e+16)/116,i=r+t/500,s=r-n/200;return i=en(i)*Jt,r=en(r)*Kt,s=en(s)*Qt,on(nn(3.2404542*i-1.5371385*r-.4985314*s),nn(-0.969266*i+1.8760108*r+.041556*s),nn(.0556434*i-.2040259*r+1.0572252*s))}function Zt(e,t,n){return e>0?Rt(Math.atan2(n,t)*St,Math.sqrt(t*t+n*n),e):Rt(NaN,NaN,e)}function en(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function tn(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function nn(e){return Math.round(255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function rn(e){return on(e>>16,e>>8&255,e&255)}function sn(e){return rn(e)+""}function on(e,t,n){return new un(e,t,n)}function un(e,t,n){this.r=e,this.g=t,this.b=n}function fn(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function ln(e,t,n){var r=0,i=0,s=0,o,u,a;o=/([a-z]+)\((.*)\)/i.exec(e);if(o){u=o[2].split(",");switch(o[1]){case"hsl":return n(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(dn(u[0]),dn(u[1]),dn(u[2]))}}return(a=vn.get(e))?t(a.r,a.g,a.b):(e!=null&&e.charAt(0)==="#"&&(e.length===4?(r=e.charAt(1),r+=r,i=e.charAt(2),i+=i,s=e.charAt(3),s+=s):e.length===7&&(r=e.substring(1,3),i=e.substring(3,5),s=e.substring(5,7)),r=parseInt(r,16),i=parseInt(i,16),s=parseInt(s,16)),t(r,i,s))}function cn(e,t,n){var r=Math.min(e/=255,t/=255,n/=255),i=Math.max(e,t,n),s=i-r,o,u,a=(i+r)/2;return s?(u=a<.5?s/(i+r):s/(2-i-r),e==i?o=(t-n)/s+(t<n?6:0):t==i?o=(n-e)/s+2:o=(e-t)/s+4,o*=60):(o=NaN,u=a>0&&a<1?0:o),jt(o,u,a)}function hn(e,t,n){e=pn(e),t=pn(t),n=pn(n);var r=tn((.4124564*e+.3575761*t+.1804375*n)/Jt),i=tn((.2126729*e+.7151522*t+.072175*n)/Kt),s=tn((.0193339*e+.119192*t+.9503041*n)/Qt);return Xt(116*i-16,500*(r-i),200*(i-s))}function pn(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function dn(e){var t=parseFloat(e);return e.charAt(e.length-1)==="%"?Math.round(t*2.55):t}function mn(e){return typeof e=="function"?e:function(){return e}}function gn(e){return e}function yn(e){return function(t,n,r){return arguments.length===2&&typeof n=="function"&&(r=n,n=null),bn(t,n,e,r)}}function bn(t,r,i,o){function h(){var e=l.status,t;if(!e&&l.responseText||e>=200&&e<300||e===304){try{t=i.call(u,l)}catch(n){a.error.call(u,n);return}a.load.call(u,t)}else a.error.call(u,l)}var u={},a=e.dispatch("beforesend","progress","load","error"),f={},l=new XMLHttpRequest,c=null;return s.XDomainRequest&&!("withCredentials"in l)&&/^(http(s)?:)?\/\//.test(t)&&(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=h:l.onreadystatechange=function(){l.readyState>3&&h()},l.onprogress=function(t){var n=e.event;e.event=t;try{a.progress.call(u,l)}finally{e.event=n}},u.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?f[e]:(t==null?delete f[e]:f[e]=t+"",u)},u.mimeType=function(e){return arguments.length?(r=e==null?null:e+"",u):r},u.responseType=function(e){return arguments.length?(c=e,u):c},u.response=function(e){return i=e,u},["get","post"].forEach(function(e){u[e]=function(){return u.send.apply(u,[e].concat(n(arguments)))}}),u.send=function(e,n,i){arguments.length===2&&typeof n=="function"&&(i=n,n=null),l.open(e,t,!0),r!=null&&!("accept"in f)&&(f.accept=r+",*/*");if(l.setRequestHeader)for(var s in f)l.setRequestHeader(s,f[s]);return r!=null&&l.overrideMimeType&&l.overrideMimeType(r),c!=null&&(l.responseType=c),i!=null&&u.on("error",i).on("load",function(e){i(null,e)}),a.beforesend.call(u,l),l.send(n==null?null:n),u},u.abort=function(){return l.abort(),u},e.rebind(u,a,"on"),o==null?u:u.get(wn(o))}function wn(e){return e.length===1?function(t,n){e(t==null?n:null)}:e}function kn(){var e=Ln(),t=An()-e;t>24?(isFinite(t)&&(clearTimeout(Tn),Tn=setTimeout(kn,t)),xn=0):(xn=1,Cn(kn))}function Ln(){var e=Date.now();Nn=En;while(Nn)e>=Nn.t&&(Nn.f=Nn.c(e-Nn.t)),Nn=Nn.n;return e}function An(){var e,t=En,n=Infinity;while(t)t.f?t=e?e.n=t.n:En=t.n:(t.t<n&&(n=t.t),t=(e=t).n);return Sn=e,n}function Hn(e,t){var n=Math.pow(10,m(8-t)*3);return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function Fn(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}function In(e){return e+""}function Un(){}function Wn(e,t,n){var r=n.s=e+t,i=r-e,s=r-i;n.t=e-s+(t-i)}function Xn(e,t){e&&$n.hasOwnProperty(e.type)&&$n[e.type](e,t)}function Jn(e,t,n){var r=-1,i=e.length-n,s;t.lineStart();while(++r<i)s=e[r],t.point(s[0],s[1],s[2]);t.lineEnd()}function Kn(e,t){var n=-1,r=e.length;t.polygonStart();while(++n<r)Jn(e[n],t,1);t.polygonEnd()}function Zn(){function s(e,t){e*=Et,t=t*Et/2+mt/4;var s=e-n,o=Math.cos(t),u=Math.sin(t),a=i*u,f=r*o+a*Math.cos(s),l=a*Math.sin(s);Gn.add(Math.atan2(l,f)),n=e,r=o,i=u}var e,t,n,r,i;Yn.point=function(o,u){Yn.point=s,n=(e=o)*Et,r=Math.cos(u=(t=u)*Et/2+mt/4),i=Math.sin(u)},Yn.lineEnd=function(){s(e,t)}}function er(e){var t=e[0],n=e[1],r=Math.cos(n);return[r*Math.cos(t),r*Math.sin(t),Math.sin(n)]}function tr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function nr(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function rr(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function ir(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function sr(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function or(e){return[Math.atan2(e[1],e[0]),Nt(e[2])]}function ur(e,t){return m(e[0]-t[0])<bt&&m(e[1]-t[1])<bt}function wr(e,t){e*=Et;var n=Math.cos(t*=Et);Er(n*Math.cos(e),n*Math.sin(e),Math.sin(t))}function Er(e,t,n){++ar,lr+=(e-lr)/ar,cr+=(t-cr)/ar,hr+=(n-hr)/ar}function Sr(){function r(r,i){r*=Et;var s=Math.cos(i*=Et),o=s*Math.cos(r),u=s*Math.sin(r),a=Math.sin(i),f=Math.atan2(Math.sqrt((f=t*a-n*u)*f+(f=n*o-e*a)*f+(f=e*u-t*o)*f),e*o+t*u+n*a);fr+=f,pr+=f*(e+(e=o)),dr+=f*(t+(t=u)),vr+=f*(n+(n=a)),Er(e,t,n)}var e,t,n;br.point=function(i,s){i*=Et;var o=Math.cos(s*=Et);e=o*Math.cos(i),t=o*Math.sin(i),n=Math.sin(s),br.point=r,Er(e,t,n)}}function xr(){br.point=wr}function Tr(){function s(e,t){e*=Et;var s=Math.cos(t*=Et),o=s*Math.cos(e),u=s*Math.sin(e),a=Math.sin(t),f=r*a-i*u,l=i*o-n*a,c=n*u-r*o,h=Math.sqrt(f*f+l*l+c*c),p=n*o+r*u+i*a,d=h&&-Tt(p)/h,v=Math.atan2(h,p);mr+=d*f,gr+=d*l,yr+=d*c,fr+=v,pr+=v*(n+(n=o)),dr+=v*(r+(r=u)),vr+=v*(i+(i=a)),Er(n,r,i)}var e,t,n,r,i;br.point=function(o,u){e=o,t=u,br.point=s,o*=Et;var a=Math.cos(u*=Et);n=a*Math.cos(o),r=a*Math.sin(o),i=Math.sin(u),Er(n,r,i)},br.lineEnd=function(){s(e,t),br.lineEnd=xr,br.point=wr}}function Nr(){return!0}function Cr(e,t,n,r,i){var s=[],o=[];e.forEach(function(e){if((t=e.length-1)<=0)return;var t,n=e[0],r=e[t];if(ur(n,r)){i.lineStart();for(var u=0;u<t;++u)i.point((n=e[u])[0],n[1]);i.lineEnd();return}var a=new Lr(n,e,null,!0),f=new Lr(n,null,a,!1);a.o=f,s.push(a),o.push(f),a=new Lr(r,e,null,!1),f=new Lr(r,null,a,!0),a.o=f,s.push(a),o.push(f)}),o.sort(t),kr(s),kr(o);if(!s.length)return;for(var u=0,a=n,f=o.length;u<f;++u)o[u].e=a=!a;var l=s[0],c,h;for(;;){var p=l,d=!0;while(p.v)if((p=p.n)===l)return;c=p.z,i.lineStart();do{p.v=p.o.v=!0;if(p.e){if(d)for(var u=0,f=c.length;u<f;++u)i.point((h=c[u])[0],h[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(d){c=p.p.z;for(var u=c.length-1;u>=0;--u)i.point((h=c[u])[0],h[1])}else r(p.x,p.p.x,-1,i);p=p.p}p=p.o,c=p.z,d=!d}while(!p.v);i.lineEnd()}}function kr(e){if(!(t=e.length))return;var t,n=0,r=e[0],i;while(++n<t)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}function Lr(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Ar(t,n,r,i){return function(s,o){function l(e,n){var r=s(e,n);t(e=r[0],n=r[1])&&o.point(e,n)}function c(e,t){var n=s(e,t);u.point(n[0],n[1])}function h(){f.point=c,u.lineStart()}function p(){f.point=l,u.lineEnd()}function b(e,t){y.push([e,t]);var n=s(e,t);m.point(n[0],n[1])}function w(){m.lineStart(),y=[]}function E(){b(y[0][0],y[0][1]),m.lineEnd();var e=m.clean(),t=v.buffer(),n,r=t.length;y.pop(),g.push(y),y=null;if(!r)return;if(e&1){n=t[0];var r=n.length-1,i=-1,s;o.lineStart();while(++i<r)o.point((s=n[i])[0],s[1]);o.lineEnd();return}r>1&&e&2&&t.push(t.pop().concat(t.shift())),d.push(t.filter(Or))}var u=n(o),a=s.invert(i[0],i[1]),f={point:l,lineStart:h,lineEnd:p,polygonStart:function(){f.point=b,f.lineStart=w,f.lineEnd=E,d=[],g=[],o.polygonStart()},polygonEnd:function(){f.point=l,f.lineStart=h,f.lineEnd=p,d=e.merge(d);var t=Dr(a,g);d.length?Cr(d,_r,t,r,o):t&&(o.lineStart(),r(null,null,1,o),o.lineEnd()),o.polygonEnd(),d=g=null},sphere:function(){o.polygonStart(),o.lineStart(),r(null,null,1,o),o.lineEnd(),o.polygonEnd()}},d,v=Mr(),m=n(v),g,y;return f}}function Or(e){return e.length>1}function Mr(){var e=[],t;return{lineStart:function(){e.push(t=[])},point:function(e,n){t.push([e,n])},lineEnd:C,buffer:function(){var n=e;return e=[],t=null,n},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function _r(e,t){return((e=e.x)[0]<0?e[1]-yt-bt:yt-e[1])-((t=t.x)[0]<0?t[1]-yt-bt:yt-t[1])}function Dr(e,t){var n=e[0],r=e[1],i=[Math.sin(n),-Math.cos(n),0],s=0,o=0;Gn.reset();for(var u=0,a=t.length;u<a;++u){var f=t[u],l=f.length;if(!l)continue;var c=f[0],h=c[0],p=c[1]/2+mt/4,d=Math.sin(p),v=Math.cos(p),g=1;for(;;){g===l&&(g=0),e=f[g];var y=e[0],b=e[1]/2+mt/4,w=Math.sin(b),E=Math.cos(b),S=y-h,x=m(S)>mt,T=d*w;Gn.add(Math.atan2(T*Math.sin(S),v*E+T*Math.cos(S))),s+=x?S+(S>=0?gt:-gt):S;if(x^h>=n^y>=n){var N=nr(er(c),er(e));sr(N);var C=nr(i,N);sr(C);var k=(x^S>=0?-1:1)*Nt(C[2]);if(r>k||r===k&&(N[0]||N[1]))o+=x^S>=0?1:-1}if(!(g++))break;h=y,d=w,v=E,c=e}}return(s<-bt||s<bt&&Gn<0)^o&1}function Hr(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(s,o){var u=s>0?mt:-mt,a=m(s-t);m(a-mt)<bt?(e.point(t,n=(n+o)/2>0?yt:-yt),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(u,n),e.point(s,n),i=0):r!==u&&a>=mt&&(m(t-r)<bt&&(t-=r*bt),m(s-u)<bt&&(s-=u*bt),n=Br(t,n,s,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(u,n),i=0),e.point(t=s,n=o),r=u},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function Br(e,t,n,r){var i,s,o=Math.sin(e-n);return m(o)>bt?Math.atan((Math.sin(t)*(s=Math.cos(r))*Math.sin(n)-Math.sin(r)*(i=Math.cos(t))*Math.sin(e))/(i*s*o)):(t+r)/2}function jr(e,t,n,r){var i;if(e==null)i=n*yt,r.point(-mt,i),r.point(0,i),r.point(mt,i),r.point(mt,0),r.point(mt,-i),r.point(0,-i),r.point(-mt,-i),r.point(-mt,0),r.point(-mt,i);else if(m(e[0]-t[0])>bt){var s=e[0]<t[0]?mt:-mt;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function Fr(e){function s(e,n){return Math.cos(e)*Math.cos(n)>t}function o(e){var t,i,o,f,l;return{lineStart:function(){f=o=!1,l=1},point:function(c,h){var p=[c,h],d,v=s(c,h),m=n?v?0:a(c,h):v?a(c+(c<0?mt:-mt),h):0;!t&&(f=o=v)&&e.lineStart();if(v!==o){d=u(t,p);if(ur(t,d)||ur(p,d))p[0]+=bt,p[1]+=bt,v=s(p[0],p[1])}if(v!==o)l=0,v?(e.lineStart(),d=u(p,t),e.point(d[0],d[1])):(d=u(t,p),e.point(d[0],d[1]),e.lineEnd()),t=d;else if(r&&t&&n^v){var g;!(m&i)&&(g=u(p,t,!0))&&(l=0,n?(e.lineStart(),e.point(g[0][0],g[0][1]),e.point(g[1][0],g[1][1]),e.lineEnd()):(e.point(g[1][0],g[1][1]),e.lineEnd(),e.lineStart(),e.point(g[0][0],g[0][1])))}v&&(!t||!ur(t,p))&&e.point(p[0],p[1]),t=p,o=v,i=m},lineEnd:function(){o&&e.lineEnd(),t=null},clean:function(){return l|(f&&o)<<1}}}function u(e,n,r){var i=er(e),s=er(n),o=[1,0,0],u=nr(i,s),a=tr(u,u),f=u[0],l=a-f*f;if(!l)return!r&&e;var c=t*a/l,h=-t*f/l,p=nr(o,u),d=ir(o,c),v=ir(u,h);rr(d,v);var g=p,y=tr(d,g),b=tr(g,g),w=y*y-b*(tr(d,d)-1);if(w<0)return;var E=Math.sqrt(w),S=ir(g,(-y-E)/b);rr(S,d),S=or(S);if(!r)return S;var x=e[0],T=n[0],N=e[1],C=n[1],k;T<x&&(k=x,x=T,T=k);var L=T-x,A=m(L-mt)<bt,O=A||L<bt;!A&&C<N&&(k=N,N=C,C=k);if(O?A?N+C>0^S[1]<(m(S[0]-x)<bt?N:C):N<=S[1]&&S[1]<=C:L>mt^(x<=S[0]&&S[0]<=T)){var M=ir(g,(-y+E)/b);return rr(M,d),[S,or(M)]}}function a(t,r){var i=n?e:mt-e,s=0;return t<-i?s|=1:t>i&&(s|=2),r<-i?s|=4:r>i&&(s|=8),s}var t=Math.cos(e),n=t>0,r=m(t)>bt,i=Si(e,6*Et);return Ar(s,o,i,n?[0,-e]:[-mt,e-mt])}function Ir(e,t,n,r){return function(i){var s=i.a,o=i.b,u=s.x,a=s.y,f=o.x,l=o.y,c=0,h=1,p=f-u,d=l-a,v;v=e-u;if(!p&&v>0)return;v/=p;if(p<0){if(v<c)return;v<h&&(h=v)}else if(p>0){if(v>h)return;v>c&&(c=v)}v=n-u;if(!p&&v<0)return;v/=p;if(p<0){if(v>h)return;v>c&&(c=v)}else if(p>0){if(v<c)return;v<h&&(h=v)}v=t-a;if(!d&&v>0)return;v/=d;if(d<0){if(v<c)return;v<h&&(h=v)}else if(d>0){if(v>h)return;v>c&&(c=v)}v=r-a;if(!d&&v<0)return;v/=d;if(d<0){if(v>h)return;v>c&&(c=v)}else if(d>0){if(v<c)return;v<h&&(h=v)}return c>0&&(i.a={x:u+c*p,y:a+c*d}),h<1&&(i.b={x:u+h*p,y:a+h*d}),i}}function Rr(t,n,r,i){function s(e,i){return m(e[0]-t)<bt?i>0?0:3:m(e[0]-r)<bt?i>0?2:1:m(e[1]-n)<bt?i>0?1:0:i>0?3:2}function o(e,t){return u(e.x,t.x)}function u(e,t){var n=s(e,1),r=s(t,1);return n!==r?n-r:n===0?t[1]-e[1]:n===1?e[0]-t[0]:n===2?e[1]-t[1]:t[0]-e[0]}return function(a){function m(e){var t=0,n=p.length,r=e[1];for(var i=0;i<n;++i)for(var s=1,o=p[i],u=o.length,a=o[0],f;s<u;++s)f=o[s],a[1]<=r?f[1]>r&&g(a,f,e)>0&&++t:f[1]<=r&&g(a,f,e)<0&&--t,a=f;return t!==0}function g(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])}function y(e,o,a,f){var l=0,c=0;if(e==null||(l=s(e,a))!==(c=s(o,a))||u(e,o)<0^a>0){do f.point(l===0||l===3?t:r,l>1?i:n);while((l=(l+a+4)%4)!==c)}else f.point(o[0],o[1])}function b(e,s){return t<=e&&e<=r&&n<=s&&s<=i}function w(e,t){b(e,t)&&a.point(e,t)}function A(){v.point=M,p&&p.push(d=[]),k=!0,C=!1,T=N=NaN}function O(){h&&(M(E,S),x&&C&&l.rejoin(),h.push(l.buffer())),v.point=w,C&&a.lineEnd()}function M(e,t){e=Math.max(-qr,Math.min(qr,e)),t=Math.max(-qr,Math.min(qr,t));var n=b(e,t);p&&d.push([e,t]);if(k)E=e,S=t,x=n,k=!1,n&&(a.lineStart(),a.point(e,t));else if(n&&C)a.point(e,t);else{var r={a:{x:T,y:N},b:{x:e,y:t}};c(r)?(C||(a.lineStart(),a.point(r.a.x,r.a.y)),a.point(r.b.x,r.b.y),n||a.lineEnd(),L=!1):n&&(a.lineStart(),a.point(e,t),L=!1)}T=e,N=t,C=n}var f=a,l=Mr(),c=Ir(t,n,r,i),h,p,d,v={point:w,lineStart:A,lineEnd:O,polygonStart:function(){a=l,h=[],p=[],L=!0},polygonEnd:function(){a=f,h=e.merge(h);var n=m([t,i]),r=L&&n,s=h.length;if(r||s)a.polygonStart(),r&&(a.lineStart(),y(null,null,1,a),a.lineEnd()),s&&Cr(h,o,n,y,a),a.polygonEnd();h=p=d=null}},E,S,x,T,N,C,k,L;return v}}function Ur(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return n=t.invert(n,r),n&&e.invert(n[0],n[1])}),n}function zr(e){var t=0,n=mt/3,r=di(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*mt/180,n=e[1]*mt/180):[t/mt*180,n/mt*180]},i}function Wr(e,t){function o(e,t){var n=Math.sqrt(i-2*r*Math.sin(t))/r;return[n*Math.sin(e*=r),s-n*Math.cos(e)]}var n=Math.sin(e),r=(n+Math.sin(t))/2,i=1+n*(2*r-n),s=Math.sqrt(i)/r;return o.invert=function(e,t){var n=s-t;return[Math.atan2(e,n)/r,Nt((i-(e*e+n*n)*r*r)/(2*r))]},o}function Jr(){function i(e,t){Vr+=r*e-n*t,n=e,r=t}var e,t,n,r;$r.point=function(s,o){$r.point=i,e=n=s,t=r=o},$r.lineEnd=function(){i(e,t)}}function ei(e,t){e<Kr&&(Kr=e),e>Gr&&(Gr=e),t<Qr&&(Qr=t),t>Yr&&(Yr=t)}function ti(){function r(n,r){t.push("M",n,",",r,e)}function i(e,r){t.push("M",e,",",r),n.point=s}function s(e,n){t.push("L",e,",",n)}function o(){n.point=r}function u(){t.push("Z")}var e=ni(4.5),t=[],n={point:r,lineStart:function(){n.point=i},lineEnd:o,polygonStart:function(){n.lineEnd=u},polygonEnd:function(){n.lineEnd=o,n.point=r},pointRadius:function(t){return e=ni(t),n},result:function(){if(t.length){var e=t.join("");return t=[],e}}};return n}function ni(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+ -2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function ii(e,t){lr+=e,cr+=t,++hr}function si(){function n(n,r){var i=n-e,s=r-t,o=Math.sqrt(i*i+s*s);pr+=o*(e+n)/2,dr+=o*(t+r)/2,vr+=o,ii(e=n,t=r)}var e,t;ri.point=function(r,i){ri.point=n,ii(e=r,t=i)}}function oi(){ri.point=ii}function ui(){function i(e,t){var i=e-n,s=t-r,o=Math.sqrt(i*i+s*s);pr+=o*(n+e)/2,dr+=o*(r+t)/2,vr+=o,o=r*e-n*t,mr+=o*(n+e),gr+=o*(r+t),yr+=o*3,ii(n=e,r=t)}var e,t,n,r;ri.point=function(s,o){ri.point=i,ii(e=n=s,t=r=o)},ri.lineEnd=function(){i(e,t)}}function ai(e){function r(n,r){e.moveTo(n,r),e.arc(n,r,t,0,gt)}function i(t,r){e.moveTo(t,r),n.point=s}function s(t,n){e.lineTo(t,n)}function o(){n.point=r}function u(){e.closePath()}var t=4.5,n={point:r,lineStart:function(){n.point=i},lineEnd:o,polygonStart:function(){n.lineEnd=u},polygonEnd:function(){n.lineEnd=o,n.point=r},pointRadius:function(e){return t=e,n},result:C};return n}function fi(e){function i(e){return(r?o:s)(e)}function s(t){return hi(t,function(n,r){n=e(n,r),t.point(n[0],n[1])})}function o(t){function y(n,r){n=e(n,r),t.point(n[0],n[1])}function b(){h=NaN,g.point=w,t.lineStart()}function w(n,i){var s=er([n,i]),o=e(n,i);u(h,p,c,d,v,m,h=o[0],p=o[1],c=n,d=s[0],v=s[1],m=s[2],r,t),t.point(h,p)}function E(){g.point=y,t.lineEnd()}function S(){b(),g.point=x,g.lineEnd=T}function x(e,t){w(n=e,i=t),s=h,o=p,a=d,f=v,l=m,g.point=w}function T(){u(h,p,c,d,v,m,s,o,n,a,f,l,r,t),g.lineEnd=E,E()}var n,i,s,o,a,f,l,c,h,p,d,v,m,g={point:y,lineStart:b,lineEnd:E,polygonStart:function(){t.polygonStart(),g.lineStart=S},polygonEnd:function(){t.polygonEnd(),g.lineStart=b}};return g}function u(r,i,s,o,a,f,l,c,h,p,d,v,g,y){var b=l-r,w=c-i,E=b*b+w*w;if(E>4*t&&g--){var S=o+p,x=a+d,T=f+v,N=Math.sqrt(S*S+x*x+T*T),C=Math.asin(T/=N),k=m(m(T)-1)<bt||m(s-h)<bt?(s+h)/2:Math.atan2(x,S),L=e(k,C),A=L[0],O=L[1],M=A-r,_=O-i,D=w*M-b*_;if(D*D/E>t||m((b*M+w*_)/E-.5)>.3||o*p+a*d+f*v<n)u(r,i,s,o,a,f,A,O,k,S/=N,x/=N,T,g,y),y.point(A,O),u(A,O,k,S,x,T,l,c,h,p,d,v,g,y)}}var t=.5,n=Math.cos(30*Et),r=16;return i.precision=function(e){return arguments.length?(r=(t=e*e)>0&&16,i):Math.sqrt(t)},i}function li(e){var t=fi(function(t,n){return e([t*St,n*St])});return function(e){return vi(t(e))}}function ci(e){this.stream=e}function hi(e,t){return{point:t,sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}function pi(e){return di(function(){return e})()}function di(t){function E(e){return e=i(e[0]*Et,e[1]*Et),[e[0]*o+d,v-e[1]*o]}function S(e){return e=i.invert((e[0]-d)/o,(v-e[1])/o),e&&[e[0]*St,e[1]*St]}function x(){i=Ur(r=yi(c,h,p),n);var e=n(f,l);return d=u-e[0]*o,v=a+e[1]*o,T()}function T(){return w&&(w.valid=!1,w=null),E}var n,r,i,s=fi(function(e,t){return e=n(e,t),[e[0]*o+d,v-e[1]*o]}),o=150,u=480,a=250,f=0,l=0,c=0,h=0,p=0,d,v,m=Pr,g=gn,y=null,b=null,w;return E.stream=function(e){return w&&(w.valid=!1),w=vi(m(r,s(g(e)))),w.valid=!0,w},E.clipAngle=function(e){return arguments.length?(m=e==null?(y=e,Pr):Fr((y=+e)*Et),T()):y},E.clipExtent=function(e){return arguments.length?(b=e,g=e?Rr(e[0][0],e[0][1],e[1][0],e[1][1]):gn,T()):b},E.scale=function(e){return arguments.length?(o=+e,x()):o},E.translate=function(e){return arguments.length?(u=+e[0],a=+e[1],x()):[u,a]},E.center=function(e){return arguments.length?(f=e[0]%360*Et,l=e[1]%360*Et,x()):[f*St,l*St]},E.rotate=function(e){return arguments.length?(c=e[0]%360*Et,h=e[1]%360*Et,p=e.length>2?e[2]%360*Et:0,x()):[c*St,h*St,p*St]},e.rebind(E,s,"precision"),function(){return n=t.apply(this,arguments),E.invert=n.invert&&S,x()}}function vi(e){return hi(e,function(t,n){e.point(t*Et,n*Et)})}function mi(e,t){return[e,t]}function gi(e,t){return[e>mt?e-gt:e<-mt?e+gt:e,t]}function yi(e,t,n){return e?t||n?Ur(wi(e),Ei(t,n)):wi(e):t||n?Ei(t,n):gi}function bi(e){return function(t,n){return t+=e,[t>mt?t-gt:t<-mt?t+gt:t,n]}}function wi(e){var t=bi(e);return t.invert=bi(-e),t}function Ei(e,t){function o(e,t){var o=Math.cos(t),u=Math.cos(e)*o,a=Math.sin(e)*o,f=Math.sin(t),l=f*n+u*r;return[Math.atan2(a*i-l*s,u*n-f*r),Nt(l*i+a*s)]}var n=Math.cos(e),r=Math.sin(e),i=Math.cos(t),s=Math.sin(t);return o.invert=function(e,t){var o=Math.cos(t),u=Math.cos(e)*o,a=Math.sin(e)*o,f=Math.sin(t),l=f*i-a*s;return[Math.atan2(a*i+f*s,u*n+l*r),Nt(l*n-u*r)]},o}function Si(e,t){var n=Math.cos(e),r=Math.sin(e);return function(i,s,o,u){var a=o*t;if(i!=null){i=xi(n,i),s=xi(n,s);if(o>0?i<s:i>s)i+=o*gt}else i=e+o*gt,s=e-.5*a;for(var f,l=i;o>0?l>s:l<s;l-=a)u.point((f=or([n,-r*Math.cos(l),-r*Math.sin(l)]))[0],f[1])}}function xi(e,t){var n=er(t);n[0]-=e,sr(n);var r=Tt(-n[1]);return((-n[2]<0?-r:r)+2*Math.PI-bt)%(2*Math.PI)}function Ti(t,n,r){var i=e.range(t,n-bt,r).concat(n);return function(e){return i.map(function(t){return[e,t]})}}function Ni(t,n,r){var i=e.range(t,n-bt,r).concat(n);return function(e){return i.map(function(t){return[t,e]})}}function Ci(e){return e.source}function ki(e){return e.target}function Li(e,t,n,r){var i=Math.cos(t),s=Math.sin(t),o=Math.cos(r),u=Math.sin(r),a=i*Math.cos(e),f=i*Math.sin(e),l=o*Math.cos(n),c=o*Math.sin(n),h=2*Math.asin(Math.sqrt(At(r-t)+i*o*At(n-e))),p=1/Math.sin(h),d=h?function(e){var t=Math.sin(e*=h)*p,n=Math.sin(h-e)*p,r=n*a+t*l,i=n*f+t*c,o=n*s+t*u;return[Math.atan2(i,r)*St,Math.atan2(o,Math.sqrt(r*r+i*i))*St]}:function(){return[e*St,t*St]};return d.distance=h,d}function Mi(){function r(r,i){var s=Math.sin(i*=Et),o=Math.cos(i),u=m((r*=Et)-e),a=Math.cos(u);Ai+=Math.atan2(Math.sqrt((u=o*Math.sin(u))*u+(u=n*s-t*o*a)*u),t*s+n*o*a),e=r,t=s,n=o}var e,t,n;Oi.point=function(i,s){e=i*Et,t=Math.sin(s*=Et),n=Math.cos(s),Oi.point=r},Oi.lineEnd=function(){Oi.point=Oi.lineEnd=C}}function _i(e,t){function n(t,n){var r=Math.cos(t),i=Math.cos(n),s=e(r*i);return[s*i*Math.sin(t),s*Math.sin(n)]}return n.invert=function(e,n){var r=Math.sqrt(e*e+n*n),i=t(r),s=Math.sin(i),o=Math.cos(i);return[Math.atan2(e*s,r*o),Math.asin(r&&n*s/r)]},n}function Hi(e,t){function o(e,t){var n=m(m(t)-yt)<bt?0:s/Math.pow(r(t),i);return[n*Math.sin(i*e),s-n*Math.cos(i*e)]}var n=Math.cos(e),r=function(e){return Math.tan(mt/4+e/2)},i=e===t?Math.sin(e):Math.log(n/Math.cos(t))/Math.log(r(t)/r(e)),s=n*Math.pow(r(e),i)/i;return i?(o.invert=function(e,t){var n=s-t,r=xt(i)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/i,2*Math.atan(Math.pow(s/r,1/i))-yt]},o):Fi}function Bi(e,t){function s(e,t){var n=i-t;return[n*Math.sin(r*e),i-n*Math.cos(r*e)]}var n=Math.cos(e),r=e===t?Math.sin(e):(n-Math.cos(t))/(t-e),i=n/r+e;return m(r)<bt?mi:(s.invert=function(e,t){var n=i-t;return[Math.atan2(e,n)/r,i-xt(r)*Math.sqrt(e*e+n*n)]},s)}function Fi(e,t){return[e,Math.log(Math.tan(mt/4+t/2))]}function Ii(e){var t=pi(e),n=t.scale,r=t.translate,i=t.clipExtent,s;return t.scale=function(){var e=n.apply(t,arguments);return e===t?s?t.clipExtent(null):t:e},t.translate=function(){var e=r.apply(t,arguments);return e===t?s?t.clipExtent(null):t:e},t.clipExtent=function(e){var o=i.apply(t,arguments);if(o===t){if(s=e==null){var u=mt*n(),a=r();i([[a[0]-u,a[1]-u],[a[0]+u,a[1]+u]])}}else s&&(o=null);return o},t.clipExtent(null)}function Ui(e,t){return[Math.log(Math.tan(mt/4+t/2)),-e]}function zi(e){return e[0]}function Wi(e){return e[1]}function Xi(e,t,n,r){var i,s,o,u,a,f,l;return i=r[e],s=i[0],o=i[1],i=r[t],u=i[0],a=i[1],i=r[n],f=i[0],l=i[1],(l-o)*(u-s)-(a-o)*(f-s)>0}function $i(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function Ji(e,t,n,r){var i=e[0],s=n[0],o=t[0]-i,u=r[0]-s,a=e[1],f=n[1],l=t[1]-a,c=r[1]-f,h=(u*(a-f)-c*(i-s))/(c*o-u*l);return[i+h*o,a+h*l]}function Ki(e){var t=e[0],n=e[e.length-1];return!(t[0]-n[0]||t[1]-n[1])}function rs(){Ts(this),this.edge=this.site=this.circle=null}function is(e){var t=Zi.pop()||new rs;return t.site=e,t}function ss(e){vs(e),Yi.remove(e),Zi.push(e),Ts(e)}function os(e){var t=e.circle,n=t.x,r=t.cy,i={x:n,y:r},s=e.P,o=e.N,u=[e];ss(e);var a=s;while(a.circle&&m(n-a.circle.x)<bt&&m(r-a.circle.cy)<bt)s=a.P,u.unshift(a),ss(a),a=s;u.unshift(a),vs(a);var f=o;while(f.circle&&m(n-f.circle.x)<bt&&m(r-f.circle.cy)<bt)o=f.N,u.push(f),ss(f),f=o;u.push(f),vs(f);var l=u.length,c;for(c=1;c<l;++c)f=u[c],a=u[c-1],Es(f.edge,a.site,f.site,i);a=u[0],f=u[l-1],f.edge=bs(a.site,f.site,null,i),ds(a),ds(f)}function us(e){var t=e.x,n=e.y,r,i,s,o,u=Yi._;while(u){s=as(u,n)-t;if(s>bt)u=u.L;else{o=t-fs(u,n);if(!(o>bt)){s>-bt?(r=u.P,i=u):o>-bt?(r=u,i=u.N):r=i=u;break}if(!u.R){r=u;break}u=u.R}}var a=is(e);Yi.insert(r,a);if(!r&&!i)return;if(r===i){vs(r),i=is(r.site),Yi.insert(a,i),a.edge=i.edge=bs(r.site,a.site),ds(r),ds(i);return}if(!i){a.edge=bs(r.site,a.site);return}vs(r),vs(i);var f=r.site,l=f.x,c=f.y,h=e.x-l,p=e.y-c,d=i.site,v=d.x-l,m=d.y-c,g=2*(h*m-p*v),y=h*h+p*p,b=v*v+m*m,w={x:(m*y-p*b)/g+l,y:(h*b-v*y)/g+c};Es(i.edge,f,d,w),a.edge=bs(f,e,null,w),i.edge=bs(e,d,null,w),ds(r),ds(i)}function as(e,t){var n=e.site,r=n.x,i=n.y,s=i-t;if(!s)return r;var o=e.P;if(!o)return-Infinity;n=o.site;var u=n.x,a=n.y,f=a-t;if(!f)return u;var l=u-r,c=1/s-1/f,h=l/f;return c?(-h+Math.sqrt(h*h-2*c*(l*l/(-2*f)-a+f/2+i-s/2)))/c+r:(r+u)/2}function fs(e,t){var n=e.N;if(n)return as(n,t);var r=e.site;return r.y===t?r.x:Infinity}function ls(e){this.site=e,this.edges=[]}function cs(e){var t=e[0][0],n=e[1][0],r=e[0][1],i=e[1][1],s,o,u,a,f=Gi,l=f.length,c,h,p,d,v,g;while(l--){c=f[l];if(!c||!c.prepare())continue;p=c.edges,d=p.length,h=0;while(h<d){g=p[h].end(),u=g.x,a=g.y,v=p[++h%d].start(),s=v.x,o=v.y;if(m(u-s)>bt||m(a-o)>bt)p.splice(h,0,new Ss(ws(c.site,g,m(u-t)<bt&&i-a>bt?{x:t,y:m(s-t)<bt?o:i}:m(a-i)<bt&&n-u>bt?{x:m(o-i)<bt?s:n,y:i}:m(u-n)<bt&&a-r>bt?{x:n,y:m(s-n)<bt?o:r}:m(a-r)<bt&&u-t>bt?{x:m(o-r)<bt?s:t,y:r}:null),c.site,null)),++d}}}function hs(e,t){return t.angle-e.angle}function ps(){Ts(this),this.x=this.y=this.arc=this.site=this.cy=null}function ds(e){var t=e.P,n=e.N;if(!t||!n)return;var r=t.site,i=e.site,s=n.site;if(r===s)return;var o=i.x,u=i.y,a=r.x-o,f=r.y-u,l=s.x-o,c=s.y-u,h=2*(a*c-f*l);if(h>=-wt)return;var p=a*a+f*f,d=l*l+c*c,v=(c*p-f*d)/h,m=(a*d-l*p)/h,c=m+u,g=ns.pop()||new ps;g.arc=e,g.site=i,g.x=v+o,g.y=c+Math.sqrt(v*v+m*m),g.cy=c,e.circle=g;var y=null,b=ts._;while(b)if(g.y<b.y||g.y===b.y&&g.x<=b.x){if(!b.L){y=b.P;break}b=b.L}else{if(!b.R){y=b;break}b=b.R}ts.insert(y,g),y||(es=g)}function vs(e){var t=e.circle;t&&(t.P||(es=t.N),ts.remove(t),ns.push(t),Ts(t),e.circle=null)}function ms(e){var t=Qi,n=Ir(e[0][0],e[0][1],e[1][0],e[1][1]),r=t.length,i;while(r--){i=t[r];if(!gs(i,e)||!n(i)||m(i.a.x-i.b.x)<bt&&m(i.a.y-i.b.y)<bt)i.a=i.b=null,t.splice(r,1)}}function gs(e,t){var n=e.b;if(n)return!0;var r=e.a,i=t[0][0],s=t[1][0],o=t[0][1],u=t[1][1],a=e.l,f=e.r,l=a.x,c=a.y,h=f.x,p=f.y,d=(l+h)/2,v=(c+p)/2,m,g;if(p===c){if(d<i||d>=s)return;if(l>h){if(!r)r={x:d,y:o};else if(r.y>=u)return;n={x:d,y:u}}else{if(!r)r={x:d,y:u};else if(r.y<o)return;n={x:d,y:o}}}else{m=(l-h)/(p-c),g=v-m*d;if(m<-1||m>1)if(l>h){if(!r)r={x:(o-g)/m,y:o};else if(r.y>=u)return;n={x:(u-g)/m,y:u}}else{if(!r)r={x:(u-g)/m,y:u};else if(r.y<o)return;n={x:(o-g)/m,y:o}}else if(c<p){if(!r)r={x:i,y:m*i+g};else if(r.x>=s)return;n={x:s,y:m*s+g}}else{if(!r)r={x:s,y:m*s+g};else if(r.x<i)return;n={x:i,y:m*i+g}}}return e.a=r,e.b=n,!0}function ys(e,t){this.l=e,this.r=t,this.a=this.b=null}function bs(e,t,n,r){var i=new ys(e,t);return Qi.push(i),n&&Es(i,e,t,n),r&&Es(i,t,e,r),Gi[e.i].edges.push(new Ss(i,e,t)),Gi[t.i].edges.push(new Ss(i,t,e)),i}function ws(e,t,n){var r=new ys(e,null);return r.a=t,r.b=n,Qi.push(r),r}function Es(e,t,n,r){!e.a&&!e.b?(e.a=r,e.l=t,e.r=n):e.l===n?e.b=r:e.a=r}function Ss(e,t,n){var r=e.a,i=e.b;this.edge=e,this.site=t,this.angle=n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y)}function xs(){this._=null}function Ts(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function Ns(e,t){var n=t,r=t.R,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function Cs(e,t){var n=t,r=t.L,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function ks(e){while(e.L)e=e.L;return e}function Ls(e,t){var n=e.sort(As).pop(),r,i,s;Qi=[],Gi=new Array(e.length),Yi=new xs,ts=new xs;for(;;){s=es;if(n&&(!s||n.y<s.y||n.y===s.y&&n.x<s.x)){if(n.x!==r||n.y!==i)Gi[n.i]=new ls(n),us(n),r=n.x,i=n.y;n=e.pop()}else{if(!s)break;os(s.arc)}}t&&(ms(t),cs(t));var o={cells:Gi,edges:Qi};return Yi=ts=Qi=Gi=null,o}function As(e,t){return t.y-e.y||t.x-e.x}function Ms(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function _s(e){return e.x}function Ds(e){return e.y}function Ps(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function Hs(e,t,n,r,i,s){if(!e(t,n,r,i,s)){var o=(n+i)*.5,u=(r+s)*.5,a=t.nodes;a[0]&&Hs(e,a[0],n,r,o,u),a[1]&&Hs(e,a[1],o,r,i,u),a[2]&&Hs(e,a[2],n,u,o,s),a[3]&&Hs(e,a[3],o,u,i,s)}}function Bs(t,n){t=e.rgb(t),n=e.rgb(n);var r=t.r,i=t.g,s=t.b,o=n.r-r,u=n.g-i,a=n.b-s;return function(e){return"#"+fn(Math.round(r+o*e))+fn(Math.round(i+u*e))+fn(Math.round(s+a*e))}}function js(e,t){var n={},r={},i;for(i in e)i in t?n[i]=Rs(e[i],t[i]):r[i]=e[i];for(i in t)i in e||(r[i]=t[i]);return function(e){for(i in n)r[i]=n[i](e);return r}}function Fs(e,t){return t-=e=+e,function(n){return e+t*n}}function Is(e,t){var n,r,i,s=0,o=0,u=[],a=[],f,l;e+="",t+="",qs.lastIndex=0;for(r=0;n=qs.exec(t);++r)n.index&&u.push(t.substring(s,o=n.index)),a.push({i:u.length,x:n[0]}),u.push(null),s=qs.lastIndex;s<t.length&&u.push(t.substring(s));for(r=0,f=a.length;(n=qs.exec(e))&&r<f;++r){l=a[r];if(l.x==n[0]){if(l.i)if(u[l.i+1]==null){u[l.i-1]+=l.x,u.splice(l.i,1);for(i=r+1;i<f;++i)a[i].i--}else{u[l.i-1]+=l.x+u[l.i+1],u.splice(l.i,2);for(i=r+1;i<f;++i)a[i].i-=2}else if(u[l.i+1]==null)u[l.i]=l.x;else{u[l.i]=l.x+u[l.i+1],u.splice(l.i+1,1);for(i=r+1;i<f;++i)a[i].i--}a.splice(r,1),f--,r--}else l.x=Fs(parseFloat(n[0]),parseFloat(l.x))}while(r<f)l=a.pop(),u[l.i+1]==null?u[l.i]=l.x:(u[l.i]=l.x+u[l.i+1],u.splice(l.i+1,1)),f--;return u.length===1?u[0]==null?(l=a[0].x,function(e){return l(e)+""}):function(){return t}:function(e){for(r=0;r<f;++r)u[(l=a[r]).i]=l.x(e);return u.join("")}}function Rs(t,n){var r=e.interpolators.length,i;while(--r>=0&&!(i=e.interpolators[r](t,n)));return i}function Us(e,t){var n=[],r=[],i=e.length,s=t.length,o=Math.min(e.length,t.length),u;for(u=0;u<o;++u)n.push(Rs(e[u],t[u]));for(;u<i;++u)r[u]=e[u];for(;u<s;++u)r[u]=t[u];return function(e){for(u=0;u<o;++u)r[u]=n[u](e);return r}}function Vs(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function $s(e){return function(t){return 1-e(1-t)}}function Js(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function Ks(e){return e*e}function Qs(e){return e*e*e}function Gs(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function Ys(e){return function(t){return Math.pow(t,e)}}function Zs(e){return 1-Math.cos(e*yt)}function eo(e){return Math.pow(2,10*(e-1))}function to(e){return 1-Math.sqrt(1-e*e)}function no(e,t){var n;return arguments.length<2&&(t=.45),arguments.length?n=t/gt*Math.asin(1/e):(e=1,n=t/4),function(r){return 1+e*Math.pow(2,-10*r)*Math.sin((r-n)*gt/t)}}function ro(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function io(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function so(t,n){t=e.hcl(t),n=e.hcl(n);var r=t.h,i=t.c,s=t.l,o=n.h-r,u=n.c-i,a=n.l-s;return isNaN(u)&&(u=0,i=isNaN(i)?n.c:i),isNaN(o)?(o=0,r=isNaN(r)?n.h:r):o>180?o-=360:o<-180&&(o+=360),function(e){return Wt(r+o*e,i+u*e,s+a*e)+""}}function oo(t,n){t=e.hsl(t),n=e.hsl(n);var r=t.h,i=t.s,s=t.l,o=n.h-r,u=n.s-i,a=n.l-s;return isNaN(u)&&(u=0,i=isNaN(i)?n.s:i),isNaN(o)?(o=0,r=isNaN(r)?n.h:r):o>180?o-=360:o<-180&&(o+=360),function(e){return qt(r+o*e,i+u*e,s+a*e)+""}}function uo(t,n){t=e.lab(t),n=e.lab(n);var r=t.l,i=t.a,s=t.b,o=n.l-r,u=n.a-i,a=n.b-s;return function(e){return Yt(r+o*e,i+u*e,s+a*e)+""}}function ao(e,t){return t-=e,function(n){return Math.round(e+t*n)}}function fo(e){var t=[e.a,e.b],n=[e.c,e.d],r=co(t),i=lo(t,n),s=co(ho(n,t,-i))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*St,this.translate=[e.e,e.f],this.scale=[r,s],this.skew=s?Math.atan2(i,s)*St:0}function lo(e,t){return e[0]*t[0]+e[1]*t[1]}function co(e){var t=Math.sqrt(lo(e,e));return t&&(e[0]/=t,e[1]/=t),t}function ho(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function vo(t,n){var r=[],i=[],s,o=e.transform(t),u=e.transform(n),a=o.translate,f=u.translate,l=o.rotate,c=u.rotate,h=o.skew,p=u.skew,d=o.scale,v=u.scale;return a[0]!=f[0]||a[1]!=f[1]?(r.push("translate(",null,",",null,")"),i.push({i:1,x:Fs(a[0],f[0])},{i:3,x:Fs(a[1],f[1])})):f[0]||f[1]?r.push("translate("+f+")"):r.push(""),l!=c?(l-c>180?c+=360:c-l>180&&(l+=360),i.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:Fs(l,c)})):c&&r.push(r.pop()+"rotate("+c+")"),h!=p?i.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:Fs(h,p)}):p&&r.push(r.pop()+"skewX("+p+")"),d[0]!=v[0]||d[1]!=v[1]?(s=r.push(r.pop()+"scale(",null,",",null,")"),i.push({i:s-4,x:Fs(d[0],v[0])},{i:s-2,x:Fs(d[1],v[1])})):(v[0]!=1||v[1]!=1)&&r.push(r.pop()+"scale("+v+")"),s=i.length,function(e){var t=-1,n;while(++t<s)r[(n=i[t]).i]=n.x(e);return r.join("")}}function mo(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return(n-e)*t}}function go(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return Math.max(0,Math.min(1,(n-e)*t))}}function yo(e){var t=e.source,n=e.target,r=wo(t,n),i=[t];while(t!==r)t=t.parent,i.push(t);var s=i.length;while(n!==r)i.splice(s,0,n),n=n.parent;return i}function bo(e){var t=[],n=e.parent;while(n!=null)t.push(e),e=n,n=n.parent;return t.push(e),t}function wo(e,t){if(e===t)return e;var n=bo(e),r=bo(t),i=n.pop(),s=r.pop(),o=null;while(i===s)o=i,i=n.pop(),s=r.pop();return o}function Eo(e){e.fixed|=2}function So(e){e.fixed&=-7}function xo(e){e.fixed|=4,e.px=e.x,e.py=e.y}function To(e){e.fixed&=-5}function No(e,t,n){var r=0,i=0;e.charge=0;if(!e.leaf){var s=e.nodes,o=s.length,u=-1,a;while(++u<o){a=s[u];if(a==null)continue;No(a,t,n),e.charge+=a.charge,r+=a.charge*a.cx,i+=a.charge*a.cy}}if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var f=t*n[e.point.index];e.charge+=e.pointCharge=f,r+=f*e.point.x,i+=f*e.point.y}e.cx=r/e.charge,e.cy=i/e.charge}function Lo(t,n){return e.rebind(t,n,"sort","children","value"),t.nodes=t,t.links=_o,t}function Ao(e){return e.children}function Oo(e){return e.value}function Mo(e,t){return t.value-e.value}function _o(t){return e.merge(t.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function Po(e){return e.x}function Ho(e){return e.y}function Bo(e,t,n){e.y0=t,e.y=n}function Io(t){return e.range(t.length)}function qo(e){var t=-1,n=e[0].length,r=[];while(++t<n)r[t]=0;return r}function Ro(e){var t=1,n=0,r=e[0][1],i,s=e.length;for(;t<s;++t)(i=e[t][1])>r&&(n=t,r=i);return n}function Uo(e){return e.reduce(zo,0)}function zo(e,t){return e+t[1]}function Wo(e,t){return Xo(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function Xo(e,t){var n=-1,r=+e[0],i=(e[1]-r)/t,s=[];while(++n<=t)s[n]=i*n+r;return s}function Vo(t){return[e.min(t),e.max(t)]}function $o(e,t){return e.parent==t.parent?1:2}function Jo(e){var t=e.children;return t&&t.length?t[0]:e._tree.thread}function Ko(e){var t=e.children,n;return t&&(n=t.length)?t[n-1]:e._tree.thread}function Qo(e,t){var n=e.children;if(n&&(i=n.length)){var r,i,s=-1;while(++s<i)t(r=Qo(n[s],t),e)>0&&(e=r)}return e}function Go(e,t){return e.x-t.x}function Yo(e,t){return t.x-e.x}function Zo(e,t){return e.depth-t.depth}function eu(e,t){function n(e,r){var i=e.children;if(i&&(a=i.length)){var s,o=null,u=-1,a;while(++u<a)s=i[u],n(s,o),o=s}t(e,r)}n(e,null)}function tu(e){var t=0,n=0,r=e.children,i=r.length,s;while(--i>=0)s=r[i]._tree,s.prelim+=t,s.mod+=t,t+=s.shift+(n+=s.change)}function nu(e,t,n){e=e._tree,t=t._tree;var r=n/(t.number-e.number);e.change+=r,t.change-=r,t.shift+=n,t.prelim+=n,t.mod+=n}function ru(e,t,n){return e._tree.ancestor.parent==t.parent?e._tree.ancestor:n}function iu(e,t){return e.value-t.value}function su(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function ou(e,t){e._pack_next=t,t._pack_prev=e}function uu(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.r+t.r;return.999*i*i>n*n+r*r}function au(e){function p(e){n=Math.min(e.x-e.r,n),r=Math.max(e.x+e.r,r),i=Math.min(e.y-e.r,i),s=Math.max(e.y+e.r,s)}if(!(t=e.children)||!(h=t.length))return;var t,n=Infinity,r=-Infinity,i=Infinity,s=-Infinity,o,u,a,f,l,c,h;t.forEach(fu),o=t[0],o.x=-o.r,o.y=0,p(o);if(h>1){u=t[1],u.x=u.r,u.y=0,p(u);if(h>2){a=t[2],hu(o,u,a),p(a),su(o,a),o._pack_prev=a,su(a,u),u=o._pack_next;for(f=3;f<h;f++){hu(o,u,a=t[f]);var d=0,v=1,m=1;for(l=u._pack_next;l!==u;l=l._pack_next,v++)if(uu(l,a)){d=1;break}if(d==1)for(c=o._pack_prev;c!==l._pack_prev;c=c._pack_prev,m++)if(uu(c,a))break;d?(v<m||v==m&&u.r<o.r?ou(o,u=l):ou(o=c,u),f--):(su(o,a),u=a,p(a))}}}var g=(n+r)/2,y=(i+s)/2,b=0;for(f=0;f<h;f++)a=t[f],a.x-=g,a.y-=y,b=Math.max(b,a.r+Math.sqrt(a.x*a.x+a.y*a.y));e.r=b,t.forEach(lu)}function fu(e){e._pack_next=e._pack_prev=e}function lu(e){delete e._pack_next,delete e._pack_prev}function cu(e,t,n,r){var i=e.children;e.x=t+=r*e.x,e.y=n+=r*e.y,e.r*=r;if(i){var s=-1,o=i.length;while(++s<o)cu(i[s],t,n,r)}}function hu(e,t,n){var r=e.r+n.r,i=t.x-e.x,s=t.y-e.y;if(r&&(i||s)){var o=t.r+n.r,u=i*i+s*s;o*=o,r*=r;var a=.5+(r-o)/(2*u),f=Math.sqrt(Math.max(0,2*o*(r+u)-(r-=u)*r-o*o))/(2*u);n.x=e.x+a*i+f*s,n.y=e.y+a*s-f*i}else n.x=e.x+r,n.y=e.y}function pu(t){return 1+e.max(t,function(e){return e.y})}function du(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function vu(e){var t=e.children;return t&&t.length?vu(t[0]):e}function mu(e){var t=e.children,n;return t&&(n=t.length)?mu(t[n-1]):e}function gu(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function yu(e,t){var n=e.x+t[3],r=e.y+t[0],i=e.dx-t[1]-t[3],s=e.dy-t[0]-t[2];return i<0&&(n+=i/2,i=0),s<0&&(r+=s/2,s=0),{x:n,y:r,dx:i,dy:s}}function bu(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function wu(e){return e.rangeExtent?e.rangeExtent():bu(e.range())}function Eu(e,t,n,r){var i=n(e[0],e[1]),s=r(t[0],t[1]);return function(e){return s(i(e))}}function Su(e,t){var n=0,r=e.length-1,i=e[n],s=e[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),e[n]=t.floor(i),e[r]=t.ceil(s),e}function xu(e){return e?{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}:Tu}function Nu(t,n,r,i){var s=[],o=[],u=0,a=Math.min(t.length,n.length)-1;t[a]<t[0]&&(t=t.slice().reverse(),n=n.slice().reverse());while(++u<=a)s.push(r(t[u-1],t[u])),o.push(i(n[u-1],n[u]));return function(n){var r=e.bisect(t,n,1,a)-1;return o[r](s[r](n))}}function Cu(e,t,n,r){function o(){var o=Math.min(e.length,t.length)>2?Nu:Eu,a=r?go:mo;return i=o(e,t,a,n),s=o(t,e,a,Rs),u}function u(e){return i(e)}var i,s;return u.invert=function(e){return s(e)},u.domain=function(t){return arguments.length?(e=t.map(Number),o()):e},u.range=function(e){return arguments.length?(t=e,o()):t},u.rangeRound=function(e){return u.range(e).interpolate(ao)},u.clamp=function(e){return arguments.length?(r=e,o()):r},u.interpolate=function(e){return arguments.length?(n=e,o()):n},u.ticks=function(t){return Ou(e,t)},u.tickFormat=function(t,n){return Mu(e,t,n)},u.nice=function(t){return Lu(e,t),o()},u.copy=function(){return Cu(e,t,n,r)},o()}function ku(t,n){return e.rebind(t,n,"range","rangeRound","interpolate","clamp")}function Lu(e,t){return Su(e,xu(Au(e,t)[2]))}function Au(e,t){t==null&&(t=10);var n=bu(e),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),s=t/r*i;return s<=.15?i*=10:s<=.35?i*=5:s<=.75&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+i*.5,n[2]=i,n}function Ou(t,n){return e.range.apply(e,Au(t,n))}function Mu(t,n,r){var i=Au(t,n);return e.format(r?r.replace(Bn,function(e,t,n,r,s,o,u,a,f,l){return[t,n,r,s,o,u,a,f||"."+Pu(l,i),l].join("")}):",."+Du(i[2])+"f")}function Du(e){return-Math.floor(Math.log(e)/Math.LN10+.01)}function Pu(e,t){var n=Du(t[2]);return e in _u?Math.abs(n-Du(Math.max(Math.abs(t[0]),Math.abs(t[1]))))+ +(e!=="e"):n-(e==="%")*2}function Hu(t,n,r,i){function s(e){return(r?Math.log(e<0?0:e):-Math.log(e>0?0:-e))/Math.log(n)}function o(e){return r?Math.pow(n,e):-Math.pow(n,-e)}function u(e){return t(s(e))}return u.invert=function(e){return o(t.invert(e))},u.domain=function(e){return arguments.length?(r=e[0]>=0,t.domain((i=e.map(Number)).map(s)),u):i},u.base=function(e){return arguments.length?(n=+e,t.domain(i.map(s)),u):n},u.nice=function(){var e=Su(i.map(s),r?Math:ju);return t.domain(e),i=e.map(o),u},u.ticks=function(){var e=bu(i),t=[],u=e[0],a=e[1],f=Math.floor(s(u)),l=Math.ceil(s(a)),c=n%1?2:n;if(isFinite(l-f)){if(r){for(;f<l;f++)for(var h=1;h<c;h++)t.push(o(f)*h);t.push(o(f))}else{t.push(o(f));for(;f++<l;)for(var h=c-1;h>0;h--)t.push(o(f)*h)}for(f=0;t[f]<u;f++);for(l=t.length;t[l-1]>a;l--);t=t.slice(f,l)}return t},u.tickFormat=function(t,n){if(!arguments.length)return Bu;arguments.length<2?n=Bu:typeof n!="function"&&(n=e.format(n));var i=Math.max(.1,t/u.ticks().length),a=r?(f=1e-12,Math.ceil):(f=-1e-12,Math.floor),f;return function(e){return e/o(a(s(e)+f))<=i?n(e):""}},u.copy=function(){return Hu(t.copy(),n,r,i)},ku(u,t)}function Fu(e,t,n){function s(t){return e(r(t))}var r=Iu(t),i=Iu(1/t);return s.invert=function(t){return i(e.invert(t))},s.domain=function(t){return arguments.length?(e.domain((n=t.map(Number)).map(r)),s):n},s.ticks=function(e){return Ou(n,e)},s.tickFormat=function(e,t){return Mu(n,e,t)},s.nice=function(e){return s.domain(Lu(n,e))},s.exponent=function(o){return arguments.length?(r=Iu(t=o),i=Iu(1/t),e.domain(n.map(r)),s):t},s.copy=function(){return Fu(e.copy(),t,n)},ku(s,e)}function Iu(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function qu(t,n){function o(e){return i[((r.get(e)||n.t==="range"&&r.set(e,t.push(e)))-1)%i.length]}function u(n,r){return e.range(t.length).map(function(e){return n+r*e})}var r,i,s;return o.domain=function(e){if(!arguments.length)return t;t=[],r=new b;var i=-1,s=e.length,u;while(++i<s)r.has(u=e[i])||r.set(u,t.push(u));return o[n.t].apply(o,n.a)},o.range=function(e){return arguments.length?(i=e,s=0,n={t:"range",a:arguments},o):i},o.rangePoints=function(e,r){arguments.length<2&&(r=0);var a=e[0],f=e[1],l=(f-a)/(Math.max(1,t.length-1)+r);return i=u(t.length<2?(a+f)/2:a+l*r/2,l),s=0,n={t:"rangePoints",a:arguments},o},o.rangeBands=function(e,r,a){arguments.length<2&&(r=0),arguments.length<3&&(a=r);var f=e[1]<e[0],l=e[f-0],c=e[1-f],h=(c-l)/(t.length-r+2*a);return i=u(l+h*a,h),f&&i.reverse(),s=h*(1-r),n={t:"rangeBands",a:arguments},o},o.rangeRoundBands=function(e,r,a){arguments.length<2&&(r=0),arguments.length<3&&(a=r);var f=e[1]<e[0],l=e[f-0],c=e[1-f],h=Math.floor((c-l)/(t.length-r+2*a)),p=c-l-(t.length-r)*h;return i=u(l+Math.round(p/2),h),f&&i.reverse(),s=Math.round(h*(1-r)),n={t:"rangeRoundBands",a:arguments},o},o.rangeBand=function(){return s},o.rangeExtent=function(){return bu(n.a[0])},o.copy=function(){return qu(t,n)},o.domain(t)}function Xu(t,n){function i(){var i=0,o=n.length;r=[];while(++i<o)r[i-1]=e.quantile(t,i/o);return s}function s(t){if(!isNaN(t=+t))return n[e.bisect(r,t)]}var r;return s.domain=function(n){return arguments.length?(t=n.filter(function(e){return!isNaN(e)}).sort(e.ascending),i()):t},s.range=function(e){return arguments.length?(n=e,i()):n},s.quantiles=function(){return r},s.invertExtent=function(e){return e=n.indexOf(e),e<0?[NaN,NaN]:[e>0?r[e-1]:t[0],e<r.length?r[e]:t[t.length-1]]},s.copy=function(){return Xu(t,n)},i()}function Vu(e,t,n){function s(t){return n[Math.max(0,Math.min(i,Math.floor(r*(t-e))))]}function o(){return r=n.length/(t-e),i=n.length-1,s}var r,i;return s.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],o()):[e,t]},s.range=function(e){return arguments.length?(n=e,o()):n},s.invertExtent=function(t){return t=n.indexOf(t),t=t<0?NaN:t/r+e,[t,t+1/r]},s.copy=function(){return Vu(e,t,n)},o()}function $u(t,n){function r(r){if(r<=r)return n[e.bisect(t,r)]}return r.domain=function(e){return arguments.length?(t=e,r):t},r.range=function(e){return arguments.length?(n=e,r):n},r.invertExtent=function(e){return e=n.indexOf(e),[t[e-1],t[e]]},r.copy=function(){return $u(t,n)},r}function Ju(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return Ou(e,t)},t.tickFormat=function(t,n){return Mu(e,t,n)},t.copy=function(){return Ju(e)},t}function Gu(e){return e.innerRadius}function Yu(e){return e.outerRadius}function Zu(e){return e.startAngle}function ea(e){return e.endAngle}function ta(e){function u(s){function d(){u.push("M",i(e(a),o))}var u=[],a=[],f=-1,l=s.length,c,h=mn(t),p=mn(n);while(++f<l)r.call(this,c=s[f],f)?a.push([+h.call(this,c,f),+p.call(this,c,f)]):a.length&&(d(),a=[]);return a.length&&d(),u.length?u.join(""):null}var t=zi,n=Wi,r=Nr,i=ra,s=i.key,o=.7;return u.x=function(e){return arguments.length?(t=e,u):t},u.y=function(e){return arguments.length?(n=e,u):n},u.defined=function(e){return arguments.length?(r=e,u):r},u.interpolate=function(e){return arguments.length?(typeof e=="function"?s=i=e:s=(i=na.get(e)||ra).key,u):s},u.tension=function(e){return arguments.length?(o=e,u):o},u}function ra(e){return e.join("L")}function ia(e){return ra(e)+"Z"}function sa(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("H",(r[0]+(r=e[t])[0])/2,"V",r[1]);return n>1&&i.push("H",r[0]),i.join("")}function oa(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("V",(r=e[t])[1],"H",r[0]);return i.join("")}function ua(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("H",(r=e[t])[0],"V",r[1]);return i.join("")}function aa(e,t){return e.length<4?ra(e):e[1]+ca(e.slice(1,e.length-1),ha(e,t))}function fa(e,t){return e.length<3?ra(e):e[0]+ca((e.push(e[0]),e),ha([e[e.length-2]].concat(e,[e[1]]),t))}function la(e,t){return e.length<3?ra(e):e[0]+ca(e,ha(e,t))}function ca(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return ra(e);var n=e.length!=t.length,r="",i=e[0],s=e[1],o=t[0],u=o,a=1;n&&(r+="Q"+(s[0]-o[0]*2/3)+","+(s[1]-o[1]*2/3)+","+s[0]+","+s[1],i=e[1],a=2);if(t.length>1){u=t[1],s=e[a],a++,r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1];for(var f=2;f<t.length;f++,a++)s=e[a],u=t[f],r+="S"+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1]}if(n){var l=e[a];r+="Q"+(s[0]+u[0]*2/3)+","+(s[1]+u[1]*2/3)+","+l[0]+","+l[1]}return r}function ha(e,t){var n=[],r=(1-t)/2,i,s=e[0],o=e[1],u=1,a=e.length;while(++u<a)i=s,s=o,o=e[u],n.push([r*(o[0]-i[0]),r*(o[1]-i[1])]);return n}function pa(e){if(e.length<3)return ra(e);var t=1,n=e.length,r=e[0],i=r[0],s=r[1],o=[i,i,i,(r=e[1])[0]],u=[s,s,s,r[1]],a=[i,",",s,"L",ga(wa,o),",",ga(wa,u)];e.push(e[n-1]);while(++t<=n)r=e[t],o.shift(),o.push(r[0]),u.shift(),u.push(r[1]),Ea(a,o,u);return e.pop(),a.push("L",r),a.join("")}function da(e){if(e.length<4)return ra(e);var t=[],n=-1,r=e.length,i,s=[0],o=[0];while(++n<3)i=e[n],s.push(i[0]),o.push(i[1]);t.push(ga(wa,s)+","+ga(wa,o)),--n;while(++n<r)i=e[n],s.shift(),s.push(i[0]),o.shift(),o.push(i[1]),Ea(t,s,o);return t.join("")}function va(e){var t,n=-1,r=e.length,i=r+4,s,o=[],u=[];while(++n<4)s=e[n%r],o.push(s[0]),u.push(s[1]);t=[ga(wa,o),",",ga(wa,u)],--n;while(++n<i)s=e[n%r],o.shift(),o.push(s[0]),u.shift(),u.push(s[1]),Ea(t,o,u);return t.join("")}function ma(e,t){var n=e.length-1;if(n){var r=e[0][0],i=e[0][1],s=e[n][0]-r,o=e[n][1]-i,u=-1,a,f;while(++u<=n)a=e[u],f=u/n,a[0]=t*a[0]+(1-t)*(r+f*s),a[1]=t*a[1]+(1-t)*(i+f*o)}return pa(e)}function ga(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Ea(e,t,n){e.push("C",ga(ya,t),",",ga(ya,n),",",ga(ba,t),",",ga(ba,n),",",ga(wa,t),",",ga(wa,n))}function Sa(e,t){return(t[1]-e[1])/(t[0]-e[0])}function xa(e){var t=0,n=e.length-1,r=[],i=e[0],s=e[1],o=r[0]=Sa(i,s);while(++t<n)r[t]=(o+(o=Sa(i=s,s=e[t+1])))/2;return r[t]=o,r}function Ta(e){var t=[],n,r,i,s,o=xa(e),u=-1,a=e.length-1;while(++u<a)n=Sa(e[u],e[u+1]),m(n)<bt?o[u]=o[u+1]=0:(r=o[u]/n,i=o[u+1]/n,s=r*r+i*i,s>9&&(s=n*3/Math.sqrt(s),o[u]=s*r,o[u+1]=s*i));u=-1;while(++u<=a)s=(e[Math.min(a,u+1)][0]-e[Math.max(0,u-1)][0])/(6*(1+o[u]*o[u])),t.push([s||0,o[u]*s||0]);return t}function Na(e){return e.length<3?ra(e):e[0]+ca(e,Ta(e))}function Ca(e){var t,n=-1,r=e.length,i,s;while(++n<r)t=e[n],i=t[0],s=t[1]+Ku,t[0]=i*Math.cos(s),t[1]=i*Math.sin(s);return e}function ka(e){function c(u){function x(){c.push("M",o(e(p),l),f,a(e(h.reverse()),l),"Z")}var c=[],h=[],p=[],d=-1,v=u.length,m,g=mn(t),y=mn(r),b=t===n?function(){return E}:mn(n),w=r===i?function(){return S}:mn(i),E,S;while(++d<v)s.call(this,m=u[d],d)?(h.push([E=+g.call(this,m,d),S=+y.call(this,m,d)]),p.push([+b.call(this,m,d),+w.call(this,m,d)])):h.length&&(x(),h=[],p=[]);return h.length&&x(),c.length?c.join(""):null}var t=zi,n=zi,r=0,i=Wi,s=Nr,o=ra,u=o.key,a=o,f="L",l=.7;return c.x=function(e){return arguments.length?(t=n=e,c):n},c.x0=function(e){return arguments.length?(t=e,c):t},c.x1=function(e){return arguments.length?(n=e,c):n},c.y=function(e){return arguments.length?(r=i=e,c):i},c.y0=function(e){return arguments.length?(r=e,c):r},c.y1=function(e){return arguments.length?(i=e,c):i},c.defined=function(e){return arguments.length?(s=e,c):s},c.interpolate=function(e){return arguments.length?(typeof e=="function"?u=o=e:u=(o=na.get(e)||ra).key,a=o.reverse||o,f=o.closed?"M":"L",c):u},c.tension=function(e){return arguments.length?(l=e,c):l},c}function La(e){return e.radius}function Aa(e){return[e.x,e.y]}function Oa(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]+Ku;return[n*Math.cos(r),n*Math.sin(r)]}}function Ma(){return 64}function _a(){return"circle"}function Da(e){var t=Math.sqrt(e/mt);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+ -t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function ja(e,t){return D(e,Fa),e.id=t,e}function Ua(e,t,n,r){var i=e.id;return tt(e,typeof n=="function"?function(e,s,o){e.__transition__[i].tween.set(t,r(n.call(e,e.__data__,s,o)))}:(n=r(n),function(e){e.__transition__[i].tween.set(t,n)}))}function za(e){return e==null&&(e=""),function(){this.textContent=e}}function Wa(t,n,r,i){var s=t.__transition__||(t.__transition__={active:0,count:0}),o=s[r];if(!o){var u=i.time;o=s[r]={tween:new b,time:u,ease:i.ease,delay:i.delay,duration:i.duration},++s.count,e.timer(function(i){function d(i){if(s.active>r)return m();s.active=r,o.event&&o.event.start.call(t,a,n),o.tween.forEach(function(e,r){(r=r.call(t,a,n))&&p.push(r)}),e.timer(function(){return h.c=v(i||1)?Nr:v,1},0,u)}function v(e){if(s.active!==r)return m();var i=e/c,u=f(i),l=p.length;while(l>0)p[--l].call(t,u);if(i>=1)return o.event&&o.event.end.call(t,a,n),m()}function m(){return--s.count?delete s[r]:delete t.__transition__,1}var a=t.__data__,f=o.ease,l=o.delay,c=o.duration,h=Nn,p=[];h.t=l+u;if(l<=i)return d(i-l);h.c=d},0,u)}}function $a(e,t){e.attr("transform",function(e){return"translate("+t(e)+",0)"})}function Ja(e,t){e.attr("transform",function(e){return"translate(0,"+t(e)+")"})}function ef(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function lf(e,t,n){function r(t){var n=e(t),r=s(n,1);return t-n<r-t?n:r}function i(n){return t(n=e(new Ya(n-1)),1),n}function s(e,n){return t(e=new Ya(+e),n),e}function o(e,r,s){var o=i(e),u=[];if(s>1)while(o<r)n(o)%s||u.push(new Date(+o)),t(o,1);else while(o<r)u.push(new Date(+o)),t(o,1);return u}function u(e,t,n){try{Ya=ef;var r=new ef;return r._=e,o(r,t,n)}finally{Ya=Date}}e.floor=e,e.round=r,e.ceil=i,e.offset=s,e.range=o;var a=e.utc=cf(e);return a.floor=a,a.round=cf(r),a.ceil=cf(i),a.offset=cf(s),a.range=u,e}function cf(e){return function(t,n){try{Ya=ef;var r=new ef;return r._=t,e(r,n)._}finally{Ya=Date}}}function hf(e){function n(n){var r=[],i=-1,s=0,o,u,a;while(++i<t)if(e.charCodeAt(i)===37){r.push(e.substring(s,i)),(u=Cf[o=e.charAt(++i)])!=null&&(o=e.charAt(++i));if(a=kf[o])o=a(n,u==null?o==="e"?" ":"0":u);r.push(o),s=i+1}return r.push(e.substring(s,i)),r.join("")}var t=e.length;return n.parse=function(t){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},r=pf(n,e,t,0);if(r!=t.length)return null;"p"in n&&(n.H=n.H%12+n.p*12);var i=n.Z!=null&&Ya!==ef,s=new(i?ef:Ya);return"j"in n?s.setFullYear(n.y,0,n.j):"w"in n&&("W"in n||"U"in n)?(s.setFullYear(n.y,0,1),s.setFullYear(n.y,0,"W"in n?(n.w+6)%7+n.W*7-(s.getDay()+5)%7:n.w+n.U*7-(s.getDay()+6)%7)):s.setFullYear(n.y,n.m,n.d),s.setHours(n.H+Math.floor(n.Z/100),n.M+n.Z%100,n.S,n.L),i?s._:s},n.toString=function(){return e},n}function pf(e,t,n,r){var i,s,o,u=0,a=t.length,f=n.length;while(u<a){if(r>=f)return-1;i=t.charCodeAt(u++);if(i===37){o=t.charAt(u++),s=Lf[o in Cf?t.charAt(u++):o];if(!s||(r=s(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function df(t){return new RegExp("^(?:"+t.map(e.requote).join("|")+")","i")}function vf(e){var t=new b,n=-1,r=e.length;while(++n<r)t.set(e[n].toLowerCase(),n);return t}function mf(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?(new Array(n-s+1)).join(t)+i:i)}function Af(e,t,n){bf.lastIndex=0;var r=bf.exec(t.substring(n));return r?(e.w=wf.get(r[0].toLowerCase()),n+r[0].length):-1}function Of(e,t,n){gf.lastIndex=0;var r=gf.exec(t.substring(n));return r?(e.w=yf.get(r[0].toLowerCase()),n+r[0].length):-1}function Mf(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function _f(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n));return r?(e.U=+r[0],n+r[0].length):-1}function Df(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n));return r?(e.W=+r[0],n+r[0].length):-1}function Pf(e,t,n){xf.lastIndex=0;var r=xf.exec(t.substring(n));return r?(e.m=Tf.get(r[0].toLowerCase()),n+r[0].length):-1}function Hf(e,t,n){Ef.lastIndex=0;var r=Ef.exec(t.substring(n));return r?(e.m=Sf.get(r[0].toLowerCase()),n+r[0].length):-1}function Bf(e,t,n){return pf(e,kf.c.toString(),t,n)}function jf(e,t,n){return pf(e,kf.x.toString(),t,n)}function Ff(e,t,n){return pf(e,kf.X.toString(),t,n)}function If(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function qf(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n,n+2));return r?(e.y=Uf(+r[0]),n+r[0].length):-1}function Rf(e,t,n){return/^[+-]\d{4}$/.test(t=t.substring(n,n+5))?(e.Z=+t,n+5):-1}function Uf(e){return e+(e>68?1900:2e3)}function zf(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Wf(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Xf(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n,n+3));return r?(e.j=+r[0],n+r[0].length):-1}function Vf(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function $f(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Jf(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function Kf(e,t,n){Qf.lastIndex=0;var r=Qf.exec(t.substring(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Gf(e,t,n){var r=Yf.get(t.substring(n,n+=2).toLowerCase());return r==null?-1:(e.p=r,n)}function Zf(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=~~(m(t)/60),i=m(t)%60;return n+mf(r,"0",2)+mf(i,"0",2)}function el(e,t,n){Nf.lastIndex=0;var r=Nf.exec(t.substring(n,n+1));return r?n+r[0].length:-1}function tl(e){function n(e){try{Ya=ef;var n=new Ya;return n._=e,t(n)}finally{Ya=Date}}var t=hf(e);return n.parse=function(e){try{Ya=ef;var n=t.parse(e);return n&&n._}finally{Ya=Date}},n.toString=t.toString,n}function rl(e){return e.toISOString()}function il(t,n,r){function i(e){return t(e)}function s(t,r){var i=t[1]-t[0],s=i/r,o=e.bisect(ul,s);return o==ul.length?[n.year,Au(t.map(function(e){return e/31536e6}),r)[2]]:o?n[s/ul[o-1]<ul[o]/s?o-1:o]:[cl,Au(t,r)[2]]}return i.invert=function(e){return sl(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain().map(sl)},i.nice=function(e,t){function u(n){return!isNaN(n)&&!e.range(n,sl(+n+1),t).length}var n=i.domain(),r=bu(n),o=e==null?s(r,10):typeof e=="number"&&s(r,e);return o&&(e=o[0],t=o[1]),i.domain(Su(n,t>1?{floor:function(t){while(u(t=e.floor(t)))t=sl(t-1);return t},ceil:function(t){while(u(t=e.ceil(t)))t=sl(+t+1);return t}}:e))},i.ticks=function(e,t){var n=bu(i.domain()),r=e==null?s(n,10):typeof e=="number"?s(n,e):!e.range&&[{range:e},t];return r&&(e=r[0],t=r[1]),e.range(n[0],sl(+n[1]+1),t<1?1:t)},i.tickFormat=function(){return r},i.copy=function(){return il(t.copy(),n,r)},ku(i,t)}function sl(e){return new Date(e)}function ol(e){return function(t){var n=e.length-1,r=e[n];while(!r[1](t))r=e[--n];return r[0](t)}}function vl(e){return JSON.parse(e.responseText)}function ml(e){var t=r.createRange();return t.selectNode(r.body),t.createContextualFragment(e.responseText)}var e={version:"3.3.13"};Date.now||(Date.now=function(){return+(new Date)});var t=[].slice,n=function(e){return t.call(e)},r=document,i=r.documentElement,s=window;try{n(i.childNodes)[0].nodeType}catch(o){n=function(e){var t=e.length,n=new Array(t);while(t--)n[t]=e[t];return n}}try{r.createElement("div").style.setProperty("opacity",0,"")}catch(u){var a=s.Element.prototype,f=a.setAttribute,l=a.setAttributeNS,c=s.CSSStyleDeclaration.prototype,h=c.setProperty;a.setAttribute=function(e,t){f.call(this,e,t+"")},a.setAttributeNS=function(e,t,n){l.call(this,e,t,n+"")},c.setProperty=function(e,t,n){h.call(this,e,t+"",n)}}e.ascending=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},e.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},e.min=function(e,t){var n=-1,r=e.length,i,s;if(arguments.length===1){while(++n<r&&!((i=e[n])!=null&&i<=i))i=undefined;while(++n<r)(s=e[n])!=null&&i>s&&(i=s)}else{while(++n<r&&!((i=t.call(e,e[n],n))!=null&&i<=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&i>s&&(i=s)}return i},e.max=function(e,t){var n=-1,r=e.length,i,s;if(arguments.length===1){while(++n<r&&!((i=e[n])!=null&&i<=i))i=undefined;while(++n<r)(s=e[n])!=null&&s>i&&(i=s)}else{while(++n<r&&!((i=t.call(e,e[n],n))!=null&&i<=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&s>i&&(i=s)}return i},e.extent=function(e,t){var n=-1,r=e.length,i,s,o;if(arguments.length===1){while(++n<r&&!((i=o=e[n])!=null&&i<=i))i=o=undefined;while(++n<r)(s=e[n])!=null&&(i>s&&(i=s),o<s&&(o=s))}else{while(++n<r&&!((i=o=t.call(e,e[n],n))!=null&&i<=i))i=undefined;while(++n<r)(s=t.call(e,e[n],n))!=null&&(i>s&&(i=s),o<s&&(o=s))}return[i,o]},e.sum=function(e,t){var n=0,r=e.length,i,s=-1;if(arguments.length===1)while(++s<r)isNaN(i=+e[s])||(n+=i);else while(++s<r)isNaN(i=+t.call(e,e[s],s))||(n+=i);return n},e.mean=function(e,t){var n=e.length,r,i=0,s=-1,o=0;if(arguments.length===1)while(++s<n)p(r=e[s])&&(i+=(r-i)/++o);else while(++s<n)p(r=t.call(e,e[s],s))&&(i+=(r-i)/++o);return o?i:undefined},e.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),i=+e[r-1],s=n-r;return s?i+s*(e[r]-i):i},e.median=function(t,n){return arguments.length>1&&(t=t.map(n)),t=t.filter(p),t.length?e.quantile(t.sort(e.ascending),.5):undefined},e.bisector=function(e){return{left:function(t,n,r,i){arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);while(r<i){var s=r+i>>>1;e.call(t,t[s],s)<n?r=s+1:i=s}return r},right:function(t,n,r,i){arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);while(r<i){var s=r+i>>>1;n<e.call(t,t[s],s)?i=s:r=s+1}return r}}};var d=e.bisector(function(e){return e});e.bisectLeft=d.left,e.bisect=e.bisectRight=d.right,e.shuffle=function(e){var t=e.length,n,r;while(t)r=Math.random()*t--|0,n=e[t],e[t]=e[r],e[r]=n;return e},e.permute=function(e,t){var n=t.length,r=new Array(n);while(n--)r[n]=e[t[n]];return r},e.pairs=function(e){var t=0,n=e.length-1,r,i=e[0],s=new Array(n<0?0:n);while(t<n)s[t]=[r=i,i=e[++t]];return s},e.zip=function(){if(!(s=arguments.length))return[];for(var t=-1,n=e.min(arguments,v),r=new Array(n);++t<n;)for(var i=-1,s,o=r[t]=new Array(s);++i<s;)o[i]=arguments[i][t];return r},e.transpose=function(t){return e.zip.apply(e,t)},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t},e.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},e.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},e.merge=function(e){var t=e.length,n,r=-1,i=0,s,o;while(++r<t)i+=e[r].length;s=new Array(i);while(--t>=0){o=e[t],n=o.length;while(--n>=0)s[--i]=o[n]}return s};var m=Math.abs;e.range=function(e,t,n){arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0));if((t-e)/n===Infinity)throw new Error("infinite range");var r=[],i=g(m(n)),s=-1,o;e*=i,t*=i,n*=i;if(n<0)while((o=e+n*++s)>t)r.push(o/i);else while((o=e+n*++s)<t)r.push(o/i);return r},e.map=function(e){var t=new b;if(e instanceof b)e.forEach(function(e,n){t.set(e,n)});else for(var n in e)t.set(n,e[n]);return t},y(b,{has:function(e){return w+e in this},get:function(e){return this[w+e]},set:function(e,t){return this[w+e]=t},remove:function(e){return e=w+e,e in this&&delete this[e]},keys:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},values:function(){var e=[];return this.forEach(function(t,n){e.push(n)}),e},entries:function(){var e=[];return this.forEach(function(t,n){e.push({key:t,value:n})}),e},forEach:function(e){for(var t in this)t.charCodeAt(0)===E&&e.call(this,t.substring(1),this[t])}});var w="\0",E=w.charCodeAt(0);e.nest=function(){function o(e,r,u){if(u>=n.length)return s?s.call(t,r):i?r.sort(i):r;var a=-1,f=r.length,l=n[u++],c,h,p,d=new b,v;while(++a<f)(v=d.get(c=l(h=r[a])))?v.push(h):d.set(c,[h]);return e?(h=e(),p=function(t,n){h.set(t,o(e,n,u))}):(h={},p=function(t,n){h[t]=o(e,n,u)}),d.forEach(p),h}function u(e,t){if(t>=n.length)return e;var i=[],s=r[t++];return e.forEach(function(e,n){i.push({key:e,values:u(n,t)})}),s?i.sort(function(e,t){return s(e.key,t.key)}):i}var t={},n=[],r=[],i,s;return t.map=function(e,t){return o(t,e,0)},t.entries=function(t){return u(o(e.map,t,0),0)},t.key=function(e){return n.push(e),t},t.sortKeys=function(e){return r[n.length-1]=e,t},t.sortValues=function(e){return i=e,t},t.rollup=function(e){return s=e,t},t},e.set=function(e){var t=new S;if(e)for(var n=0,r=e.length;n<r;++n)t.add(e[n]);return t},y(S,{has:function(e){return w+e in this},add:function(e){return this[w+e]=!0,e},remove:function(e){return e=w+e,e in this&&delete this[e]},values:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},forEach:function(e){for(var t in this)t.charCodeAt(0)===E&&e.call(this,t.substring(1))}}),e.behavior={},e.rebind=function(e,t){var n=1,r=arguments.length,i;while(++n<r)e[i=arguments[n]]=x(e,t,t[i]);return e};var N=["webkit","ms","moz","Moz","o","O"];e.dispatch=function(){var e=new k,t=-1,n=arguments.length;while(++t<n)e[arguments[t]]=L(e);return e},k.prototype.on=function(e,t){var n=e.indexOf("."),r="";n>=0&&(r=e.substring(n+1),e=e.substring(0,n));if(e)return arguments.length<2?this[e].on(r):this[e].on(r,t);if(arguments.length===2){if(t==null)for(e in this)this.hasOwnProperty(e)&&this[e].on(r,null);return this}},e.event=null,e.requote=function(e){return e.replace(_,"\\$&")};var _=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,D={}.__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]},H=function(e,t){return t.querySelector(e)},B=function(e,t){return t.querySelectorAll(e)},j=i[T(i,"matchesSelector")],F=function(e,t){return j.call(e,t)};typeof Sizzle=="function"&&(H=function(e,t){return Sizzle(e,t)[0]||null},B=function(e,t){return Sizzle.uniqueSort(Sizzle(e,t))},F=Sizzle.matchesSelector),e.selection=function(){return ot};var I=e.selection.prototype=[];I.select=function(e){var t=[],n,r,i,s;e=q(e);for(var o=-1,u=this.length;++o<u;){t.push(n=[]),n.parentNode=(i=this[o]).parentNode;for(var a=-1,f=i.length;++a<f;)(s=i[a])?(n.push(r=e.call(s,s.__data__,a,o)),r&&"__data__"in s&&(r.__data__=s.__data__)):n.push(null)}return P(t)},I.selectAll=function(e){var t=[],r,i;e=R(e);for(var s=-1,o=this.length;++s<o;)for(var u=this[s],a=-1,f=u.length;++a<f;)if(i=u[a])t.push(r=n(e.call(i,i.__data__,a,s))),r.parentNode=i;return P(t)};var U={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};e.ns={prefix:U,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.substring(0,t),e=e.substring(t+1)),U.hasOwnProperty(n)?{space:U[n],local:e}:e}},I.attr=function(t,n){if(arguments.length<2){if(typeof t=="string"){var r=this.node();return t=e.ns.qualify(t),t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}for(n in t)this.each(z(n,t[n]));return this}return this.each(z(t,n))},I.classed=function(e,t){if(arguments.length<2){if(typeof e=="string"){var n=this.node(),r=(e=V(e)).length,i=-1;if(t=n.classList){while(++i<r)if(!t.contains(e[i]))return!1}else{t=n.getAttribute("class");while(++i<r)if(!X(e[i]).test(t))return!1}return!0}for(t in e)this.each($(t,e[t]));return this}return this.each($(e,t))},I.style=function(e,t,n){var r=arguments.length;if(r<3){if(typeof e!="string"){r<2&&(t="");for(n in e)this.each(K(n,e[n],t));return this}if(r<2)return s.getComputedStyle(this.node(),null).getPropertyValue(e);n=""}return this.each(K(e,t,n))},I.property=function(e,t){if(arguments.length<2){if(typeof e=="string")return this.node()[e];for(t in e)this.each(Q(t,e[t]));return this}return this.each(Q(e,t))},I.text=function(e){return arguments.length?this.each(typeof e=="function"?function(){var t=e.apply(this,arguments);this.textContent=t==null?"":t}:e==null?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},I.html=function(e){return arguments.length?this.each(typeof e=="function"?function(){var t=e.apply(this,arguments);this.innerHTML=t==null?"":t}:e==null?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},I.append=function(e){return e=G(e),this.select(function(){return this.appendChild(e.apply(this,arguments))})},I.insert=function(e,t){return e=G(e),t=q(t),this.select(function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null)})},I.remove=function(){return this.each(function(){var e=this.parentNode;e&&e.removeChild(this)})},I.data=function(e,t){function o(e,n){var r,i=e.length,s=n.length,o=Math.min(i,s),l=new Array(s),c=new Array(s),h=new Array(i),p,d;if(t){var v=new b,m=new b,g=[],y;for(r=-1;++r<i;)y=t.call(p=e[r],p.__data__,r),v.has(y)?h[r]=p:v.set(y,p),g.push(y);for(r=-1;++r<s;)y=t.call(n,d=n[r],r),(p=v.get(y))?(l[r]=p,p.__data__=d):m.has(y)||(c[r]=Y(d)),m.set(y,d),v.remove(y);for(r=-1;++r<i;)v.has(g[r])&&(h[r]=e[r])}else{for(r=-1;++r<o;)p=e[r],d=n[r],p?(p.__data__=d,l[r]=p):c[r]=Y(d);for(;r<s;++r)c[r]=Y(n[r]);for(;r<i;++r)h[r]=e[r]}c.update=l,c.parentNode=l.parentNode=h.parentNode=e.parentNode,u.push(c),a.push(l),f.push(h)}var n=-1,r=this.length,i,s;if(!arguments.length){e=new Array(r=(i=this[0]).length);while(++n<r)if(s=i[n])e[n]=s.__data__;return e}var u=nt([]),a=P([]),f=P([]);if(typeof e=="function")while(++n<r)o(i=this[n],e.call(i,i.parentNode.__data__,n));else while(++n<r)o(i=this[n],e);return a.enter=function(){return u},a.exit=function(){return f},a},I.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},I.filter=function(e){var t=[],n,r,i;typeof e!="function"&&(e=Z(e));for(var s=0,o=this.length;s<o;s++){t.push(n=[]),n.parentNode=(r=this[s]).parentNode;for(var u=0,a=r.length;u<a;u++)(i=r[u])&&e.call(i,i.__data__,u,s)&&n.push(i)}return P(t)},I.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n=this[e],r=n.length-1,i=n[r],s;--r>=0;)if(s=n[r])i&&i!==s.nextSibling&&i.parentNode.insertBefore(s,i),i=s;return this},I.sort=function(e){e=et.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},I.each=function(e){return tt(this,function(t,n,r){e.call(t,t.__data__,n,r)})},I.call=function(e){var t=n(arguments);return e.apply(t[0]=this,t),this},I.empty=function(){return!this.node()},I.node=function(){for(var e=0,t=this.length;e<t;e++)for(var n=this[e],r=0,i=n.length;r<i;r++){var s=n[r];if(s)return s}return null},I.size=function(){var e=0;return this.each(function(){++e}),e};var rt=[];e.selection.enter=nt,e.selection.enter.prototype=rt,rt.append=I.append,rt.empty=I.empty,rt.node=I.node,rt.call=I.call,rt.size=I.size,rt.select=function(e){var t=[],n,r,i,s,o;for(var u=-1,a=this.length;++u<a;){i=(s=this[u]).update,t.push(n=[]),n.parentNode=s.parentNode;for(var f=-1,l=s.length;++f<l;)(o=s[f])?(n.push(i[f]=r=e.call(s.parentNode,o.__data__,f,u)),r.__data__=o.__data__):n.push(null)}return P(t)},rt.insert=function(e,t){return arguments.length<2&&(t=it(this)),I.insert.call(this,e,t)},I.transition=function(){var e=qa||++Ia,t=[],n,r,i=Ra||{time:Date.now(),ease:Gs,delay:0,duration:250};for(var s=-1,o=this.length;++s<o;){t.push(n=[]);for(var u=this[s],a=-1,f=u.length;++a<f;)(r=u[a])&&Wa(r,a,e,i),n.push(r)}return ja(t,e)},I.interrupt=function(){return this.each(st)},e.select=function(e){var t=[typeof e=="string"?H(e,r):e];return t.parentNode=i,P([t])},e.selectAll=function(e){var t=n(typeof e=="string"?B(e,r):e);return t.parentNode=i,P([t])};var ot=e.select(i);I.on=function(e,t,n){var r=arguments.length;if(r<3){if(typeof e!="string"){r<2&&(t=!1);for(n in e)this.each(ut(n,e[n],t));return this}if(r<2)return(r=this.node()["__on"+e])&&r._;n=!1}return this.each(ut(e,t,n))};var at=e.map({mouseenter:"mouseover",mouseleave:"mouseout"});at.forEach(function(e){"on"+e in r&&at.remove(e)});var ct="onselectstart"in r?null:T(i.style,"userSelect"),ht=0;e.mouse=function(e){return vt(e,O())};var dt=/WebKit/.test(s.navigator.userAgent)?-1:0;e.touches=function(e,t){return arguments.length<2&&(t=O().touches),t?n(t).map(function(t){var n=vt(e,t);return n.identifier=t.identifier,n}):[]},e.behavior.drag=function(){function o(){this.on("mousedown.drag",r).on("touchstart.drag",i)}function u(){return e.event.changedTouches[0].identifier}function a(t,n){return e.touches(t).filter(function(e){return e.identifier===n})[0]}function f(r,i,o,u){return function(){function b(){var e=i(f,h),t=e[0]-d[0],n=e[1]-d[1];v|=t|n,d=e,l({type:"drag",x:e[0]+m[0],y:e[1]+m[1],dx:t,dy:n})}function w(){g.on(o+"."+p,null).on(u+"."+p,null),y(v&&e.event.target===c),l({type:"dragend"})}var a=this,f=a.parentNode,l=t.of(a,arguments),c=e.event.target,h=r(),p=h==null?"drag":"drag-"+h,d=i(f,h),v=0,m,g=e.select(s).on(o+"."+p,b).on(u+"."+p,w),y=pt();n?(m=n.apply(a,arguments),m=[m.x-d[0],m.y-d[1]]):m=[0,0],l({type:"dragstart"})}}var t=M(o,"drag","dragstart","dragend"),n=null,r=f(C,e.mouse,"mousemove","mouseup"),i=f(u,a,"touchmove","touchend");return o.origin=function(e){return arguments.length?(n=e,o):n},e.rebind(o,t,"on")};var mt=Math.PI,gt=2*mt,yt=mt/2,bt=1e-6,wt=bt*bt,Et=mt/180,St=180/mt,Ot=Math.SQRT2,Mt=2,_t=4;e.interpolateZoom=function(e,t){function y(e){var t=e*g;if(m){var s=kt(d),o=i/(Mt*c)*(s*Lt(Ot*t+d)-Ct(d));return[n+o*a,r+o*f,i*s/kt(Ot*t+d)]}return[n+e*a,r+e*f,i*Math.exp(Ot*t)]}var n=e[0],r=e[1],i=e[2],s=t[0],o=t[1],u=t[2],a=s-n,f=o-r,l=a*a+f*f,c=Math.sqrt(l),h=(u*u-i*i+_t*l)/(2*i*Mt*c),p=(u*u-i*i-_t*l)/(2*u*Mt*c),d=Math.log(Math.sqrt(h*h+1)-h),v=Math.log(Math.sqrt(p*p+1)-p),m=v-d,g=(m||Math.log(u/i))/Ot;return y.duration=g*1e3,y},e.behavior.zoom=function(){function y(e){e.on(u,k).on(Ht+".zoom",O).on(a,_).on("dblclick.zoom",D).on(c,L)}function b(e){return[(e[0]-t.x)/t.k,(e[1]-t.y)/t.k]}function w(e){return[e[0]*t.k+t.x,e[1]*t.k+t.y]}function E(e){t.k=Math.max(o[0],Math.min(o[1],e))}function S(e,n){n=w(n),t.x+=e[0]-n[0],t.y+=e[1]-n[1]}function x(){v&&v.domain(d.range().map(function(e){return(e-t.x)/t.k}).map(d.invert)),g&&g.domain(m.range().map(function(e){return(e-t.y)/t.k}).map(m.invert))}function T(e){e({type:"zoomstart"})}function N(e){x(),e({type:"zoom",scale:t.k,translate:[t.x,t.y]})}function C(e){e({type:"zoomend"})}function k(){function c(){i=1,S(e.mouse(t),u),N(n)}function h(){o.on(a,s===t?_:null).on(f,null),l(i&&e.event.target===r),C(n)}var t=this,n=p.of(t,arguments),r=e.event.target,i=0,o=e.select(s).on(a,c).on(f,h),u=b(e.mouse(t)),l=pt();st.call(t),T(n)}function L(){function y(){var r=e.touches(n);return a=t.k,r.forEach(function(e){e.identifier in i&&(i[e.identifier]=b(e))}),r}function w(){var n=e.event.changedTouches;for(var s=0,u=n.length;s<u;++s)i[n[s].identifier]=null;var a=y(),f=Date.now();if(a.length===1){if(f-h<500){var l=a[0],c=i[l.identifier];E(t.k*2),S(l,c),A(),N(r)}h=f}else if(a.length>1){var l=a[0],p=a[1],d=l[0]-p[0],v=l[1]-p[1];o=d*d+v*v}}function x(){var t=e.touches(n),s,u,f,l;for(var c=0,p=t.length;c<p;++c,l=null){f=t[c];if(l=i[f.identifier]){if(u)break;s=f,u=l}}if(l){var d=(d=f[0]-s[0])*d+(d=f[1]-s[1])*d,v=o&&Math.sqrt(d/o);s=[(s[0]+f[0])/2,(s[1]+f[1])/2],u=[(u[0]+l[0])/2,(u[1]+l[1])/2],E(v*a)}h=null,S(s,u),N(r)}function O(){if(e.event.touches.length){var t=e.event.changedTouches;for(var n=0,s=t.length;n<s;++n)delete i[t[n].identifier];for(var o in i)return void y()}v.on(l,null).on(d,null),m.on(u,k).on(c,L),g(),C(r)}var n=this,r=p.of(n,arguments),i={},o=0,a,f=e.event.changedTouches[0].identifier,l="touchmove.zoom-"+f,d="touchend.zoom-"+f,v=e.select(s).on(l,x).on(d,O),m=e.select(n).on(u,null).on(c,w),g=pt();st.call(n),w(),T(r)}function O(){var i=p.of(this,arguments);l?clearTimeout(l):(st.call(this),T(i)),l=setTimeout(function(){l=null,C(i)},50),A();var s=r||e.mouse(this);n||(n=b(s)),E(Math.pow(2,Pt()*.002)*t.k),S(s,n),N(i)}function _(){n=null}function D(){var n=p.of(this,arguments),r=e.mouse(this),i=b(r),s=Math.log(t.k)/Math.LN2;T(n),E(Math.pow(2,e.event.shiftKey?Math.ceil(s)-1:Math.floor(s)+1)),S(r,i),N(n),C(n)}var t={x:0,y:0,k:1},n,r,i=[960,500],o=Dt,u="mousedown.zoom",a="mousemove.zoom",f="mouseup.zoom",l,c="touchstart.zoom",h,p=M(y,"zoomstart","zoom","zoomend"),d,v,m,g;return y.event=function(n){n.each(function(){var n=p.of(this,arguments),r=t;qa?e.select(this).transition().each("start.zoom",function(){t=this.__chart__||{x:0,y:0,k:1},T(n)}).tween("zoom:zoom",function(){var s=i[0],o=i[1],u=s/2,a=o/2,f=e.interpolateZoom([(u-t.x)/t.k,(a-t.y)/t.k,s/t.k],[(u-r.x)/r.k,(a-r.y)/r.k,s/r.k]);return function(e){var r=f(e),i=s/r[2];this.__chart__=t={x:u-r[0]*i,y:a-r[1]*i,k:i},N(n)}}).each("end.zoom",function(){C(n)}):(this.__chart__=t,T(n),N(n),C(n))})},y.translate=function(e){return arguments.length?(t={x:+e[0],y:+e[1],k:t.k},x(),y):[t.x,t.y]},y.scale=function(e){return arguments.length?(t={x:t.x,y:t.y,k:+e},x(),y):t.k},y.scaleExtent=function(e){return arguments.length?(o=e==null?Dt:[+e[0],+e[1]],y):o},y.center=function(e){return arguments.length?(r=e&&[+e[0],+e[1]],y):r},y.size=function(e){return arguments.length?(i=e&&[+e[0],+e[1]],y):i},y.x=function(e){return arguments.length?(v=e,d=e.copy(),t={x:0,y:0,k:1},y):v},y.y=function(e){return arguments.length?(g=e,m=e.copy(),t={x:0,y:0,k:1},y):g},e.rebind(y,p,"on")};var Dt=[0,Infinity],Pt,Ht="onwheel"in r?(Pt=function(){return-e.event.deltaY*(e.event.deltaMode?120:1)},"wheel"):"onmousewheel"in r?(Pt=function(){return e.event.wheelDelta},"mousewheel"):(Pt=function(){return-e.event.detail},"MozMousePixelScroll");Bt.prototype.toString=function(){return this.rgb()+""},e.hsl=function(e,t,n){return arguments.length===1?e instanceof Ft?jt(e.h,e.s,e.l):ln(""+e,cn,jt):jt(+e,+t,+n)};var It=Ft.prototype=new Bt;It.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),jt(this.h,this.s,this.l/e)},It.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),jt(this.h,this.s,e*this.l)},It.rgb=function(){return qt(this.h,this.s,this.l)},e.hcl=function(t,n,r){return arguments.length===1?t instanceof Ut?Rt(t.h,t.c,t.l):t instanceof Vt?Zt(t.l,t.a,t.b):Zt((t=hn((t=e.rgb(t)).r,t.g,t.b)).l,t.a,t.b):Rt(+t,+n,+r)};var zt=Ut.prototype=new Bt;zt.brighter=function(e){return Rt(this.h,this.c,Math.min(100,this.l+$t*(arguments.length?e:1)))},zt.darker=function(e){return Rt(this.h,this.c,Math.max(0,this.l-$t*(arguments.length?e:1)))},zt.rgb=function(){return Wt(this.h,this.c,this.l).rgb()},e.lab=function(t,n,r){return arguments.length===1?t instanceof Vt?Xt(t.l,t.a,t.b):t instanceof Ut?Wt(t.l,t.c,t.h):hn((t=e.rgb(t)).r,t.g,t.b):Xt(+t,+n,+r)};var $t=18,Jt=.95047,Kt=1,Qt=1.08883,Gt=Vt.prototype=new Bt;Gt.brighter=function(e){return Xt(Math.min(100,this.l+$t*(arguments.length?e:1)),this.a,this.b)},Gt.darker=function(e){return Xt(Math.max(0,this.l-$t*(arguments.length?e:1)),this.a,this.b)},Gt.rgb=function(){return Yt(this.l,this.a,this.b)},e.rgb=function(e,t,n){return arguments.length===1?e instanceof un?on(e.r,e.g,e.b):ln(""+e,on,qt):on(~~e,~~t,~~n)};var an=un.prototype=new Bt;an.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;return!t&&!n&&!r?on(i,i,i):(t&&t<i&&(t=i),n&&n<i&&(n=i),r&&r<i&&(r=i),on(Math.min(255,~~(t/e)),Math.min(255,~~(n/e)),Math.min(255,~~(r/e))))},an.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),on(~~(e*this.r),~~(e*this.g),~~(e*this.b))},an.hsl=function(){return cn(this.r,this.g,this.b)},an.toString=function(){return"#"+fn(this.r)+fn(this.g)+fn(this.b)};var vn=e.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});vn.forEach(function(e,t){vn.set(e,rn(t))}),e.functor=mn,e.xhr=yn(gn),e.dsv=function(e,t){function i(e,n,r){arguments.length<3&&(r=n,n=null);var i=bn(e,t,n==null?s:o(n),r);return i.row=function(e){return arguments.length?i.response((n=e)==null?s:o(e)):n},i}function s(e){return i.parse(e.responseText)}function o(e){return function(t){return i.parse(t.responseText,e)}}function u(t){return t.map(a).join(e)}function a(e){return n.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var n=new RegExp('["'+e+"\n]"),r=e.charCodeAt(0);return i.parse=function(e,t){var n;return i.parseRows(e,function(e,r){if(n)return n(e,r-1);var i=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");n=t?function(e,n){return t(i(e),n)}:i})},i.parseRows=function(e,t){function c(){if(u>=o)return i;if(l)return l=!1,n;var t=u;if(e.charCodeAt(t)===34){var s=t;while(s++<o)if(e.charCodeAt(s)===34){if(e.charCodeAt(s+1)!==34)break;++s}u=s+2;var a=e.charCodeAt(s+1);return a===13?(l=!0,e.charCodeAt(s+2)===10&&++u):a===10&&(l=!0),e.substring(t+1,s).replace(/""/g,'"')}while(u<o){var a=e.charCodeAt(u++),f=1;if(a===10)l=!0;else if(a===13)l=!0,e.charCodeAt(u)===10&&(++u,++f);else if(a!==r)continue;return e.substring(t,u-f)}return e.substring(t)}var n={},i={},s=[],o=e.length,u=0,a=0,f,l;while((f=c())!==i){var h=[];while(f!==n&&f!==i)h.push(f),f=c();if(t&&!(h=t(h,a++)))continue;s.push(h)}return s},i.format=function(t){if(Array.isArray(t[0]))return i.formatRows(t);var n=new S,r=[];return t.forEach(function(e){for(var t in e)n.has(t)||r.push(n.add(t))}),[r.map(a).join(e)].concat(t.map(function(t){return r.map(function(e){return a(t[e])}).join(e)})).join("\n")},i.formatRows=function(e){return e.map(u).join("\n")},i},e.csv=e.dsv(",","text/csv"),e.tsv=e.dsv("	","text/tab-separated-values");var En,Sn,xn,Tn,Nn,Cn=s[T(s,"requestAnimationFrame")]||function(e){setTimeout(e,17)};e.timer=function(e,t,n){var r=arguments.length;r<2&&(t=0),r<3&&(n=Date.now());var i=n+t,s={c:e,t:i,f:!1,n:null};Sn?Sn.n=s:En=s,Sn=s,xn||(Tn=clearTimeout(Tn),xn=1,Cn(kn))},e.timer.flush=function(){Ln(),An()};var On=".",Mn=",",_n=[3,3],Dn="$",Pn=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(Hn);e.formatPrefix=function(t,n){var r=0;return t&&(t<0&&(t*=-1),n&&(t=e.round(t,Fn(t,n))),r=1+Math.floor(1e-12+Math.log(t)/Math.LN10),r=Math.max(-24,Math.min(24,Math.floor((r<=0?r+1:r-1)/3)*3))),Pn[8+r/3]},e.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)},e.format=function(t){var n=Bn.exec(t),r=n[1]||" ",i=n[2]||">",s=n[3]||"",o=n[4]||"",u=n[5],a=+n[6],f=n[7],l=n[8],c=n[9],h=1,p="",d=!1;l&&(l=+l.substring(1));if(u||r==="0"&&i==="=")u=r="0",i="=",f&&(a-=Math.floor((a-1)/4));switch(c){case"n":f=!0,c="g";break;case"%":h=100,p="%",c="f";break;case"p":h=100,p="%",c="r";break;case"b":case"o":case"x":case"X":o==="#"&&(o="0"+c.toLowerCase());case"c":case"d":d=!0,l=0;break;case"s":h=-1,c="r"}o==="#"?o="":o==="$"&&(o=Dn),c=="r"&&!l&&(c="g");if(l!=null)if(c=="g")l=Math.max(1,Math.min(21,l));else if(c=="e"||c=="f")l=Math.max(0,Math.min(20,l));c=jn.get(c)||In;var v=u&&f;return function(t){if(d&&t%1)return"";var n=t<0||t===0&&1/t<0?(t=-t,"-"):s;if(h<0){var m=e.formatPrefix(t,l);t=m.scale(t),p=m.symbol}else t*=h;t=c(t,l);var g=t.lastIndexOf("."),y=g<0?t:t.substring(0,g),b=g<0?"":On+t.substring(g+1);!u&&f&&(y=qn(y));var w=o.length+y.length+b.length+(v?0:n.length),E=w<a?(new Array(w=a-w+1)).join(r):"";return v&&(y=qn(E+y)),n+=o,t=y+b,(i==="<"?n+t+E:i===">"?E+n+t:i==="^"?E.substring(0,w>>=1)+n+t+E.substring(w):n+(v?t:E+t))+p}};var Bn=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,jn=e.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(t,n){return(t=e.round(t,Fn(t,n))).toFixed(Math.max(0,Math.min(20,Fn(t*(1+1e-15),n))))}}),qn=gn;if(_n){var Rn=_n.length;qn=function(e){var t=e.length,n=[],r=0,i=_n[0];while(t>0&&i>0)n.push(e.substring(t-=i,t+i)),i=_n[r=(r+1)%Rn];return n.reverse().join(Mn)}}e.geo={},Un.prototype={s:0,t:0,add:function(e){Wn(e,this.t,zn),Wn(zn.s,this.s,this),this.s?this.t+=zn.t:this.s=zn.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var zn=new Un;e.geo.stream=function(e,t){e&&Vn.hasOwnProperty(e.type)?Vn[e.type](e,t):Xn(e,t)};var Vn={Feature:function(e,t){Xn(e.geometry,t)},FeatureCollection:function(e,t){var n=e.features,r=-1,i=n.length;while(++r<i)Xn(n[r].geometry,t)}},$n={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Jn(e.coordinates,t,0)},MultiLineString:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)Jn(n[r],t,0)},Polygon:function(e,t){Kn(e.coordinates,t)},MultiPolygon:function(e,t){var n=e.coordinates,r=-1,i=n.length;while(++r<i)Kn(n[r],t)},GeometryCollection:function(e,t){var n=e.geometries,r=-1,i=n.length;while(++r<i)Xn(n[r],t)}};e.geo.area=function(t){return Qn=0,e.geo.stream(t,Yn),Qn};var Qn,Gn=new Un,Yn={sphere:function(){Qn+=4*mt},point:C,lineStart:C,lineEnd:C,polygonStart:function(){Gn.reset(),Yn.lineStart=Zn},polygonEnd:function(){var e=2*Gn;Qn+=e<0?4*mt+e:e,Yn.lineStart=Yn.lineEnd=Yn.point=C}};e.geo.bounds=function(){function p(e,s){l.push(c=[t=e,r=e]),s<n&&(n=s),s>i&&(i=s)}function d(e,o){var u=er([e*Et,o*Et]);if(a){var f=nr(a,u),l=[f[1],-f[0],0],c=nr(l,f);sr(c),c=or(c);var h=e-s,d=h>0?1:-1,v=c[0]*St*d,g=m(h)>180;if(g^(d*s<v&&v<d*e)){var y=c[1]*St;y>i&&(i=y)}else if(v=(v+360)%360-180,g^(d*s<v&&v<d*e)){var y=-c[1]*St;y<n&&(n=y)}else o<n&&(n=o),o>i&&(i=o);g?e<s?E(t,e)>E(t,r)&&(r=e):E(e,r)>E(t,r)&&(t=e):r>=t?(e<t&&(t=e),e>r&&(r=e)):e>s?E(t,e)>E(t,r)&&(r=e):E(e,r)>E(t,r)&&(t=e)}else p(e,o);a=u,s=e}function v(){h.point=d}function g(){c[0]=t,c[1]=r,h.point=p,a=null}function y(e,t){if(a){var n=e-s;f+=m(n)>180?n+(n>0?360:-360):n}else o=e,u=t;Yn.point(e,t),d(e,t)}function b(){Yn.lineStart()}function w(){y(o,u),Yn.lineEnd(),m(f)>bt&&(t=-(r=180)),c[0]=t,c[1]=r,a=null}function E(e,t){return(t-=e)<0?t+360:t}function S(e,t){return e[0]-t[0]}function x(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var t,n,r,i,s,o,u,a,f,l,c,h={point:p,lineStart:v,lineEnd:g,polygonStart:function(){h.point=y,h.lineStart=b,h.lineEnd=w,f=0,Yn.polygonStart()},polygonEnd:function(){Yn.polygonEnd(),h.point=p,h.lineStart=v,h.lineEnd=g,Gn<0?(t=-(r=180),n=-(i=90)):f>bt?i=90:f<-bt&&(n=-90),c[0]=t,c[1]=r}};return function(s){i=r=-(t=n=Infinity),l=[],e.geo.stream(s,h);var o=l.length;if(o){l.sort(S);for(var u=1,a=l[0],f,p=[a];u<o;++u)f=l[u],x(f[0],a)||x(f[1],a)?(E(a[0],f[1])>E(a[0],a[1])&&(a[1]=f[1]),E(f[0],a[1])>E(a[0],a[1])&&(a[0]=f[0])):p.push(a=f);var d=-Infinity,v;for(var o=p.length-1,u=0,a=p[o],f;u<=o;a=f,++u)f=p[u],(v=E(a[1],f[0]))>d&&(d=v,t=f[0],r=a[1])}return l=c=null,t===Infinity||n===Infinity?[[NaN,NaN],[NaN,NaN]]:[[t,n],[r,i]]}}(),e.geo.centroid=function(t){ar=fr=lr=cr=hr=pr=dr=vr=mr=gr=yr=0,e.geo.stream(t,br);var n=mr,r=gr,i=yr,s=n*n+r*r+i*i;if(s<wt){n=pr,r=dr,i=vr,fr<bt&&(n=lr,r=cr,i=hr),s=n*n+r*r+i*i;if(s<wt)return[NaN,NaN]}return[Math.atan2(r,n)*St,Nt(i/Math.sqrt(s))*St]};var ar,fr,lr,cr,hr,pr,dr,vr,mr,gr,yr,br={sphere:C,point:wr,lineStart:Sr,lineEnd:xr,polygonStart:function(){br.lineStart=Tr},polygonEnd:function(){br.lineStart=Sr}},Pr=Ar(Nr,Hr,jr,[-mt,-mt/2]),qr=1e9;e.geo.clipExtent=function(){var e,t,n,r,i,s,o={stream:function(e){return i&&(i.valid=!1),i=s(e),i.valid=!0,i},extent:function(u){return arguments.length?(s=Rr(e=+u[0][0],t=+u[0][1],n=+u[1][0],r=+u[1][1]),i&&(i.valid=!1,i=null),o):[[e,t],[n,r]]}};return o.extent([[0,0],[960,500]])},(e.geo.conicEqualArea=function(){return zr(Wr)}).raw=Wr,e.geo.albers=function(){return e.geo.conicEqualArea().rotate([96,0]).center([-0.6,38.7]).parallels([29.5,45.5]).scale(1070)},e.geo.albersUsa=function(){function f(e){var t=e[0],n=e[1];return i=null,(o(t,n),i)||(u(t,n),i)||a(t,n),i}var t=e.geo.albers(),n=e.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),r=e.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),i,s={point:function(e,t){i=[e,t]}},o,u,a;return f.invert=function(e){var i=t.scale(),s=t.translate(),o=(e[0]-s[0])/i,u=(e[1]-s[1])/i;return(u>=.12&&u<.234&&o>=-0.425&&o<-0.214?n:u>=.166&&u<.234&&o>=-0.214&&o<-0.115?r:t).invert(e)},f.stream=function(e){var i=t.stream(e),s=n.stream(e),o=r.stream(e);return{point:function(e,t){i.point(e,t),s.point(e,t),o.point(e,t)},sphere:function(){i.sphere(),s.sphere(),o.sphere()},lineStart:function(){i.lineStart(),s.lineStart(),o.lineStart()},lineEnd:function(){i.lineEnd(),s.lineEnd(),o.lineEnd()},polygonStart:function(){i.polygonStart(),s.polygonStart(),o.polygonStart()},polygonEnd:function(){i.polygonEnd(),s.polygonEnd(),o.polygonEnd()}}},f.precision=function(e){return arguments.length?(t.precision(e),n.precision(e),r.precision(e),f):t.precision()},f.scale=function(e){return arguments.length?(t.scale(e),n.scale(e*.35),r.scale(e),f.translate(t.translate())):t.scale()},f.translate=function(e){if(!arguments.length)return t.translate();var i=t.scale(),l=+e[0],c=+e[1];return o=t.translate(e).clipExtent([[l-.455*i,c-.238*i],[l+.455*i,c+.238*i]]).stream(s).point,u=n.translate([l-.307*i,c+.201*i]).clipExtent([[l-.425*i+bt,c+.12*i+bt],[l-.214*i-bt,c+.234*i-bt]]).stream(s).point,a=r.translate([l-.205*i,c+.212*i]).clipExtent([[l-.214*i+bt,c+.166*i+bt],[l-.115*i-bt,c+.234*i-bt]]).stream(s).point,f},f.scale(1070)};var Xr,Vr,$r={point:C,lineStart:C,lineEnd:C,polygonStart:function(){Vr=0,$r.lineStart=Jr},polygonEnd:function(){$r.lineStart=$r.lineEnd=$r.point=C,Xr+=m(Vr/2)}},Kr,Qr,Gr,Yr,Zr={point:ei,lineStart:C,lineEnd:C,polygonStart:C,polygonEnd:C},ri={point:ii,lineStart:si,lineEnd:oi,polygonStart:function(){ri.lineStart=ui},polygonEnd:function(){ri.point=ii,ri.lineStart=si,ri.lineEnd=oi}};e.geo.path=function(){function u(n){if(n){typeof t=="function"&&s.pointRadius(+t.apply(this,arguments));if(!o||!o.valid)o=i(s);e.geo.stream(n,o)}return s.result()}function a(){return o=null,u}var t=4.5,n,r,i,s,o;return u.area=function(t){return Xr=0,e.geo.stream(t,i($r)),Xr},u.centroid=function(t){return lr=cr=hr=pr=dr=vr=mr=gr=yr=0,e.geo.stream(t,i(ri)),yr?[mr/yr,gr/yr]:vr?[pr/vr,dr/vr]:hr?[lr/hr,cr/hr]:[NaN,NaN]},u.bounds=function(t){return Gr=Yr=-(Kr=Qr=Infinity),e.geo.stream(t,i(Zr)),[[Kr,Qr],[Gr,Yr]]},u.projection=function(e){return arguments.length?(i=(n=e)?e.stream||li(e):gn,a()):n},u.context=function(e){return arguments.length?(s=(r=e)==null?new ti:new ai(e),typeof t!="function"&&s.pointRadius(t),a()):r},u.pointRadius=function(e){return arguments.length?(t=typeof e=="function"?e:(s.pointRadius(+e),+e),u):t},u.projection(e.geo.albersUsa()).context(null)},e.geo.transform=function(e){return{stream:function(t){var n=new ci(t);for(var r in e)n[r]=e[r];return n}}},ci.prototype={point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},e.geo.projection=pi,e.geo.projectionMutator=di,(e.geo.equirectangular=function(){return pi(mi)}).raw=mi.invert=mi,e.geo.rotation=function(e){function t(t){return t=e(t[0]*Et,t[1]*Et),t[0]*=St,t[1]*=St,t}return e=yi(e[0]%360*Et,e[1]*Et,e.length>2?e[2]*Et:0),t.invert=function(t){return t=e.invert(t[0]*Et,t[1]*Et),t[0]*=St,t[1]*=St,t},t},gi.invert=mi,e.geo.circle=function(){function i(){var t=typeof e=="function"?e.apply(this,arguments):e,n=yi(-t[0]*Et,-t[1]*Et,0).invert,i=[];return r(null,null,1,{point:function(e,t){i.push(e=n(e,t)),e[0]*=St,e[1]*=St}}),{type:"Polygon",coordinates:[i]}}var e=[0,0],t,n=6,r;return i.origin=function(t){return arguments.length?(e=t,i):e},i.angle=function(e){return arguments.length?(r=Si((t=+e)*Et,n*Et),i):t},i.precision=function(e){return arguments.length?(r=Si(t*Et,(n=+e)*Et),i):n},i.angle(90)},e.geo.distance=function(e,t){var n=(t[0]-e[0])*Et,r=e[1]*Et,i=t[1]*Et,s=Math.sin(n),o=Math.cos(n),u=Math.sin(r),a=Math.cos(r),f=Math.sin(i),l=Math.cos(i),c;return Math.atan2(Math.sqrt((c=l*s)*c+(c=a*f-u*l*o)*c),u*f+a*l*o)},e.geo.graticule=function(){function b(){return{type:"MultiLineString",coordinates:w()}}function w(){return e.range(Math.ceil(i/c)*c,r,c).map(v).concat(e.range(Math.ceil(a/h)*h,u,h).map(g)).concat(e.range(Math.ceil(n/f)*f,t,f).filter(function(e){return m(e%c)>bt}).map(p)).concat(e.range(Math.ceil(o/l)*l,s,l).filter(function(e){return m(e%h)>bt}).map(d))}var t,n,r,i,s,o,u,a,f=10,l=f,c=90,h=360,p,d,v,g,y=2.5;return b.lines=function(){return w().map(function(e){return{type:"LineString",coordinates:e}})},b.outline=function(){return{type:"Polygon",coordinates:[v(i).concat(g(u).slice(1),v(r).reverse().slice(1),g(a).reverse().slice(1))]}},b.extent=function(e){return arguments.length?b.majorExtent(e).minorExtent(e):b.minorExtent()},b.majorExtent=function(e){return arguments.length?(i=+e[0][0],r=+e[1][0],a=+e[0][1],u=+e[1][1],i>r&&(e=i,i=r,r=e),a>u&&(e=a,a=u,u=e),b.precision(y)):[[i,a],[r,u]]},b.minorExtent=function(e){return arguments.length?(n=+e[0][0],t=+e[1][0],o=+e[0][1],s=+e[1][1],n>t&&(e=n,n=t,t=e),o>s&&(e=o,o=s,s=e),b.precision(y)):[[n,o],[t,s]]},b.step=function(e){return arguments.length?b.majorStep(e).minorStep(e):b.minorStep()},b.majorStep=function(e){return arguments.length?(c=+e[0],h=+e[1],b):[c,h]},b.minorStep=function(e){return arguments.length?(f=+e[0],l=+e[1],b):[f,l]},b.precision=function(e){return arguments.length?(y=+e,p=Ti(o,s,90),d=Ni(n,t,y),v=Ti(a,u,90),g=Ni(i,r,y),b):y},b.majorExtent([[-180,-90+bt],[180,90-bt]]).minorExtent([[-180,-80-bt],[180,80+bt]])},e.geo.greatArc=function(){function s(){return{type:"LineString",coordinates:[n||t.apply(this,arguments),i||r.apply(this,arguments)]}}var t=Ci,n,r=ki,i;return s.distance=function(){return e.geo.distance(n||t.apply(this,arguments),i||r.apply(this,arguments))},s.source=function(e){return arguments.length?(t=e,n=typeof e=="function"?null:e,s):t},s.target=function(e){return arguments.length?(r=e,i=typeof e=="function"?null:e,s):r},s.precision=function(){return arguments.length?s:0},s},e.geo.interpolate=function(e,t){return Li(e[0]*Et,e[1]*Et,t[0]*Et,t[1]*Et)},e.geo.length=function(t){return Ai=0,e.geo.stream(t,Oi),Ai};var Ai,Oi={sphere:C,point:C,lineStart:Mi,lineEnd:C,polygonStart:C,polygonEnd:C},Di=_i(function(e){return Math.sqrt(2/(1+e))},function(e){return 2*Math.asin(e/2)});(e.geo.azimuthalEqualArea=function(){return pi(Di)}).raw=Di;var Pi=_i(function(e){var t=Math.acos(e);return t&&t/Math.sin(t)},gn);(e.geo.azimuthalEquidistant=function(){return pi(Pi)}).raw=Pi,(e.geo.conicConformal=function(){return zr(Hi)}).raw=Hi,(e.geo.conicEquidistant=function(){return zr(Bi)}).raw=Bi;var ji=_i(function(e){return 1/e},Math.atan);(e.geo.gnomonic=function(){return pi(ji)}).raw=ji,Fi.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-yt]},(e.geo.mercator=function(){return Ii(Fi)}).raw=Fi;var qi=_i(function(){return 1},Math.asin);(e.geo.orthographic=function(){return pi(qi)}).raw=qi;var Ri=_i(function(e){return 1/(1+e)},function(e){return 2*Math.atan(e)});(e.geo.stereographic=function(){return pi(Ri)}).raw=Ri,Ui.invert=function(e,t){return[-t,2*Math.atan(Math.exp(e))-yt]},(e.geo.transverseMercator=function(){var e=Ii(Ui),t=e.center,n=e.rotate;return e.center=function(e){return e?t([-e[1],e[0]]):(e=t(),[-e[1],e[0]])},e.rotate=function(e){return e?n([e[0],e[1],e.length>2?e[2]+90:90]):(e=n(),[e[0],e[1],e[2]-90])},e.rotate([0,0])}).raw=Ui,e.geom={},e.geom.hull=function(e){function r(e){if(e.length<3)return[];var r=mn(t),i=mn(n),s=e.length,o,u=s-1,a=[],f=[],l,c,h,p=0,d,v,m,g,y,b,w,E;if(r===zi&&n===Wi)o=e;else for(c=0,o=[];c<s;++c)o.push([+r.call(this,l=e[c],c),+i.call(this,l,c)]);for(c=1;c<s;++c)if(o[c][1]<o[p][1]||o[c][1]==o[p][1]&&o[c][0]<o[p][0])p=c;for(c=0;c<s;++c){if(c===p)continue;v=o[c][1]-o[p][1],d=o[c][0]-o[p][0],a.push({angle:Math.atan2(v,d),index:c})}a.sort(function(e,t){return e.angle-t.angle}),w=a[0].angle,b=a[0].index,y=0;for(c=1;c<u;++c){h=a[c].index;if(w==a[c].angle){d=o[b][0]-o[p][0],v=o[b][1]-o[p][1],m=o[h][0]-o[p][0],g=o[h][1]-o[p][1];if(d*d+v*v>=m*m+g*g){a[c].index=-1;continue}a[y].index=-1}w=a[c].angle,y=c,b=h}f.push(p);for(c=0,h=0;c<2;++h)a[h].index>-1&&(f.push(a[h].index),c++);E=f.length;for(;h<u;++h){if(a[h].index<0)continue;while(!Xi(f[E-2],f[E-1],a[h].index,o))--E;f[E++]=a[h].index}var S=[];for(c=E-1;c>=0;--c)S.push(e[f[c]]);return S}var t=zi,n=Wi;return arguments.length?r(e):(r.x=function(e){return arguments.length?(t=e,r):t},r.y=function(e){return arguments.length?(n=e,r):n},r)},e.geom.polygon=function(e){return D(e,Vi),e};var Vi=e.geom.polygon.prototype=[];Vi.area=function(){var e=-1,t=this.length,n,r=this[t-1],i=0;while(++e<t)n=r,r=this[e],i+=n[1]*r[0]-n[0]*r[1];return i*.5},Vi.centroid=function(e){var t=-1,n=this.length,r=0,i=0,s,o=this[n-1],u;arguments.length||(e=-1/(6*this.area()));while(++t<n)s=o,o=this[t],u=s[0]*o[1]-o[0]*s[1],r+=(s[0]+o[0])*u,i+=(s[1]+o[1])*u;return[r*e,i*e]},Vi.clip=function(e){var t,n=Ki(e),r=-1,i=this.length-Ki(this),s,o,u=this[i-1],a,f,l;while(++r<i){t=e.slice(),e.length=0,a=this[r],f=t[(o=t.length-n)-1],s=-1;while(++s<o)l=t[s],$i(l,u,a)?($i(f,u,a)||e.push(Ji(f,l,u,a)),e.push(l)):$i(f,u,a)&&e.push(Ji(f,l,u,a)),f=l;n&&e.push(e[0]),u=a}return e};var Qi,Gi,Yi,Zi=[],es,ts,ns=[];ls.prototype.prepare=function(){var e=this.edges,t=e.length,n;while(t--)n=e[t].edge,(!n.b||!n.a)&&e.splice(t,1);return e.sort(hs),e.length},Ss.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},xs.prototype={insert:function(e,t){var n,r,i;if(e){t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t;if(e.R){e=e.R;while(e.L)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=ks(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);t.L=t.R=null,t.U=n,t.C=!0,e=t;while(n&&n.C)r=n.U,n===r.L?(i=r.R,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.R&&(Ns(this,n),e=n,n=e.U),n.C=!1,r.C=!0,Cs(this,r))):(i=r.L,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.L&&(Cs(this,n),e=n,n=e.U),n.C=!1,r.C=!0,Ns(this,r))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t=e.U,n,r=e.L,i=e.R,s,o;r?i?s=ks(i):s=r:s=i,t?t.L===e?t.L=s:t.R=s:this._=s,r&&i?(o=s.C,s.C=e.C,s.L=r,r.U=s,s!==i?(t=s.U,s.U=e.U,e=s.R,t.L=e,s.R=i,i.U=s):(s.U=t,t=s,e=s.R)):(o=e.C,e=s),e&&(e.U=t);if(o)return;if(e&&e.C){e.C=!1;return}do{if(e===this._)break;if(e===t.L){n=t.R,n.C&&(n.C=!1,t.C=!0,Ns(this,t),n=t.R);if(n.L&&n.L.C||n.R&&n.R.C){if(!n.R||!n.R.C)n.L.C=!1,n.C=!0,Cs(this,n),n=t.R;n.C=t.C,t.C=n.R.C=!1,Ns(this,t),e=this._;break}}else{n=t.L,n.C&&(n.C=!1,t.C=!0,Cs(this,t),n=t.L);if(n.L&&n.L.C||n.R&&n.R.C){if(!n.L||!n.L.C)n.R.C=!1,n.C=!0,Ns(this,n),n=t.L;n.C=t.C,t.C=n.L.C=!1,Cs(this,t),e=this._;break}}n.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}},e.geom.voronoi=function(e){function o(e){var t=new Array(e.length),n=s[0][0],r=s[0][1],i=s[1][0],o=s[1][1];return Ls(u(e),s).cells.forEach(function(s,u){var a=s.edges,f=s.site,l=t[u]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):f.x>=n&&f.x<=i&&f.y>=r&&f.y<=o?[[n,o],[i,o],[i,r],[n,r]]:[];l.point=e[u]}),t}function u(e){return e.map(function(e,t){return{x:Math.round(r(e,t)/bt)*bt,y:Math.round(i(e,t)/bt)*bt,i:t}})}var t=zi,n=Wi,r=t,i=n,s=Os;return e?o(e):(o.links=function(e){return Ls(u(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},o.triangles=function(e){var t=[];return Ls(u(e)).cells.forEach(function(n,r){var i=n.site,s=n.edges.sort(hs),o=-1,u=s.length,a,f,l=s[u-1].edge,c=l.l===i?l.r:l.l;while(++o<u)a=l,f=c,l=s[o].edge,c=l.l===i?l.r:l.l,r<f.i&&r<c.i&&Ms(i,f,c)<0&&t.push([e[r],e[f.i],e[c.i]])}),t},o.x=function(e){return arguments.length?(r=mn(t=e),o):t},o.y=function(e){return arguments.length?(i=mn(n=e),o):n},o.clipExtent=function(e){return arguments.length?(s=e==null?Os:e,o):s===Os?null:s},o.size=function(e){return arguments.length?o.clipExtent(e&&[[0,0],e]):s===Os?null:s&&s[1]},o)};var Os=[[-1e6,-1e6],[1e6,1e6]];e.geom.delaunay=function(t){return e.geom.voronoi().triangles(t)},e.geom.quadtree=function(e,t,n,r,i){function a(e){function T(e,t,n,r,i,s,o,u){if(isNaN(n)||isNaN(r))return;if(e.leaf){var a=e.x,f=e.y;if(a!=null)if(m(a-n)+m(f-r)<.01)N(e,t,n,r,i,s,o,u);else{var l=e.point;e.x=e.y=e.point=null,N(e,l,a,f,i,s,o,u),N(e,t,n,r,i,s,o,u)}else e.x=n,e.y=r,e.point=t}else N(e,t,n,r,i,s,o,u)}function N(e,t,n,r,i,s,o,u){var a=(i+o)*.5,f=(s+u)*.5,l=n>=a,c=r>=f,h=(c<<1)+l;e.leaf=!1,e=e.nodes[h]||(e.nodes[h]=Ps()),l?i=a:o=a,c?s=f:u=f,T(e,t,n,r,i,s,o,u)}var a,f=mn(s),l=mn(o),c,h,p,d,v,g,y,b;if(t!=null)v=t,g=n,y=r,b=i;else{y=b=-(v=g=Infinity),c=[],h=[],d=e.length;if(u)for(p=0;p<d;++p)a=e[p],a.x<v&&(v=a.x),a.y<g&&(g=a.y),a.x>y&&(y=a.x),a.y>b&&(b=a.y),c.push(a.x),h.push(a.y);else for(p=0;p<d;++p){var w=+f(a=e[p],p),E=+l(a,p);w<v&&(v=w),E<g&&(g=E),w>y&&(y=w),E>b&&(b=E),c.push(w),h.push(E)}}var S=y-v,x=b-g;S>x?b=g+S:y=v+x;var C=Ps();C.add=function(e){T(C,e,+f(e,++p),+l(e,p),v,g,y,b)},C.visit=function(e){Hs(e,C,v,g,y,b)},p=-1;if(t==null){while(++p<d)T(C,e[p],c[p],h[p],v,g,y,b);--p}else e.forEach(C.add);return c=h=e=a=null,C}var s=zi,o=Wi,u;return(u=arguments.length)?(s=_s,o=Ds,u===3&&(i=n,r=t,n=t=0),a(e)):(a.x=function(e){return arguments.length?(s=e,a):s},a.y=function(e){return arguments.length?(o=e,a):o},a.extent=function(e){return arguments.length?(e==null?t=n=r=i=null:(t=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),a):t==null?null:[[t,n],[r,i]]},a.size=function(e){return arguments.length?(e==null?t=n=r=i=null:(t=n=0,r=+e[0],i=+e[1]),a):t==null?null:[r-t,i-n]},a)},e.interpolateRgb=Bs,e.interpolateObject=js,e.interpolateNumber=Fs,e.interpolateString=Is;var qs=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;e.interpolate=Rs,e.interpolators=[function(e,t){var n=typeof t;return(n==="string"?vn.has(t)||/^(#|rgb\(|hsl\()/.test(t)?Bs:Is:t instanceof Bt?Bs:n==="object"?Array.isArray(t)?Us:js:Fs)(e,t)}],e.interpolateArray=Us;var zs=function(){return gn},Ws=e.map({linear:zs,poly:Ys,quad:function(){return Ks},cubic:function(){return Qs},sin:function(){return Zs},exp:function(){return eo},circle:function(){return to},elastic:no,back:ro,bounce:function(){return io}}),Xs=e.map({"in":gn,out:$s,"in-out":Js,"out-in":function(e){return Js($s(e))}});e.ease=function(e){var n=e.indexOf("-"),r=n>=0?e.substring(0,n):e,i=n>=0?e.substring(n+1):"in";return r=Ws.get(r)||zs,i=Xs.get(i)||gn,Vs(i(r.apply(null,t.call(arguments,1))))},e.interpolateHcl=so,e.interpolateHsl=oo,e.interpolateLab=uo,e.interpolateRound=ao,e.transform=function(t){var n=r.createElementNS(e.ns.prefix.svg,"g");return(e.transform=function(e){if(e!=null){n.setAttribute("transform",e);var t=n.transform.baseVal.consolidate()}return new fo(t?t.matrix:po)})(t)},fo.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var po={a:1,b:0,c:0,d:1,e:0,f:0};e.interpolateTransform=vo,e.layout={},e.layout.bundle=function(){return function(e){var t=[],n=-1,r=e.length;while(++n<r)t.push(yo(e[n]));return t}},e.layout.chord=function(){function l(){var t={},l=[],h=e.range(s),p=[],d,v,m,g,y;n=[],r=[],d=0,g=-1;while(++g<s){v=0,y=-1;while(++y<s)v+=i[g][y];l.push(v),p.push(e.range(s)),d+=v}u&&h.sort(function(e,t){return u(l[e],l[t])}),a&&p.forEach(function(e,t){e.sort(function(e,n){return a(i[t][e],i[t][n])})}),d=(gt-o*s)/d,v=0,g=-1;while(++g<s){m=v,y=-1;while(++y<s){var b=h[g],w=p[b][y],E=i[b][w],S=v,x=v+=E*d;t[b+"-"+w]={index:b,subindex:w,startAngle:S,endAngle:x,value:E}}r[b]={index:b,startAngle:m,endAngle:v,value:(v-m)/d},v+=o}g=-1;while(++g<s){y=g-1;while(++y<s){var T=t[g+"-"+y],N=t[y+"-"+g];(T.value||N.value)&&n.push(T.value<N.value?{source:N,target:T}:{source:T,target:N})}}f&&c()}function c(){n.sort(function(e,t){return f((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var t={},n,r,i,s,o=0,u,a,f;return t.matrix=function(e){return arguments.length?(s=(i=e)&&i.length,n=r=null,t):i},t.padding=function(e){return arguments.length?(o=e,n=r=null,t):o},t.sortGroups=function(e){return arguments.length?(u=e,n=r=null,t):u},t.sortSubgroups=function(e){return arguments.length?(a=e,n=null,t):a},t.sortChords=function(e){return arguments.length?(f=e,n&&c(),t):f},t.chords=function(){return n||l(),n},t.groups=function(){return r||l(),r},t},e.layout.force=function(){function g(e){return function(t,n,r,i){if(t.point!==e){var s=t.cx-e.x,o=t.cy-e.y,u=1/Math.sqrt(s*s+o*o);if((i-n)*u<c){var a=t.charge*u*u;return e.px-=s*a,e.py-=o*a,!0}if(t.point&&isFinite(u)){var a=t.pointCharge*u*u;e.px-=s*a,e.py-=o*a}}return!t.charge}}function y(n){n.px=e.event.x,n.py=e.event.y,t.resume()}var t={},n=e.dispatch("start","tick","end"),r=[1,1],i,s,o=.9,u=Co,a=ko,f=-30,l=.1,c=.8,h=[],p=[],d,v,m;return t.tick=function(){if((s*=.99)<.005)return n.end({type:"end",alpha:s=0}),!0;var t=h.length,i=p.length,u,a,c,y,b,w,E,S,x;for(a=0;a<i;++a){c=p[a],y=c.source,b=c.target,S=b.x-y.x,x=b.y-y.y;if(w=S*S+x*x)w=s*v[a]*((w=Math.sqrt(w))-d[a])/w,S*=w,x*=w,b.x-=S*(E=y.weight/(b.weight+y.weight)),b.y-=x*E,y.x+=S*(E=1-E),y.y+=x*E}if(E=s*l){S=r[0]/2,x=r[1]/2,a=-1;if(E)while(++a<t)c=h[a],c.x+=(S-c.x)*E,c.y+=(x-c.y)*E}if(f){No(u=e.geom.quadtree(h),s,m),a=-1;while(++a<t)(c=h[a]).fixed||u.visit(g(c))}a=-1;while(++a<t)c=h[a],c.fixed?(c.x=c.px,c.y=c.py):(c.x-=(c.px-(c.px=c.x))*o,c.y-=(c.py-(c.py=c.y))*o);n.tick({type:"tick",alpha:s})},t.nodes=function(e){return arguments.length?(h=e,t):h},t.links=function(e){return arguments.length?(p=e,t):p},t.size=function(e){return arguments.length?(r=e,t):r},t.linkDistance=function(e){return arguments.length?(u=typeof e=="function"?e:+e,t):u},t.distance=t.linkDistance,t.linkStrength=function(e){return arguments.length?(a=typeof e=="function"?e:+e,t):a},t.friction=function(e){return arguments.length?(o=+e,t):o},t.charge=function(e){return arguments.length?(f=typeof e=="function"?e:+e,t):f},t.gravity=function(e){return arguments.length?(l=+e,t):l},t.theta=function(e){return arguments.length?(c=+e,t):c},t.alpha=function(r){return arguments.length?(r=+r,s?r>0?s=r:s=0:r>0&&(n.start({type:"start",alpha:s=r}),e.timer(t.tick)),t):s},t.start=function(){function g(t,r){if(!l){l=new Array(n);for(o=0;o<n;++o)l[o]=[];for(o=0;o<u;++o){var i=p[o];l[i.source.index].push(i.target),l[i.target.index].push(i.source)}}var s=l[e],o=-1,u=s.length,a;while(++o<u)if(!isNaN(a=s[o][t]))return a;return Math.random()*r}var e,n=h.length,i=p.length,s=r[0],o=r[1],l,c;for(e=0;e<n;++e)(c=h[e]).index=e,c.weight=0;for(e=0;e<i;++e)c=p[e],typeof c.source=="number"&&(c.source=h[c.source]),typeof c.target=="number"&&(c.target=h[c.target]),++c.source.weight,++c.target.weight;for(e=0;e<n;++e)c=h[e],isNaN(c.x)&&(c.x=g("x",s)),isNaN(c.y)&&(c.y=g("y",o)),isNaN(c.px)&&(c.px=c.x),isNaN(c.py)&&(c.py=c.y);d=[];if(typeof u=="function")for(e=0;e<i;++e)d[e]=+u.call(this,p[e],e);else for(e=0;e<i;++e)d[e]=u;v=[];if(typeof a=="function")for(e=0;e<i;++e)v[e]=+a.call(this,p[e],e);else for(e=0;e<i;++e)v[e]=a;m=[];if(typeof f=="function")for(e=0;e<n;++e)m[e]=+f.call(this,h[e],e);else for(e=0;e<n;++e)m[e]=f;return t.resume()},t.resume=function(){return t.alpha(.1)},t.stop=function(){return t.alpha(0)},t.drag=function(){i||(i=e.behavior.drag().origin(gn).on("dragstart.force",Eo).on("drag.force",y).on("dragend.force",So));if(!arguments.length)return i;this.on("mouseover.force",xo).on("mouseout.force",To).call(i)},e.rebind(t,n,"on")};var Co=20,ko=1;e.layout.hierarchy=function(){function r(i,o,u){var a=t.call(s,i,o);i.depth=o,u.push(i);if(a&&(l=a.length)){var f=-1,l,c=i.children=new Array(l),h=0,p=o+1,d;while(++f<l)d=c[f]=r(a[f],p,u),d.parent=i,h+=d.value;e&&c.sort(e),n&&(i.value=h)}else delete i.children,n&&(i.value=+n.call(s,i,o)||0);return i}function i(e,t){var r=e.children,o=0;if(r&&(a=r.length)){var u=-1,a,f=t+1;while(++u<a)o+=i(r[u],f)}else n&&(o=+n.call(s,e,t)||0);return n&&(e.value=o),o}function s(e){var t=[];return r(e,0,t),t}var e=Mo,t=Ao,n=Oo;return s.sort=function(t){return arguments.length?(e=t,s):e},s.children=function(e){return arguments.length?(t=e,s):t},s.value=function(e){return arguments.length?(n=e,s):n},s.revalue=function(e){return i(e,0),e},s},e.layout.partition=function(){function r(e,t,n,i){var s=e.children;e.x=t,e.y=e.depth*i,e.dx=n,e.dy=i;if(s&&(u=s.length)){var o=-1,u,a,f;n=e.value?n/e.value:0;while(++o<u)r(a=s[o],t,f=a.value*n,i),t+=f}}function i(e){var t=e.children,n=0;if(t&&(s=t.length)){var r=-1,s;while(++r<s)n=Math.max(n,i(t[r]))}return 1+n}function s(e,s){var o=t.call(this,e,s);return r(o[0],0,n[0],n[1]/i(o[0])),o}var t=e.layout.hierarchy(),n=[1,1];return s.size=function(e){return arguments.length?(n=e,s):n},Lo(s,t)},e.layout.pie=function(){function s(o){var u=o.map(function(e,n){return+t.call(s,e,n)}),a=+(typeof r=="function"?r.apply(this,arguments):r),f=((typeof i=="function"?i.apply(this,arguments):i)-a)/e.sum(u),l=e.range(o.length);n!=null&&l.sort(n===Do?function(e,t){return u[t]-u[e]}:function(e,t){return n(o[e],o[t])});var c=[];return l.forEach(function(e){var t;c[e]={data:o[e],value:t=u[e],startAngle:a,endAngle:a+=t*f}}),c}var t=Number,n=Do,r=0,i=gt;return s.value=function(e){return arguments.length?(t=e,s):t},s.sort=function(e){return arguments.length?(n=e,s):n},s.startAngle=function(e){return arguments.length?(r=e,s):r},s.endAngle=function(e){return arguments.length?(i=e,s):i},s};var Do={};e.layout.stack=function(){function u(a,f){var l=a.map(function(e,n){return t.call(u,e,n)}),c=l.map(function(e){return e.map(function(e,t){return[s.call(u,e,t),o.call(u,e,t)]})}),h=n.call(u,c,f);l=e.permute(l,h),c=e.permute(c,h);var p=r.call(u,c,f),d=l.length,v=l[0].length,m,g,y;for(g=0;g<v;++g){i.call(u,l[0][g],y=p[g],c[0][g][1]);for(m=1;m<d;++m)i.call(u,l[m][g],y+=c[m-1][g][1],c[m][g][1])}return a}var t=gn,n=Io,r=qo,i=Bo,s=Po,o=Ho;return u.values=function(e){return arguments.length?(t=e,u):t},u.order=function(e){return arguments.length?(n=typeof e=="function"?e:jo.get(e)||Io,u):n},u.offset=function(e){return arguments.length?(r=typeof e=="function"?e:Fo.get(e)||qo,u):r},u.x=function(e){return arguments.length?(s=e,u):s},u.y=function(e){return arguments.length?(o=e,u):o},u.out=function(e){return arguments.length?(i=e,u):i},u};var jo=e.map({"inside-out":function(t){var n=t.length,r,i,s=t.map(Ro),o=t.map(Uo),u=e.range(n).sort(function(e,t){return s[e]-s[t]}),a=0,f=0,l=[],c=[];for(r=0;r<n;++r)i=u[r],a<f?(a+=o[i],l.push(i)):(f+=o[i],c.push(i));return c.reverse().concat(l)},reverse:function(t){return e.range(t.length).reverse()},"default":Io}),Fo=e.map({silhouette:function(e){var t=e.length,n=e[0].length,r=[],i=0,s,o,u,a=[];for(o=0;o<n;++o){for(s=0,u=0;s<t;s++)u+=e[s][o][1];u>i&&(i=u),r.push(u)}for(o=0;o<n;++o)a[o]=(i-r[o])/2;return a},wiggle:function(e){var t=e.length,n=e[0],r=n.length,i,s,o,u,a,f,l,c,h,p=[];p[0]=c=h=0;for(s=1;s<r;++s){for(i=0,u=0;i<t;++i)u+=e[i][s][1];for(i=0,a=0,l=n[s][0]-n[s-1][0];i<t;++i){for(o=0,f=(e[i][s][1]-e[i][s-1][1])/(2*l);o<i;++o)f+=(e[o][s][1]-e[o][s-1][1])/l;a+=f*e[i][s][1]}p[s]=c-=u?a/u*l:0,c<h&&(h=c)}for(s=0;s<r;++s)p[s]-=h;return p},expand:function(e){var t=e.length,n=e[0].length,r=1/t,i,s,o,u=[];for(s=0;s<n;++s){for(i=0,o=0;i<t;i++)o+=e[i][s][1];if(o)for(i=0;i<t;i++)e[i][s][1]/=o;else for(i=0;i<t;i++)e[i][s][1]=r}for(s=0;s<n;++s)u[s]=0;return u},zero:qo});e.layout.histogram=function(){function s(s,o){var u=[],a=s.map(n,this),f=r.call(this,a,o),l=i.call(this,f,a,o),c,o=-1,h=a.length,p=l.length-1,d=t?1:1/h,v;while(++o<p)c=u[o]=[],c.dx=l[o+1]-(c.x=l[o]),c.y=0;if(p>0){o=-1;while(++o<h)v=a[o],v>=f[0]&&v<=f[1]&&(c=u[e.bisect(l,v,1,p)-1],c.y+=d,c.push(s[o]))}return u}var t=!0,n=Number,r=Vo,i=Wo;return s.value=function(e){return arguments.length?(n=e,s):n},s.range=function(e){return arguments.length?(r=mn(e),s):r},s.bins=function(e){return arguments.length?(i=typeof e=="number"?function(t){return Xo(t,e)}:mn(e),s):i},s.frequency=function(e){return arguments.length?(t=!!e,s):t},s},e.layout.tree=function(){function s(e,s){function a(e,t){var r=e.children,i=e._tree;if(r&&(s=r.length)){var s,o=r[0],u,f=o,c,h=-1;while(++h<s)c=r[h],a(c,u),f=l(c,u,f),u=c;tu(e);var p=.5*(o._tree.prelim+c._tree.prelim);t?(i.prelim=t._tree.prelim+n(e,t),i.mod=i.prelim-p):i.prelim=p}else t&&(i.prelim=t._tree.prelim+n(e,t))}function f(e,t){e.x=e._tree.prelim+t;var n=e.children;if(n&&(i=n.length)){var r=-1,i;t+=e._tree.mod;while(++r<i)f(n[r],t)}}function l(e,t,r){if(t){var i=e,s=e,o=t,u=e.parent.children[0],a=i._tree.mod,f=s._tree.mod,l=o._tree.mod,c=u._tree.mod,h;while(o=Ko(o),i=Jo(i),o&&i)u=Jo(u),s=Ko(s),s._tree.ancestor=e,h=o._tree.prelim+l-i._tree.prelim-a+n(o,i),h>0&&(nu(ru(o,e,r),e,h),a+=h,f+=h),l+=o._tree.mod,a+=i._tree.mod,c+=u._tree.mod,f+=s._tree.mod;o&&!Ko(s)&&(s._tree.thread=o,s._tree.mod+=l-f),i&&!Jo(u)&&(u._tree.thread=i,u._tree.mod+=a-c,r=e)}return r}var o=t.call(this,e,s),u=o[0];eu(u,function(e,t){e._tree={ancestor:e,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),a(u),f(u,-u._tree.prelim);var c=Qo(u,Yo),h=Qo(u,Go),p=Qo(u,Zo),d=c.x-n(c,h)/2,v=h.x+n(h,c)/2,m=p.depth||1;return eu(u,i?function(e){e.x*=r[0],e.y=e.depth*r[1],delete e._tree}:function(e){e.x=(e.x-d)/(v-d)*r[0],e.y=e.depth/m*r[1],delete e._tree}),o}var t=e.layout.hierarchy().sort(null).value(null),n=$o,r=[1,1],i=!1;return s.separation=function(e){return arguments.length?(n=e,s):n},s.size=function(e){return arguments.length?(i=(r=e)==null,s):i?null:r},s.nodeSize=function(e){return arguments.length?(i=(r=e)!=null,s):i?r:null},Lo(s,t)},e.layout.pack=function(){function s(e,s){var o=t.call(this,e,s),u=o[0],a=r[0],f=r[1],l=i==null?Math.sqrt:typeof i=="function"?i:function(){return i};u.x=u.y=0,eu(u,function(e){e.r=+l(e.value)}),eu(u,au);if(n){var c=n*(i?1:Math.max(2*u.r/a,2*u.r/f))/2;eu(u,function(e){e.r+=c}),eu(u,au),eu(u,function(e){e.r-=c})}return cu(u,a/2,f/2,i?1:1/Math.max(2*u.r/a,2*u.r/f)),o}var t=e.layout.hierarchy().sort(iu),n=0,r=[1,1],i;return s.size=function(e){return arguments.length?(r=e,s):r},s.radius=function(e){return arguments.length?(i=e==null||typeof e=="function"?e:+e,s):i},s.padding=function(e){return arguments.length?(n=+e,s):n},Lo(s,t)},e.layout.cluster=function(){function s(e,s){var o=t.call(this,e,s),u=o[0],a,f=0;eu(u,function(e){var t=e.children;t&&t.length?(e.x=du(t),e.y=pu(t)):(e.x=a?f+=n(e,a):0,e.y=0,a=e)});var l=vu(u),c=mu(u),h=l.x-n(l,c)/2,p=c.x+n(c,l)/2;return eu(u,i?function(e){e.x=(e.x-u.x)*r[0],e.y=(u.y-e.y)*r[1]}:function(e){e.x=(e.x-h)/(p-h)*r[0],e.y=(1-(u.y?e.y/u.y:1))*r[1]}),o}var t=e.layout.hierarchy().sort(null).value(null),n=$o,r=[1,1],i=!1;return s.separation=function(e){return arguments.length?(n=e,s):n},s.size=function(e){return arguments.length?(i=(r=e)==null,s):i?null:r},s.nodeSize=function(e){return arguments.length?(i=(r=e)!=null,s):i?r:null},Lo(s,t)},e.layout.treemap=function(){function l(e,t){var n=-1,r=e.length,i,s;while(++n<r)s=(i=e[n]).value*(t<0?0:t),i.area=isNaN(s)||s<=0?0:s}function c(e){var t=e.children;if(t&&t.length){var n=s(e),r=[],i=t.slice(),o,u=Infinity,f,h=a==="slice"?n.dx:a==="dice"?n.dy:a==="slice-dice"?e.depth&1?n.dy:n.dx:Math.min(n.dx,n.dy),v;l(i,n.dx*n.dy/e.value),r.area=0;while((v=i.length)>0)r.push(o=i[v-1]),r.area+=o.area,a!=="squarify"||(f=p(r,h))<=u?(i.pop(),u=f):(r.area-=r.pop().area,d(r,h,n,!1),h=Math.min(n.dx,n.dy),r.length=r.area=0,u=Infinity);r.length&&(d(r,h,n,!0),r.length=r.area=0),t.forEach(c)}}function h(e){var t=e.children;if(t&&t.length){var n=s(e),r=t.slice(),i,o=[];l(r,n.dx*n.dy/e.value),o.area=0;while(i=r.pop())o.push(i),o.area+=i.area,i.z!=null&&(d(o,i.z?n.dx:n.dy,n,!r.length),o.length=o.area=0);t.forEach(h)}}function p(e,t){var n=e.area,r,i=0,s=Infinity,o=-1,u=e.length;while(++o<u){if(!(r=e[o].area))continue;r<s&&(s=r),r>i&&(i=r)}return n*=n,t*=t,n?Math.max(t*i*f/n,n/(t*s*f)):Infinity}function d(e,t,r,i){var s=-1,o=e.length,u=r.x,a=r.y,f=t?n(e.area/t):0,l;if(t==r.dx){if(i||f>r.dy)f=r.dy;while(++s<o)l=e[s],l.x=u,l.y=a,l.dy=f,u+=l.dx=Math.min(r.x+r.dx-u,f?n(l.area/f):0);l.z=!0,l.dx+=r.x+r.dx-u,r.y+=f,r.dy-=f}else{if(i||f>r.dx)f=r.dx;while(++s<o)l=e[s],l.x=u,l.y=a,l.dx=f,a+=l.dy=Math.min(r.y+r.dy-a,f?n(l.area/f):0);l.z=!1,l.dy+=r.y+r.dy-a,r.x+=f,r.dx-=f}}function v(e){var n=u||t(e),i=n[0];return i.x=0,i.y=0,i.dx=r[0],i.dy=r[1],u&&t.revalue(i),l([i],i.dx*i.dy/i.value),(u?h:c)(i),o&&(u=n),n}var t=e.layout.hierarchy(),n=Math.round,r=[1,1],i=null,s=gu,o=!1,u,a="squarify",f=.5*(1+Math.sqrt(5));return v.size=function(e){return arguments.length?(r=e,v):r},v.padding=function(e){function t(t){var n=e.call(v,t,t.depth);return n==null?gu(t):yu(t,typeof n=="number"?[n,n,n,n]:n)}function n(t){return yu(t,e)}if(!arguments.length)return i;var r;return s=(i=e)==null?gu:(r=typeof e)==="function"?t:r==="number"?(e=[e,e,e,e],n):n,v},v.round=function(e){return arguments.length?(n=e?Math.round:Number,v):n!=Number},v.sticky=function(e){return arguments.length?(o=e,u=null,v):o},v.ratio=function(e){return arguments.length?(f=e,v):f},v.mode=function(e){return arguments.length?(a=e+"",v):a},Lo(v,t)},e.random={normal:function(e,t){var n=arguments.length;return n<2&&(t=1),n<1&&(e=0),function(){var n,r,i;do n=Math.random()*2-1,r=Math.random()*2-1,i=n*n+r*r;while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var t=e.random.normal.apply(e,arguments);return function(){return Math.exp(t())}},bates:function(t){var n=e.random.irwinHall(t);return function(){return n()/t}},irwinHall:function(e){return function(){for(var t=0,n=0;n<e;n++)t+=Math.random();return t}}},e.scale={};var Tu={floor:gn,ceil:gn};e.scale.linear=function(){return Cu([0,1],[0,1],Rs,!1)};var _u={s:1,g:1,p:1,r:1,e:1};e.scale.log=function(){return Hu(e.scale.linear().domain([0,1]),10,!0,[1,10])};var Bu=e.format(".0e"),ju={floor:function(e){return-Math.ceil(-e)},ceil:function(e){return-Math.floor(-e)}};e.scale.pow=function(){return Fu(e.scale.linear(),1,[0,1])},e.scale.sqrt=function(){return e.scale.pow().exponent(.5)},e.scale.ordinal=function(){return qu([],{t:"range",a:[[]]})},e.scale.category10=function(){return e.scale.ordinal().range(Ru)},e.scale.category20=function(){return e.scale.ordinal().range(Uu)},e.scale.category20b=function(){return e.scale.ordinal().range(zu)},e.scale.category20c=function(){return e.scale.ordinal().range(Wu)};var Ru=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(sn),Uu=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(sn),zu=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(sn),Wu=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(sn);e.scale.quantile=function(){return Xu([],[])},e.scale.quantize=function(){return Vu(0,1,[0,1])},e.scale.threshold=function(){return $u([.5],[0,1])},e.scale.identity=function(){return Ju([0,1])},e.svg={},e.svg.arc=function(){function i(){var i=e.apply(this,arguments),s=t.apply(this,arguments),o=n.apply(this,arguments)+Ku,u=r.apply(this,arguments)+Ku,a=(u<o&&(a=o,o=u,u=a),u-o),f=a<mt?"0":"1",l=Math.cos(o),c=Math.sin(o),h=Math.cos(u),p=Math.sin(u);return a>=Qu?i?"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"M0,"+i+"A"+i+","+i+" 0 1,0 0,"+ -i+"A"+i+","+i+" 0 1,0 0,"+i+"Z":"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"Z":i?"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L"+i*h+","+i*p+"A"+i+","+i+" 0 "+f+",0 "+i*l+","+i*c+"Z":"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L0,0"+"Z"}var e=Gu,t=Yu,n=Zu,r=ea;return i.innerRadius=function(t){return arguments.length?(e=mn(t),i):e},i.outerRadius=function(e){return arguments.length?(t=mn(e),i):t},i.startAngle=function(e){return arguments.length?(n=mn(e),i):n},i.endAngle=function(e){return arguments.length?(r=mn(e),i):r},i.centroid=function(){var i=(e.apply(this,arguments)+t.apply(this,arguments))/2,s=(n.apply(this,arguments)+r.apply(this,arguments))/2+Ku;return[Math.cos(s)*i,Math.sin(s)*i]},i};var Ku=-yt,Qu=gt-bt;e.svg.line=function(){return ta(gn)};var na=e.map({linear:ra,"linear-closed":ia,step:sa,"step-before":oa,"step-after":ua,basis:pa,"basis-open":da,"basis-closed":va,bundle:ma,cardinal:la,"cardinal-open":aa,"cardinal-closed":fa,monotone:Na});na.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e)});var ya=[0,2/3,1/3,0],ba=[0,1/3,2/3,0],wa=[0,1/6,2/3,1/6];e.svg.line.radial=function(){var e=ta(Ca);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},oa.reverse=ua,ua.reverse=oa,e.svg.area=function(){return ka(gn)},e.svg.area.radial=function(){var e=ka(Ca);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},e.svg.chord=function(){function s(n,r){var i=o(this,e,n,r),s=o(this,t,n,r);return"M"+i.p0+a(i.r,i.p1,i.a1-i.a0)+(u(i,s)?f(i.r,i.p1,i.r,i.p0):f(i.r,i.p1,s.r,s.p0)+a(s.r,s.p1,s.a1-s.a0)+f(s.r,s.p1,i.r,i.p0))+"Z"}function o(e,t,s,o){var u=t.call(e,s,o),a=n.call(e,u,o),f=r.call(e,u,o)+Ku,l=i.call(e,u,o)+Ku;return{r:a,a0:f,a1:l,p0:[a*Math.cos(f),a*Math.sin(f)],p1:[a*Math.cos(l),a*Math.sin(l)]}}function u(e,t){return e.a0==t.a0&&e.a1==t.a1}function a(e,t,n){return"A"+e+","+e+" 0 "+ +(n>mt)+",1 "+t}function f(e,t,n,r){return"Q 0,0 "+r}var e=Ci,t=ki,n=La,r=Zu,i=ea;return s.radius=function(e){return arguments.length?(n=mn(e),s):n},s.source=function(t){return arguments.length?(e=mn(t),s):e},s.target=function(e){return arguments.length?(t=mn(e),s):t},s.startAngle=function(e){return arguments.length?(r=mn(e),s):r},s.endAngle=function(e){return arguments.length?(i=mn(e),s):i},s},e.svg.diagonal=function(){function r(r,i){var s=e.call(this,r,i),o=t.call(this,r,i),u=(s.y+o.y)/2,a=[s,{x:s.x,y:u},{x:o.x,y:u},o];return a=a.map(n),"M"+a[0]+"C"+a[1]+" "+a[2]+" "+a[3]}var e=Ci,t=ki,n=Aa;return r.source=function(t){return arguments.length?(e=mn(t),r):e},r.target=function(e){return arguments.length?(t=mn(e),r):t},r.projection=function(e){return arguments.length?(n=e,r):n},r},e.svg.diagonal.radial=function(){var t=e.svg.diagonal(),n=Aa,r=t.projection;return t.projection=function(e){return arguments.length?r(Oa(n=e)):n},t},e.svg.symbol=function(){function n(n,r){return(Pa.get(e.call(this,n,r))||Da)(t.call(this,n,r))}var e=_a,t=Ma;return n.type=function(t){return arguments.length?(e=mn(t),n):e},n.size=function(e){return arguments.length?(t=mn(e),n):t},n};var Pa=e.map({circle:Da,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+ -3*t+","+ -t+"H"+ -t+"V"+ -3*t+"H"+t+"V"+ -t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+ -t+"V"+t+"H"+ -3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Ba)),n=t*Ba;return"M0,"+ -t+"L"+n+",0"+" 0,"+t+" "+ -n+",0"+"Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+ -t+","+ -t+"L"+t+","+ -t+" "+t+","+t+" "+ -t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/Ha),n=t*Ha/2;return"M0,"+n+"L"+t+","+ -n+" "+ -t+","+ -n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/Ha),n=t*Ha/2;return"M0,"+ -n+"L"+t+","+n+" "+ -t+","+n+"Z"}});e.svg.symbolTypes=Pa.keys();var Ha=Math.sqrt(3),Ba=Math.tan(30*Et),Fa=[],Ia=0,qa,Ra;Fa.call=I.call,Fa.empty=I.empty,Fa.node=I.node,Fa.size=I.size,e.transition=function(e){return arguments.length?qa?e.transition():e:ot.transition()},e.transition.prototype=Fa,Fa.select=function(e){var t=this.id,n=[],r,i,s;e=q(e);for(var o=-1,u=this.length;++o<u;){n.push(r=[]);for(var a=this[o],f=-1,l=a.length;++f<l;)(s=a[f])&&(i=e.call(s,s.__data__,f,o))?("__data__"in s&&(i.__data__=s.__data__),Wa(i,f,t,s.__transition__[t]),r.push(i)):r.push(null)}return ja(n,t)},Fa.selectAll=function(e){var t=this.id,n=[],r,i,s,o,u;e=R(e);for(var a=-1,f=this.length;++a<f;)for(var l=this[a],c=-1,h=l.length;++c<h;)if(s=l[c]){u=s.__transition__[t],i=e.call(s,s.__data__,c,a),n.push(r=[]);for(var p=-1,d=i.length;++p<d;)(o=i[p])&&Wa(o,p,t,u),r.push(o)}return ja(n,t)},Fa.filter=function(e){var t=[],n,r,i;typeof e!="function"&&(e=Z(e));for(var s=0,o=this.length;s<o;s++){t.push(n=[]);for(var r=this[s],u=0,a=r.length;u<a;u++)(i=r[u])&&e.call(i,i.__data__,u,s)&&n.push(i)}return ja(t,this.id)},Fa.tween=function(e,t){var n=this.id;return arguments.length<2?this.node().__transition__[n].tween.get(e):tt(this,t==null?function(t){t.__transition__[n].tween.remove(e)}:function(r){r.__transition__[n].tween.set(e,t)})},Fa.attr=function(t,n){function s(){this.removeAttribute(i)}function o(){this.removeAttributeNS(i.space,i.local)}function u(e){return e==null?s:(e+="",function(){var t=this.getAttribute(i),n;return t!==e&&(n=r(t,e),function(e){this.setAttribute(i,n(e))})})}function a(e){return e==null?o:(e+="",function(){var t=this.getAttributeNS(i.space,i.local),n;return t!==e&&(n=r(t,e),function(e){this.setAttributeNS(i.space,i.local,n(e))})})}if(arguments.length<2){for(n in t)this.attr(n,t[n]);return this}var r=t=="transform"?vo:Rs,i=e.ns.qualify(t);return Ua(this,"attr."+t,n,i.local?a:u)},Fa.attrTween=function(t,n){function i(e,t){var i=n.call(this,e,t,this.getAttribute(r));return i&&function(e){this.setAttribute(r,i(e))}}function s(e,t){var i=n.call(this,e,t,this.getAttributeNS(r.space,r.local));return i&&function(e){this.setAttributeNS(r.space,r.local,i(e))}}var r=e.ns.qualify(t);return this.tween("attr."+t,r.local?s:i)},Fa.style=function(e,t,n){function i(){this.style.removeProperty(e)}function o(t){return t==null?i:(t+="",function(){var r=s.getComputedStyle(this,null).getPropertyValue(e),i;return r!==t&&(i=Rs(r,t),function(t){this.style.setProperty(e,i(t),n)})})}var r=arguments.length;if(r<3){if(typeof e!="string"){r<2&&(t="");for(n in e)this.style(n,e[n],t);return this}n=""}return Ua(this,"style."+e,t,o)},Fa.styleTween=function(e,t,n){function r(r,i){var o=t.call(this,r,i,s.getComputedStyle(this,null).getPropertyValue(e));return o&&function(t){this.style.setProperty(e,o(t),n)}}return arguments.length<3&&(n=""),this.tween("style."+e,r)},Fa.text=function(e){return Ua(this,"text",e,za)},Fa.remove=function(){return this.each("end.transition",function(){var e;this.__transition__.count<2&&(e=this.parentNode)&&e.removeChild(this)})},Fa.ease=function(t){var n=this.id;return arguments.length<1?this.node().__transition__[n].ease:(typeof t!="function"&&(t=e.ease.apply(e,arguments)),tt(this,function(e){e.__transition__[n].ease=t}))},Fa.delay=function(e){var t=this.id;return tt(this,typeof e=="function"?function(n,r,i){n.__transition__[t].delay=+e.call(n,n.__data__,r,i)}:(e=+e,function(n){n.__transition__[t].delay=e}))},Fa.duration=function(e){var t=this.id;return tt(this,typeof e=="function"?function(n,r,i){n.__transition__[t].duration=Math.max(1,e.call(n,n.__data__,r,i))}:(e=Math.max(1,e),function(n){n.__transition__[t].duration=e}))},Fa.each=function(t,n){var r=this.id;if(arguments.length<2){var i=Ra,s=qa;qa=r,tt(this,function(e,n,i){Ra=e.__transition__[r],t.call(e,e.__data__,n,i)}),Ra=i,qa=s}else tt(this,function(i){var s=i.__transition__[r];(s.event||(s.event=e.dispatch("start","end"))).on(t,n)});return this},Fa.transition=function(){var e=this.id,t=++Ia,n=[],r,i,s,o;for(var u=0,a=this.length;u<a;u++){n.push(r=[]);for(var i=this[u],f=0,l=i.length;f<l;f++){if(s=i[f])o=Object.create(s.__transition__[e]),o.delay+=o.duration,Wa(s,f,t,o);r.push(s)}}return ja(n,t)},e.svg.axis=function(){function f(f){f.each(function(){var f=e.select(this),l=this.__chart__||t,c=this.__chart__=t.copy(),h=u==null?c.ticks?c.ticks.apply(c,o):c.domain():u,p=a==null?c.tickFormat?c.tickFormat.apply(c,o):gn:a,d=f.selectAll(".tick").data(h,c),v=d.enter().insert("g",".domain").attr("class","tick").style("opacity",bt),m=e.transition(d.exit()).style("opacity",bt).remove(),g=e.transition(d).style("opacity",1),y,b=wu(c),w=f.selectAll(".domain").data([0]),E=(w.enter().append("path").attr("class","domain"),e.transition(w));v.append("line"),v.append("text");var S=v.select("line"),x=g.select("line"),T=d.select("text").text(p),N=v.select("text"),C=g.select("text");switch(n){case"bottom":y=$a,S.attr("y2",r),N.attr("y",Math.max(r,0)+s),x.attr("x2",0).attr("y2",r),C.attr("x",0).attr("y",Math.max(r,0)+s),T.attr("dy",".71em").style("text-anchor","middle"),E.attr("d","M"+b[0]+","+i+"V0H"+b[1]+"V"+i);break;case"top":y=$a,S.attr("y2",-r),N.attr("y",-(Math.max(r,0)+s)),x.attr("x2",0).attr("y2",-r),C.attr("x",0).attr("y",-(Math.max(r,0)+s)),T.attr("dy","0em").style("text-anchor","middle"),E.attr("d","M"+b[0]+","+ -i+"V0H"+b[1]+"V"+ -i);break;case"left":y=Ja,S.attr("x2",-r),N.attr("x",-(Math.max(r,0)+s)),x.attr("x2",-r).attr("y2",0),C.attr("x",-(Math.max(r,0)+s)).attr("y",0),T.attr("dy",".32em").style("text-anchor","end"),E.attr("d","M"+ -i+","+b[0]+"H0V"+b[1]+"H"+ -i);break;case"right":y=Ja,S.attr("x2",r),N.attr("x",Math.max(r,0)+s),x.attr("x2",r).attr("y2",0),C.attr("x",Math.max(r,0)+s).attr("y",0),T.attr("dy",".32em").style("text-anchor","start"),E.attr("d","M"+i+","+b[0]+"H0V"+b[1]+"H"+i)}if(c.rangeBand){var k=c,L=k.rangeBand()/2;l=c=function(e){return k(e)+L}}else l.rangeBand?l=c:m.call(y,c);v.call(y,l),g.call(y,c)})}var t=e.scale.linear(),n=Xa,r=6,i=6,s=3,o=[10],u=null,a;return f.scale=function(e){return arguments.length?(t=e,f):t},f.orient=function(e){return arguments.length?(n=e in Va?e+"":Xa,f):n},f.ticks=function(){return arguments.length?(o=arguments,f):o},f.tickValues=function(e){return arguments.length?(u=e,f):u},f.tickFormat=function(e){return arguments.length?(a=e,f):a},f.tickSize=function(e){var t=arguments.length;return t?(r=+e,i=+arguments[t-1],f):r},f.innerTickSize=function(e){return arguments.length?(r=+e,f):r},f.outerTickSize=function(e){return arguments.length?(i=+e,f):i},f.tickPadding=function(e){return arguments.length?(s=+e,f):s},f.tickSubdivide=function(){return arguments.length&&f},f};var Xa="bottom",Va={top:1,right:1,bottom:1,left:1};e.svg.brush=function(){function h(t){t.each(function(){var t=e.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",m).on("touchstart.brush",m),i=t.selectAll(".background").data([0]);i.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),t.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=t.selectAll(".resize").data(c,gn);s.exit().remove(),s.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return Ka[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",h.empty()?"none":null);var o=e.transition(t),u=e.transition(i),a;n&&(a=wu(n),u.attr("x",a[0]).attr("width",a[1]-a[0]),d(o)),r&&(a=wu(r),u.attr("y",a[0]).attr("height",a[1]-a[0]),v(o)),p(o)})}function p(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+i[+/e$/.test(e)]+","+o[+/^s/.test(e)]+")"})}function d(e){e.select(".extent").attr("x",i[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",i[1]-i[0])}function v(e){e.select(".extent").attr("y",o[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",o[1]-o[0])}function m(){function M(){e.event.keyCode==32&&(S||(T=null,N[0]-=i[1],N[1]-=o[1],S=2),A())}function _(){e.event.keyCode==32&&S==2&&(N[0]+=i[1],N[1]+=o[1],S=0,A())}function D(){var t=e.mouse(c),s=!1;C&&(t[0]+=C[0],t[1]+=C[1]),S||(e.event.altKey?(T||(T=[(i[0]+i[1])/2,(o[0]+o[1])/2]),N[0]=i[+(t[0]<T[0])],N[1]=o[+(t[1]<T[1])]):T=null),w&&P(t,n,0)&&(d(y),s=!0),E&&P(t,r,1)&&(v(y),s=!0),s&&(p(y),g({type:"brush",mode:S?"move":"resize"}))}function P(e,t,n){var r=wu(t),s=r[0],c=r[1],h=N[n],p=n?o:i,d=p[1]-p[0],v,m;S&&(s-=h,c-=d+h),v=(n?l:f)?Math.max(s,Math.min(c,e[n])):e[n],S?m=(v+=h)+d:(T&&(h=Math.max(s,Math.min(c,2*T[n]-v))),h<v?(m=v,v=h):m=h);if(p[0]!=v||p[1]!=m)return n?a=null:u=null,p[0]=v,p[1]=m,!0}function H(){D(),y.style("pointer-events","all").selectAll(".resize").style("display",h.empty()?"none":null),e.select("body").style("cursor",null),k.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),x(),g({type:"brushend"})}var c=this,m=e.select(e.event.target),g=t.of(c,arguments),y=e.select(c),b=m.datum(),w=!/^(n|s)$/.test(b)&&n,E=!/^(e|w)$/.test(b)&&r,S=m.classed("extent"),x=pt(),T,N=e.mouse(c),C,k=e.select(s).on("keydown.brush",M).on("keyup.brush",_);e.event.changedTouches?k.on("touchmove.brush",D).on("touchend.brush",H):k.on("mousemove.brush",D).on("mouseup.brush",H),y.interrupt().selectAll("*").interrupt();if(S)N[0]=i[0]-N[0],N[1]=o[0]-N[1];else if(b){var L=+/w$/.test(b),O=+/^n/.test(b);C=[i[1-L]-N[0],o[1-O]-N[1]],N[0]=i[L],N[1]=o[O]}else e.event.altKey&&(T=N.slice());y.style("pointer-events","none").selectAll(".resize").style("display",null),e.select("body").style("cursor",m.style("cursor")),g({type:"brushstart"}),D()}var t=M(h,"brushstart","brush","brushend"),n=null,r=null,i=[0,0],o=[0,0],u,a,f=!0,l=!0,c=Qa[0];return h.event=function(n){n.each(function(){var n=t.of(this,arguments),r={x:i,y:o,i:u,j:a},s=this.__chart__||r;this.__chart__=r,qa?e.select(this).transition().each("start.brush",function(){u=s.i,a=s.j,i=s.x,o=s.y,n({type:"brushstart"})}).tween("brush:brush",function(){var e=Us(i,r.x),t=Us(o,r.y);return u=a=null,function(s){i=r.x=e(s),o=r.y=t(s),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){u=r.i,a=r.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},h.x=function(e){return arguments.length?(n=e,c=Qa[!n<<1|!r],h):n},h.y=function(e){return arguments.length?(r=e,c=Qa[!n<<1|!r],h):r},h.clamp=function(e){return arguments.length?(n&&r?(f=!!e[0],l=!!e[1]):n?f=!!e:r&&(l=!!e),h):n&&r?[f,l]:n?f:r?l:null},h.extent=function(e){var t,s,f,l,c;if(!arguments.length)return n&&(u?(t=u[0],s=u[1]):(t=i[0],s=i[1],n.invert&&(t=n.invert(t),s=n.invert(s)),s<t&&(c=t,t=s,s=c))),r&&(a?(f=a[0],l=a[1]):(f=o[0],l=o[1],r.invert&&(f=r.invert(f),l=r.invert(l)),l<f&&(c=f,f=l,l=c))),n&&r?[[t,f],[s,l]]:n?[t,s]:r&&[f,l];if(n){t=e[0],s=e[1],r&&(t=t[0],s=s[0]),u=[t,s],n.invert&&(t=n(t),s=n(s)),s<t&&(c=t,t=s,s=c);if(t!=i[0]||s!=i[1])i=[t,s]}if(r){f=e[0],l=e[1],n&&(f=f[1],l=l[1]),a=[f,l],r.invert&&(f=r(f),l=r(l)),l<f&&(c=f,f=l,l=c);if(f!=o[0]||l!=o[1])o=[f,l]}return h},h.clear=function(){return h.empty()||(i=[0,0],o=[0,0],u=a=null),h},h.empty=function(){return!!n&&i[0]==i[1]||!!r&&o[0]==o[1]},e.rebind(h,t,"on")};var Ka={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Qa=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Ga=e.time={},Ya=Date,Za=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];ef.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){tf.setUTCDate.apply(this._,arguments)},setDay:function(){tf.setUTCDay.apply(this._,arguments)},setFullYear:function(){tf.setUTCFullYear.apply(this._,arguments)},setHours:function(){tf.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){tf.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){tf.setUTCMinutes.apply(this._,arguments)},setMonth:function(){tf.setUTCMonth.apply(this._,arguments)},setSeconds:function(){tf.setUTCSeconds.apply(this._,arguments)},setTime:function(){tf.setTime.apply(this._,arguments)}};var tf=Date.prototype,nf="%a %b %e %X %Y",rf="%m/%d/%Y",sf="%H:%M:%S",of=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],uf=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],af=["January","February","March","April","May","June","July","August","September","October","November","December"],ff=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];Ga.year=lf(function(e){return e=Ga.day(e),e.setMonth(0,1),e},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),Ga.years=Ga.year.range,Ga.years.utc=Ga.year.utc.range,Ga.day=lf(function(e){var t=new Ya(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),Ga.days=Ga.day.range,Ga.days.utc=Ga.day.utc.range,Ga.dayOfYear=function(e){var t=Ga.year(e);return Math.floor((e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/864e5)},Za.forEach(function(e,t){e=e.toLowerCase(),t=7-t;var n=Ga[e]=lf(function(e){return(e=Ga.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+Math.floor(t)*7)},function(e){var n=Ga.year(e).getDay();return Math.floor((Ga.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});Ga[e+"s"]=n.range,Ga[e+"s"].utc=n.utc.range,Ga[e+"OfYear"]=function(e){var n=Ga.year(e).getDay();return Math.floor((Ga.dayOfYear(e)+(n+t)%7)/7)}}),Ga.week=Ga.sunday,Ga.weeks=Ga.sunday.range,Ga.weeks.utc=Ga.sunday.utc.range,Ga.weekOfYear=Ga.sundayOfYear,Ga.format=hf;var gf=df(of),yf=vf(of),bf=df(uf),wf=vf(uf),Ef=df(af),Sf=vf(af),xf=df(ff),Tf=vf(ff),Nf=/^%/,Cf={"-":"",_:" ",0:"0"},kf={a:function(e){return uf[e.getDay()]},A:function(e){return of[e.getDay()]},b:function(e){return ff[e.getMonth()]},B:function(e){return af[e.getMonth()]},c:hf(nf),d:function(e,t){return mf(e.getDate(),t,2)},e:function(e,t){return mf(e.getDate(),t,2)},H:function(e,t){return mf(e.getHours(),t,2)},I:function(e,t){return mf(e.getHours()%12||12,t,2)},j:function(e,t){return mf(1+Ga.dayOfYear(e),t,3)},L:function(e,t){return mf(e.getMilliseconds(),t,3)},m:function(e,t){return mf(e.getMonth()+1,t,2)},M:function(e,t){return mf(e.getMinutes(),t,2)},p:function(e){return e.getHours()>=12?"PM":"AM"},S:function(e,t){return mf(e.getSeconds(),t,2)},U:function(e,t){return mf(Ga.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return mf(Ga.mondayOfYear(e),t,2)},x:hf(rf),X:hf(sf),y:function(e,t){return mf(e.getFullYear()%100,t,2)},Y:function(e,t){return mf(e.getFullYear()%1e4,t,4)},Z:Zf,"%":function(){return"%"}},Lf={a:Af,A:Of,b:Pf,B:Hf,c:Bf,d:Wf,e:Wf,H:Vf,I:Vf,j:Xf,L:Kf,m:zf,M:$f,p:Gf,S:Jf,U:_f,w:Mf,W:Df,x:jf,X:Ff,y:qf,Y:If,Z:Rf,"%":el},Qf=/^\s*\d+/,Yf=e.map({am:0,pm:1});hf.utc=tl;var nl=tl("%Y-%m-%dT%H:%M:%S.%LZ");hf.iso=Date.prototype.toISOString&&+(new Date("2000-01-01T00:00:00.000Z"))?rl:nl,rl.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},rl.toString=nl.toString,Ga.second=lf(function(e){return new Ya(Math.floor(e/1e3)*1e3)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*1e3)},function(e){return e.getSeconds()}),Ga.seconds=Ga.second.range,Ga.seconds.utc=Ga.second.utc.range,Ga.minute=lf(function(e){return new Ya(Math.floor(e/6e4)*6e4)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*6e4)},function(e){return e.getMinutes()}),Ga.minutes=Ga.minute.range,Ga.minutes.utc=Ga.minute.utc.range,Ga.hour=lf(function(e){var t=e.getTimezoneOffset()/60;return new Ya((Math.floor(e/36e5-t)+t)*36e5)},function(e,t){e.setTime(e.getTime()+Math.floor(t)*36e5)},function(e){return e.getHours()}),Ga.hours=Ga.hour.range,Ga.hours.utc=Ga.hour.utc.range,Ga.month=lf(function(e){return e=Ga.day(e),e.setDate(1),e},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),Ga.months=Ga.month.range,Ga.months.utc=Ga.month.utc.range;var ul=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],al=[[Ga.second,1],[Ga.second,5],[Ga.second,15],[Ga.second,30],[Ga.minute,1],[Ga.minute,5],[Ga.minute,15],[Ga.minute,30],[Ga.hour,1],[Ga.hour,3],[Ga.hour,6],[Ga.hour,12],[Ga.day,1],[Ga.day,2],[Ga.week,1],[Ga.month,1],[Ga.month,3],[Ga.year,1]],fl=[[hf("%Y"),Nr],[hf("%B"),function(e){return e.getMonth()}],[hf("%b %d"),function(e){return e.getDate()!=1}],[hf("%a %d"),function(e){return e.getDay()&&e.getDate()!=1}],[hf("%I %p"),function(e){return e.getHours()}],[hf("%I:%M"),function(e){return e.getMinutes()}],[hf(":%S"),function(e){return e.getSeconds()}],[hf(".%L"),function(e){return e.getMilliseconds()}]],ll=ol(fl);al.year=Ga.year,Ga.scale=function(){return il(e.scale.linear(),al,ll)};var cl={range:function(t,n,r){return e.range(+t,+n,r).map(sl)},floor:gn,ceil:gn},hl=al.map(function(e){return[e[0].utc,e[1]]}),pl=[[tl("%Y"),Nr],[tl("%B"),function(e){return e.getUTCMonth()}],[tl("%b %d"),function(e){return e.getUTCDate()!=1}],[tl("%a %d"),function(e){return e.getUTCDay()&&e.getUTCDate()!=1}],[tl("%I %p"),function(e){return e.getUTCHours()}],[tl("%I:%M"),function(e){return e.getUTCMinutes()}],[tl(":%S"),function(e){return e.getUTCSeconds()}],[tl(".%L"),function(e){return e.getUTCMilliseconds()}]],dl=ol(pl);return hl.year=Ga.year.utc,Ga.scale.utc=function(){return il(e.scale.linear(),hl,dl)},e.text=yn(function(e){return e.responseText}),e.json=function(e,t){return bn(e,"application/json",vl,t)},e.html=function(e,t){return bn(e,"text/html",ml,t)},e.xml=yn(function(e){return e.responseXML}),e}(),define("d3",function(e){return function(){var t,n;return t||e.d3}}(this)),define("REM/recline-extensions/data/data.formatters",["REM/recline-extensions/recline-amd","accounting","d3"],function(e,t,n){e.Data=e.Data||{},e.Data.Format=e.Format||{},e.Data.Formatters=e.Formatters||{};var r=e.Data;return r.FormattersMoviri={integer:function(e){return isFinite(e)?parseInt(e,10):0},string:function(e){return e?e.toString():null},date:function(e){return(new Date(parseInt(e))).valueOf()},"float":function(e){return isFinite(e)?parseFloat(e,10):0},number:function(e){return isFinite(e)?parseFloat(e,10):0}},r.Formatters.scale=function(e){var t=function(e,t){return[0,e*t]};return function(r,i,s){var o={},u;o.axisScale={};var a=t(s,i);if(e.type==="linear"){var f=n.max(r,function(t){var n=0;return u=0,_.each(e.domain,function(e){n=t.getFieldValue({id:e})>n?t.getFieldValue({id:e}):n,u++}),n*u});_.each(e.domain,function(t,r){var i,s=[a[0],a[1]/u];r%2==1&&e.invertEven?i=[f/u,0]:i=[0,f/u],o.axisScale[t]=n.scale.linear().domain(i).range(s)}),o.scale=n.scale.linear().domain([0,f]).range(a)}return o}},r.Formatters.Renderers=function(e,t,n){var i=r.Formatters.RenderersImpl[t.attributes.type];if(i==null)throw"No custom renderers defined for field type "+t.attributes.type;return i(e,t,n)},r.Formatters.RenderersConvert_ALL_=function(e,t,n){var i=function(e,t,n){var r=t.get("format");if(r==="markdown"){if(typeof Showdown!="undefined"){var i=new Showdown.converter;return out=i.makeHtml(e),out}return e}return r=="plain"?e?e.replace(/\b_ALL_\b/g,"All"):e:(e&&typeof e=="string"&&(e=e.replace(/(https?:\/\/[^ ]+)/g,'<a href="$1">$1</a>').replace(/\b_ALL_\b/g,"All")),e)},s=r.Formatters.RenderersImpl[t.attributes.type];if(s==null)throw"No custom renderers defined for field type "+t.attributes.type;return t.attributes.type=="string"&&(s=i),s(e,t,n)},r.Formatters.RenderersImpl={object:function(e,t,n){return JSON.stringify(e)},integer:function(e,n,r){var i=n.get("format");return i==="currency_euro"?t.formatMoney(e,{symbol:"",format:"%v %s",decimal:".",thousand:",",precision:0}):t.formatNumber(e,0,",")},date:function(e,t,n){var r=t.get("format");return r==null||r=="date"?e:r==="localeTimeString"?(new Date(e)).toLocaleString():r==="timeString"?(new Date(e)).toUTCString():(new Date(e)).toUTCString()},geo_point:function(e,t,n){return JSON.stringify(e)},number:function(e,n,r){var i=n.get("format");if(i==="percentage")try{return t.formatNumber(e,2,",",".")+'<small class="muted">%</small>'}catch(s){return"-"}else if(i==="percentage_0to1")try{return t.formatNumber(e*100,2,",",".")+'<small class="muted">%</small>'}catch(s){return"-"}else if(i==="currency_euro")try{return t.formatMoney(e,{symbol:"",format:"%v %s",decimal:".",thousand:",",precision:0})+'<small class="muted"></small>'}catch(s){return"-"}else if(i==="currency_euro_decimal")try{return t.formatMoney(e,{symbol:"",format:"%v %s",decimal:".",thousand:",",precision:2})+'<small class="muted"></small>'}catch(s){return"-"}else{if(i==="time"){var o=parseInt(e),u=Math.floor(o/3600),a=Math.floor((o-u*3600)/60),f=o-u*3600-a*60;u<10&&(u="0"+u),a<10&&(a="0"+a),f<10&&(f="0"+f);var l=u+":"+a+":"+f;return l}if(i==="integer")try{return t.formatNumber(e,0,",",".")}catch(s){return"-"}}try{return t.formatNumber(e,2,",",".")}catch(s){return"-"}},string:function(e,t,n){var r=t.get("format");if(r==="markdown"){if(typeof Showdown!="undefined"){var i=new Showdown.converter;return out=i.makeHtml(e),out}return e}if(r=="plain")return e;if(r==="time"){var s=parseInt(e),o=Math.floor(s/3600),u=Math.floor((s-o*3600)/60),a=s-o*3600-u*60;o<10&&(o="0"+o),u<10&&(u="0"+u),a<10&&(a="0"+a);var f=o+":"+u+":"+a;return f}return e&&typeof e=="string"&&(e=e.replace(/(https?:\/\/[^ ]+)/g,'<a href="$1">$1</a>')),e}},r.Formatters.getFieldLabel=function(e,t){var n=e.attributes.label;e.attributes.is_partitioned&&(n=e.attributes.partitionValue);if(t){var r=_.find(t,function(e){return e.id==n});typeof r!="undefined"&&r!=null&&(n=r.label)}return n},r}),define("REM/recline-extensions/data/data.series.utility",["jquery","REM/recline-extensions/recline-amd"],function(e,t){t.Data=t.Data||{},t.Data.SeriesUtility=t.Data.SeriesUtility||{};var n=t.Data.SeriesUtility;return n.createSeries=function(e,n,r,i,s,o,u){var a=[],f=e.fillEmptyValuesWith,l=e.requiredXValues,c="#C0C0C0";n&&(c=n);var h=!1;r.queryState.isSelected()&&(h=!0);var p="filtered";i&&(p=i);var d=r.getRecords(p),v=r.fields.get(s);if(!v)throw"data.series.utility.CreateSeries: unable to find field ["+s+"] in model ["+r.id+"]";var m=[];l&&(m=l);var g;if(e.sizeField){g=r.fields.get(e.sizeField);if(!g)throw"data.series.utility.CreateSeries: unable to find field ["+e.sizeField+"] on model"}if(e.type=="byFieldValue"){var y={},b=r.fields.get(e.seriesField),w=r.fields.get(e.valuesField);if(!w)throw"data.series.utility.CreateSeries: unable to find field ["+e.valuesField+"] in model ["+r.id+"]";if(!b)throw"data.series.utility.CreateSeries: unable to find field ["+e.seriesField+"] in model ["+r.id+"]";_.each(d,function(e,t){var n=e.getFieldValueUnrendered(b),r=e.getFieldValue(b),i;if(y[n]!=null)i=y[n];else{i={key:n,label:r,values:[],field:w};var s=e.getFieldColor(b);s!=null&&(i.color=s)}var o=e.getFieldShapeName(b),u=e.getFieldValueUnrendered(v),a=e.getFieldValue(v),l=e.getFieldValueUnrendered(w),c=e.getFieldValue(w);if(l==null||typeof l=="undefined"&&f!=null)l=f,c=l;if(l!=null&&typeof l!="undefined"&&!isNaN(l)){var h={x:u,y:l,record:e,y_formatted:c,x_formatted:a,legendField:b.attributes.label||b.attributes.id,legendValue:r};g&&(h.size=e.getFieldValueUnrendered(g)),o!=null&&(h.shape=o),i.values.push(h),f!=null&&m.push(u),y[n]=i}});for(var E in y)a.push(y[E])}else{if(e.type!="byFieldName"&&e.type!="byPartitionedField")throw"data.series.utility.CreateSeries: unsupported or not defined type "+e.type;var S;e.type=="byFieldName"?S=e.valuesField:(S=[],_.each(e.aggregationFunctions,function(t){_.each(r.getPartitionedFieldsForAggregationFunction(t,e.aggregatedField),function(e){S.push(e.get("id"))})})),_.each(S,function(e){var n;n=r.fields.get(e);if(!n)throw"data.series.utility.CreateSeries: unable to find field ["+e+"] on model";var i;e.fieldColor&&(i=e.fieldColor);var s=[];_.each(d,function(t,r){var i=t.getFieldValueUnrendered(v),o=t.getFieldValue(v);try{var u=t.getFieldValueUnrendered(n),a=t.getFieldValue(n);if(u==null||typeof u=="undefined"&&f!=null)u=f;if(u!=null&&!isNaN(u)){var l,p=t.getFieldColor(n);p||(p=t.getFieldColor(v)),h?t.isRecordSelected()?l=p:l=c:l=p;var d=t.getFieldShapeName(n),y={x:i,y:u,record:t,y_formatted:a,x_formatted:o};l!=null&&(y.color=l),d!=null&&(y.shape=d),g&&(y.size=t.getFieldValueUnrendered(g)),s.push(y),f!=null&&m.push(i)}}catch(b){console.log("Can't add field ["+e+"] to graph, filtered?")}});if(s.length>0){var o;i?o=i:o=n.getColorForPartition();var u={values:s,key:t.Data.Formatters.getFieldLabel(n,r.attributes.fieldLabels)};o&&(u.color=o),a.push(u)}})}f!=null&&(m=_.unique(m),_.each(a,function(e){var t={};e.values&&e.values.length&&(t=e.values[0]);var n=_.unique(_.map(e.values,function(e){return e.x}));_.each(_.difference(m,n),function(n){e.values.push({x:n,y:f,legendField:t.legendField,legendValue:t.legendValue})})}));if(a.length>1){var x=[];_.each(a[0].values,function(e,t){x[e.x]=t+1}),_.each(a,function(e,t){t>0&&(e.values=_.sortBy(e.values,function(e){return x[e.x]||1e9}))})}if(u){var T=u.mainSeriesCount,N=u.labelForSmallSeries||"Other",C=[];_.each(a,function(e){C.push({id:C.length,key:e.key,total:_.reduce(e.values,function(e,t){return e+t.y},0)})}),C=_.sortBy(C,function(e){return-e.total});var k=[],E=0;for(E=0;E<T&&E<C.length;E++)k.push(a[C[E].id]);if(E<a.length){var L={key:N,values:[]};_.each(a[C[E].id].values,function(e){L.values.push({x:e.x,y:e.y})});var A=a[0].values.length;for(var O=E+1;O<a.length;O++)for(var M=0;M<A;M++)L.values[M].y+=a[C[O].id].values[M].y;k.push(L)}a=k}if(o&&a.length){var D=a[0].values.length,P=[];for(var M=0;M<D;M++)P.push(_.reduce(a,function(e,t){return e+t.values[M].y},0));for(var M=0;M<D;M++)_.each(a,function(e){P[M]&&(e.values[M].y_orig=e.values[M].y,e.values[M].y=Math.round(e.values[M].y_orig/P[M]*1e4)/100)})}return a},n.createSerieAnnotations=function(e,t,n,r,i,s){var o=[];if(e&&t&&n&&e.records.length){var u=e.fields.get(t);if(typeof u=="undefined"||u==null)throw"data.series.utility.CreateSerieAnnotations: field "+t+" not found in model";var a=e.fields.get(n);if(typeof a=="undefined"||a==null)throw"data.series.utility.CreateSerieAnnotations: field "+n+" not found in model";_.each(e.getRecords(),function(t){var n=[],f=t.getFieldValueUnrendered(u).valueOf();_.each(r,function(e,t){var r=_.find(e.data,function(e){return e.x==f});if(r)n.push(r);else for(var i=1;i<e.data.length;i++)if(e.data[i-1].x<f&&e.data[i].x>f){var s=d3.scale.linear().domain([e.data[i-1].x,e.data[i].x]).range([e.data[i-1].y,e.data[i].y]);n.push({y:s(f),serie:t});break}});var l=_.max(n,function(e){return e.y});if(l){var c=_.find(o,function(e){return e.x==f});if(c)c.text+="<br>"+t.getFieldValue(a);else{var h=o.length,p=String.fromCharCode(h%27+65);h>26&&(p+=Math.floor(h/27));var d=-1;s||(d=l.serie||0);var v=l.y||0;if(i){var m=e.fields.get(i),g=t.getFieldValueUnrendered(m);for(var y=0;y<r.length;y++)if(r[y].name==g){d=y;break}}if(s&&d==-1&&r.length==1&&r[0].name=="_ALL_")d=0,o.push({x:f,text:t.getFieldValue(a),letter:p,y:v,serie:d});else if(d>=0){var b=!1;_.find(n,function(e){e.legendValue==r[d].label&&(v=e.y,b=!0)}),(s&&b||!s)&&o.push({x:f,text:t.getFieldValue(a),letter:p,y:v,serie:d})}}}}),_.each(r,function(e,t){e.annotations=_.filter(o,function(e){return e.serie==t})})}},n}),define("REM/recline-extensions/data/data.shapes",["jquery","REM/recline-extensions/recline-amd"],function(e,t){t.Data=t.Data||{},t.Data.ShapeSchema=t.Data.ShapeSchema||{};var n=t.Data;return n.ShapeSchema=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){var e=this;if(this.attributes.data){var t=this.attributes.data;e._generateLimits(t)}else this.attributes.dataset&&this.bindToDataset()},bindToDataset:function(){var e=this;e.attributes.dataset.dataset.records.bind("reset",function(){e._generateFromDataset()}),e.attributes.dataset.dataset.fields.bind("reset",function(){e.attributes.dataset.dataset.setShapeSchema(e.attributes.dataset.type)}),e.attributes.dataset.dataset.records.models.length>0&&e._generateFromDataset()},setDataset:function(e,t,n){var r=this;r.attributes.dataset={dataset:e,field:t,type:n},e.attributes.shapeSchema||(e.attributes.shapeSchema=[]),e.attributes.shapeSchema.push({schema:r,field:t}),e.setShapeSchema(n),r.bindToDataset()},_generateFromDataset:function(){var e=this,t=this.getRecordsArray(e.attributes.dataset);e._generateLimits(t)},_generateLimits:function(e){var t=this;t.schema={},_.each(t.attributes.limits,function(e,n){t.schema[e]=t.attributes.shapes[n]})},getShapeNameFor:function(e){var t=this;if(this.schema==null)throw"data.shape.js: shape schema not yet initialized, datasource not fetched?";return t._shapeName(e)},getShapeFor:function(e,n,r,i){var s=this;if(this.schema==null)throw"data.shape.js: shape schema not yet initialized, datasource not fetched?";if(!s.attributes.shapeType||s.attributes.shapeType=="svg"){var o=t.Template.Shapes[this._shapeName(e)];if(o==null)throw"data.shape.js: shape ["+this._shapeName(e)+"] not defined in template.shapes";return o(n,i,r)}if(s.attributes.shapeType=="text")return this._shapeName(this._shapeName(e));if(s.attributes.shapeType=="image")return'<img src="'+this._shapeName(e)+'" class="shape_image">';throw"data.shape.js: unsupported shapeType ["+s.attributes.shapeType+"]"},_shapeName:function(e){var t=this;if(t.attributes.limitType&&this.attributes.limitType=="fixedLimits"){var n=t.attributes.shapes[0];for(var r=1;r<this.attributes.limits.length;r++)if(e>=this.attributes.limits[r-1]&&e<this.attributes.limits[r]){n=t.attributes.shapes[r];break}return n}return t.schema[e]},getRecordsArray:function(e){var t=this,n=[];if(e.recordCount)if(e.dataset.isFieldPartitioned&&e.dataset.isFieldPartitioned(e.field,e.type)){var r=e.dataset.getPartitionedFields(e.field);_.each(e.dataset.getRecords(e.type),function(e){_.each(r,function(t){n.push(e.attributes[t.id])})})}else{var r=[e.field];_.each(e.dataset.getRecords(e.type),function(e){_.each(r,function(t){n.push(e.attributes[t])})})}return n},limits:{distinct:function(e){var n={};return _.each(_.uniq(e),function(e,r){n[e]=t.Data.Transform.getFieldHash(e)}),e}}}),n.ShapeSchema.addShapesToTerms=function(e,t,n){_.each(t,function(t){n&&_.each(n,function(n){n.field===e&&(t.shape=n.schema.getShapeFor(t.term,t.color,!1,!1))})})},n.ShapeSchema}),define("REM/recline-extensions/data/template.shapes",["jquery","REM/recline-extensions/recline-amd","mustache"],function(e,t,n){t.Template=t.Template||{},t.Template.Shapes=t.Template.Shapes||{};var r=t.Template;r.Shapes={circle:function(e,t,n){var i='<circle cx="100" cy="50" r="40" stroke="black" stroke-width="2" fill="{{color}}"/>',s={color:e};return r._internalDataConversion(t,n,i,s)},empty:function(e,t,n){r._internalDataConversion(t,n,"")}},r._internalDataConversion=function(e,t,r,i){t&&(r="<svg>"+r+"</svg>");var s=n.render(r,i);return e?jQuery(s):s}}),"use strict",define("REM/recline-extensions/recline-extensions-amd",["REM/recline-extensions/model/model.extensions.all","REM/recline-extensions/data/action","REM/recline-extensions/data/data.colors","REM/recline-extensions/data/data.faceting","REM/recline-extensions/data/data.filters","REM/recline-extensions/data/data.formatters","REM/recline-extensions/data/data.series.utility","REM/recline-extensions/data/data.shapes","REM/recline-extensions/data/template.shapes"],function(e){return e}),define("REM/controllers/VisualsDatasetManager",["backbone.marionette","REM/recline-extensions/recline-extensions-amd","REM/recline-extensions/backend/backend.extensions.csv"],function(e,t){"use strict";return e.Controller.extend({datasets:[],librarySettings:[],models:{dataset:t.Model.Dataset},visuals:[],initialize:function(e){_.bindAll(this,"_create","get"),this.librarySettings=e.library,_.isUndefined(e.models)||(this.models=_.extend(e.models,this.models))},_create:function(e){var t=this.librarySettings[e],n,r=this.librarySettings[e].model||!1;return r&&!_.isUndefined(this.models[r])?n=new this.models[r](t):n=new this.models.dataset(t),this.datasets[e]=n,n},get:function(e){return _.isUndefined(this.datasets[e])?this._create(e):this.datasets[e]},expireVisual:function(e){this.visuals=_.reject(this.visuals,function(t){return t.visual===e});var t=_.pluck(this.visuals,"visual");this.datasets=_.filter(this.datsets,function(e){if(_.contains(t,e.visual))return!0})},registerModel:function(e,t){this.models[e]=t},registerVisual:function(e){this.visuals.push(e)},reset:function(){this.datasets=[]}})}),define("communicator",["backbone.marionette"],function(e){"use strict";var t=e.Controller.extend({initialize:function(e){this.radioBroadcaster=Backbone.Wreqr.radio.channel("DATA_ATLAS").vent,this.reqres=new Backbone.Wreqr.RequestResponse,this.command=new Backbone.Wreqr.Commands}});return window.testIfExists=function(e,t){return t.split(".").reduce(function(e,t){return typeof e=="undefined"||e===null?e:e[t]},e)},new t}),define("REM/controllers/VisualsManager",["backbone","backbone.marionette","jquery","communicator","backbone.wreqr"],function(e,t,n,r,i){"use strict";return t.Controller.extend({settings:{placeholderSelector:".totalvis-instance"},datasetManager:null,visuals:[],library:[],initialize:function(e){this.datasetManager=e.datasetManager,_.isUndefined(window.dataAtlas)&&(window.dataAtlas={}),e.library&&(this.library=e.library),_.bindAll(this,"register","getPlaceholders")},_add:function(e){this.visuals=_.reject(this.visuals,function(t){return t.dom===e.dom}),this.visuals.push(e),this.datasetManager.registerVisual(e)},empty:function(e){var t=this;this.visuals=_.reject(this.visuals,function(n){console.log("destroying",n),r.radioBroadcaster.trigger("DATA_ATLAS:RADIO_DESTROYED",n.id);if(n.dom===e[0])return t.datasetManager.expireVisual(n),n.visual.destroy(),!0}),e.empty()},getPlaceholders:function(e){var e=e||n("body");return n(this.settings.placeholderSelector,e)},getVisuals:function(){return this.visuals},render:function(t,i){function o(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}var s=this;t.each(function(){var t=n(this),u=t.data("dataset"),a=t.data("visual"),f=t.data("id")||o()+o()+o(),l=e.Wreqr.radio.channel(f);r.radioBroadcaster.trigger("DATA_ATLAS:RADIO_CREATED",f);var c=s.datasetManager.get(u),h=new s.library[a]({dataset:c,container:t[0],id:f,channel:l,visualsManager:s});(!t.data("delayed-render")||i)&&h.render();var p={dataset:c,visual:h,dom:t[0],id:f};s._add(p)})},register:function(e,t){this.library[e]=t},remove:function(e){if(!e)throw"Target ID required to remove a visual from library.";var t=[];_.each(this.visuals,function(n){n.id==e?n.visual.destroy():t.push(n)}),this.visuals=t},reset:function(){_.each(this.visuals,function(e){e.visual.destroy()}),this.datasetManager.reset(),this.visuals=[]}})}),define("REM/models/budget",["backbone"],function(e){"use strict";return e.Model.extend({initialize:function(e){this.url=e.url}})}),define("REM/recline-extensions/backend/backend.raw",["jquery","REM/recline-extensions/recline-amd","REM/recline-extensions/data/data.formatters"],function(e,t){t.Backend=t.Backend||{},t.Backend.raw=t.Backend.raw||{},t.Backend.raw={__type__:"raw",timeout:6e4,fetch:function(t){this.url=t.url;var n=e.Deferred();return e.get(t.url).done(function(e){var t=e;n.resolve({records:[t],useMemoryStore:!0})}),n}}}),define("REM/views/tabs/base_tab",["backbone.marionette"],function(e){"use strict";return e.ItemView.extend({onRender:function(){this.$placeholders=this.visualsManager.getPlaceholders(this.$el)},onShow:function(){this.visualsManager.render(this.$placeholders)},onBeforeDestroy:function(){var e=this;this.$placeholders.each(function(){e.visualsManager.empty($(this))})}})}),function(e){if(typeof bootstrap=="function")bootstrap("promise",e);else if(typeof exports=="object")module.exports=e();else if(typeof define=="function"&&define.amd)define("q",e);else if(typeof ses!="undefined"){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function u(e){return function(){return o.apply(e,arguments)}}function m(e){return e===Object(e)}function g(e){return v(e)==="[object StopIteration]"||e instanceof y}function w(t,n){if(e&&n.stack&&typeof t=="object"&&t!==null&&t.stack&&t.stack.indexOf(b)===-1){var r=[];for(var i=n;!!i;i=i.source)i.stack&&r.unshift(i.stack);r.unshift(t.stack);var s=r.join("\n"+b+"\n");t.stack=E(s)}}function E(e){var t=e.split("\n"),n=[];for(var r=0;r<t.length;++r){var i=t[r];!T(i)&&!S(i)&&i&&n.push(i)}return n.join("\n")}function S(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function x(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);if(r)return[r[1],Number(r[2])]}function T(e){var t=x(e);if(!t)return!1;var i=t[0],s=t[1];return i===r&&s>=n&&s<=ot}function N(){if(!e)return;try{throw new Error}catch(t){var n=t.stack.split("\n"),i=n[0].indexOf("@")>0?n[1]:n[2],s=x(i);if(!s)return;return r=s[0],s[1]}}function C(e,t,n){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn(t+" is deprecated, use "+n+" instead.",(new Error("")).stack),e.apply(e,arguments)}}function k(e){return P(e)?e:H(e)?$(e):V(e)}function L(){function l(e){r=e,o.source=e,f(t,function(t,n){s(function(){e.promiseDispatch.apply(e,n)})},void 0),t=void 0,n=void 0}var t=[],n=[],r,i=h(L.prototype),o=h(M.prototype);o.promiseDispatch=function(e,i,o){var u=a(arguments);t?(t.push(u),i==="when"&&o[1]&&n.push(o[1])):s(function(){r.promiseDispatch.apply(r,u)})},o.valueOf=function(){if(t)return o;var e=D(r);return P(e)&&(r=e),e},o.inspect=function(){return r?r.inspect():{state:"pending"}};if(k.longStackSupport&&e)try{throw new Error}catch(u){o.stack=u.stack.substring(u.stack.indexOf("\n")+1)}return i.promise=o,i.resolve=function(e){if(r)return;l(k(e))},i.fulfill=function(e){if(r)return;l(V(e))},i.reject=function(e){if(r)return;l(X(e))},i.notify=function(e){if(r)return;f(n,function(t,n){s(function(){n(e)})},void 0)},i}function A(e){if(typeof e!="function")throw new TypeError("resolver must be a function.");var t=L();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function O(e){return A(function(t,n){for(var r=0,i=e.length;r<i;r++)k(e[r]).then(t,n)})}function M(e,t,n){t===void 0&&(t=function(e){return X(new Error("Promise does not support operation: "+e))}),n===void 0&&(n=function(){return{state:"unknown"}});var r=h(M.prototype);r.promiseDispatch=function(n,i,s){var o;try{e[i]?o=e[i].apply(r,s):o=t.call(r,i,s)}catch(u){o=X(u)}n&&n(o)},r.inspect=n;if(n){var i=n();i.state==="rejected"&&(r.exception=i.reason),r.valueOf=function(){var e=n();return e.state==="pending"||e.state==="rejected"?r:e.value}}return r}function _(e,t,n,r){return k(e).then(t,n,r)}function D(e){if(P(e)){var t=e.inspect();if(t.state==="fulfilled")return t.value}return e}function P(e){return m(e)&&typeof e.promiseDispatch=="function"&&typeof e.inspect=="function"}function H(e){return m(e)&&typeof e.then=="function"}function B(e){return P(e)&&e.inspect().state==="pending"}function j(e){return!P(e)||e.inspect().state==="fulfilled"}function F(e){return P(e)&&e.inspect().state==="rejected"}function U(){I.length=0,q.length=0,R||(R=!0)}function z(e,t){if(!R)return;q.push(e),t&&typeof t.stack!="undefined"?I.push(t.stack):I.push("(no stack) "+t)}function W(e){if(!R)return;var t=l(q,e);t!==-1&&(q.splice(t,1),I.splice(t,1))}function X(e){var t=M({when:function(t){return t&&W(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return z(t,e),t}function V(e){return M({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return t===null||t===void 0?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return d(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function $(e){var t=L();return s(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function J(e){return M({isDef:function(){}},function(n,r){return et(e,n,r)},function(){return k(e).inspect()})}function K(e,t,n){return k(e).spread(t,n)}function Q(e){return function(){function t(e,t){var s;if(typeof StopIteration=="undefined"){try{s=n[e](t)}catch(o){return X(o)}return s.done?s.value:_(s.value,r,i)}try{s=n[e](t)}catch(o){return g(o)?o.value:X(o)}return _(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"next"),i=t.bind(t,"throw");return r()}}function G(e){k.done(k.async(e)())}function Y(e){throw new y(e)}function Z(e){return function(){return K([this,tt(arguments)],function(t,n){return e.apply(t,n)})}}function et(e,t,n){return k(e).dispatch(t,n)}function tt(e){return _(e,function(e){var t=0,n=L();return f(e,function(r,i,s){var o;P(i)&&(o=i.inspect()).state==="fulfilled"?e[s]=o.value:(++t,_(i,function(r){e[s]=r,--t===0&&n.resolve(e)},n.reject,function(e){n.notify({index:s,value:e})}))},void 0),t===0&&n.resolve(e),n.promise})}function nt(e){return _(e,function(e){return e=c(e,k),_(tt(c(e,function(e){return _(e,i,i)})),function(){return e})})}function rt(e){return k(e).allSettled()}function it(e,t){return k(e).then(void 0,void 0,t)}function st(e,t){return k(e).nodeify(t)}var e=!1;try{throw new Error}catch(t){e=!!t.stack}var n=N(),r,i=function(){},s=function(){function o(){while(e.next){e=e.next;var t=e.task;e.task=void 0;var r=e.domain;r&&(e.domain=void 0,r.enter());try{t()}catch(s){if(i)throw r&&r.exit(),setTimeout(o,0),r&&r.enter(),s;setTimeout(function(){throw s},0)}r&&r.exit()}n=!1}var e={task:void 0,next:null},t=e,n=!1,r=void 0,i=!1;s=function(e){t=t.next={task:e,domain:i&&process.domain,next:null},n||(n=!0,r())};if(typeof process!="undefined"&&process.nextTick)i=!0,r=function(){process.nextTick(o)};else if(typeof setImmediate=="function")typeof window!="undefined"?r=setImmediate.bind(window,o):r=function(){setImmediate(o)};else if(typeof MessageChannel!="undefined"){var u=new MessageChannel;u.port1.onmessage=function(){r=a,u.port1.onmessage=o,o()};var a=function(){u.port2.postMessage(0)};r=function(){setTimeout(o,0),a()}}else r=function(){setTimeout(o,0)};return s}(),o=Function.call,a=u(Array.prototype.slice),f=u(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1)do{if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}while(1);for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),l=u(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),c=u(Array.prototype.map||function(e,t){var n=this,r=[];return f(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),h=Object.create||function(e){function t(){}return t.prototype=e,new t},p=u(Object.prototype.hasOwnProperty),d=Object.keys||function(e){var t=[];for(var n in e)p(e,n)&&t.push(n);return t},v=u(Object.prototype.toString),y;typeof ReturnValue!="undefined"?y=ReturnValue:y=function(e){this.value=e};var b="From previous event:";k.resolve=k,k.nextTick=s,k.longStackSupport=!1,k.defer=L,L.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(a(arguments,1)):e.resolve(n)}},k.Promise=A,k.promise=A,A.race=O,A.all=tt,A.reject=X,A.resolve=k,k.passByCopy=function(e){return e},M.prototype.passByCopy=function(){return this},k.join=function(e,t){return k(e).join(t)},M.prototype.join=function(e){return k([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},k.race=O,M.prototype.race=function(){return this.then(k.race)},k.makePromise=M,M.prototype.toString=function(){return"[object Promise]"},M.prototype.then=function(e,t,n){function u(t){try{return typeof e=="function"?e(t):t}catch(n){return X(n)}}function a(e){if(typeof t=="function"){w(e,r);try{return t(e)}catch(n){return X(n)}}return X(e)}function f(e){return typeof n=="function"?n(e):e}var r=this,i=L(),o=!1;return s(function(){r.promiseDispatch(function(e){if(o)return;o=!0,i.resolve(u(e))},"when",[function(e){if(o)return;o=!0,i.resolve(a(e))}])}),r.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=f(e)}catch(r){n=!0;if(!k.onerror)throw r;k.onerror(r)}n||i.notify(t)}]),i.promise},k.when=_,M.prototype.thenResolve=function(e){return this.then(function(){return e})},k.thenResolve=function(e,t){return k(e).thenResolve(t)},M.prototype.thenReject=function(e){return this.then(function(){throw e})},k.thenReject=function(e,t){return k(e).thenReject(t)},k.nearer=D,k.isPromise=P,k.isPromiseAlike=H,k.isPending=B,M.prototype.isPending=function(){return this.inspect().state==="pending"},k.isFulfilled=j,M.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"},k.isRejected=F,M.prototype.isRejected=function(){return this.inspect().state==="rejected"};var I=[],q=[],R=!0;k.resetUnhandledRejections=U,k.getUnhandledReasons=function(){return I.slice()},k.stopUnhandledRejectionTracking=function(){U(),R=!1},U(),k.reject=X,k.fulfill=V,k.master=J,k.spread=K,M.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},k.async=Q,k.spawn=G,k["return"]=Y,k.promised=Z,k.dispatch=et,M.prototype.dispatch=function(e,t){var n=this,r=L();return s(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},k.get=function(e,t){return k(e).dispatch("get",[t])},M.prototype.get=function(e){return this.dispatch("get",[e])},k.set=function(e,t,n){return k(e).dispatch("set",[t,n])},M.prototype.set=function(e,t){return this.dispatch("set",[e,t])},k.del=k["delete"]=function(e,t){return k(e).dispatch("delete",[t])},M.prototype.del=M.prototype["delete"]=function(e){return this.dispatch("delete",[e])},k.mapply=k.post=function(e,t,n){return k(e).dispatch("post",[t,n])},M.prototype.mapply=M.prototype.post=function(e,t){return this.dispatch("post",[e,t])},k.send=k.mcall=k.invoke=function(e,t){return k(e).dispatch("post",[t,a(arguments,2)])},M.prototype.send=M.prototype.mcall=M.prototype.invoke=function(e){return this.dispatch("post",[e,a(arguments,1)])},k.fapply=function(e,t){return k(e).dispatch("apply",[void 0,t])},M.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},k["try"]=k.fcall=function(e){return k(e).dispatch("apply",[void 0,a(arguments,1)])},M.prototype.fcall=function(){return this.dispatch("apply",[void 0,a(arguments)])},k.fbind=function(e){var t=k(e),n=a(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(a(arguments))])}},M.prototype.fbind=function(){var e=this,t=a(arguments);return function(){return e.dispatch("apply",[this,t.concat(a(arguments))])}},k.keys=function(e){return k(e).dispatch("keys",[])},M.prototype.keys=function(){return this.dispatch("keys",[])},k.all=tt,M.prototype.all=function(){return tt(this)},k.allResolved=C(nt,"allResolved","allSettled"),M.prototype.allResolved=function(){return nt(this)},k.allSettled=rt,M.prototype.allSettled=function(){return this.then(function(e){return tt(c(e,function(e){function t(){return e.inspect()}return e=k(e),e.then(t,t)}))})},k.fail=k["catch"]=function(e,t){return k(e).then(void 0,t)},M.prototype.fail=M.prototype["catch"]=function(e){return this.then(void 0,e)},k.progress=it,M.prototype.progress=function(e){return this.then(void 0,void 0,e)},k.fin=k["finally"]=function(e,t){return k(e)["finally"](t)},M.prototype.fin=M.prototype["finally"]=function(e){return e=k(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},k.done=function(e,t,n,r){return k(e).done(t,n,r)},M.prototype.done=function(e,t,n){var r=function(e){s(function(){w(e,i);if(!k.onerror)throw e;k.onerror(e)})},i=e||t||n?this.then(e,t,n):this;typeof process=="object"&&process&&process.domain&&(r=process.domain.bind(r)),i.then(void 0,r)},k.timeout=function(e,t,n){return k(e).timeout(t,n)},M.prototype.timeout=function(e,t){var n=L(),r=setTimeout(function(){n.reject(new Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},k.delay=function(e,t){return t===void 0&&(t=e,e=void 0),k(e).delay(t)},M.prototype.delay=function(e){return this.then(function(t){var n=L();return setTimeout(function(){n.resolve(t)},e),n.promise})},k.nfapply=function(e,t){return k(e).nfapply(t)},M.prototype.nfapply=function(e){var t=L(),n=a(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},k.nfcall=function(e){var t=a(arguments,1);return k(e).nfapply(t)},M.prototype.nfcall=function(){var e=a(arguments),t=L();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},k.nfbind=k.denodeify=function(e){var t=a(arguments,1);return function(){var n=t.concat(a(arguments)),r=L();return n.push(r.makeNodeResolver()),k(e).fapply(n).fail(r.reject),r.promise}},M.prototype.nfbind=M.prototype.denodeify=function(){var e=a(arguments);return e.unshift(this),k.denodeify.apply(void 0,e)},k.nbind=function(e,t){var n=a(arguments,2);return function(){function s(){return e.apply(t,arguments)}var r=n.concat(a(arguments)),i=L();return r.push(i.makeNodeResolver()),k(s).fapply(r).fail(i.reject),i.promise}},M.prototype.nbind=function(){var e=a(arguments,0);return e.unshift(this),k.nbind.apply(void 0,e)},k.nmapply=k.npost=function(e,t,n){return k(e).npost(t,n)},M.prototype.nmapply=M.prototype.npost=function(e,t){var n=a(t||[]),r=L();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},k.nsend=k.nmcall=k.ninvoke=function(e,t){var n=a(arguments,2),r=L();return n.push(r.makeNodeResolver()),k(e).dispatch("post",[t,n]).fail(r.reject),r.promise},M.prototype.nsend=M.prototype.nmcall=M.prototype.ninvoke=function(e){var t=a(arguments,1),n=L();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},k.nodeify=st,M.prototype.nodeify=function(e){if(!e)return this;this.then(function(t){s(function(){e(null,t)})},function(t){s(function(){e(t)})})};var ot=N();return k}),function(){function u(e){this._value=e}function a(e,t,n,r){var i=Math.pow(10,t),s,o;return o=(n(e*i)/i).toFixed(t),r&&(s=new RegExp("0{1,"+r+"}$"),o=o.replace(s,"")),o}function f(e,t,n){var r;return t.indexOf("$")>-1?r=c(e,t,n):t.indexOf("%")>-1?r=h(e,t,n):t.indexOf(":")>-1?r=p(e,t):r=v(e._value,t,n),r}function l(e,t){var s=t,o,u,a,f,l=["KB","MB","GB","TB","PB","EB","ZB","YB"],c=!1,h;if(t.indexOf(":")>-1)e._value=d(t);else if(t===i)e._value=0;else{n[r].delimiters.decimal!=="."&&(t=t.replace(/\./g,"").replace(n[r].delimiters.decimal,".")),o=new RegExp("[^a-zA-Z]"+n[r].abbreviations.thousand+"(?:\\)|(\\"+n[r].currency.symbol+")?(?:\\))?)?$"),u=new RegExp("[^a-zA-Z]"+n[r].abbreviations.million+"(?:\\)|(\\"+n[r].currency.symbol+")?(?:\\))?)?$"),a=new RegExp("[^a-zA-Z]"+n[r].abbreviations.billion+"(?:\\)|(\\"+n[r].currency.symbol+")?(?:\\))?)?$"),f=new RegExp("[^a-zA-Z]"+n[r].abbreviations.trillion+"(?:\\)|(\\"+n[r].currency.symbol+")?(?:\\))?)?$");for(h=0;h<=l.length;h++){c=t.indexOf(l[h])>-1?Math.pow(1024,h+1):!1;if(c)break}e._value=(c?c:1)*(s.match(o)?Math.pow(10,3):1)*(s.match(u)?Math.pow(10,6):1)*(s.match(a)?Math.pow(10,9):1)*(s.match(f)?Math.pow(10,12):1)*(t.indexOf("%")>-1?.01:1)*((t.split("-").length+Math.min(t.split("(").length-1,t.split(")").length-1))%2?1:-1)*Number(t.replace(/[^0-9\.]+/g,"")),e._value=c?Math.ceil(e._value):e._value}return e._value}function c(e,t,i){var s=t.indexOf("$"),o=t.indexOf("("),u=t.indexOf("-"),a="",f,l;t.indexOf(" $")>-1?(a=" ",t=t.replace(" $","")):t.indexOf("$ ")>-1?(a=" ",t=t.replace("$ ","")):t=t.replace("$",""),l=v(e._value,t,i);if(s<=1)if(l.indexOf("(")>-1||l.indexOf("-")>-1){l=l.split(""),f=1;if(s<o||s<u)f=0;l.splice(f,0,n[r].currency.symbol+a),l=l.join("")}else l=n[r].currency.symbol+a+l;else l.indexOf(")")>-1?(l=l.split(""),l.splice(-1,0,a+n[r].currency.symbol),l=l.join("")):l=l+a+n[r].currency.symbol;return l}function h(e,t,n){var r="",i,s=e._value*100;return t.indexOf(" %")>-1?(r=" ",t=t.replace(" %","")):t=t.replace("%",""),i=v(s,t,n),i.indexOf(")")>-1?(i=i.split(""),i.splice(-1,0,r+"%"),i=i.join("")):i=i+r+"%",i}function p(e){var t=Math.floor(e._value/60/60),n=Math.floor((e._value-t*60*60)/60),r=Math.round(e._value-t*60*60-n*60);return t+":"+(n<10?"0"+n:n)+":"+(r<10?"0"+r:r)}function d(e){var t=e.split(":"),n=0;return t.length===3?(n+=Number(t[0])*60*60,n+=Number(t[1])*60,n+=Number(t[2])):t.length===2&&(n+=Number(t[0])*60,n+=Number(t[1])),Number(n)}function v(e,t,s){var o=!1,u=!1,f=!1,l="",c=!1,h=!1,p=!1,d=!1,v=!1,m="",g="",y=Math.abs(e),b=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],w,E,S,x,T,N,C="",k=!1;if(e===0&&i!==null)return i;t.indexOf("(")>-1?(o=!0,t=t.slice(1,-1)):t.indexOf("+")>-1&&(u=!0,t=t.replace(/\+/g,""));if(t.indexOf("a")>-1){c=t.indexOf("aK")>=0,h=t.indexOf("aM")>=0,p=t.indexOf("aB")>=0,d=t.indexOf("aT")>=0,v=c||h||p||d,t.indexOf(" a")>-1?(l=" ",t=t.replace(" a","")):t=t.replace("a","");if(y>=Math.pow(10,12)&&!v||d)l+=n[r].abbreviations.trillion,e/=Math.pow(10,12);else if(y<Math.pow(10,12)&&y>=Math.pow(10,9)&&!v||p)l+=n[r].abbreviations.billion,e/=Math.pow(10,9);else if(y<Math.pow(10,9)&&y>=Math.pow(10,6)&&!v||h)l+=n[r].abbreviations.million,e/=Math.pow(10,6);else if(y<Math.pow(10,6)&&y>=Math.pow(10,3)&&!v||c)l+=n[r].abbreviations.thousand,e/=Math.pow(10,3)}if(t.indexOf("b")>-1){t.indexOf(" b")>-1?(m=" ",t=t.replace(" b","")):t=t.replace("b","");for(S=0;S<=b.length;S++){w=Math.pow(1024,S),E=Math.pow(1024,S+1);if(e>=w&&e<E){m+=b[S],w>0&&(e/=w);break}}}return t.indexOf("o")>-1&&(t.indexOf(" o")>-1?(g=" ",t=t.replace(" o","")):t=t.replace("o",""),g+=n[r].ordinal(e)),t.indexOf("[.]")>-1&&(f=!0,t=t.replace("[.]",".")),x=e.toString().split(".")[0],T=t.split(".")[1],N=t.indexOf(","),T?(T.indexOf("[")>-1?(T=T.replace("]",""),T=T.split("["),C=a(e,T[0].length+T[1].length,s,T[1].length)):C=a(e,T.length,s),x=C.split(".")[0],C.split(".")[1].length?C=n[r].delimiters.decimal+C.split(".")[1]:C="",f&&Number(C.slice(1))===0&&(C="")):x=a(e,null,s),x.indexOf("-")>-1&&(x=x.slice(1),k=!0),N>-1&&(x=x.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+n[r].delimiters.thousands)),t.indexOf(".")===0&&(x=""),(o&&k?"(":"")+(!o&&k?"-":"")+(!k&&u?"+":"")+x+C+(g?g:"")+(l?l:"")+(m?m:"")+(o&&k?")":"")}function m(e,t){n[e]=t}function g(e){var t=e.toString().split(".");return t.length<2?1:Math.pow(10,t[1].length)}function y(){var e=Array.prototype.slice.call(arguments);return e.reduce(function(e,t){var n=g(e),r=g(t);return n>r?n:r},-Infinity)}var e,t="1.5.3",n={},r="en",i=null,s="0,0",o=typeof module!="undefined"&&module.exports;e=function(t){return e.isNumeral(t)?t=t.value():t===0||typeof t=="undefined"?t=0:Number(t)||(t=e.fn.unformat(t)),new u(Number(t))},e.version=t,e.isNumeral=function(e){return e instanceof u},e.language=function(t,i){if(!t)return r;if(t&&!i){if(!n[t])throw new Error("Unknown language : "+t);r=t}return(i||!n[t])&&m(t,i),e},e.languageData=function(e){if(!e)return n[r];if(!n[e])throw new Error("Unknown language : "+e);return n[e]},e.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th"},currency:{symbol:"$"}}),e.zeroFormat=function(e){i=typeof e=="string"?e:null},e.defaultFormat=function(e){s=typeof e=="string"?e:"0.0"},"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(e,t){"use strict";if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var n,r,i=this.length>>>0,s=!1;1<arguments.length&&(r=t,s=!0);for(n=0;i>n;++n)this.hasOwnProperty(n)&&(s?r=e(r,this[n],n,this):(r=this[n],s=!0));if(!s)throw new TypeError("Reduce of empty array with no initial value");return r}),e.fn=u.prototype={clone:function(){return e(this)},format:function(e,t){return f(this,e?e:s,t!==undefined?t:Math.round)},unformat:function(e){return Object.prototype.toString.call(e)==="[object Number]"?e:l(this,e?e:s)},value:function(){return this._value},valueOf:function(){return this._value},set:function(e){return this._value=Number(e),this},add:function(e){function n(e,n,r,i){return e+t*n}var t=y.call(null,this._value,e);return this._value=[this._value,e].reduce(n,0)/t,this},subtract:function(e){function n(e,n,r,i){return e-t*n}var t=y.call(null,this._value,e);return this._value=[e].reduce(n,this._value*t)/t,this},multiply:function(e){function t(e,t,n,r){var i=y(e,t);return e*i*t*i/(i*i)}return this._value=[this._value,e].reduce(t,1),this},divide:function(e){function t(e,t,n,r){var i=y(e,t);return e*i/(t*i)}return this._value=[this._value,e].reduce(t),this},difference:function(t){return Math.abs(e(this._value).subtract(t).value())}},o&&(module.exports=e),typeof ender=="undefined"&&(this.numeral=e),typeof define=="function"&&define.amd&&define("numeral",[],function(){return e})}.call(this),define("DATAATLAS/config/localizations",[],function(){return{nl:{delimiters:{thousands:".",decimal:","},abbreviations:{thousand:"k",million:"mln",billion:"mrd",trillion:"bln"},ordinal:function(e){var t=e%100;return e!==0&&t<=1||t===8||t>=20?"ste":"de"},currency:{symbol:" "}},en:{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th"},currency:{symbol:""}},getLocalization:function(e){return this[e]}}}),define("text",["module"],function(e){"use strict";var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.12",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("")===0&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!DATAATLAS/templates/map_layout.html",[],function(){return'<div class="map-layout">\n  <div class="timeline"></div>\n  <div class="tooltips"></div>\n  <div class="teaser">\n    <div class="title"></div>\n    <div class="description"></div>\n  </div>\n  <div class="popup"></div>\n  <div class="intro"></div>\n  <div class="controls"></div>\n  <div class="legend"></div>\n  <div class="credits"><a href="http://www.oneworld.nl/atlas" target="_top">OneWorld Data Atlas</a></div>\n</div>'}),define("DATAATLAS/views/map_layout",["backbone.marionette","text!DATAATLAS/templates/map_layout.html"],function(e,t){return e.LayoutView.extend({template:t,regions:{legend:".legend",popup:".popup",intro:".intro",teaser:".teaser",credits:".credits",controls:".controls",timeline:".timeline",tooltips:".tooltips"}})}),define("jquery-ui/core",["jquery"],function(e){(function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.10.0",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})})(e)}),define("jquery-ui/widget",["jquery"],function(e){(function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=i,s=r.apply(this,arguments),this._super=t,this._superApply=n,s}}()}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})})(e)}),define("jquery-ui/mouse",["jquery","./widget"],function(e){(function(e,t){var n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"1.10.0",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(e)}),define("jquery-ui/draggable",["jquery","./core","./mouse","./widget"],function(e){(function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.0",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){this.options.helper==="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!=="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!=="x")this.helper[0].style.top=this.position.top+"px";return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n,r=this,i=!1,s=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),n=this.element[0];while(n&&(n=n.parentNode))n===document&&(i=!0);return!i&&this.options.helper==="original"?!1:(this.options.revert==="invalid"&&!s||this.options.revert==="valid"&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==!1&&r._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1)},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?!0:!1;return e(this.options.handle,this.element).find("*").addBack().each(function(){this===t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper==="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo==="parent"?this.element[0].parentNode:n.appendTo),r[0]!==this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;i.containment==="parent"&&(i.containment=this.helper[0].parentNode);if(i.containment==="document"||i.containment==="window")this.containment=[i.containment==="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,i.containment==="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(i.containment==="document"?0:e(window).scrollLeft())+e(i.containment==="document"?document:window).width()-this.helperProportions.width-this.margins.left,(i.containment==="document"?0:e(window).scrollTop())+(e(i.containment==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(i.containment)&&i.containment.constructor!==Array){n=e(i.containment),r=n[0];if(!r)return;t=e(r).css("overflow")!=="hidden",this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(t?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}else i.containment.constructor===Array&&(this.containment=i.containment)},_convertPositionTo:function(t,n){n||(n=this.position);var r=t==="absolute"?1:-1,i=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():s?0:i.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():s?0:i.scrollLeft())*r}},_generatePosition:function(t){var n,r,i,s,o=this.options,u=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(u[0].tagName),f=t.pageX,l=t.pageY;return this.originalPosition&&(this.containment&&(this.relative_container?(r=this.relative_container.offset(),n=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):n=this.containment,t.pageX-this.offset.click.left<n[0]&&(f=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(l=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(f=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(l=n[3]+this.offset.click.top)),o.grid&&(i=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=n?i-this.offset.click.top>=n[1]||i-this.offset.click.top>n[3]?i:i-this.offset.click.top>=n[1]?i-o.grid[1]:i+o.grid[1]:i,s=o.grid[0]?this.originalPageX+Math.round((f-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,f=n?s-this.offset.click.left>=n[0]||s-this.offset.click.left>n[2]?s:s-this.offset.click.left>=n[0]?s-o.grid[0]:s+o.grid[0]:s)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():a?0:u.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():a?0:u.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t==="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("ui-draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"ui-sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("ui-draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper==="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("ui-draggable"),i=this;e.each(r.sortables,function(){var s=!1,o=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(s=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!==o&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(o.instance.element[0],this.instance.element[0])&&(s=!1),s})),s?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("ui-draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&t.scrollParent[0].tagName!=="HTML"&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("ui-draggable"),r=n.options,i=!1;if(n.scrollParent[0]!==document&&n.scrollParent[0].tagName!=="HTML"){if(!r.axis||r.axis!=="x")n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-n.overflowOffset.top<r.scrollSensitivity&&(n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop-r.scrollSpeed);if(!r.axis||r.axis!=="y")n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-n.overflowOffset.left<r.scrollSensitivity&&(n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft-r.scrollSpeed)}else{if(!r.axis||r.axis!=="x")t.pageY-e(document).scrollTop()<r.scrollSensitivity?i=e(document).scrollTop(e(document).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<r.scrollSensitivity&&(i=e(document).scrollTop(e(document).scrollTop()+r.scrollSpeed));if(!r.axis||r.axis!=="y")t.pageX-e(document).scrollLeft()<r.scrollSensitivity?i=e(document).scrollLeft(e(document).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<r.scrollSensitivity&&(i=e(document).scrollLeft(e(document).scrollLeft()+r.scrollSpeed))}i!==!1&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=e(this),r=n.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:r.top,left:r.left})})},drag:function(t,n){var r,i,s,o,u,a,f,l,c,h,p=e(this).data("ui-draggable"),d=p.options,v=d.snapTolerance,m=n.offset.left,g=m+p.helperProportions.width,y=n.offset.top,b=y+p.helperProportions.height;for(c=p.snapElements.length-1;c>=0;c--){u=p.snapElements[c].left,a=u+p.snapElements[c].width,f=p.snapElements[c].top,l=f+p.snapElements[c].height;if(!(u-v<m&&m<a+v&&f-v<y&&y<l+v||u-v<m&&m<a+v&&f-v<b&&b<l+v||u-v<g&&g<a+v&&f-v<y&&y<l+v||u-v<g&&g<a+v&&f-v<b&&b<l+v)){p.snapElements[c].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=!1;continue}d.snapMode!=="inner"&&(r=Math.abs(f-b)<=v,i=Math.abs(l-y)<=v,s=Math.abs(u-g)<=v,o=Math.abs(a-m)<=v,r&&(n.position.top=p._convertPositionTo("relative",{top:f-p.helperProportions.height,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u-p.helperProportions.width}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left)),h=r||i||s||o,d.snapMode!=="outer"&&(r=Math.abs(f-y)<=v,i=Math.abs(l-b)<=v,s=Math.abs(u-m)<=v,o=Math.abs(a-g)<=v,r&&(n.position.top=p._convertPositionTo("relative",{top:f,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l-p.helperProportions.height,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[c].snapping&&(r||i||s||o||h)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=r||i||s||o||h}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,n=e(this).data("ui-draggable").options,r=e.makeArray(e(n.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!r.length)return;t=parseInt(r[0].style.zIndex,10)||0,e(r).each(function(e){this.style.zIndex=t+e}),this[0].style.zIndex=t+r.length}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})})(e)}),define("DATAATLAS/plugins/dataatlas_plugin",["backbone.marionette","jquery"],function(e,t){return e.ItemView.extend({initialize:function(e){this.channel=e.channel,this.container=e.container}})}),define("text!DATAATLAS/plugins/timeline/timeline.html",[],function(){return'<div class="dataworld-timeline">\n  <div class="dial-tip">\n    <div class="dial"></div>\n    <div class="draggable"><!-- years are populated here. --></div>\n  </div>\n</div>'}),define("DATAATLAS/plugins/timeline/timeline",["backbone","jquery","underscore","d3","jquery-ui/draggable","DATAATLAS/plugins/dataatlas_plugin","text!DATAATLAS/plugins/timeline/timeline.html"],function(e,t,n,r,i,s,o){return s.extend({events:{"click .year":function(e){this.makeActiveColumn(t(e.currentTarget))}},template:o,initialize:function(e){n.bindAll(this,"makeActiveColumn","render","repositionTimeline"),this.columns=e.columns,this.channel=e.channel,this.container=e.container,s.prototype.initialize(arguments[0])},makeActiveColumn:function(e){var t=this;return this.$timeline.stop().animate({left:(e.position().left-t.dialPosition+e.outerWidth()/2)*-1},function(){e.parent().find(".year").removeClass("active"),e.addClass("active"),t.channel.vent.trigger("DATA_ATLAS:CHANGE_ACTIVE_COLUMN",e.text())}),!1},onShow:function(){var e=this.columns,r="";n.each(e,function(e){r+="<div class='year'>"+e+"</div>"}),this.$el.find(".draggable").html(r);var i=t(".year",this.$el),s=t(".draggable",this.$el),o=t(this.container),u=[],a=[],f=this,l=this;this.$timeline=s,i.each(function(){a.push(t(this).outerWidth())});var c=n.reduce(a,function(e,t){return e+t},0)+i.length*2,h=c>o.width()?c:o.width();s.width(h),this.dialPosition=t(".dial",this.$el).css("left",o.width()/2).position().left,i.each(function(){var e=t(this).position();u.push(e.left)}),i.last().each(function(){l.makeActiveColumn(t(this))}),i.first().each(function(){t(this).addClass("first")}),s.draggable({axis:"x",helper:function(){return i.removeClass("active"),t("<div></div>")},drag:function(e,r){t(this).stop().animate({left:r.helper.position().left},{complete:function(){var e=parseInt(s.css("left"),10)*-1,r=0;n.each(u,function(t,n){l.dialPosition+e>t&&(r=n)});var o=t(i[r]).addClass("active");f.channel.vent.trigger("DATA_ATLAS:CHANGE_ACTIVE_COLUMN",o.text()),s.stop().animate({left:(o.position().left-l.dialPosition+o.outerWidth()/2)*-1},300)}},400,"easeOutCirc")}}),f.channel.vent.on("fullscreen:on fullscreen:off",function(){$el=t(".active",l.$el);var e=$el.position().left;setTimeout(function(){l.dialPosition=t(".dial",l.$el).css("left",o.width()/2).position().left;var r=parseInt(l.$timeline.css("left"),10)*-1,i=0;n.each(u,function(e,t){l.dialPosition+r>e&&(i=t)}),l.$timeline.stop().animate({left:(e-l.dialPosition+$el.outerWidth()/2)*-1})},1500)},this)},repositionTimeline:function(e){setInterval(function(){view.dialPosition=t(".dial",this.$el).css("left",e.width()/2).position().left,view.makeActiveColumn(t("a.active-trail.active"))},5e3)}})}),define("DATAATLAS/models/country_translations_model",["backbone"],function(e){return e.Model.extend({initialize:function(){},getTranslation:function(e,t){var t=t||"en",n=_.findWhere(this.get("countries"),{cc:e});return n[t]},defaults:{countries:[{cc:"ABW",en:"Aruba",nl:"Aruba"},{cc:"AFG",en:"Afghanistan",nl:"Afghanistan"},{cc:"AGO",en:"Angola",nl:"Angola"},{cc:"AIA",en:"Anguilla",nl:"Anguilla"},{cc:"ALA",en:"land Islands",nl:"land"},{cc:"ALB",en:"Albania",nl:"Albani"},{cc:"AND",en:"Andorra",nl:"Andorra"},{cc:"ARE",en:"United Arab Emirates",nl:"Verenigde Arabische Emiraten"},{cc:"ARG",en:"Argentina",nl:"Argentini"},{cc:"ARM",en:"Armenia",nl:"Armeni"},{cc:"ASM",en:"American Samoa",nl:"Amerikaans-Samoa"},{cc:"ATA",en:"Antarctica",nl:"Antarctica"},{cc:"ATF",en:"French Southern Territories",nl:"Franse Zuidelijke en Antarctische Gebieden"},{cc:"ATG",en:"Antigua and Barbuda",nl:"Antigua en Barbuda"},{cc:"AUS",en:"Australia",nl:"Australi"},{cc:"AUT",en:"Austria",nl:"Oostenrijk"},{cc:"AZE",en:"Azerbaijan",nl:"Azerbeidzjan"},{cc:"BDI",en:"Burundi",nl:"Burundi"},{cc:"BEL",en:"Belgium",nl:"Belgi"},{cc:"BEN",en:"Benin",nl:"Benin"},{cc:"BES",en:"Bonaire, Sint Eustatius and Saba",nl:"Bonaire, Sint Eustatius en Saba"},{cc:"BFA",en:"Burkina Faso",nl:"Burkina Faso"},{cc:"BGD",en:"Bangladesh",nl:"Bangladesh"},{cc:"BGR",en:"Bulgaria",nl:"Bulgarije"},{cc:"BHR",en:"Bahrain",nl:"Bahrein"},{cc:"BHS",en:"Bahamas",nl:"Bahama's"},{cc:"BIH",en:"Bosnia and Herzegovina",nl:"Bosni en Herzegovina"},{cc:"BLM",en:"Saint Barthlemy",nl:"Saint-Barthlemy"},{cc:"BLR",en:"Belarus",nl:"Wit-Rusland"},{cc:"BLZ",en:"Belize",nl:"Belize"},{cc:"BMU",en:"Bermuda",nl:"Bermuda"},{cc:"BOL",en:"Bolivia, Plurinational State of",nl:"Bolivia"},{cc:"BRA",en:"Brazil",nl:"Brazili"},{cc:"BRB",en:"Barbados",nl:"Barbados"},{cc:"BRN",en:"Brunei Darussalam",nl:"Brunei"},{cc:"BTN",en:"Bhutan",nl:"Bhutan"},{cc:"BVT",en:"Bouvet Island",nl:"Bouveteiland"},{cc:"BWA",en:"Botswana",nl:"Botswana"},{cc:"CAF",en:"Central African Republic",nl:"Centraal-Afrikaanse Republiek"},{cc:"CAN",en:"Canada",nl:"Canada"},{cc:"CCK",en:"Cocos (Keeling) Islands",nl:"Cocoseilanden"},{cc:"CHE",en:"Switzerland",nl:"Zwitserland"},{cc:"CHL",en:"Chile",nl:"Chili"},{cc:"CHN",en:"China",nl:"China"},{cc:"CIV",en:"Cte d'Ivoire",nl:"Ivoorkust"},{cc:"CMR",en:"Cameroon",nl:"Kameroen"},{cc:"COD",en:"Congo, the Democratic Republic of the",nl:"Congo-Kinshasa"},{cc:"COG",en:"Congo",nl:"Congo-Brazzaville"},{cc:"COK",en:"Cook Islands",nl:"Cookeilanden"},{cc:"COL",en:"Colombia",nl:"Colombia"},{cc:"COM",en:"Comoros",nl:"Comoren"},{cc:"CPV",en:"Cape Verde",nl:"Kaapverdi"},{cc:"CRI",en:"Costa Rica",nl:"Costa Rica"},{cc:"CUB",en:"Cuba",nl:"Cuba"},{cc:"CUW",en:"Curaao",nl:"Curaao"},{cc:"CXR",en:"Christmas Island",nl:"Christmaseiland"},{cc:"CYM",en:"Cayman Islands",nl:"Kaaimaneilanden"},{cc:"CYP",en:"Cyprus",nl:"Cyprus"},{cc:"CZE",en:"Czech Republic",nl:"Tsjechi"},{cc:"DEU",en:"Germany",nl:"Duitsland"},{cc:"DJI",en:"Djibouti",nl:"Djibouti"},{cc:"DMA",en:"Dominica",nl:"Dominica"},{cc:"DNK",en:"Denmark",nl:"Denemarken"},{cc:"DOM",en:"Dominican Republic",nl:"Dominicaanse Republiek"},{cc:"DZA",en:"Algeria",nl:"Algerije"},{cc:"ECU",en:"Ecuador",nl:"Ecuador"},{cc:"EGY",en:"Egypt",nl:"Egypte"},{cc:"ERI",en:"Eritrea",nl:"Eritrea"},{cc:"ESH",en:"Western Sahara",nl:"Westelijke Sahara"},{cc:"ESP",en:"Spain",nl:"Spanje"},{cc:"EST",en:"Estonia",nl:"Estland"},{cc:"ETH",en:"Ethiopia",nl:"Ethiopi"},{cc:"FIN",en:"Finland",nl:"Finland"},{cc:"FJI",en:"Fiji",nl:"Fiji"},{cc:"FLK",en:"Falkland Islands (Malvinas)",nl:"Falklandeilanden"},{cc:"FRA",en:"France",nl:"Frankrijk"},{cc:"FRO",en:"Faroe Islands",nl:"Faerer"},{cc:"FSM",en:"Micronesia, Federated States of",nl:"Micronesia"},{cc:"GAB",en:"Gabon",nl:"Gabon"},{cc:"GBR",en:"United Kingdom",nl:"Verenigd Koninkrijk"},{cc:"GEO",en:"Georgia",nl:"Georgi"},{cc:"GGY",en:"Guernsey",nl:"Guernsey"},{cc:"GHA",en:"Ghana",nl:"Ghana"},{cc:"GIB",en:"Gibraltar",nl:"Gibraltar"},{cc:"GIN",en:"Guinea",nl:"Guinee"},{cc:"GLP",en:"Guadeloupe",nl:"Guadeloupe"},{cc:"GMB",en:"Gambia",nl:"Gambia"},{cc:"GNB",en:"Guinea-Bissau",nl:"Guinee-Bissau"},{cc:"GNQ",en:"Equatorial Guinea",nl:"Equatoriaal-Guinea"},{cc:"GRC",en:"Greece",nl:"Griekenland"},{cc:"GRD",en:"Grenada",nl:"Grenada"},{cc:"GRL",en:"Greenland",nl:"Groenland"},{cc:"GTM",en:"Guatemala",nl:"Guatemala"},{cc:"GUF",en:"French Guiana",nl:"Frans-Guyana"},{cc:"GUM",en:"Guam",nl:"Guam"},{cc:"GUY",en:"Guyana",nl:"Guyana"},{cc:"HKG",en:"Hong Kong",nl:"Hongkong"},{cc:"HMD",en:"Heard Island and McDonald Islands",nl:"Heard en MacDonaldeilanden"},{cc:"HND",en:"Honduras",nl:"Honduras"},{cc:"HRV",en:"Croatia",nl:"Kroati"},{cc:"HTI",en:"Haiti",nl:"Hati"},{cc:"HUN",en:"Hungary",nl:"Hongarije"},{cc:"IDN",en:"Indonesia",nl:"Indonesi"},{cc:"IMN",en:"Isle of Man",nl:"Man"},{cc:"IND",en:"India",nl:"India"},{cc:"IOT",en:"British Indian Ocean Territory",nl:"Brits Indische Oceaanterritorium"},{cc:"IRL",en:"Ireland",nl:"Ierland"},{cc:"IRN",en:"Iran, Islamic Republic of",nl:"Iran"},{cc:"IRQ",en:"Iraq",nl:"Irak"},{cc:"ISL",en:"Iceland",nl:"IJsland"},{cc:"ISR",en:"Israel",nl:"Isral"},{cc:"ITA",en:"Italy",nl:"Itali"},{cc:"JAM",en:"Jamaica",nl:"Jamaica"},{cc:"JEY",en:"Jersey",nl:"Jersey"},{cc:"JOR",en:"Jordan",nl:"Jordani"},{cc:"JPN",en:"Japan",nl:"Japan"},{cc:"KAZ",en:"Kazakhstan",nl:"Kazachstan"},{cc:"KEN",en:"Kenya",nl:"Kenia"},{cc:"KGZ",en:"Kyrgyzstan",nl:"Kirgizi"},{cc:"KHM",en:"Cambodia",nl:"Cambodja"},{cc:"KIR",en:"Kiribati",nl:"Kiribati"},{cc:"KNA",en:"Saint Kitts and Nevis",nl:"Saint Kitts en Nevis"},{cc:"KOR",en:"Korea, Republic of",nl:"Zuid-Korea"},{cc:"KWT",en:"Kuwait",nl:"Koeweit"},{cc:"LAO",en:"Lao People's Democratic Republic",nl:"Laos"},{cc:"LBN",en:"Lebanon",nl:"Libanon"},{cc:"LBR",en:"Liberia",nl:"Liberia"},{cc:"LBY",en:"Libya",nl:"Libi"},{cc:"LCA",en:"Saint Lucia",nl:"Saint Lucia"},{cc:"LIE",en:"Liechtenstein",nl:"Liechtenstein"},{cc:"LKA",en:"Sri Lanka",nl:"Sri Lanka"},{cc:"LSO",en:"Lesotho",nl:"Lesotho"},{cc:"LTU",en:"Lithuania",nl:"Litouwen"},{cc:"LUX",en:"Luxembourg",nl:"Luxemburg"},{cc:"LVA",en:"Latvia",nl:"Letland"},{cc:"MAC",en:"Macao",nl:"Macau"},{cc:"MAF",en:"Saint Martin (French part)",nl:"Sint-Maarten"},{cc:"MAR",en:"Morocco",nl:"Marokko"},{cc:"MCO",en:"Monaco",nl:"Monaco"},{cc:"MDA",en:"Moldova, Republic of",nl:"Moldavi"},{cc:"MDG",en:"Madagascar",nl:"Madagaskar"},{cc:"MDV",en:"Maldives",nl:"Maldiven"},{cc:"MEX",en:"Mexico",nl:"Mexico"},{cc:"MHL",en:"Marshall Islands",nl:"Marshalleilanden"},{cc:"MKD",en:"Macedonia, the former Yugoslav Republic of",nl:"Macedoni"},{cc:"MLI",en:"Mali",nl:"Mali"},{cc:"MLT",en:"Malta",nl:"Malta"},{cc:"MMR",en:"Myanmar",nl:"Myanmar"},{cc:"MNE",en:"Montenegro",nl:"Montenegro"},{cc:"MNG",en:"Mongolia",nl:"Mongoli"},{cc:"MNP",en:"Northern Mariana Islands",nl:"Noordelijke Marianen"},{cc:"MOZ",en:"Mozambique",nl:"Mozambique"},{cc:"MRT",en:"Mauritania",nl:"Mauritani"},{cc:"MSR",en:"Montserrat",nl:"Montserrat"},{cc:"MTQ",en:"Martinique",nl:"Martinique"},{cc:"MUS",en:"Mauritius",nl:"Mauritius"},{cc:"MWI",en:"Malawi",nl:"Malawi"},{cc:"MYS",en:"Malaysia",nl:"Maleisi"},{cc:"MYT",en:"Mayotte",nl:"Mayotte"},{cc:"NAM",en:"Namibia",nl:"Namibi"},{cc:"NCL",en:"New Caledonia",nl:"Nieuw-Caledoni"},{cc:"NER",en:"Niger",nl:"Niger"},{cc:"NFK",en:"Norfolk Island",nl:"Norfolk"},{cc:"NGA",en:"Nigeria",nl:"Nigeria"},{cc:"NIC",en:"Nicaragua",nl:"Nicaragua"},{cc:"NIU",en:"Niue",nl:"Niue"},{cc:"NLD",en:"Netherlands",nl:"Nederland"},{cc:"NOR",en:"Norway",nl:"Noorwegen"},{cc:"NPL",en:"Nepal",nl:"Nepal"},{cc:"NRU",en:"Nauru",nl:"Nauru"},{cc:"NZL",en:"New Zealand",nl:"Nieuw-Zeeland"},{cc:"OMN",en:"Oman",nl:"Oman"},{cc:"PAK",en:"Pakistan",nl:"Pakistan"},{cc:"PAN",en:"Panama",nl:"Panama"},{cc:"PCN",en:"Pitcairn",nl:"Pitcairneilanden"},{cc:"PER",en:"Peru",nl:"Peru"},{cc:"PHL",en:"Philippines",nl:"Filipijnen"},{cc:"PLW",en:"Palau",nl:"Palau"},{cc:"PNG",en:"Papua New Guinea",nl:"Papoea-Nieuw-Guinea"},{cc:"POL",en:"Poland",nl:"Polen"},{cc:"PRI",en:"Puerto Rico",nl:"Puerto Rico"},{cc:"PRK",en:"Korea, Democratic People's Republic of",nl:"Noord-Korea"},{cc:"PRT",en:"Portugal",nl:"Portugal"},{cc:"PRY",en:"Paraguay",nl:"Paraguay"},{cc:"PSE",en:"Palestine, State of",nl:"Palestina"},{cc:"PYF",en:"French Polynesia",nl:"Frans-Polynesi"},{cc:"QAT",en:"Qatar",nl:"Qatar"},{cc:"REU",en:"Runion",nl:"Runion"},{cc:"ROU",en:"Romania",nl:"Roemeni"},{cc:"RUS",en:"Russian Federation",nl:"Rusland"},{cc:"RWA",en:"Rwanda",nl:"Rwanda"},{cc:"SAU",en:"Saudi Arabia",nl:"Saoedi-Arabi"},{cc:"SDN",en:"Sudan",nl:"Soedan"},{cc:"SEN",en:"Senegal",nl:"Senegal"},{cc:"SGP",en:"Singapore",nl:"Singapore"},{cc:"SGS",en:"South Georgia and the South Sandwich Islands",nl:"Zuid-Georgia en de Zuidelijke Sandwicheilanden"},{cc:"SHN",en:"Saint Helena, Ascension and Tristan da Cunha",nl:"Sint-Helena, Ascension en Tristan da Cunha"},{cc:"SJM",en:"Svalbard and Jan Mayen",nl:"Spitsbergen en Jan Mayen"},{cc:"SLB",en:"Solomon Islands",nl:"Salomonseilanden"},{cc:"SLE",en:"Sierra Leone",nl:"Sierra Leone"},{cc:"SLV",en:"El Salvador",nl:"El Salvador"},{cc:"SMR",en:"San Marino",nl:"San Marino"},{cc:"SOM",en:"Somalia",nl:"Somali"},{cc:"SPM",en:"Saint Pierre and Miquelon",nl:"Saint-Pierre en Miquelon"},{cc:"SRB",en:"Serbia",nl:"Servi"},{cc:"SSD",en:"South Sudan",nl:"Zuid-Soedan"},{cc:"STP",en:"Sao Tome and Principe",nl:"Sao Tom en Principe"},{cc:"SUR",en:"Suriname",nl:"Suriname"},{cc:"SVK",en:"Slovakia",nl:"Slowakije"},{cc:"SVN",en:"Slovenia",nl:"Sloveni"},{cc:"SWE",en:"Sweden",nl:"Zweden"},{cc:"SWZ",en:"Swaziland",nl:"Swaziland"},{cc:"SXM",en:"Sint Maarten (Dutch part)",nl:"Sint Maarten"},{cc:"SYC",en:"Seychelles",nl:"Seychellen"},{cc:"SYR",en:"Syrian Arab Republic",nl:"Syri"},{cc:"TCA",en:"Turks and Caicos Islands",nl:"Turks- en Caicoseilanden"},{cc:"TCD",en:"Chad",nl:"Tsjaad"},{cc:"TGO",en:"Togo",nl:"Togo"},{cc:"THA",en:"Thailand",nl:"Thailand"},{cc:"TJK",en:"Tajikistan",nl:"Tadzjikistan"},{cc:"TKL",en:"Tokelau",nl:"Tokelau"},{cc:"TKM",en:"Turkmenistan",nl:"Turkmenistan"},{cc:"TLS",en:"Timor-Leste",nl:"Oost-Timor"},{cc:"TON",en:"Tonga",nl:"Tonga"},{cc:"TTO",en:"Trinidad and Tobago",nl:"Trinidad en Tobago"},{cc:"TUN",en:"Tunisia",nl:"Tunesi"},{cc:"TUR",en:"Turkey",nl:"Turkije"},{cc:"TUV",en:"Tuvalu",nl:"Tuvalu"},{cc:"TWN",en:"Taiwan, Province of China",nl:"Taiwan"},{cc:"TZA",en:"Tanzania, United Republic of",nl:"Tanzania"},{cc:"UGA",en:"Uganda",nl:"Oeganda"},{cc:"UKR",en:"Ukraine",nl:"Oekrane"},{cc:"UMI",en:"United States Minor Outlying Islands",nl:"Kleine Pacifische eilanden van de Verenigde Staten"},{cc:"URY",en:"Uruguay",nl:"Uruguay"},{cc:"USA",en:"United States",nl:"Verenigde Staten"},{cc:"UZB",en:"Uzbekistan",nl:"Oezbekistan"},{cc:"VAT",en:"Holy See (Vatican City State)",nl:"Vaticaanstad"},{cc:"VCT",en:"Saint Vincent and the Grenadines",nl:"Saint Vincent en de Grenadines"},{cc:"VEN",en:"Venezuela, Bolivarian Republic of",nl:"Venezuela"},{cc:"VGB",en:"Virgin Islands, British",nl:"Britse Maagdeneilanden"},{cc:"VIR",en:"Virgin Islands, U.S.",nl:"Amerikaanse Maagdeneilanden"},{cc:"VNM",en:"Viet Nam",nl:"Vietnam"},{cc:"VUT",en:"Vanuatu",nl:"Vanuatu"},{cc:"WLF",en:"Wallis and Futuna",nl:"Wallis en Futuna"},{cc:"WSM",en:"Samoa",nl:"Samoa"},{cc:"YEM",en:"Yemen",nl:"Jemen"},{cc:"ZAF",en:"South Africa",nl:"Zuid-Afrika"},{cc:"ZMB",en:"Zambia",nl:"Zambia"},{cc:"ZWE",en:"Zimbabwe",nl:"Zimbabwe"}]}})}),define("text!DATAATLAS/plugins/popups/popups.html",[],function(){return'<div id="data-atlas-popup">\n\n  <!-- Header row. -->\n  <% if (headerRow) { %>\n    <header class="<%= headerClass %>">\n      <h3><%= headerRow.value %></h3>\n    </header>\n  <% } %>\n\n  <!-- All additional fields. -->\n  <% if (rows.length > 0) { %><section class="fields"><% } %>\n  <% _.each(rows, function(row) { %>\n    <div class="record">\n      <label><%= row.fieldName %></label>\n      <div class="field-value"><%= row.value %></div>\n    </div>\n  <% }); %>\n  <% if (rows.length > 0) { %></section><% } %>\n\n  <!-- Currently selected field for this country. -->\n  <section class="current-value">\n    <label><%= activeField %></label>\n    <div class="field-value"><%= value %> <%= units %></div>\n  </section>\n\n</div>'}),define("DATAATLAS/plugins/popups/popups",["backbone","jquery","underscore","d3","DATAATLAS/plugins/dataatlas_plugin","DATAATLAS/models/country_translations_model","text!DATAATLAS/plugins/popups/popups.html"],function(e,t,n,r,i,s,o){return i.extend({fields:[],template:function(){return""},initialize:function(e){n.bindAll(this,"mouseOver","mouseOut"),this.translations=new s,e.fields.length>0&&(this.fields=e.fields.split(",")),e.fields==[""]&&(this.channel=e.channel),this.container=e.container,this.header=e.header,this.units=e.units,this.config=e.config,this.header=="none"&&(this.header=!1),i.prototype.initialize(arguments[0]),this.channel.vent.on("DATA_ATLAS:VISUAL_FINISHED",this.registerEvents,this)},onDestroy:function(){console.log("destroy popup")},onShow:function(){var e=this,n={x:20,y:0};t(document).on("mousemove",function(t){e.$el.offset({top:t.pageY+n.y,left:t.pageX+n.x})})},checkField:function(e){return!n.isNull(e)&&!n.isUndefined(e)&&!n.isNaN(e)},mouseOver:function(e){var t=this;if(!e||!e.properties[this.config.keyProperty])return;var r=e.properties[this.config.keyProperty],i=this.dataset.get("activeSet"),s=i[r],u=[],a=this.dataset.getRecordForCountry(r);n.each(this.fields,function(e){var n=t.dataset.getFieldType(e);u.push({fieldName:e,value:n=="countrycode"?t.translations.getTranslation(a[e],t.lang):a[e],hideName:n=="countrycode"})});var f=this.header?u.shift():!1,l={activeField:this.dataset.get("activeField"),value:this.checkField(s)?s:"",rows:u,headerRow:f,headerClass:this.header,units:this.units};this.$el.html(n.template(o,l)),this.$el.show()},mouseOut:function(e){this.$el.hide()},registerEvents:function(){this.dataset=this.channel.reqres.request("DATA_ATLAS:GET_DATASET"),r.select(this.container).selectAll(".with-data").on("mouseover",this.mouseOver).on("mouseout",this.mouseOut)}})}),define("text!DATAATLAS/templates/map_controls.html",[],function(){return'<div class="leaflet-control-container">\n  <div class="leaflet-top leaflet-left">\n    <div class="leaflet-control-zoom leaflet-bar leaflet-control">\n      <a class="mapbox-icon leaflet-control-zoom-in" href="#" title="Zoom in">+</a>\n      <a class="mapbox-icon leaflet-control-zoom-out" href="#" title="Zoom out">-</a>\n    </div>\n    <div class="leaflet-control-fullscreen leaflet-bar leaflet-control">\n      <a href="#" class="leaflet-control-zoom-fullscreen mapbox-icon mapbox-button-icon map-control-fullscreen"></a>\n    </div>\n  </div>\n</div>'}),define("DATAATLAS/views/map_controls",["backbone.marionette","communicator","text!DATAATLAS/templates/map_controls.html"],function(e,t,n){return e.ItemView.extend({template:n,events:{"click .leaflet-control-zoom-in":"zoomIn","click .leaflet-control-zoom-out":"zoomOut","click .map-control-fullscreen":"fullscreen"},initialize:function(e){function t(){var e=navigator.userAgent.toLowerCase();return e.indexOf("msie")!=-1?parseInt(e.split("msie")[1]):!1}this.channel=e.channel,t()&&$(".map-control-fullscreen",this.$el).hide()},zoomIn:function(e){e.stopPropagation(),e.preventDefault(),this.channel.vent.trigger("DATA_ATLAS:ZOOM_IN")},zoomOut:function(e){e.stopPropagation(),e.preventDefault(),this.channel.vent.trigger("DATA_ATLAS:ZOOM_OUT")},fullscreen:function(e){e.stopPropagation(),e.preventDefault(),this.channel.vent.trigger("DATA_ATLAS:FULLSCREEN_REQUESTED")}})}),define("DATAATLAS/models/dataset_map_model",["backbone","d3","REM/recline-extensions/backend/backend.extensions.csv"],function(e,t){return e.Model.extend({max:null,min:null,manualMax:!1,manualMin:!1,initialize:function(e){this.columns=e.fields,this.rows=e.records,this.channel=e.channel,this.keyField=e.keyField||!1,_.isNaN(Number(e.minValue))||(this.min=Number(e.minValue),this.set("min",this.min),this.manualMin=!0),_.isNaN(Number(e.maxValue))||(this.max=Number(e.maxValue),this.set("max",this.max),this.manualMax=!0),!this.manualMin&&!this.manualMax&&this.calculateDomain(),this._updateActiveColumn(),e.channel.vent.on("DATA_ATLAS:CHANGE_ACTIVE_COLUMN",this._updateActiveColumn,this)},calculateDomain:function(e){var n=_.where(this.get("fields"),{type:"integer"}),r=_.pluck(n,"id");if(_.isNull(this.min)||e===!0)this.min=t.min(this.rows,function(e){return _.min(_.pick(e,r))}),this.set("min",this.min);if(_.isNull(this.max)||e===!0)this.max=t.max(this.rows,function(e){return _.max(_.pick(e,r))}),this.set("max",this.max)},getKeyField:function(){if(this.keyField)return this.keyField;this.keyField=this.getFirstFieldOfType("countrycode")},getFirstFieldOfType:function(e){var t=_.findWhere(this.get("fields"),{type:e});if(!t)throw"No "+e+" was defined.";return t.id},getFieldType:function(e){var t=_.findWhere(this.get("fields"),{id:e});return t.type},getRecordForCountry:function(e){var t={};return t[this.getKeyField()]=e,_.findWhere(this.get("records"),t)},_updateActiveColumn:function(e){if(!e)return;var t=this.getKeyField();this.set("activeField",e),console.log("setting active column to "+e);var n=e||2e3,r={};for(var i=0;i<this.rows.length;i++)_.isFunction(this.rows[i].get)?r[this.rows[i].get(t)]=this.rows[i].get(n):r[this.rows[i][t]]=this.rows[i][n];this.set("activeSet",r),this.channel.vent.trigger("DATA_ATLAS:ACTIVE_COLUMN_CHANGED")}})}),define("DATAATLAS/views/dataworld_map",["backbone.marionette","jquery","q","REM/recline-extensions/recline-extensions-amd","numeral","DATAATLAS/config/localizations","DATAATLAS/views/map_layout","DATAATLAS/plugins/timeline/timeline","DATAATLAS/plugins/popups/popups","DATAATLAS/views/map_controls","DATAATLAS/models/dataset_map_model"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";return e.ItemView.extend({container:null,dataset:null,defaults:{centerPoint:{lng:11.93,lat:7.984,zoom:1.88},countryLabels:!1,domainMin:null,domainMax:null,fields:[],keyField:"Country Code",keyProperty:"iso_a3",landShadow:!1,language:"nl",leaflet:!1,legend:!0,manualDomain:!1,outlierMaxColor:"#ffcc00",outlierMinColor:"#33ccff",popups:!0,popupsHeader:"oranje",popupsFields:"",projection:"robinson",rotate:[0,0,0],roundValues:!0,scale:90,shapefile:"../data/geojson/world-m.topojson",shapefileFeature:"world",showOutliersInLegend:!0,scheme:"purple_10",timeline:!0,timelineFields:[],valueLabel:"",units:"",disablePanZoom:!0,zoomControls:!0,zoomMin:1,zoomMax:32,zoomWithMouse:!0},initialize:function(n){var r=this;this.container=n.container;var i=t("<div></div>").appendTo(this.container);this.setElement(i[0]),this.reclineDataset=n.dataset,_.isUndefined(window.Drupal)||(this.defaults.shapefile=Drupal.settings.totalvis.shapefile),this._id=n.id,this.channel=n.channel,this.channel.vent.on("config-refresh",this.refreshVisual,this),this.channel.vent.on("all",function(e){}),this.channel.reqres.setHandler("DATA_ATLAS:GET_CURRENT_POSITION",function(){return r.map.getCurrentCenter()}),this.channel.reqres.setHandler("DATA_ATLAS:GET_DATASET",function(){return r.dataset}),this.channel.reqres.setHandler("DATA_ATLAS:GET_CONFIGURATION",function(){return r.configureVisual()}),this.channel.vent.on("DATA_ATLAS:COUNTRY_DRAW_FINISHED",this.initializePlugins,this),this.channel.vent.on("DATA_ATLAS:VISUAL_FINISHED",function(){if(_.isFunction(r.getLegend)){var t=e.ItemView.extend({template:r.getLegend});r.layout.legend.show(new t)}_.isFunction(r.setLegendBehavior)&&r.setLegendBehavior(r.layout.legend.$el),r.config.legend||(console.log("hiding legend"),r.layout.legend.$el.hide())})},onDestroy:function(){console.log("destroying map"),this.channel.vent.off()},initializePlugins:function(){var e=this,t;this.pluginConfig={container:this.el,channel:e.channel,language:e.config.language,config:e.config,layout:e.layout,visual:e};if(e.config.timeline)t=_.clone(this.pluginConfig),t.columns=e.config.timelineFields,e.layout.timeline.show(new u(t));else{var n=e.config.timelineFields[e.config.timelineFields.length-1];console.log("no timeline, assuming "+n),e.channel.vent.trigger("DATA_ATLAS:CHANGE_ACTIVE_COLUMN",n)}!e.config.disablePanZoom&&e.config.zoomControls&&e.layout.controls.show(new f({channel:e.channel})),e.config.popups&&(t=_.clone(this.pluginConfig),t.fields=e.config.popupsFields,t.header=e.config.popupsHeader,t.units=e.config.units,e.layout.popup.show(new a(t)))},configureVisual:function(){window.dataAtlas.configurationDefaults=this.defaults;var e={};return _.isObject(window.dataAtlas)&&window.dataAtlas.configurationOverrides&&(e=window.dataAtlas.configurationOverrides),e=_.extend({},e,this.channel.reqres.request("visual-configuration")),this.config=_.extend({},this.defaults,e),i.language(this.config.language,s.getLocalization(this.config.language)),i.language(this.config.language),this.config},_generate:function(e){this.$el.addClass("dataworld-container dataworld-map");var t=e.records.toJSON().slice();_.isUndefined(t[0].attributes)||_.each(t,function(e,n){t[n]=e.attributes});var n=e.fields.toJSON().slice();_.isUndefined(n[0].attributes)||_.each(n,function(e,t){n[t]=e.attributes});var r={fields:n,records:t,channel:this.channel,keyField:this.config.keyField};this.config.manualDomain&&(_.isNull(this.config.domainMin)||(r.minValue=this.config.domainMin),_.isNull(this.config.domainMax)||(r.maxValue=this.config.domainMax)),this.dataset=new l(r)},getUnitString:function(){return this.config.unit?this.config.units:""},localizeNumber:function(e){var t=i(e).format();return _.isNaN(t)||t=="NaN"?"":t},refreshVisual:function(e){_.isObject(e)&&(this.config=_.extend({},this.defaults,e)),this._generate()},render:function(){var e=this;this.$el.empty(),this.layout=new o({el:this.el}),this.$el.append(this.layout.el),this.layout.render(),this.shapefileDrawn=n.defer(),e.channel.vent.off("DATA_ATLAS:ACTIVE_COLUMN_CHANGED",e.colorizeMap,e),this.reclineDataset.fetch().done(function(t){e.setDefaults(t),e.configureVisual(),e._generate(t),e.channel.vent.trigger("DATA_ATLAS:DATASET_FETCHED",t)})},setDefaults:function(e){var t=e.fields.filter(function(e){var t=e.get("type");return t=="number"||t=="integer"});_.extend(this.defaults,{fields:e.fields.pluck("id"),timelineFields:_.pluck(t,"id")})}})}),!function(){function t(e,t){function u(t){var n=e.arcs[t<0?~t:t],r=n[0],i;return e.transform?(i=[0,0],n.forEach(function(e){i[0]+=e[0],i[1]+=e[1]})):i=n[n.length-1],t<0?[i,r]:[r,i]}function a(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach(function(e){n[e<0?~e:e]=1}),s.push(i)}}var n={},r={},i={},s=[],o=-1;return t.forEach(function(n,r){var i=e.arcs[n<0?~n:n],s;i.length<3&&!i[1][0]&&!i[1][1]&&(s=t[++o],t[o]=n,t[r]=s)}),t.forEach(function(e){var t=u(e),n=t[0],s=t[1],o,a;if(o=i[n]){delete i[o.end],o.push(e),o.end=s;if(a=r[s]){delete r[a.start];var f=a===o?o:o.concat(a);r[f.start=o.start]=i[f.end=a.end]=f}else r[o.start]=i[o.end]=o}else if(o=r[s]){delete r[o.start],o.unshift(e),o.start=n;if(a=i[n]){delete i[a.end];var l=a===o?o:a.concat(o);r[l.start=a.start]=i[l.end=o.end]=l}else r[o.start]=i[o.end]=o}else o=[e],r[o.start=n]=i[o.end=s]=o}),a(i,r),a(r,i),t.forEach(function(e){n[e<0?~e:e]||s.push([e])}),s}function r(e,n,r){var i=[];if(arguments.length>1){var s=[],o;function u(e){var t=e<0?~e:e;(s[t]||(s[t]=[])).push({i:e,g:o})}function a(e){e.forEach(u)}function f(e){e.forEach(a)}function l(e){e.type==="GeometryCollection"?e.geometries.forEach(l):e.type in c&&(o=e,c[e.type](e.arcs))}var c={LineString:a,MultiLineString:f,Polygon:f,MultiPolygon:function(e){e.forEach(f)}};l(n),s.forEach(arguments.length<3?function(e){i.push(e[0].i)}:function(e){r(e[0].g,e[e.length-1].g)&&i.push(e[0].i)})}else for(var h=0,p=e.arcs.length;h<p;++h)i.push(h);return{type:"MultiLineString",arcs:t(e,i)}}function i(e,r){function a(e){e.forEach(function(t){t.forEach(function(t){(i[t=t<0?~t:t]||(i[t]=[])).push(e)})}),s.push(e)}function f(t){return h(u(e,{type:"Polygon",arcs:[t]}).coordinates[0])>0}var i={},s=[],o=[];return r.forEach(function(e){e.type==="Polygon"?a(e.arcs):e.type==="MultiPolygon"&&e.arcs.forEach(a)}),s.forEach(function(e){if(!e._){var t=[],n=[e];e._=1,o.push(t);while(e=n.pop())t.push(e),e.forEach(function(e){e.forEach(function(e){i[e<0?~e:e].forEach(function(e){e._||(e._=1,n.push(e))})})})}}),s.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:o.map(function(r){var s=[];r.forEach(function(e){e.forEach(function(e){e.forEach(function(e){i[e<0?~e:e].length<2&&s.push(e)})})}),s=t(e,s);if((n=s.length)>1){var o=f(r[0][0]);for(var u=0,a;u<n;++u)if(o===f(s[u])){a=s[0],s[0]=s[u],s[u]=a;break}}return s})}}function s(e,t){return t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(t){return o(e,t)})}:o(e,t)}function o(e,t){var n={type:"Feature",id:t.id,properties:t.properties||{},geometry:u(e,t)};return t.id==null&&delete n.id,n}function u(e,t){function i(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],s=0,o=i.length,u;s<o;++s)t.push(u=i[s].slice()),n(u,s);e<0&&a(t,o)}function s(e){return e=e.slice(),n(e,0),e}function o(e){var t=[];for(var n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0].slice()),t}function u(e){var t=o(e);while(t.length<4)t.push(t[0].slice());return t}function f(e){return e.map(u)}function l(e){var t=e.type;return t==="GeometryCollection"?{type:t,geometries:e.geometries.map(l)}:t in c?{type:t,coordinates:c[t](e)}:null}var n=m(e.transform),r=e.arcs,c={Point:function(e){return s(e.coordinates)},MultiPoint:function(e){return e.coordinates.map(s)},LineString:function(e){return o(e.arcs)},MultiLineString:function(e){return e.arcs.map(o)},Polygon:function(e){return f(e.arcs)},MultiPolygon:function(e){return e.arcs.map(f)}};return l(t)}function a(e,t){var n,r=e.length,i=r-t;while(i<--r)n=e[i],e[i++]=e[r],e[r]=n}function f(e,t){var n=0,r=e.length;while(n<r){var i=n+r>>>1;e[i]<t?n=i+1:r=i}return n}function l(e){function r(e,n){e.forEach(function(e){e<0&&(e=~e);var r=t[e];r?r.push(n):t[e]=[n]})}function i(e,t){e.forEach(function(e){r(e,t)})}function s(e,t){e.type==="GeometryCollection"?e.geometries.forEach(function(e){s(e,t)}):e.type in o&&o[e.type](e.arcs,t)}var t={},n=e.map(function(){return[]}),o={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(e,t){e.forEach(function(e){i(e,t)})}};e.forEach(s);for(var u in t)for(var a=t[u],l=a.length,c=0;c<l;++c)for(var h=c+1;h<l;++h){var p=a[c],d=a[h],v;(v=n[p])[u=f(v,d)]!==d&&v.splice(u,0,d),(v=n[d])[u=f(v,p)]!==p&&v.splice(u,0,p)}return n}function c(e,t){function s(e){i.remove(e),e[1][2]=t(e),i.push(e)}var n=m(e.transform),r=g(e.transform),i=v();return t||(t=p),e.arcs.forEach(function(e){var o=[],u=0,a;for(var f=0,l=e.length,c;f<l;++f)c=e[f],n(e[f]=[c[0],c[1],Infinity],f);for(var f=1,l=e.length-1;f<l;++f)a=e.slice(f-1,f+2),a[1][2]=t(a),o.push(a),i.push(a);for(var f=0,l=o.length;f<l;++f)a=o[f],a.previous=o[f-1],a.next=o[f+1];while(a=i.pop()){var h=a.previous,p=a.next;a[1][2]<u?a[1][2]=u:u=a[1][2],h&&(h.next=p,h[2]=a[2],s(h)),p&&(p.previous=h,p[0]=a[0],s(p))}e.forEach(r)}),e}function h(e){var t=-1,n=e.length,r,i=e[n-1],s=0;while(++t<n)r=i,i=e[t],s+=r[0]*i[1]-r[1]*i[0];return s*.5}function p(e){var t=e[0],n=e[1],r=e[2];return Math.abs((t[0]-r[0])*(n[1]-t[1])-(t[0]-n[0])*(r[1]-t[1]))}function d(e,t){return e[1][2]-t[1][2]}function v(){function r(e,n){while(n>0){var r=(n+1>>1)-1,i=t[r];if(d(e,i)>=0)break;t[i._=n]=i,t[e._=n=r]=e}}function i(e,r){for(;;){var i=r+1<<1,s=i-1,o=r,u=t[o];s<n&&d(t[s],u)<0&&(u=t[o=s]),i<n&&d(t[i],u)<0&&(u=t[o=i]);if(o===r)break;t[u._=r]=u,t[e._=r=o]=e}}var e={},t=[],n=0;return e.push=function(e){return r(t[e._=n]=e,n++),n},e.pop=function(){if(n<=0)return;var e=t[0],r;return--n>0&&(r=t[n],i(t[r._=0]=r,0)),e},e.remove=function(e){var s=e._,o;if(t[s]!==e)return;return s!==--n&&(o=t[n],(d(o,e)<0?r:i)(t[o._=s]=o,s)),s},e}function m(e){if(!e)return y;var t,n,r=e.scale[0],i=e.scale[1],s=e.translate[0],o=e.translate[1];return function(e,u){u||(t=n=0),e[0]=(t+=e[0])*r+s,e[1]=(n+=e[1])*i+o}}function g(e){if(!e)return y;var t,n,r=e.scale[0],i=e.scale[1],s=e.translate[0],o=e.translate[1];return function(e,u){u||(t=n=0);var a=(e[0]-s)/r|0,f=(e[1]-o)/i|0;e[0]=a-t,e[1]=f-n,t=a,n=f}}function y(){}var e={version:"1.6.18",mesh:function(e){return u(e,r.apply(this,arguments))},meshArcs:r,merge:function(e){return u(e,i.apply(this,arguments))},mergeArcs:i,feature:s,neighbors:l,presimplify:c};typeof define=="function"&&define.amd?define("topojson",e):typeof module=="object"&&module.exports?module.exports=e:this.topojson=e}(),function(){"use strict";var e=typeof module!="undefined"&&module.exports,t=typeof Element!="undefined"&&"ALLOW_KEYBOARD_INPUT"in Element,n=function(){var e,t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,i=n.length,s={};for(;r<i;r++){e=n[r];if(e&&e[1]in document){for(r=0,t=e.length;r<t;r++)s[n[0][r]]=e[r];return s}}return!1}(),r={request:function(e){var r=n.requestFullscreen;e=e||document.documentElement,/5\.1[\.\d]* Safari/.test(navigator.userAgent)?e[r]():e[r](t&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[n.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},onchange:function(){},onerror:function(){},raw:n};if(!n){e?module.exports=!1:window.screenfull=!1;return}Object.defineProperties(r,{isFullscreen:{get:function(){return!!document[n.fullscreenElement]}},element:{enumerable:!0,get:function(){return document[n.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!document[n.fullscreenEnabled]}}}),document.addEventListener(n.fullscreenchange,function(e){r.onchange.call(r,e)}),document.addEventListener(n.fullscreenerror,function(e){r.onerror.call(r,e)}),e?module.exports=r:window.screenfull=r}(),define("screenfull",function(e){return function(){var t,n;return t||e.screenfull}}(this)),define("d3.global",["d3"],function(e){return d3=e,d3}),!function(){function e(e,n){return{type:"Feature",id:e.id,properties:e.properties,geometry:t(e.geometry,n)}}function t(e,n){if(!e)return null;if("GeometryCollection"===e.type)return{type:"GeometryCollection",geometries:object.geometries.map(function(e){return t(e,n)})};if(!pn.hasOwnProperty(e.type))return null;var r=pn[e.type];return d3.geo.stream(e,n(r)),r.result()}function n(){}function r(e){if((t=e.length)<4)return!1;for(var t,n=0,r=e[t-1][1]*e[0][0]-e[t-1][0]*e[0][1];++n<t;)r+=e[n-1][1]*e[n][0]-e[n-1][0]*e[n][1];return 0>=r}function i(e,t){for(var n=t[0],r=t[1],i=!1,s=0,o=e.length,u=o-1;o>s;u=s++){var a=e[s],f=a[0],l=a[1],c=e[u],h=c[0],p=c[1];l>r^p>r&&(h-f)*(r-l)/(p-l)+f>n&&(i=!i)}return i}function s(e){return e?e/Math.sin(e):1}function o(e){return e>0?1:0>e?-1:0}function u(e){return e>1?gn:-1>e?-gn:Math.asin(e)}function a(e){return e>1?0:-1>e?mn:Math.acos(e)}function f(e){return e>0?Math.sqrt(e):0}function l(e){function t(e,t){var n=Math.cos(e),i=Math.cos(t),s=Math.sin(t),o=i*n,u=-((1-o?Math.log(.5*(1+o))/(1-o):-0.5)+r/(1+o));return[u*i*Math.sin(e),u*s]}var n=Math.tan(.5*e),r=2*Math.log(Math.cos(.5*e))/(n*n);return t.invert=function(t,n){var i,s=Math.sqrt(t*t+n*n),o=e*-0.5,a=50;if(!s)return[0,0];do{var f=.5*o,l=Math.cos(f),c=Math.sin(f),h=Math.tan(f),p=Math.log(1/l);o-=i=(2/h*p-r*h-s)/(-p/(c*c)+1-r/(2*l*l))}while(Math.abs(i)>dn&&--a>0);var d=Math.sin(o);return[Math.atan2(t*d,s*Math.cos(o)),u(n*d/s)]},t}function c(){var e=gn,t=Sn(l),n=t(e);return n.radius=function(n){return arguments.length?t(e=n*mn/180):e/mn*180},n}function h(e,t){var n=Math.cos(t),r=s(a(n*Math.cos(e/=2)));return[2*n*Math.sin(e)*r,Math.sin(t)*r]}function p(e){function t(e,t){var u=Math.cos(t),a=Math.cos(e/=2);return[(1+u)*Math.sin(e),(i*t>-Math.atan2(a,s)-.001?0:10*-i)+o+Math.sin(t)*r-(1+u)*n*a]}var n=Math.sin(e),r=Math.cos(e),i=e>0?1:-1,s=Math.tan(i*e),o=(1+n-r)/2;return t.invert=function(e,t){var u=0,a=0,f=50;do{var l=Math.cos(u),c=Math.sin(u),h=Math.cos(a),p=Math.sin(a),d=1+h,v=d*c-e,m=o+p*r-d*n*l-t,g=.5*d*l,y=-c*p,b=.5*n*d*c,w=r*h+n*l*p,E=y*b-w*g,S=.5*(m*y-v*w)/E,x=(v*b-m*g)/E;u-=S,a-=x}while((Math.abs(S)>dn||Math.abs(x)>dn)&&--f>0);return i*a>-Math.atan2(Math.cos(u),s)-.001?[2*u,a]:null},t}function d(){var e=mn/9,t=e>0?1:-1,n=Math.tan(t*e),r=Sn(p),i=r(e),s=i.stream;return i.parallel=function(i){return arguments.length?(n=Math.tan((t=(e=i*mn/180)>0?1:-1)*e),r(e)):e/mn*180},i.stream=function(r){var o=i.rotate(),u=s(r),a=(i.rotate([0,0]),s(r));return i.rotate(o),u.sphere=function(){a.polygonStart(),a.lineStart();for(var r=-180*t;180>t*r;r+=90*t)a.point(r,90*t);for(;t*(r-=e)>=-180;)a.point(r,t*-Math.atan2(Math.cos(r*bn/2),n)*wn);a.lineEnd(),a.polygonEnd()},u},i}function v(e){return e=Math.exp(2*e),(e-1)/(e+1)}function m(e){return.5*(Math.exp(e)-Math.exp(-e))}function g(e){return.5*(Math.exp(e)+Math.exp(-e))}function y(e){return Math.log(e+f(e*e+1))}function b(e){return Math.log(e+f(e*e-1))}function w(e,t){var n=Math.tan(t/2),r=f(1-n*n),i=1+r*Math.cos(e/=2),s=Math.sin(e)*r/i,o=n/i,u=s*s,a=o*o;return[4/3*s*(3+u-3*a),4/3*o*(3+3*u-a)]}function E(e,t){var n=Math.abs(t);return mn/4>n?[e,Math.log(Math.tan(mn/4+t/2))]:[e*Math.cos(n)*(2*Math.SQRT2-1/Math.sin(n)),o(t)*(2*Math.SQRT2*(n-mn/4)-Math.log(Math.tan(n/2)))]}function S(e){function t(e,t){var r=Tn(e,t);if(Math.abs(e)>gn){var i=Math.atan2(r[1],r[0]),s=Math.sqrt(r[0]*r[0]+r[1]*r[1]),o=n*Math.round((i-gn)/n)+gn,a=Math.atan2(Math.sin(i-=o),2-Math.cos(i));i=o+u(mn/s*Math.sin(a))-a,r[0]=s*Math.cos(i),r[1]=s*Math.sin(i)}return r}var n=2*mn/e;return t.invert=function(e,t){var r=Math.sqrt(e*e+t*t);if(r>gn){var i=Math.atan2(t,e),s=n*Math.round((i-gn)/n)+gn,o=i>s?-1:1,u=r*Math.cos(s-i),a=1/Math.tan(o*Math.acos((u-mn)/Math.sqrt(mn*(mn-2*u)+r*r)));i=s+2*Math.atan((a+o*Math.sqrt(a*a-3))/3),e=r*Math.cos(i),t=r*Math.sin(i)}return Tn.invert(e,t)},t}function x(){var e=5,t=Sn(S),n=t(e),r=n.stream,i=.01,s=-Math.cos(i*bn),o=Math.sin(i*bn);return n.lobes=function(n){return arguments.length?t(e=+n):e},n.stream=function(t){var a=n.rotate(),f=r(t),l=(n.rotate([0,0]),r(t));return n.rotate(a),f.sphere=function(){l.polygonStart(),l.lineStart();for(var t=0,n=360/e,r=2*mn/e,a=90-180/e,f=gn;e>t;++t,a-=n,f-=r)l.point(Math.atan2(o*Math.cos(f),s)*wn,u(o*Math.sin(f))*wn),-90>a?(l.point(-90,-180-a-i),l.point(-90,-180-a+i)):(l.point(90,a+i),l.point(90,a-i));l.lineEnd(),l.polygonEnd()},f},n}function T(e){return function(t){var n,r=e*Math.sin(t),i=30;do t-=n=(t+Math.sin(t)-r)/(1+Math.cos(t));while(Math.abs(n)>dn&&--i>0);return t/2}}function N(e,t,n){function r(n,r){return[e*n*Math.cos(r=i(r)),t*Math.sin(r)]}var i=T(n);return r.invert=function(r,i){var s=u(i/t);return[r/(e*Math.cos(s)),u((2*s+Math.sin(2*s))/n)]},r}function C(e,t){var n=2.00276,r=Nn(t);return[n*e/(1/Math.cos(t)+1.11072/Math.cos(r)),(t+Math.SQRT2*Math.sin(r))/n]}function k(e){var t=0,n=Sn(e),r=n(t);return r.parallel=function(e){return arguments.length?n(t=e*mn/180):t/mn*180},r}function L(e,t){return[e*Math.cos(t),t]}function A(e){function t(t,r){var i=n+e-r,s=i?t*Math.cos(r)/i:i;return[i*Math.sin(s),n-i*Math.cos(s)]}if(!e)return L;var n=1/Math.tan(e);return t.invert=function(t,r){var i=Math.sqrt(t*t+(r=n-r)*r),s=n+e-i;return[i/Math.cos(s)*Math.atan2(t,r),s]},t}function O(e){function t(t,n){for(var r=Math.sin(n),i=Math.cos(n),s=new Array(3),f=0;3>f;++f){var l=e[f];if(s[f]=_(n-l[1],l[3],l[2],i,r,t-l[0]),!s[f][0])return l.point;s[f][1]=P(s[f][1]-l.v[1])}for(var c=a.slice(),f=0;3>f;++f){var h=2==f?0:f+1,p=D(e[f].v[0],s[f][0],s[h][0]);s[f][1]<0&&(p=-p),f?1==f?(p=o-p,c[0]-=s[f][0]*Math.cos(p),c[1]-=s[f][0]*Math.sin(p)):(p=u-p,c[0]+=s[f][0]*Math.cos(p),c[1]+=s[f][0]*Math.sin(p)):(c[0]+=s[f][0]*Math.cos(p),c[1]-=s[f][0]*Math.sin(p))}return c[0]/=3,c[1]/=3,c}e=e.map(function(e){return[e[0],e[1],Math.sin(e[1]),Math.cos(e[1])]});for(var n,r=e[2],i=0;3>i;++i,r=n)n=e[i],r.v=_(n[1]-r[1],r[3],r[2],n[3],n[2],n[0]-r[0]),r.point=[0,0];var s=D(e[0].v[0],e[2].v[0],e[1].v[0]),o=D(e[0].v[0],e[1].v[0],e[2].v[0]),u=mn-s;e[2].point[1]=0,e[0].point[0]=-(e[1].point[0]=.5*e[0].v[0]);var a=[e[2].point[0]=e[0].point[0]+e[2].v[0]*Math.cos(s),2*(e[0].point[1]=e[1].point[1]=e[2].v[0]*Math.sin(s))];return t}function M(){var e=[[0,0],[0,0],[0,0]],t=Sn(O),n=t(e),r=n.rotate;return delete n.rotate,n.points=function(i){if(!arguments.length)return e;e=i;var s=d3.geo.centroid({type:"MultiPoint",coordinates:e}),o=[-s[0],-s[1]];return r.call(n,o),t(e.map(d3.geo.rotation(o)).map(H))},n.points([[-150,55],[-35,55],[-92.5,10]])}function _(e,t,n,r,i,s){var o,f=Math.cos(s);if(Math.abs(e)>1||Math.abs(s)>1)o=a(n*i+t*r*f);else{var l=Math.sin(.5*e),c=Math.sin(.5*s);o=2*u(Math.sqrt(l*l+t*r*c*c))}return Math.abs(o)>dn?[o,Math.atan2(r*Math.sin(s),t*i-n*r*f)]:[0,0]}function D(e,t,n){return a(.5*(e*e+t*t-n*n)/(e*t))}function P(e){return e-2*mn*Math.floor((e+mn)/(2*mn))}function H(e){return[e[0]*bn,e[1]*bn]}function B(e,t){var n=f(1-Math.sin(t));return[2/yn*e*n,yn*(1-n)]}function j(e){function t(e,t){return[e,(e?e/Math.sin(e):1)*(Math.sin(t)*Math.cos(e)-n*Math.cos(t))]}var n=Math.tan(e);return t.invert=n?function(e,t){e&&(t*=Math.sin(e)/e);var r=Math.cos(e);return[e,2*Math.atan2(Math.sqrt(r*r+n*n-t*t)-r,n-t)]}:function(e,t){return[e,u(e?t*Math.tan(e)/e:t)]},t}function F(e,t){var n=Math.sqrt(3);return[n*e*(2*Math.cos(2*t/3)-1)/yn,n*yn*Math.sin(t/3)]}function I(e){function t(e,t){return[e*n,Math.sin(t)/n]}var n=Math.cos(e);return t.invert=function(e,t){return[e/n,u(t*n)]},t}function q(e){function t(e,t){return[e*n,(1+n)*Math.tan(.5*t)]}var n=Math.cos(e);return t.invert=function(e,t){return[e/n,2*Math.atan(t/(1+n))]},t}function R(e,t){var n=Math.sqrt(8/(3*mn));return[n*e*(1-Math.abs(t)/mn),n*t]}function U(e,t){var n=Math.sqrt(4-3*Math.sin(Math.abs(t)));return[2/Math.sqrt(6*mn)*e*n,o(t)*Math.sqrt(2*mn/3)*(2-n)]}function z(e,t){var n=Math.sqrt(mn*(4+mn));return[2/n*e*(1+Math.sqrt(1-4*t*t/(mn*mn))),4/n*t]}function W(e,t){var n=(2+gn)*Math.sin(t);t/=2;for(var r=0,i=1/0;10>r&&Math.abs(i)>dn;r++){var s=Math.cos(t);t-=i=(t+Math.sin(t)*(s+2)-n)/(2*s*(1+s))}return[2/Math.sqrt(mn*(4+mn))*e*(1+Math.cos(t)),2*Math.sqrt(mn/(4+mn))*Math.sin(t)]}function X(e,t){return[e*(1+Math.cos(t))/Math.sqrt(2+mn),2*t/Math.sqrt(2+mn)]}function V(e,t){for(var n=(1+gn)*Math.sin(t),r=0,i=1/0;10>r&&Math.abs(i)>dn;r++)t-=i=(t+Math.sin(t)-n)/(1+Math.cos(t));return n=Math.sqrt(2+mn),[e*(1+Math.cos(t))/n,2*t/n]}function $(e,t){var n=Math.sin(e/=2),r=Math.cos(e),i=Math.sqrt(Math.cos(t)),s=Math.cos(t/=2),o=Math.sin(t)/(s+Math.SQRT2*r*i),u=Math.sqrt(2/(1+o*o)),a=Math.sqrt((Math.SQRT2*s+(r+n)*i)/(Math.SQRT2*s+(r-n)*i));return[Ln*(u*(a-1/a)-2*Math.log(a)),Ln*(u*o*(a+1/a)-2*Math.atan(o))]}function J(e,t){var n=Math.tan(t/2);return[e*An*f(1-n*n),(1+An)*n]}function K(e,t){var n=t/2,r=Math.cos(n);return[2*e/yn*Math.cos(t)*r*r,yn*Math.tan(n)]}function Q(e,t){function n(t,n){var s=On(t,n),o=s[0],u=s[1],a=o*o+u*u;if(a>i){var f=Math.sqrt(a),l=Math.atan2(u,o),c=r*Math.round(l/r),h=l-c,p=e*Math.cos(h),d=(e*Math.sin(h)-h*Math.sin(p))/(gn-p),v=G(h,d),m=(mn-e)/Z(v,p,mn);o=f;var g,y=50;do o-=g=(e+Z(v,p,o)*m-f)/(v(o)*m);while(Math.abs(g)>dn&&--y>0);u=h*Math.sin(o),gn>o&&(u-=d*(o-gn));var b=Math.sin(c),w=Math.cos(c);s[0]=o*w-u*b,s[1]=o*b+u*w}return s}var r=2*mn/t,i=e*e;return n.invert=function(t,n){var s=t*t+n*n;if(s>i){var o=Math.sqrt(s),u=Math.atan2(n,t),a=r*Math.round(u/r),f=u-a,t=o*Math.cos(f);n=o*Math.sin(f);for(var l=t-gn,c=Math.sin(t),h=n/c,p=gn>t?1/0:0,d=10;;){var v=e*Math.sin(h),m=e*Math.cos(h),g=Math.sin(m),y=gn-m,b=(v-h*g)/y,w=G(h,b);if(Math.abs(p)<vn||!--d)break;h-=p=(h*c-b*l-n)/(c-2*l*(y*(m+h*v*Math.cos(m)-g)-v*(v-h*g))/(y*y))}o=e+Z(w,m,t)*(mn-e)/Z(w,m,mn),u=a+h,t=o*Math.cos(u),n=o*Math.sin(u)}return On.invert(t,n)},n}function G(e,t){return function(n){var r=e*Math.cos(n);return gn>n&&(r-=t),Math.sqrt(1+r*r)}}function Y(){var e=6,t=30*bn,n=Math.cos(t),r=Math.sin(t),i=Sn(Q),s=i(t,e),o=s.stream,u=.01,a=-Math.cos(u*bn),f=Math.sin(u*bn);return s.radius=function(s){return arguments.length?(n=Math.cos(t=s*bn),r=Math.sin(t),i(t,e)):t*wn},s.lobes=function(n){return arguments.length?i(t,e=+n):e},s.stream=function(t){var i=s.rotate(),u=o(t),l=(s.rotate([0,0]),o(t));return s.rotate(i),u.sphere=function(){l.polygonStart(),l.lineStart();for(var t=0,i=2*mn/e,s=0;e>t;++t,s-=i)l.point(Math.atan2(f*Math.cos(s),a)*wn,Math.asin(f*Math.sin(s))*wn),l.point(Math.atan2(r*Math.cos(s-i/2),n)*wn,Math.asin(r*Math.sin(s-i/2))*wn);l.lineEnd(),l.polygonEnd()},u},s}function Z(e,t,n){for(var r=50,i=(n-t)/r,s=e(t)+e(n),o=1,u=t;r>o;++o)s+=2*e(u+=i);return.5*s*i}function et(e,t,n,r,i,s,o,u){function a(a,f){if(!f)return[e*a/mn,0];var l=f*f,c=e+l*(t+l*(n+l*r)),h=f*(i-1+l*(s-u+l*o)),p=(c*c+h*h)/(2*h),d=a*Math.asin(c/p)/mn;return[p*Math.sin(d),f*(1+l*u)+p*(1-Math.cos(d))]}return arguments.length<8&&(u=0),a.invert=function(a,l){var c,h,p=mn*a/e,d=l,v=50;do{var m=d*d,g=e+m*(t+m*(n+m*r)),y=d*(i-1+m*(s-u+m*o)),b=g*g+y*y,w=2*y,E=b/w,S=E*E,x=Math.asin(g/E)/mn,T=p*x;if(xB2=g*g,dxBd=(2*t+m*(4*n+6*m*r))*d,dyBd=i+m*(3*s+5*m*o),dpd=2*(g*dxBd+y*(dyBd-1)),dqd=2*(dyBd-1),dmd=(dpd*w-b*dqd)/(w*w),cos=Math.cos(T),sin=Math.sin(T),mcos=E*cos,msin=E*sin,dd=p/mn*(1/f(1-xB2/S))*(dxBd*E-g*dmd)/S,fx=msin-a,fy=d*(1+m*u)+E-mcos-l,x=dmd*sin+mcos*dd,x=mcos*x,y=1+dmd-(dmd*cos-msin*dd),y=msin*x,denominator=x*y-y*x,!denominator)break;p-=c=(fy*x-fx*y)/denominator,d-=h=(fx*y-fy*x)/denominator}while((Math.abs(c)>dn||Math.abs(h)>dn)&&--v>0);return[p,d]},a}function tt(e,t){var n=e*e,r=t*t;return[e*(1-.162388*r)*(.87-952426e-9*n*n),t*(1+r/12)]}function nt(e){function t(){var e=!1,t=Sn(n),r=t(e);return r.quincuncial=function(n){return arguments.length?t(e=!!n):e},r}function n(t){var n=t?function(t,n){var i=Math.abs(t)<gn,s=e(i?t:t>0?t-mn:t+mn,n),u=(s[0]-s[1])*Math.SQRT1_2,a=(s[0]+s[1])*Math.SQRT1_2;if(i)return[u,a];var f=r*Math.SQRT1_2,l=u>0^a>0?-1:1;return[l*u-o(a)*f,l*a-o(u)*f]}:function(t,n){var i=t>0?-0.5:.5,s=e(t+i*mn,n);return s[0]-=i*r,s};return e.invert&&(n.invert=t?function(t,n){var i=(t+n)*Math.SQRT1_2,s=(n-t)*Math.SQRT1_2,o=Math.abs(i)<.5*r&&Math.abs(s)<.5*r;if(!o){var u=r*Math.SQRT1_2,a=i>0^s>0?-1:1,f=-a*(t+(s>0?1:-1)*u),l=-a*(n+(i>0?1:-1)*u);i=(-f-l)*Math.SQRT1_2,s=(f-l)*Math.SQRT1_2}var c=e.invert(i,s);return o||(c[0]+=i>0?mn:-mn),c}:function(t,n){var i=t>0?-0.5:.5,s=e.invert(t+i*r,n),o=s[0]-i*mn;return-mn>o?o+=2*mn:o>mn&&(o-=2*mn),s[0]=o,s}),n}var r=e(gn,0)[0]-e(-gn,0)[0];return t.raw=n,t}function rt(e,t){var n=o(e),r=o(t),i=Math.cos(t),s=Math.cos(e)*i,a=Math.sin(e)*i,f=Math.sin(r*t);e=Math.abs(Math.atan2(a,f)),t=u(s),Math.abs(e-gn)>dn&&(e%=gn);var l=it(e>mn/4?gn-e:e,t);return e>mn/4&&(f=l[0],l[0]=-l[1],l[1]=-f),l[0]*=n,l[1]*=-r,l}function it(e,t){if(t===gn)return[0,0];var n=Math.sin(t),r=n*n,i=r*r,s=1+i,o=1+3*i,a=1-i,l=u(1/Math.sqrt(s)),c=a+r*s*l,h=(1-n)/c,p=Math.sqrt(h),d=h*s,v=Math.sqrt(d),m=p*a;if(0===e)return[0,-(m+r*v)];var g=Math.cos(t),y=1/g,b=2*n*g,w=(-3*r+l*o)*b,E=(-c*g-(1-n)*w)/(c*c),S=.5*E/p,x=a*S-2*r*p*b,T=r*s*E+h*o*b,N=-y*b,C=-y*T,k=-2*y*x,L=4*e/mn;if(e>.222*mn||mn/4>t&&e>.175*mn){var A=(m+r*f(d*(1+i)-m*m))/(1+i);if(e>mn/4)return[A,A];var O=A,M=.5*A,_=50;A=.5*(M+O);do{var D=Math.sqrt(d-A*A),P=A*(k+N*D)+C*u(A/v)-L;if(!P)break;0>P?M=A:O=A,A=.5*(M+O)}while(Math.abs(O-M)>dn&&--_>0)}else{var H,A=dn,_=25;do{var B=A*A,D=f(d-B),j=k+N*D,P=A*j+C*u(A/v)-L,F=j+(C-N*B)/D;A-=H=D?P/F:0}while(Math.abs(H)>dn&&--_>0)}return[A,-m-r*f(d-A*A)]}function st(e,t){for(var n=0,r=1,i=.5,s=50;;){var o=i*i,u=Math.sqrt(i),a=Math.asin(1/Math.sqrt(1+o)),f=1-o+i*(1+o)*a,l=(1-u)/f,c=Math.sqrt(l),h=l*(1+o),p=c*(1-o),d=h-e*e,v=Math.sqrt(d),m=t+p+i*v;if(Math.abs(r-n)<vn||0===--s||0===m)break;m>0?n=i:r=i,i=.5*(n+r)}if(!s)return null;var g=Math.asin(u),y=Math.cos(g),b=1/y,w=2*u*y,E=(-3*i+a*(1+3*o))*w,S=(-f*y-(1-u)*E)/(f*f),x=.5*S/c,T=(1-o)*x-2*i*c*w,N=-2*b*T,C=-b*w,k=-b*(i*(1+o)*S+l*(1+3*o)*w);return[mn/4*(e*(N+C*v)+k*Math.asin(e/Math.sqrt(h))),g]}function ot(e,t,n){if(!e){var r=ut(t,1-n);return[[0,r[0]/r[1]],[1/r[1],0],[r[2]/r[1],0]]}var i=ut(e,n);if(!t)return[[i[0],0],[i[1],0],[i[2],0]];var r=ut(t,1-n),s=r[1]*r[1]+n*i[0]*i[0]*r[0]*r[0];return[[i[0]*r[2]/s,i[1]*i[2]*r[0]*r[1]/s],[i[1]*r[1]/s,-i[0]*i[2]*r[0]*r[2]/s],[i[2]*r[1]*r[2]/s,-n*i[0]*i[1]*r[0]/s]]}function ut(e,t){var n,r,i,s,o;if(dn>t)return s=Math.sin(e),r=Math.cos(e),n=.25*t*(e-s*r),[s-n*r,r+n*s,1-.5*t*s*s,e-n];if(t>=1-dn)return n=.25*(1-t),r=g(e),s=v(e),i=1/r,o=r*m(e),[s+n*(o-e)/(r*r),i-n*s*i*(o-e),i+n*s*i*(o+e),2*Math.atan(Math.exp(e))-gn+n*(o-e)/r];var a=[1,0,0,0,0,0,0,0,0],l=[Math.sqrt(t),0,0,0,0,0,0,0,0],c=0;for(r=Math.sqrt(1-t),o=1;Math.abs(l[c]/a[c])>dn&&8>c;)n=a[c++],l[c]=.5*(n-r),a[c]=.5*(n+r),r=f(n*r),o*=2;i=o*a[c]*e;do s=l[c]*Math.sin(r=i)/a[c],i=.5*(u(s)+i);while(--c);return[Math.sin(i),s=Math.cos(i),s/Math.cos(i-r),i]}function at(e,t,n){var r=Math.abs(e),i=Math.abs(t),s=m(i);if(r){var u=1/Math.sin(r),a=1/(Math.tan(r)*Math.tan(r)),l=-(a+n*s*s*u*u-1+n),c=(n-1)*a,h=.5*(-l+Math.sqrt(l*l-4*c));return[ft(Math.atan(1/Math.sqrt(h)),n)*o(e),ft(Math.atan(f((h/a-1)/n)),1-n)*o(t)]}return[0,ft(Math.atan(s),1-n)*o(t)]}function ft(e,t){if(!t)return e;if(1===t)return Math.log(Math.tan(e/2+mn/4));for(var n=1,r=Math.sqrt(1-t),i=Math.sqrt(t),s=0;Math.abs(i)>dn;s++){if(e%mn){var o=Math.atan(r*Math.tan(e)/n);0>o&&(o+=mn),e+=o+~~(e/mn)*mn}else e+=e;i=(n+r)/2,r=Math.sqrt(n*r),i=((n=i)-r)/2}return e/(Math.pow(2,s)*n)}function lt(e,t){var n=(Math.SQRT2-1)/(Math.SQRT2+1),r=Math.sqrt(1-n*n),i=ft(gn,r*r),s=-1,o=Math.log(Math.tan(mn/4+Math.abs(t)/2)),u=Math.exp(s*o)/Math.sqrt(n),a=ct(u*Math.cos(s*e),u*Math.sin(s*e)),f=at(a[0],a[1],r*r);return[-f[1],(t>=0?1:-1)*(.5*i-f[0])]}function ct(e,t){var n=e*e,r=t+1,i=1-n-t*t;return[.5*((e>=0?gn:-gn)-Math.atan2(i,2*e)),-0.25*Math.log(i*i+4*n)+.5*Math.log(r*r+n)]}function ht(e,t){var n=t[0]*t[0]+t[1]*t[1];return[(e[0]*t[0]+e[1]*t[1])/n,(e[1]*t[0]-e[0]*t[1])/n]}function pt(e){function t(e,t){var s=i(e,t);e=s[0],t=s[1];var o=Math.sin(t),u=Math.cos(t),f=Math.cos(e),l=a(n*o+r*u*f),c=Math.sin(l),h=Math.abs(c)>dn?l/c:1;return[h*r*Math.sin(e),(Math.abs(e)>gn?h:-h)*(n*u-r*o*f)]}var n=Math.sin(e),r=Math.cos(e),i=dt(e);return i.invert=dt(-e),t.invert=function(e,t){var r=Math.sqrt(e*e+t*t),s=-Math.sin(r),o=Math.cos(r),u=r*o,a=-t*s,l=r*n,c=f(u*u+a*a-l*l),h=Math.atan2(u*l+a*c,a*l-u*c),p=(r>gn?-1:1)*Math.atan2(e*s,r*Math.cos(h)*o+t*Math.sin(h)*s);return i.invert(p,h)},t}function dt(e){var t=Math.sin(e),n=Math.cos(e);return function(e,r){var i=Math.cos(r),s=Math.cos(e)*i,o=Math.sin(e)*i,a=Math.sin(r);return[Math.atan2(o,s*n-a*t),u(a*n+s*t)]}}function vt(){var e=0,t=Sn(pt),n=t(e),r=n.rotate,i=n.stream,s=d3.geo.circle();return n.parallel=function(r){if(!arguments.length)return e/mn*180;var i=n.rotate();return t(e=r*mn/180).rotate(i)},n.rotate=function(t){return arguments.length?(r.call(n,[t[0],t[1]-e/mn*180]),s.origin([-t[0],-t[1]]),n):(t=r.call(n),t[1]+=e/mn*180,t)},n.stream=function(e){return e=i(e),e.sphere=function(){e.polygonStart();var t,n=.01,r=s.angle(90-n)().coordinates[0],i=r.length-1,o=-1;for(e.lineStart();++o<i;)e.point((t=r[o])[0],t[1]);for(e.lineEnd(),r=s.angle(90+n)().coordinates[0],i=r.length-1,e.lineStart();--o>=0;)e.point((t=r[o])[0],t[1]);e.lineEnd(),e.polygonEnd()},e},n}function mt(e,t){function n(n,r){var i=Hn(n/t,r);return i[0]*=e,i}return arguments.length<2&&(t=e),1===t?Hn:1/0===t?yt:(n.invert=function(n,r){var i=Hn.invert(n/e,r);return i[0]*=t,i},n)}function gt(){var e=2,t=Sn(mt),n=t(e);return n.coefficient=function(n){return arguments.length?t(e=+n):e},n}function yt(e,t){return[e*Math.cos(t)/Math.cos(t/=2),2*Math.sin(t)]}function bt(e,t){for(var n,r=Math.sin(t)*(0>t?2.43763:2.67595),i=0;20>i&&(t-=n=(t+Math.sin(t)-r)/(1+Math.cos(t)),!(Math.abs(n)<dn));i++);return[.85*e*Math.cos(t*=.5),Math.sin(t)*(0>t?1.93052:1.75859)]}function wt(e){function t(t,l){var c,h=Math.abs(l);if(h>r){var p=Math.min(e-1,Math.max(0,Math.floor((t+mn)/f)));t+=mn*(e-1)/e-p*f,c=d3.geo.collignon.raw(t,h),c[0]=c[0]*i/s-i*(e-1)/(2*e)+p*i/e,c[1]=o+4*(c[1]-u)*a/i,0>l&&(c[1]=-c[1])}else c=n(t,l);return c[0]/=2,c}var n=d3.geo.cylindricalEqualArea.raw(0),r=Bn*mn/180,i=2*mn,s=d3.geo.collignon.raw(mn,r)[0]-d3.geo.collignon.raw(-mn,r)[0],o=n(0,r)[1],u=d3.geo.collignon.raw(0,r)[1],a=d3.geo.collignon.raw(0,gn)[1]-u,f=2*mn/e;return t.invert=function(t,r){t*=2;var l=Math.abs(r);if(l>o){var c=Math.min(e-1,Math.max(0,Math.floor((t+mn)/f)));t=(t+mn*(e-1)/e-c*f)*s/i;var h=d3.geo.collignon.raw.invert(t,.25*(l-o)*i/a+u);return h[0]-=mn*(e-1)/e-c*f,0>r&&(h[1]=-h[1]),h}return n.invert(t,r)},t}function Et(){function e(){var e=180/t;return{type:"Polygon",coordinates:[d3.range(-180,180+e/2,e).map(function(e,t){return[e,1&t?90-1e-6:Bn]}).concat(d3.range(180,-180-e/2,-e).map(function(e,t){return[e,1&t?-90+1e-6:-Bn]}))]}}var t=2,n=Sn(wt),r=n(t),i=r.stream;return r.lobes=function(e){return arguments.length?n(t=+e):t},r.stream=function(t){var n=r.rotate(),s=i(t),o=(r.rotate([0,0]),i(t));return r.rotate(n),s.sphere=function(){d3.geo.stream(e(),o)},s},r}function St(e){function t(t,i){var u,a,h=1-Math.sin(i);if(h&&2>h){var p,d=gn-i,v=25;do{var m=Math.sin(d),g=Math.cos(d),y=s+Math.atan2(m,r-g),b=1+c-2*r*g;d-=p=(d-l*s-r*m+b*y-.5*h*n)/(2*r*m*y)}while(Math.abs(p)>vn&&--v>0);u=o*Math.sqrt(b),a=t*y/mn}else u=o*(e+h),a=t*s/mn;return[u*Math.sin(a),f-u*Math.cos(a)]}var n,r=1+e,i=Math.sin(1/r),s=u(i),o=2*Math.sqrt(mn/(n=mn+4*s*r)),f=.5*o*(r+Math.sqrt(e*(2+e))),l=e*e,c=r*r;return t.invert=function(e,t){var i=e*e+(t-=f)*t,h=(1+c-i/(o*o))/(2*r),p=a(h),d=Math.sin(p),v=s+Math.atan2(d,r-h);return[u(e/Math.sqrt(i))*mn/v,u(1-2*(p-l*s-r*d+(1+c-2*r*h)*v)/n)]},t}function xt(){var e=1,t=Sn(St),n=t(e);return n.ratio=function(n){return arguments.length?t(e=+n):e},n}function Tt(e,t){return t>-jn?(e=Cn(e,t),e[1]+=Fn,e):L(e,t)}function Nt(e,t){return Math.abs(t)>jn?(e=Cn(e,t),e[1]-=t>0?Fn:-Fn,e):L(e,t)}function Ct(e,t){return[3*e/(2*mn)*Math.sqrt(mn*mn/3-t*t),t]}function kt(e){function t(t,n){if(Math.abs(Math.abs(n)-gn)<dn)return[0,0>n?-2:2];var r=Math.sin(n),i=Math.pow((1+r)/(1-r),e/2),s=.5*(i+1/i)+Math.cos(t*=e);return[2*Math.sin(t)/s,(i-1/i)/s]}return t.invert=function(t,n){var r=Math.abs(n);if(Math.abs(r-2)<dn)return t?null:[0,o(n)*gn];if(r>2)return null;t/=2,n/=2;var i=t*t,s=n*n,a=2*n/(1+i+s);return a=Math.pow((1+a)/(1-a),1/e),[Math.atan2(2*t,1-i-s)/e,u((a-1)/(a+1))]},t}function Lt(){var e=.5,t=Sn(kt),n=t(e);return n.spacing=function(n){return arguments.length?t(e=+n):e},n}function At(e,t){return[e*(1+Math.sqrt(Math.cos(t)))/2,t/(Math.cos(t/2)*Math.cos(e/6))]}function Ot(e,t){var n=e*e,r=t*t;return[e*(.975534+r*(-0.119161+n*-0.0143059+r*-0.0547009)),t*(1.00384+n*(.0802894+r*-0.02855+199025e-9*n)+r*(.0998909+r*-0.0491032))]}function Mt(e,t){return[Math.sin(e)/Math.cos(t),Math.tan(t)*Math.cos(e)]}function _t(e){function t(t,i){var s=i-e,o=Math.abs(s)<dn?t*n:Math.abs(o=mn/4+i/2)<dn||Math.abs(Math.abs(o)-gn)<dn?0:t*s/Math.log(Math.tan(o)/r);return[o,s]}var n=Math.cos(e),r=Math.tan(mn/4+e/2);return t.invert=function(t,i){var s,o=i+e;return[Math.abs(i)<dn?t/n:Math.abs(s=mn/4+o/2)<dn||Math.abs(Math.abs(s)-gn)<dn?0:t*Math.log(Math.tan(s)/r)/i,o]},t}function Dt(e,t){return[e,1.25*Math.log(Math.tan(mn/4+.4*t))]}function Pt(e){function t(t,r){for(var i,s=Math.cos(r),o=2/(1+s*Math.cos(t)),u=o*s*Math.sin(t),a=o*Math.sin(r),f=n,l=e[f],c=l[0],h=l[1];--f>=0;)l=e[f],c=l[0]+u*(i=c)-a*h,h=l[1]+u*h+a*i;return c=u*(i=c)-a*h,h=u*h+a*i,[c,h]}var n=e.length-1;return t.invert=function(t,r){var i=20,s=t,o=r;do{for(var a,f=n,l=e[f],c=l[0],h=l[1],p=0,d=0;--f>=0;)l=e[f],p=c+s*(a=p)-o*d,d=h+s*d+o*a,c=l[0]+s*(a=c)-o*h,h=l[1]+s*h+o*a;p=c+s*(a=p)-o*d,d=h+s*d+o*a,c=s*(a=c)-o*h-t,h=s*h+o*a-r;var v,m,g=p*p+d*d;s-=v=(c*p+h*d)/g,o-=m=(h*p-c*d)/g}while(Math.abs(v)+Math.abs(m)>dn*dn&&--i>0);if(i){var y=Math.sqrt(s*s+o*o),b=2*Math.atan(.5*y),w=Math.sin(b);return[Math.atan2(s*w,y*Math.cos(b)),y?u(o*w/y):0]}},t}function Ht(){var e=In.miller,t=Sn(Pt),n=t(e);return n.coefficients=function(n){return arguments.length?t(e="string"==typeof n?In[n]:n):e},n}function Bt(e,t){var n=Math.sqrt(6),r=Math.sqrt(7),i=Math.asin(7*Math.sin(t)/(3*n));return[n*e*(2*Math.cos(2*i/3)-1)/r,9*Math.sin(i/3)/r]}function jt(e,t){for(var n,r=(1+Math.SQRT1_2)*Math.sin(t),i=t,s=0;25>s&&(i-=n=(Math.sin(i/2)+Math.sin(i)-r)/(.5*Math.cos(i/2)+Math.cos(i)),!(Math.abs(n)<dn));s++);return[e*(1+2*Math.cos(i)/Math.cos(i/2))/(3*Math.SQRT2),2*Math.sqrt(3)*Math.sin(i/2)/Math.sqrt(2+Math.SQRT2)]}function Ft(e,t){for(var n,r=Math.sqrt(6/(4+mn)),i=(1+mn/4)*Math.sin(t),s=t/2,o=0;25>o&&(s-=n=(s/2+Math.sin(s)-i)/(.5+Math.cos(s)),!(Math.abs(n)<dn));o++);return[r*(.5+Math.cos(s))*e/1.5,r*s]}function It(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(-0.013791+r*(.003971*n-.001529*r))),t*(1.007226+n*(.015085+r*(-0.044475+.028874*n-.005916*r)))]}function qt(e,t){return[e*(1+Math.cos(t))/2,2*(t-Math.tan(t/2))]}function Rt(e,t){if(Math.abs(t)<dn)return[e,0];var n=Math.tan(t),r=e*Math.sin(t);return[Math.sin(r)/n,t+(1-Math.cos(r))/n]}function Ut(e){function t(t,r){var i=n?Math.tan(t*n/2)/n:t/2;if(!r)return[2*i,-e];var s=2*Math.atan(i*Math.sin(r)),o=1/Math.tan(r);return[Math.sin(s)*o,r+(1-Math.cos(s))*o-e]}var n=Math.sin(e);return t.invert=function(t,r){if(Math.abs(r+=e)<dn)return[n?2*Math.atan(n*t/2)/n:t,0];var i,s=t*t+r*r,o=0,f=10;do{var l=Math.tan(o),c=1/Math.cos(o),h=s-2*r*o+o*o;o-=i=(l*h+2*(o-r))/(2+h*c*c+2*(o-r)*l)}while(Math.abs(i)>dn&&--f>0);var p=t*(l=Math.tan(o)),d=Math.tan(Math.abs(r)<Math.abs(o+1/l)?.5*u(p):.5*a(p)+mn/4)/Math.sin(o);return[n?2*Math.atan(n*d)/n:2*d,o]},t}function zt(e,t){var n,r=Math.min(18,36*Math.abs(t)/mn),i=Math.floor(r),s=r-i,o=(n=Rn[i])[0],u=n[1],a=(n=Rn[++i])[0],f=n[1],l=(n=Rn[Math.min(19,++i)])[0],c=n[1];return[e*(a+s*(l-o)/2+s*s*(l-2*a+o)/2),(t>0?gn:-gn)*(f+s*(c-u)/2+s*s*(c-2*f+u)/2)]}function Wt(e){function t(t,n){var r=Math.cos(n),i=(e-1)/(e-r*Math.cos(t));return[i*r*Math.sin(t),i*Math.sin(n)]}return t.invert=function(t,n){var r=t*t+n*n,i=Math.sqrt(r),s=(e-Math.sqrt(1-r*(e+1)/(e-1)))/((e-1)/i+i/(e-1));return[Math.atan2(t*s,i*Math.sqrt(1-s*s)),i?u(n*s/i):0]},t}function Xt(e,t){function n(t,n){var o=r(t,n),u=o[1],a=u*s/(e-1)+i;return[o[0]*i/a,u/a]}var r=Wt(e);if(!t)return r;var i=Math.cos(t),s=Math.sin(t);return n.invert=function(t,n){var o=(e-1)/(e-1-n*s);return r.invert(o*t,o*n*i)},n}function Vt(){var e=1.4,t=0,n=Sn(Xt),r=n(e,t);return r.distance=function(r){return arguments.length?n(e=+r,t):e},r.tilt=function(r){return arguments.length?n(e,t=r*mn/180):180*t/mn},r}function $t(e,t){var n=Math.tan(t/2),r=Math.sin(mn/4*n);return[e*(.74482-.34588*r*r),1.70711*n]}function Jt(e){function t(t,s){var o=a(Math.cos(s)*Math.cos(t-n)),u=a(Math.cos(s)*Math.cos(t-r)),l=0>s?-1:1;return o*=o,u*=u,[(o-u)/(2*e),l*f(4*i*u-(i-o+u)*(i-o+u))/(2*e)]}if(!e)return d3.geo.azimuthalEquidistant.raw;var n=-e/2,r=-n,i=e*e,s=Math.tan(r),o=.5/Math.sin(r);return t.invert=function(e,t){var i,u,f=t*t,l=Math.cos(Math.sqrt(f+(i=e+n)*i)),c=Math.cos(Math.sqrt(f+(i=e+r)*i));return[Math.atan2(u=l-c,i=(l+c)*s),(0>t?-1:1)*a(Math.sqrt(i*i+u*u)*o)]},t}function Kt(){var e=[[0,0],[0,0]],t=Sn(Jt),n=t(0),r=n.rotate;return delete n.rotate,n.points=function(n){if(!arguments.length)return e;e=n;var i=d3.geo.interpolate(n[0],n[1]),s=i(.5),o=d3.geo.rotation([-s[0],-s[1]])(n[0]),a=.5*i.distance,f=-u(Math.sin(o[1]*bn)/Math.sin(a));return o[0]>0&&(f=mn-f),r.call(o,[-s[0],-s[1],-f*wn]),t(2*a)},n}function Qt(e){function t(e,t){var r=d3.geo.gnomonic.raw(e,t);return r[0]*=n,r}var n=Math.cos(e);return t.invert=function(e,t){return d3.geo.gnomonic.raw.invert(e/n,t)},t}function Gt(){var e=[[0,0],[0,0]],t=Sn(Qt),n=t(0),r=n.rotate;return delete n.rotate,n.points=function(n){if(!arguments.length)return e;e=n;var i=d3.geo.interpolate(n[0],n[1]),s=i(.5),o=d3.geo.rotation([-s[0],-s[1]])(n[0]),a=.5*i.distance,f=-u(Math.sin(o[1]*bn)/Math.sin(a));return o[0]>0&&(f=mn-f),r.call(o,[-s[0],-s[1],-f*wn]),t(a)},n}function Yt(e,t){if(Math.abs(t)<dn)return[e,0];var n=Math.abs(t/gn),r=u(n);if(Math.abs(e)<dn||Math.abs(Math.abs(t)-gn)<dn)return[0,o(t)*mn*Math.tan(r/2)];var i=Math.cos(r),s=Math.abs(mn/e-e/mn)/2,a=s*s,f=i/(n+i-1),l=f*(2/n-1),c=l*l,h=c+a,p=f-c,d=a+f;return[o(e)*mn*(s*p+Math.sqrt(a*p*p-h*(f*f-c)))/h,o(t)*mn*(l*d-s*Math.sqrt((a+1)*h-d*d))/h]}function Zt(e,t){if(Math.abs(t)<dn)return[e,0];var n=Math.abs(t/gn),r=u(n);if(Math.abs(e)<dn||Math.abs(Math.abs(t)-gn)<dn)return[0,o(t)*mn*Math.tan(r/2)];var i=Math.cos(r),s=Math.abs(mn/e-e/mn)/2,a=s*s,l=i*(Math.sqrt(1+a)-s*i)/(1+a*n*n);return[o(e)*mn*l,o(t)*mn*f(1-l*(2*s+l))]}function en(e,t){if(Math.abs(t)<dn)return[e,0];var n=t/gn,r=u(n);if(Math.abs(e)<dn||Math.abs(Math.abs(t)-gn)<dn)return[0,mn*Math.tan(r/2)];var i=(mn/e-e/mn)/2,s=n/(1+Math.cos(r));return[mn*(o(e)*f(i*i+1-s*s)-i),mn*s]}function tn(e,t){if(!t)return[e,0];var n=Math.abs(t);if(!e||n===gn)return[0,t];var r=n/gn,i=r*r,s=(8*r-i*(i+2)-5)/(2*i*(r-1)),u=s*s,a=r*s,l=i+u+2*a,c=r+3*s,h=e/gn,p=h+1/h,d=o(Math.abs(e)-gn)*Math.sqrt(p*p-4),v=d*d,m=l*(i+u*v-1)+(1-i)*(i*(c*c+4*u)+12*a*u+4*u*u),g=(d*(l+u-1)+2*f(m))/(4*l+v);return[o(e)*gn*g,o(t)*gn*f(1+d*Math.abs(g)-g*g)]}function nn(e,t){return[e*Math.sqrt(1-3*t*t/(mn*mn)),t]}function rn(e,t){var n=.90631*Math.sin(t),r=Math.sqrt(1-n*n),i=Math.sqrt(2/(1+r*Math.cos(e/=3)));return[2.66723*r*i*Math.sin(e),1.24104*n*i]}function sn(e,t){var n=Math.cos(t),r=Math.cos(e)*n,i=1-r,s=Math.cos(e=Math.atan2(Math.sin(e)*n,-Math.sin(t))),o=Math.sin(e);return n=f(1-r*r),[o*n-s*i,-s*n-o*i]}function on(e,t){var n=h(e,t);return[(n[0]+e/gn)/2,(n[1]+t)/2]}d3.geo.project=function(e,n){var r=n.stream;if(!r)throw new Error("not yet supported");return(e&&un.hasOwnProperty(e.type)?un[e.type]:t)(e,r)};var un={Feature:e,FeatureCollection:function(t,n){return{type:"FeatureCollection",features:t.features.map(function(t){return e(t,n)})}}},an=[],fn=[],ln={point:function(e,t){an.push([e,t])},result:function(){var e=an.length?an.length<2?{type:"Point",coordinates:an[0]}:{type:"MultiPoint",coordinates:an}:null;return an=[],e}},cn={lineStart:n,point:function(e,t){an.push([e,t])},lineEnd:function(){an.length&&(fn.push(an),an=[])},result:function(){var e=fn.length?fn.length<2?{type:"LineString",coordinates:fn[0]}:{type:"MultiLineString",coordinates:fn}:null;return fn=[],e}},hn={polygonStart:n,lineStart:n,point:function(e,t){an.push([e,t])},lineEnd:function(){var e=an.length;if(e){do an.push(an[0].slice());while(++e<4);fn.push(an),an=[]}},polygonEnd:n,result:function(){if(!fn.length)return null;var e=[],t=[];return fn.forEach(function(n){r(n)?e.push([n]):t.push(n)}),t.forEach(function(t){var n=t[0];e.some(function(e){return i(e[0],n)?(e.push(t),!0):void 0})||e.push([t])}),fn=[],e.length?e.length>1?{type:"MultiPolygon",coordinates:e}:{type:"Polygon",coordinates:e[0]}:null}},pn={Point:ln,MultiPoint:ln,LineString:cn,MultiLineString:cn,Polygon:hn,MultiPolygon:hn,Sphere:hn},dn=1e-6,vn=dn*dn,mn=Math.PI,gn=mn/2,yn=Math.sqrt(mn),bn=mn/180,wn=180/mn,En=d3.geo.projection,Sn=d3.geo.projectionMutator;d3.geo.interrupt=function(e){function t(t,n){for(var r=0>n?-1:1,i=u[+(0>n)],s=0,o=i.length-1;o>s&&t>i[s][2][0];++s);var a=e(t-i[s][1][0],n);return a[0]+=e(i[s][1][0],r*n>r*i[s][0][1]?i[s][0][1]:n)[0],a}function n(){o=u.map(function(t){return t.map(function(t){var n,r=e(t[0][0],t[0][1])[0],i=e(t[2][0],t[2][1])[0],s=e(t[1][0],t[0][1])[1],o=e(t[1][0],t[1][1])[1];return s>o&&(n=s,s=o,o=n),[[r,s],[i,o]]})})}function r(){for(var e=1e-6,t=[],n=0,r=u[0].length;r>n;++n){var s=u[0][n],o=180*s[0][0]/mn,a=180*s[0][1]/mn,f=180*s[1][1]/mn,l=180*s[2][0]/mn,c=180*s[2][1]/mn;t.push(i([[o+e,a+e],[o+e,f-e],[l-e,f-e],[l-e,c+e]],30))}for(var n=u[1].length-1;n>=0;--n){var s=u[1][n],o=180*s[0][0]/mn,a=180*s[0][1]/mn,f=180*s[1][1]/mn,l=180*s[2][0]/mn,c=180*s[2][1]/mn;t.push(i([[l-e,c-e],[l-e,f+e],[o+e,f+e],[o+e,a-e]],30))}return{type:"Polygon",coordinates:[d3.merge(t)]}}function i(e,t){for(var n,r,i,s=-1,o=e.length,u=e[0],a=[];++s<o;){n=e[s],r=(n[0]-u[0])/t,i=(n[1]-u[1])/t;for(var f=0;t>f;++f)a.push([u[0]+f*r,u[1]+f*i]);u=n}return a.push(n),a}function s(e,t){return Math.abs(e[0]-t[0])<dn&&Math.abs(e[1]-t[1])<dn}var o,u=[[[[-mn,0],[0,gn],[mn,0]]],[[[-mn,0],[0,-gn],[mn,0]]]];e.invert&&(t.invert=function(n,r){for(var i=o[+(0>r)],a=u[+(0>r)],f=0,l=i.length;l>f;++f){var c=i[f];if(c[0][0]<=n&&n<c[1][0]&&c[0][1]<=r&&r<c[1][1]){var h=e.invert(n-e(a[f][1][0],0)[0],r);return h[0]+=a[f][1][0],s(t(h[0],h[1]),[n,r])?h:null}}});var a=d3.geo.projection(t),f=a.stream;return a.stream=function(e){var t=a.rotate(),n=f(e),i=(a.rotate([0,0]),f(e));return a.rotate(t),n.sphere=function(){d3.geo.stream(r(),i)},n},a.lobes=function(e){return arguments.length?(u=e.map(function(e){return e.map(function(e){return[[e[0][0]*mn/180,e[0][1]*mn/180],[e[1][0]*mn/180,e[1][1]*mn/180],[e[2][0]*mn/180,e[2][1]*mn/180]]})}),n(),a):u.map(function(e){return e.map(function(e){return[[180*e[0][0]/mn,180*e[0][1]/mn],[180*e[1][0]/mn,180*e[1][1]/mn],[180*e[2][0]/mn,180*e[2][1]/mn]]})})},a},(d3.geo.airy=c).raw=l,h.invert=function(e,t){if(!(e*e+4*t*t>mn*mn+dn)){var n=e,r=t,i=25;do{var s,o=Math.sin(n),u=Math.sin(n/2),f=Math.cos(n/2),l=Math.sin(r),c=Math.cos(r),h=Math.sin(2*r),p=l*l,d=c*c,v=u*u,m=1-d*f*f,g=m?a(c*f)*Math.sqrt(s=1/m):s=0,y=2*g*c*u-e,b=g*l-t,w=s*(d*v+g*c*f*p),E=s*(.5*o*h-2*g*l*u),S=.25*s*(h*u-g*l*d*o),x=s*(p*f+g*v*c),T=E*S-x*w;if(!T)break;var N=(b*E-y*x)/T,C=(y*S-b*w)/T;n-=N,r-=C}while((Math.abs(N)>dn||Math.abs(C)>dn)&&--i>0);return[n,r]}},(d3.geo.aitoff=function(){return En(h)}).raw=h,(d3.geo.armadillo=d).raw=p,w.invert=function(e,t){if(e*=3/8,t*=3/8,!e&&Math.abs(t)>1)return null;var n=e*e,r=t*t,i=1+n+r,s=Math.sqrt(.5*(i-Math.sqrt(i*i-4*t*t))),a=u(s)/3,f=s?b(Math.abs(t/s))/3:y(Math.abs(e))/3,l=Math.cos(a),c=g(f),h=c*c-l*l;return[2*o(e)*Math.atan2(m(f)*l,.25-h),2*o(t)*Math.atan2(c*Math.sin(a),.25+h)]},(d3.geo.august=function(){return En(w)}).raw=w;var xn=Math.log(1+Math.SQRT2);E.invert=function(e,t){if((r=Math.abs(t))<xn)return[e,2*Math.atan(Math.exp(t))-gn];var n,r,i=Math.sqrt(8),s=mn/4,u=25;do{var a=Math.cos(s/2),f=Math.tan(s/2);s-=n=(i*(s-mn/4)-Math.log(f)-r)/(i-.5*a*a/f)}while(Math.abs(n)>vn&&--u>0);return[e/(Math.cos(s)*(i-1/Math.sin(s))),o(t)*s]},(d3.geo.baker=function(){return En(E)}).raw=E;var Tn=d3.geo.azimuthalEquidistant.raw;(d3.geo.berghaus=x).raw=S;var Nn=T(mn),Cn=N(Math.SQRT2/gn,Math.SQRT2,mn);(d3.geo.mollweide=function(){return En(Cn)}).raw=Cn,C.invert=function(e,t){var n,r,i=2.00276,s=i*t,o=0>t?-mn/4:mn/4,u=25;do r=s-Math.SQRT2*Math.sin(o),o-=n=(Math.sin(2*o)+2*o-mn*Math.sin(r))/(2*Math.cos(2*o)+2+mn*Math.cos(r)*Math.SQRT2*Math.cos(o));while(Math.abs(n)>dn&&--u>0);return r=s-Math.SQRT2*Math.sin(o),[e*(1/Math.cos(r)+1.11072/Math.cos(o))/i,r]},(d3.geo.boggs=function(){return En(C)}).raw=C,L.invert=function(e,t){return[e/Math.cos(t),t]},(d3.geo.sinusoidal=function(){return En(L)}).raw=L,(d3.geo.bonne=function(){return k(A).parallel(45)}).raw=A;var kn=N(1,4/mn,mn);(d3.geo.bromley=function(){return En(kn)}).raw=kn,(d3.geo.chamberlin=M).raw=O,B.invert=function(e,t){var n=(n=t/yn-1)*n;return[n>0?e*Math.sqrt(mn/n)/2:0,u(1-n)]},(d3.geo.collignon=function(){return En(B)}).raw=B,(d3.geo.craig=function(){return k(j)}).raw=j,F.invert=function(e,t){var n=Math.sqrt(3),r=3*u(t/(n*yn));return[yn*e/(n*(2*Math.cos(2*r/3)-1)),r]},(d3.geo.craster=function(){return En(F)}).raw=F,(d3.geo.cylindricalEqualArea=function(){return k(I)}).raw=I,(d3.geo.cylindricalStereographic=function(){return k(q)}).raw=q,R.invert=function(e,t){var n=Math.sqrt(8/(3*mn)),r=t/n;return[e/(n*(1-Math.abs(r)/mn)),r]},(d3.geo.eckert1=function(){return En(R)}).raw=R,U.invert=function(e,t){var n=2-Math.abs(t)/Math.sqrt(2*mn/3);return[e*Math.sqrt(6*mn)/(2*n),o(t)*u((4-n*n)/3)]},(d3.geo.eckert2=function(){return En(U)}).raw=U,z.invert=function(e,t){var n=Math.sqrt(mn*(4+mn))/2;return[e*n/(1+f(1-t*t*(4+mn)/(4*mn))),t*n/2]},(d3.geo.eckert3=function(){return En(z)}).raw=z,W.invert=function(e,t){var n=.5*t*Math.sqrt((4+mn)/mn),r=u(n),i=Math.cos(r);return[e/(2/Math.sqrt(mn*(4+mn))*(1+i)),u((r+n*(i+2))/(2+gn))]},(d3.geo.eckert4=function(){return En(W)}).raw=W,X.invert=function(e,t){var n=Math.sqrt(2+mn),r=t*n/2;return[n*e/(1+Math.cos(r)),r]},(d3.geo.eckert5=function(){return En(X)}).raw=X,V.invert=function(e,t){var n=1+gn,r=Math.sqrt(n/2);return[2*e*r/(1+Math.cos(t*=r)),u((t+Math.sin(t))/n)]},(d3.geo.eckert6=function(){return En(V)}).raw=V,$.invert=function(e,t){var n=d3.geo.august.raw.invert(e/1.2,1.065*t);if(!n)return null;var r=n[0],i=n[1],s=20;e/=Ln,t/=Ln;do{var o=r/2,u=i/2,a=Math.sin(o),f=Math.cos(o),l=Math.sin(u),c=Math.cos(u),h=Math.cos(i),p=Math.sqrt(h),d=l/(c+Math.SQRT2*f*p),v=d*d,m=Math.sqrt(2/(1+v)),g=Math.SQRT2*c+(f+a)*p,y=Math.SQRT2*c+(f-a)*p,b=g/y,w=Math.sqrt(b),E=w-1/w,S=w+1/w,x=m*E-2*Math.log(w)-e,T=m*d*S-2*Math.atan(d)-t,N=l&&Math.SQRT1_2*p*a*v/l,C=(Math.SQRT2*f*c+p)/(2*(c+Math.SQRT2*f*p)*(c+Math.SQRT2*f*p)*p),k=-0.5*d*m*m*m,L=k*N,A=k*C,O=(O=2*c+Math.SQRT2*p*(f-a))*O*w,M=(Math.SQRT2*f*c*p+h)/O,_=-(Math.SQRT2*a*l)/(p*O),D=E*L-2*M/w+m*(M+M/b),P=E*A-2*_/w+m*(_+_/b),H=d*S*L-2*N/(1+v)+m*S*N+m*d*(M-M/b),B=d*S*A-2*C/(1+v)+m*S*C+m*d*(_-_/b),j=P*H-B*D;if(!j)break;var F=(T*P-x*B)/j,I=(x*H-T*D)/j;r-=F,i=Math.max(-gn,Math.min(gn,i-I))}while((Math.abs(F)>dn||Math.abs(I)>dn)&&--s>0);return Math.abs(Math.abs(i)-gn)<dn?[0,i]:s&&[r,i]};var Ln=3+2*Math.SQRT2;(d3.geo.eisenlohr=function(){return En($)}).raw=$,J.invert=function(e,t){var n=t/(1+An);return[e?e/(An*f(1-n*n)):0,2*Math.atan(n)]};var An=Math.cos(35*bn);(d3.geo.fahey=function(){return En(J)}).raw=J,K.invert=function(e,t){var n=Math.atan(t/yn),r=Math.cos(n),i=2*n;return[e*yn*.5/(Math.cos(i)*r*r),i]},(d3.geo.foucaut=function(){return En(K)}).raw=K,d3.geo.gilbert=function(e){function t(t){return e([.5*t[0],u(Math.tan(.5*t[1]*bn))*wn])}var n=d3.geo.equirectangular().scale(wn).translate([0,0]);return e.invert&&(t.invert=function(t){return t=e.invert(t),t[0]*=2,t[1]=2*Math.atan(Math.sin(t[1]*bn))*wn,t}),t.stream=function(t){t=e.stream(t);var r=n.stream({point:function(e,n){t.point(.5*e,u(Math.tan(.5*-n*bn))*wn)},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}});return r.sphere=function(){t.sphere()},r.valid=!1,r},t};var On=d3.geo.azimuthalEquidistant.raw;(d3.geo.gingery=Y).raw=Q;var Mn=et(2.8284,-1.6988,.75432,-0.18071,1.76003,-0.38914,.042555);(d3.geo.ginzburg4=function(){return En(Mn)}).raw=Mn;var _n=et(2.583819,-0.835827,.170354,-0.038094,1.543313,-0.411435,.082742);(d3.geo.ginzburg5=function(){return En(_n)}).raw=_n;var Dn=et(5/6*mn,-0.62636,-0.0344,0,1.3493,-0.05524,0,.045);(d3.geo.ginzburg6=function(){return En(Dn)}).raw=Dn,tt.invert=function(e,t){var n,r=e,i=t,s=50;do{var o=i*i;i-=n=(i*(1+o/12)-t)/(1+o/4)}while(Math.abs(n)>dn&&--s>0);s=50,e/=1-.162388*o;do{var u=(u=r*r)*u;r-=n=(r*(.87-952426e-9*u)-e)/(.87-.00476213*u)}while(Math.abs(n)>dn&&--s>0);return[r,i]},(d3.geo.ginzburg8=function(){return En(tt)}).raw=tt;var Pn=et(2.6516,-0.76534,.19123,-0.047094,1.36289,-0.13965,.031762);(d3.geo.ginzburg9=function(){return En(Pn)}).raw=Pn,rt.invert=function(e,t){var n=o(e),r=o(t),i=-n*e,s=-r*t,a=1>s/i,f=st(a?s:i,a?i:s),l=f[0],c=f[1];a&&(l=-gn-l);var h=Math.cos(c),e=Math.cos(l)*h,t=Math.sin(l)*h,p=Math.sin(c);return[n*(Math.atan2(t,-p)+mn),r*u(e)]},d3.geo.gringorten=nt(rt),lt.invert=function(e,t){var n=(Math.SQRT2-1)/(Math.SQRT2+1),r=Math.sqrt(1-n*n),i=ft(gn,r*r),s=-1,o=ot(.5*i-t,-e,r*r),u=ht(o[0],o[1]),a=Math.atan2(u[1],u[0])/s;return[a,2*Math.atan(Math.exp(.5/s*Math.log(n*u[0]*u[0]+n*u[1]*u[1])))-gn]},d3.geo.guyou=nt(lt),(d3.geo.hammerRetroazimuthal=vt).raw=pt;var Hn=d3.geo.azimuthalEqualArea.raw;yt.invert=function(e,t){var n=2*u(t/2);return[e*Math.cos(n/2)/Math.cos(n),n]},(d3.geo.hammer=gt).raw=mt,bt.invert=function(e,t){var n=Math.abs(n=t*(0>t?.5179951515653813:.5686373742600607))>1-dn?n>0?gn:-gn:u(n);return[1.1764705882352942*e/Math.cos(n),Math.abs(n=((n+=n)+Math.sin(n))*(0>t?.4102345310814193:.3736990601468637))>1-dn?n>0?gn:-gn:u(n)]},(d3.geo.hatano=function(){return En(bt)}).raw=bt;var Bn=41+48/36+37/3600;(d3.geo.healpix=Et).raw=wt,(d3.geo.hill=xt).raw=St;var jn=.7109889596207567,Fn=.0528035274542;Tt.invert=function(e,t){return t>-jn?Cn.invert(e,t-Fn):L.invert(e,t)},(d3.geo.sinuMollweide=function(){return En(Tt).rotate([-20,-55])}).raw=Tt,Nt.invert=function(e,t){return Math.abs(t)>jn?Cn.invert(e,t+(t>0?Fn:-Fn)):L.invert(e,t)},(d3.geo.homolosine=function(){return En(Nt)}).raw=Nt,Ct.invert=function(e,t){return[2/3*mn*e/Math.sqrt(mn*mn/3-t*t),t]},(d3.geo.kavrayskiy7=function(){return En(Ct)}).raw=Ct,(d3.geo.lagrange=Lt).raw=kt,At.invert=function(e,t){var n=Math.abs(e),r=Math.abs(t),i=mn/Math.SQRT2,s=dn,o=gn;i>r?o*=r/i:s+=6*a(i/r);for(var u=0;25>u;u++){var l=Math.sin(o),c=f(Math.cos(o)),h=Math.sin(o/2),p=Math.cos(o/2),d=Math.sin(s/6),v=Math.cos(s/6),m=.5*s*(1+c)-n,g=o/(p*v)-r,y=c?-0.25*s*l/c:0,b=.5*(1+c),w=(1+.5*o*h/p)/(p*v),E=o/p*(d/6)/(v*v),S=y*E-w*b,x=(m*E-g*b)/S,T=(g*y-m*w)/S;if(o-=x,s-=T,Math.abs(x)<dn&&Math.abs(T)<dn)break}return[0>e?-s:s,0>t?-o:o]},(d3.geo.larrivee=function(){return En(At)}).raw=At,Ot.invert=function(e,t){var n=o(e)*mn,r=t/2,i=50;do{var s=n*n,u=r*r,a=n*r,f=n*(.975534+u*(-0.119161+s*-0.0143059+u*-0.0547009))-e,l=r*(1.00384+s*(.0802894+u*-0.02855+199025e-9*s)+u*(.0998909+u*-0.0491032))-t,c=.975534-u*(.119161+3*s*.0143059+.0547009*u),h=-a*(.238322+.2188036*u+.0286118*s),p=a*(.1605788+7961e-7*s+ -0.0571*u),d=1.00384+s*(.0802894+199025e-9*s)+u*(3*(.0998909-.02855*s)-.245516*u),v=h*p-d*c,m=(l*h-f*d)/v,g=(f*p-l*c)/v;n-=m,r-=g}while((Math.abs(m)>dn||Math.abs(g)>dn)&&--i>0);return i&&[n,r]},(d3.geo.laskowski=function(){return En(Ot)}).raw=Ot,Mt.invert=function(e,t){var n=e*e,r=t*t,i=r+1,s=e?Math.SQRT1_2*Math.sqrt((i-Math.sqrt(n*n+2*n*(r-1)+i*i))/n+1):1/Math.sqrt(i);return[u(e*s),o(t)*a(s)]},(d3.geo.littrow=function(){return En(Mt)}).raw=Mt,(d3.geo.loximuthal=function(){return k(_t).parallel(40)}).raw=_t,Dt.invert=function(e,t){return[e,2.5*Math.atan(Math.exp(.8*t))-.625*mn]},(d3.geo.miller=function(){return En(Dt)}).raw=Dt;var In={alaska:[[.9972523,0],[.0052513,-0.0041175],[.0074606,.0048125],[-0.0153783,-0.1968253],[.0636871,-0.1408027],[.3660976,-0.2937382]],gs48:[[.98879,0],[0,0],[-0.050909,0],[0,0],[.075528,0]],gs50:[[.984299,0],[.0211642,.0037608],[-0.1036018,-0.0575102],[-0.0329095,-0.0320119],[.0499471,.1223335],[.026046,.0899805],[7388e-7,-0.1435792],[.0075848,-0.1334108],[-0.0216473,.0776645],[-0.0225161,.0853673]],miller:[[.9245,0],[0,0],[.01943,0]],lee:[[.721316,0],[0,0],[-0.00881625,-0.00617325]]};(d3.geo.modifiedStereographic=Ht).raw=Pt,Bt.invert=function(e,t){var n=Math.sqrt(6),r=Math.sqrt(7),i=3*u(t*r/9);return[e*r/(n*(2*Math.cos(2*i/3)-1)),u(3*Math.sin(i)*n/7)]},(d3.geo.mtFlatPolarParabolic=function(){return En(Bt)}).raw=Bt,jt.invert=function(e,t){var n=t*Math.sqrt(2+Math.SQRT2)/(2*Math.sqrt(3)),r=2*u(n);return[3*Math.SQRT2*e/(1+2*Math.cos(r)/Math.cos(r/2)),u((n+Math.sin(r))/(1+Math.SQRT1_2))]},(d3.geo.mtFlatPolarQuartic=function(){return En(jt)}).raw=jt,Ft.invert=function(e,t){var n=Math.sqrt(6/(4+mn)),r=t/n;return Math.abs(Math.abs(r)-gn)<dn&&(r=0>r?-gn:gn),[1.5*e/(n*(.5+Math.cos(r))),u((r/2+Math.sin(r))/(1+mn/4))]},(d3.geo.mtFlatPolarSinusoidal=function(){return En(Ft)}).raw=Ft,It.invert=function(e,t){var n,r=t,i=25;do{var s=r*r,o=s*s;r-=n=(r*(1.007226+s*(.015085+o*(-0.044475+.028874*s-.005916*o)))-t)/(1.007226+s*(.045255+o*(-0.311325+.259866*s-.005916*11*o)))}while(Math.abs(n)>dn&&--i>0);return[e/(.8707+(s=r*r)*(-0.131979+s*(-0.013791+s*s*s*(.003971-.001529*s)))),r]},(d3.geo.naturalEarth=function(){return En(It)}).raw=It,qt.invert=function(e,t){for(var n=t/2,r=0,i=1/0;10>r&&Math.abs(i)>dn;r++){var s=Math.cos(t/2);t-=i=(t-Math.tan(t/2)-n)/(1-.5/(s*s))}return[2*e/(1+Math.cos(t)),t]},(d3.geo.nellHammer=function(){return En(qt)}).raw=qt;var qn=nt(lt);(d3.geo.peirceQuincuncial=function(){return qn().quincuncial(!0).rotate([-90,-90,45]).clipAngle(180-1e-6)}).raw=qn.raw,Rt.invert=function(e,t){if(Math.abs(t)<dn)return[e,0];var n,r=e*e+t*t,i=.5*t,s=10;do{var f=Math.tan(i),l=1/Math.cos(i),c=r-2*t*i+i*i;i-=n=(f*c+2*(i-t))/(2+c*l*l+2*(i-t)*f)}while(Math.abs(n)>dn&&--s>0);return f=Math.tan(i),[(Math.abs(t)<Math.abs(i+1/f)?u(e*f):o(e)*(a(Math.abs(e*f))+gn))/Math.sin(i),i]},(d3.geo.polyconic=function(){return En(Rt)}).raw=Rt,(d3.geo.rectangularPolyconic=function(){return k(Ut)}).raw=Ut;var Rn=[[.9986,-0.062],[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1]];Rn.forEach(function(e){e[1]*=1.0144}),zt.invert=function(e,t){var n=t/gn,r=90*n,i=Math.min(18,Math.abs(r/5)),s=Math.max(0,Math.floor(i));do{var o=Rn[s][1],u=Rn[s+1][1],a=Rn[Math.min(19,s+2)][1],f=a-o,l=a-2*u+o,c=2*(Math.abs(n)-u)/f,h=l/f,p=c*(1-h*c*(1-2*h*c));if(p>=0||1===s){r=(t>=0?5:-5)*(p+i);var d,v=50;do i=Math.min(18,Math.abs(r)/5),s=Math.floor(i),p=i-s,o=Rn[s][1],u=Rn[s+1][1],a=Rn[Math.min(19,s+2)][1],r-=(d=(t>=0?gn:-gn)*(u+p*(a-o)/2+p*p*(a-2*u+o)/2)-t)*wn;while(Math.abs(d)>vn&&--v>0);break}}while(--s>=0);var m=Rn[s][0],g=Rn[s+1][0],y=Rn[Math.min(19,s+2)][0];return[e/(g+p*(y-m)/2+p*p*(y-2*g+m)/2),r*bn]},(d3.geo.robinson=function(){return En(zt)}).raw=zt,(d3.geo.satellite=Vt).raw=Xt,$t.invert=function(e,t){var n=t/1.70711,r=Math.sin(mn/4*n);return[e/(.74482-.34588*r*r),2*Math.atan(n)]},(d3.geo.times=function(){return En($t)}).raw=$t,(d3.geo.twoPointEquidistant=Kt).raw=Jt,(d3.geo.twoPointAzimuthal=Gt).raw=Qt,Yt.invert=function(e,t){if(Math.abs(t)<dn)return[e,0];if(Math.abs(e)<dn)return[0,gn*Math.sin(2*Math.atan(t/mn))];var n=(e/=mn)*e,r=(t/=mn)*t,i=n+r,s=i*i,u=-Math.abs(t)*(1+i),f=u-2*r+n,l=-2*u+1+2*r+s,c=r/l+(2*f*f*f/(l*l*l)-9*u*f/(l*l))/27,h=(u-f*f/(3*l))/l,p=2*Math.sqrt(-h/3),d=a(3*c/(h*p))/3;return[mn*(i-1+Math.sqrt(1+2*(n-r)+s))/(2*e),o(t)*mn*(-p*Math.cos(d+mn/3)-f/(3*l))]},(d3.geo.vanDerGrinten=function(){return En(Yt)}).raw=Yt,Zt.invert=function(e,t){if(!e)return[0,gn*Math.sin(2*Math.atan(t/mn))];var n=Math.abs(e/mn),r=(1-n*n-(t/=mn)*t)/(2*n),i=r*r,s=Math.sqrt(i+1);return[o(e)*mn*(s-r),o(t)*gn*Math.sin(2*Math.atan2(Math.sqrt((1-2*r*n)*(r+s)-n),Math.sqrt(s+r+n)))]},(d3.geo.vanDerGrinten2=function(){return En(Zt)}).raw=Zt,en.invert=function(e,t){if(!t)return[e,0];var n=t/mn,r=(mn*mn*(1-n*n)-e*e)/(2*mn*e);return[e?mn*(o(e)*Math.sqrt(r*r+1)-r):0,gn*Math.sin(2*Math.atan(n))]},(d3.geo.vanDerGrinten3=function(){return En(en)}).raw=en,tn.invert=function(e,t){if(!e||!t)return[e,t];t/=mn;var n=o(e)*e/gn,r=(n*n-1+4*t*t)/Math.abs(n),i=r*r,s=2*t,u=50;do{var a=s*s,f=(8*s-a*(a+2)-5)/(2*a*(s-1)),l=(3*s-a*s-10)/(2*a*s),c=f*f,h=s*f,p=s+f,d=p*p,v=s+3*f,m=d*(a+c*i-1)+(1-a)*(a*(v*v+4*c)+c*(12*h+4*c)),g=-2*p*(4*h*c+(1-4*a+3*a*a)*(1+l)+c*(-6+14*a-i+(-8+8*a-2*i)*l)+h*(-8+12*a+(-10+10*a-i)*l)),y=Math.sqrt(m),b=r*(d+c-1)+2*y-n*(4*d+i),w=r*(2*f*l+2*p*(1+l))+g/y-8*p*(r*(-1+c+d)+2*y)*(1+l)/(i+4*d);s-==b/w}while(>dn&&--u>0);return[o(e)*(Math.sqrt(r*r+4)+r)*mn/4,gn*s]},(d3.geo.vanDerGrinten4=function(){return En(tn)}).raw=tn;var Un=function(){var e=4*mn+3*Math.sqrt(3),t=2*Math.sqrt(2*mn*Math.sqrt(3)/e);return N(t*Math.sqrt(3)/mn,t,e/6)}();(d3.geo.wagner4=function(){return En(Un)}).raw=Un,nn.invert=function(e,t){return[e/Math.sqrt(1-3*t*t/(mn*mn)),t]},(d3.geo.wagner6=function(){return En(nn)}).raw=nn,rn.invert=function(e,t){var n=e/2.66723,r=t/1.24104,i=Math.sqrt(n*n+r*r),s=2*u(i/2);return[3*Math.atan2(e*Math.tan(s),2.66723*i),i&&u(t*Math.sin(s)/(1.24104*.90631*i))]},(d3.geo.wagner7=function(){return En(rn)}).raw=rn,sn.invert=function(e,t){var n=-0.5*(e*e+t*t),r=Math.sqrt(-n*(2+n)),i=t*n+e*r,s=e*n-t*r,o=Math.sqrt(s*s+i*i);return[Math.atan2(r*i,o*(1+n)),o?-u(r*s/o):0]},(d3.geo.wiechel=function(){return En(sn)}).raw=sn,on.invert=function(e,t){var n=e,r=t,i=25;do{var s,o=Math.cos(r),u=Math.sin(r),f=Math.sin(2*r),l=u*u,c=o*o,h=Math.sin(n),p=Math.cos(n/2),d=Math.sin(n/2),v=d*d,m=1-c*p*p,g=m?a(o*p)*Math.sqrt(s=1/m):s=0,y=.5*(2*g*o*d+n/gn)-e,b=.5*(g*u+r)-t,w=.5*s*(c*v+g*o*p*l)+.5/gn,E=s*(h*f/4-g*u*d),S=.125*s*(f*d-g*u*c*h),x=.5*s*(l*p+g*v*o)+.5,T=E*S-x*w,N=(b*E-y*x)/T,C=(y*S-b*w)/T;n-=N,r-=C}while((Math.abs(N)>dn||Math.abs(C)>dn)&&--i>0);return[n,r]},(d3.geo.winkel3=function(){return En(on)}).raw=on}(),define("d3.geo.projection",function(){}),define("DATAATLAS/views/map_layer",["backbone.marionette","jquery"],function(e,t){return e.ItemView.extend({map:null,originalHeight:null,originalWidth:null,$wait:null,w:null,h:null,manualZooming:!1,data:null,countryShapes:null,countriesLatLong:null,countriesMetaData:null,initialize:function(e){_.bindAll(this,"getZoom","reset"),this.channel=e.channel,this.originalHeight=this.$el.css("height"),this.originalWidth=this.$el.css("width"),this.w=this.$el.width(),this.h=this.$el.height(),this.channel.vent.on("DATA_ATLAS:SHOW_WAIT_ICON",this.showWait,this),this.channel.vent.on("DATA_ATLAS:HIDE_WAIT_ICON",this.hideWait,this)},getPositionHash:function(){var e=window.location.hash.split(",");return e.length==3?{lat:e[0].substring(1),lng:e[1],zoom:e[2]}:!1},getZoom:function(){return this.zoom},hideWait:function(){this.$wait.fadeOut(1e3)},roundPosition:function(e){return Math.round(e*1e3)/1e3},prepareReset:function(){this.channel.vent.off("DATA_ATLAS:SHOW_WAIT_ICON",this.showWait,this),this.channel.vent.off("DATA_ATLAS:HIDE_WAIT_ICON",this.hideWait,this)},showWait:function(){if(_.isNull(this.$wait)){var e=t("#wereldatlas-wait");this.$wait=t(_.template(e.html(),{})),this.$el.append(this.$wait)}this.$wait.show()}})}),define("DATAATLAS/views/map_layer_d3",["d3","jquery","backbone.marionette","topojson","screenfull","d3.geo.projection","DATAATLAS/views/map_layer"],function(e,t,n,r,i,s,o,u){return o.extend({manualZooming:!1,inFullscreenMode:!1,bounds:null,zoom:null,path:null,feature:null,svg:null,g:null,projection:null,originalProjection:null,initialize:function(e){function r(e,t,n){var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),i=e.indexOf("#")!==-1?"&":"#";return e.match(r)?e.replace(r,"$1"+t+"="+n+"$2"):e+i+t+"="+n}console.log("map layer initialized");var n=this;n.setElement(e.$el[0]),this.startingPoint=e.startingPoint,this.config=e.config,o.prototype.initialize.apply(this,arguments),_.bindAll(this,"render","drawCountries","zoomReset","applyZoom","enforceBounding"),this.channel.vent.on("DATA_ATLAS:FULLSCREEN_REQUESTED",this.toggleFullScreen,n),this.channel.vent.on("DATA_ATLAS:COUNTRY_SHAPES_LOADED",this.drawCountries,this),this.channel.vent.on("DATA_ATLAS:MAP_DRAG_START",function(){clearTimeout(n.boundingTimer)}),this.channel.vent.on("DATA_ATLAS:ZOOM_IN",this.zoomIn,this),this.channel.vent.on("DATA_ATLAS:ZOOM_OUT",this.zoomOut,this),this.channel.reqres.setHandler("DATA_ATLAS:GET_PROJECTION",function(){return this.projection},this),this.channel.vent.on("DATA_ATLAS:VISUAL_FINISHED",this.resizeBorders,this),this.$fullscreenIcon=t(".leaflet-control-fullscreen",this.$el)},addDropShadow:function(){var e=this.svg.append("defs").append("filter").attr("id","drop-shadow").attr("height","130%");e.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",2).attr("result","blur"),e.append("feOffset").attr("in","blur").attr("dx",0).attr("dy",0).attr("result","offsetBlur");var t=e.append("feMerge");t.append("feMergeNode").attr("in","offsetBlur"),t.append("feMergeNode").attr("in","SourceGraphic")},addPattern:function(){var e=this.svg.append("defs"),t=4,n=e.append("radialGradient").attr("cx","50%").attr("cy","50%").attr("r","75%").attr("id","land");n.append("stop").attr("offset","0%").style("stop-color","rgb(231,224,216)"),n.append("stop").attr("offset","100%").style("stop-color","rgb(224,218,211)");var r=e.append("pattern").attr("id","hash").attr("patternUnits","userSpaceOnUse").attr("width",t).attr("height",t).attr("x",0).attr("y",0).append("g").style("stroke","#928474").style("stroke-width",.1);r.append("rect").attr("width","110%").attr("x","-5%").attr("y","-5%").attr("height","100%").attr("fill","#e7e0d8"),r.append("path").attr("d","M0,0 l"+t+","+t),r.append("path").attr("d","M"+t+",0 l-"+t+","+t)},applyZoom:function(e){var t=this.$el.width(),n=this.$el.height(),r={w:t*this.zoom.scale(),h:n*this.zoom.scale()},i={w:t*e,h:n*e},s={x:(r.w-t)/-2,y:(r.h-n)/-2},o={x:(i.w-t)/-2,y:(i.h-n)/-2},u={x:this.zoom.translate()[0],y:this.zoom.translate()[1]},a={x:(u.x-s.x)/this.zoom.scale(),y:(u.y-s.y)/this.zoom.scale()},f=[a.x*e+o.x,a.y*e+o.y];return this.zoom.scale(e).translate(f),this.manualZooming=!0,this.zoom.event(this.svg),!1},drawCountries:function(t){var n=this,i=this.$el.width(),s=this.$el.height(),o=e.select(this.el);this.svg=o.select("svg.wereldmap-svg"),this.svg.empty()&&(this.svg=e.select(this.el).append("svg").attr("class","wereldmap-svg"),this.addPattern());var u=this.config.projection,a=null;switch(u){case"orthographic":case"airy":f=140,clipAngle=90,drawGraticule=!1,zoom=!0,rotate=!0,rotateWithMouse=!1;break;case"cylindricalEqualArea":default:var f=this.config.scale;radius=!1,clipAngle=!1,zoom=!0,rotate=!1,rotateWithMouse=!1,drawGraticule=!1}u=="cylindricalEqualArea"&&(a=45),u=="airy"&&(radius=90),this.originalScale=f,this.projection=e.geo[u](),this.projection.scale(f).translate([0,0]).precision(.001),_.isNull(a)||this.projection.parallel(a),this.originalProjection=e.geo[u](),this.originalProjection.scale(f).translate([0,0]).precision(.001),clipAngle&&this.projection.clipAngle(clipAngle),radius&&this.projection.radius(radius),rotate&&this.projection.rotate(this.config.rotate),this.g=o.select("g.wereldatlas-land"),this.g.empty()&&(this.zoomGroup=this.svg.append("g").attr("class","zoom"),this.g=this.zoomGroup.append("g").attr("class","wereldatlas-land"));if(this.config.landShadow){this.addDropShadow();var l=e.geo.path().projection(this.projection);this.g.append("path").datum(r.feature(t,t.objects[this.config.shapefileFeature])).attr("class","land").attr("d",l).style("filter","url(#drop-shadow)")}this.path=e.geo.path().projection(this.projection);if(drawGraticule){var c=this.svg.append("g").attr("id","sphere-group");c.append("defs").append("path").datum({type:"Sphere"}).attr("id","sphere").attr("d",this.path),c.append("use").attr("class","sphere").attr("xlink:href","#sphere");var h=this.svg.append("g").attr("id","graticule-group"),p=e.geo.graticule(),d=h.append("path").datum(p).attr("class","graticule").attr("d",this.path)}this.feature=this.g.selectAll(".country").data(r.feature(t,t.objects[this.config.shapefileFeature]).features).enter().append("path").attr("class",function(e){return"country country-"+e.properties[n.config.keyProperty]}).attr("data-country-code",function(e){return e.properties[n.config.keyProperty]}).attr("d",this.path).on("mouseenter",function(){n.channel.vent.trigger("DATA_ATLAS:FEATURE:MOUSEENTER",{model:n.channel.reqres.request("DATA_ATLAS:GET_DATASET"),mouseCoords:e.mouse(n.svg[0][0]),parentArguments:arguments})}).on("mouseleave",function(){n.channel.vent.trigger("DATA_ATLAS:FEATURE:MOUSELEAVE",{model:n.channel.reqres.request("DATA_ATLAS:GET_DATASET"),mouseCoords:e.mouse(n.svg[0][0]),parentArguments:arguments})}),this.boundaries=o.select("path.boundary"),this.boundaries.empty()&&(this.boundaries=this.g.insert("path",".boundary").datum(r.mesh(t,t.objects[this.config.shapefileFeature],function(e,t){return e!==t})).attr("class","boundary").attr("d",this.path));if(zoom){var v=!1;this.zoom=e.behavior.zoom().scaleExtent([this.config.zoomMin,this.config.zoomMax]).size([i,s]).on("zoom",function(){n.projection.translate(e.event.translate).scale(n.originalScale*e.event.scale),v===!1&&(n.channel.vent.trigger("DATA_ATLAS:MAP_DRAG_START"),v=!0),n.manualZooming===!0?n.zoomGroup.transition().duration(400).attr("transform","translate("+e.event.translate+")scale("+e.event.scale+")"):n.zoomGroup.attr("transform","translate("+e.event.translate+")scale("+e.event.scale+")"),n.resizeBorders(e.event),drawGraticule&&d.style("stroke-width",.2/e.event.scale+"px")}).on("zoomend",function(){v=!1,n.manualZooming=!1,n.channel.vent.trigger("DATA_ATLAS:MAP_DRAG_END")}),this.zoomReset(this.startingPoint),this.resizeBorders()}if(rotateWithMouse){var m=e.scale.linear().domain([0,n.$el.width()]).range([-180,180]),g=e.scale.linear().domain([0,n.$el.height()]).range([90,-90]);this.svg.on("mousemove",function(){var t=e.mouse(this);n.projection.rotate([m(t[0]),g(t[1])]),n.svg.selectAll("path").attr("d",n.path)})}n.channel.vent.trigger("DATA_ATLAS:COUNTRY_DRAW_FINISHED",this.svg)},enforceBounding:function(){this.zoom.scale()<=this.zoom.scaleExtent()[0]&&this.zoomReset()},onShow:function(){console.log("show"),this.initializeMap()},reset:function(){this.svg.attr("width",this.w).attr("height",this.$el.height()),this.feature.attr("d",this.path).attr("opacity",.5).transition().duration(400).attr("opacity",1)},resizeBorders:function(e){var t=e?e.scale:this.zoom.scale();this.feature.style("stroke-width",.2/t+"px"),this.boundaries.style("stroke-width",.15/t+"px")},toggleFullScreen:function(){var e=this;if(i.enabled){e.channel.vent.trigger("fullscreen:on"),e.inFullscreenMode=!0;var n=e.projection.invert([e.$el.width()/2,e.$el.height()/2]);i.toggle(this.$el[0]);var r=null;document.addEventListener(i.raw.fullscreenchange,function(){i.isFullscreen?(r=t(".field-name-field-years-in-timeline").clone(!0,!0),console.log(n),e.$el.addClass("fullscreen").append(r),$svg=t(".wereldmap-svg",e.$el),$svg.height("100%").width("100%"),r.css("bottom","0px").css("position","absolute").css("width","100%").css("left","0px"),e.$fullscreenIcon.addClass("active"),_.delay(function(){e.zoomReset({lng:n[0],lat:n[1],zoom:e.zoom.scale()})},500)):(console.log(n),e.channel.vent.trigger("fullscreen:off"),e.inFullscreenMode=!1,e.$el.removeClass("fullscreen"),e.$fullscreenIcon.removeClass("active"),r&&r.remove(),_.delay(function(){e.zoomReset({lng:n[0],lat:n[1],zoom:e.zoom.scale()})},500))})}},updateHashPosition:function(){var e=this,t=this.getCurrentCenter(),n=[parseFloat(t.point[0]).toFixed(3),parseFloat(t.point[1]).toFixed(3),t.zoom].join(",");window.location.hash=updateHashStringParameter(window.location.hash,"dataatlas_center",n)},getCurrentCenter:function(){var e=this;return{point:this.projection.invert([e.$el.width()/2,e.$el.height()/2]),zoom:e.zoom.scale()}},zoomIn:function(){var e=this.zoom.scale()*2,t=this.zoom.scaleExtent();return e<t[1]?this.applyZoom(e):this.applyZoom(t[1]),!1},zoomOut:function(){var e=this.zoom.scale()/2,t=this.zoom.scaleExtent();return e>t[0]&&this.applyZoom(e),!1},zoomReset:function(e){var t=_.isUndefined(e.zoom)?this.zoom.scale():e.zoom,n=e||this.startingPoint,r=[this.$el.width()/2,this.$el.height()/2];this.projection.scale(this.originalScale*t).center([n.lng,n.lat]).translate(r);var i=this.projection([0,0]);return this.projection.center([0,0]),this.zoom.scale(t).translate(i),this.svg.call(this.zoom),this.config.zoomWithMouse||(this.svg.on("wheel.zoom",null),this.svg.on("mousewheel.zoom",null)),this.zoom.event(this.svg),this.config.disablePanZoom&&(this.zoom.on("zoom",null),this.zoom.on("zoomend",null)),!1}})}),define("DATAATLAS/plugins/tooltips/tooltips",["backbone.marionette","jquery","DATAATLAS/plugins/dataatlas_plugin","underscore","d3","DATAATLAS/models/country_translations_model"],function(e,t,n,r,i,s){return n.extend({initialize:function(e){var o=this;n.prototype.initialize(arguments[0]),this.language=e.language;var u=new s,a=u.get("countries"),f=t(o.container),l=e.dataset.get("activeSet");i.select(o.container).selectAll("path.country").each(function(n){var i=t(this),s=n.properties[o.options.config.keyProperty],u=r.findWhere(a,{cc:s});u&&(i.tooltip("destroy"),i.attr("title",u[o.language]+" - "+e.visual.localizeNumber(l[s])+" "+e.visual.getUnitString()),i.tooltip({container:f.find(".tooltips")[0],placement:"right",html:!0}))})}})}),define("text!DATAATLAS/templates/legend_choro.html",[],function(){return'  <%\n  var max = Number(quantiles.pop());\n  // Define max color.\n  if (!_.isNull(maxColor)) {\n  %>\n  <style>\n    /* These are in fact overrides, so they are marked !important. */\n    .value-higher-than-max {\n      fill: <%= maxColor %> !important;\n      background-color: <%= maxColor %> !important;\n    }\n  </style>\n  <div class="swatch <%= scheme %><%= tints %>-<%= tints%> value-higher-than-max" data-toggle="tooltip" title="<%= max + 1 %>+ <%= unit %>"></div>\n  <% } %>\n\n  <div class="swatch <%= scheme %><%= tints - 1 %>-<%= tints%>" data-toggle="tooltip" title="<%= quantiles[tints - 1] %> - <%= max %> <%= unit %>"></div>\n  <% for (var i = tints - 1; i > 0; i--) { %>\n  <div class="swatch <%= scheme %><%= i - 1 %>-<%= tints %>" data-toggle="tooltip" title="<%= quantiles[i - 1] %> - <%= quantiles[i] %> <%= unit %>"></div>\n  <% } %>\n\n  <%\n  // Define min color.\n  if (!_.isNull(minColor)) {\n  %>\n  <style>\n    /* These are in fact overrides, so they are marked !important. */\n    .value-lower-than-min {\n      fill: <%= minColor %> !important;\n      background-color: <%= minColor %> !important;\n    }\n  </style>\n  <div class="swatch <%= scheme %>9999-<%= tints%> value-lower-than-min" data-toggle="tooltip" title="&lt; <%= minNumber %> <%= unit %>"></div>\n  <% } %>\n\n  <div class="swatch choro-null <%= scheme %>0-99999" data-toggle="tooltip" title="Data niet beschikbaar"></div>'}),define("DATAATLAS/views/visual_types/choropletenkaart",["d3","jquery","q","underscore","DATAATLAS/views/dataworld_map","DATAATLAS/views/map_layer_d3","DATAATLAS/plugins/tooltips/tooltips","text!DATAATLAS/templates/legend_choro.html"],function(e,t,n,r,i,s,o,u){"use strict";return i.extend({group:"g.wereldatlas-land",unit:null,roundValues:!1,map:null,dataset:null,initialize:function(e){r.bindAll(this,"colorizeMap","getLegend","setLegendBehavior"),i.prototype.initialize.apply(this,arguments)},onDestroy:function(){i.prototype.onDestroy.apply(this,arguments)},_generate:function(t){var n=this;i.prototype._generate.apply(this,arguments),this.$el.addClass("dataworld-choropletenkaart"),this.map=new s({startingPoint:this.config.centerPoint,$el:this.$el,channel:this.channel,config:this.config}),e.json(this.config.shapefile,function(e,t){n.channel.vent.trigger("DATA_ATLAS:COUNTRY_SHAPES_LOADED",t)}),n.channel.vent.on("DATA_ATLAS:COUNTRY_DRAW_FINISHED",function(){n.shapefileDrawn.resolve()}),n.channel.vent.on("DATA_ATLAS:ACTIVE_COLUMN_CHANGED",n.colorizeMap,n)},colorizeMap:function(){var t=this;console.log("colorizing map...");var n=this.config.scheme.split("_"),i=parseInt(n[1]),s=n[0],u=e.select(this.group),a=t.dataset.get("activeSet"),f=e.scale.quantize().domain([this.dataset.min,this.dataset.max]).range(e.range(i).map(function(e){return"choro "+s+e+"-"+i})),l=e.scale.quantile().domain([this.dataset.min,this.dataset.max]).range(e.range(i)),c=l.quantiles(),h;for(var p=0;p<c.length;p++)this.roundValues===!0?h=c[p].toFixed(0):h=c[p].toFixed(2),c[p]=h;c.unshift(this.dataset.min),c.push(this.dataset.max),this.quantileList=c,u.selectAll("path.country").attr("style",null).attr("class",function(e){if(r.isUndefined(a))return console.log("error: data undefined"),"no-data";var n=a[e.properties[t.config.keyProperty]];if(!r.isNull(n)&&!r.isUndefined(n)&&!r.isNaN(n)){var o="country with-data country-"+e.properties[t.config.keyProperty],u;return n>t.dataset.get("max")?(u="choro "+s+i+"-"+i,o+" value-higher-than-max "+u):n<t.dataset.get("min")?(u="choro "+s+9999+"-"+i,o+" value-lower-than-min "+u):o+" "+f(n)}return"country no-data "+s+"0-99999"+" country-"+e.properties[t.config.keyProperty]}),u.selectAll("path.no-data"),this.config.countryLabels&&(this.pluginConfig.dataset=this.dataset,new o(this.pluginConfig)),this.channel.vent.trigger("DATA_ATLAS:VISUAL_FINISHED")},getLegend:function(){var e=this,t=this.config.scheme.split("_"),n=parseInt(t[1]),i=t[0],s=r.clone(this.quantileList);r.each(s,function(t,n){s[n]=e.localizeNumber(t)});var o={unit:this.config.units,quantiles:s,minNumber:this.localizeNumber(this.quantileList[0]-1),tints:n,scheme:i,minColor:null,maxColor:null};return this.config.manualDomain&&(o.maxColor=this.config.outlierMaxColor,o.minColor=this.config.outlierMinColor),r.template(u,o)},setLegendBehavior:function(n){n.show();var r=this.config.scheme.split("_"),i=r[0],s=e.select(this.el).selectAll("path.country"),o=new RegExp(i+"\\d+-\\d+","g");n.find("div.swatch").tooltip({placement:"right"}).hover(function(){var e=t(this).attr("class").match(o);s.classed("dimmed",!0),s.filter("."+e).classed("dimmed",!1)},function(){s.classed("dimmed",!1)})}})}),define("DATAATLAS/models/country_points_collection",["backbone"],function(e){var t=e.Model.extend({});return e.Collection.extend({model:t,initialize:function(){this.set([{longitude:-160.027,iso_a3:"UMI",latitude:-0.385},{longitude:35.278,iso_a3:"PSE",latitude:32.037},{longitude:19.952,iso_a3:"ALA",latitude:60.198},{longitude:-69.977,iso_a3:"ABW",latitude:12.517},{longitude:-61.783,iso_a3:"ATG",latitude:17.078},{longitude:54.163,iso_a3:"ARE",latitude:23.549},{longitude:65.216,iso_a3:"AFG",latitude:33.677},{longitude:2.632,iso_a3:"DZA",latitude:28.163},{longitude:47.395,iso_a3:"AZE",latitude:40.43},{longitude:20.068,iso_a3:"ALB",latitude:41.143},{longitude:44.563,iso_a3:"ARM",latitude:40.534},{longitude:1.576,iso_a3:"AND",latitude:42.549},{longitude:17.544,iso_a3:"AGO",latitude:-12.296},{longitude:-170.73,iso_a3:"ASM",latitude:-14.318},{longitude:-65.167,iso_a3:"ARG",latitude:-35.377},{longitude:136.189,iso_a3:"AUS",latitude:-24.973},{longitude:14.912,iso_a3:"AUT",latitude:47.683},{longitude:-63.032,iso_a3:"AIA",latitude:18.237},{longitude:21.304,iso_a3:"ATA",latitude:-80.446},{longitude:50.562,iso_a3:"BHR",latitude:26.019},{longitude:-59.559,iso_a3:"BRB",latitude:13.153},{longitude:23.815,iso_a3:"BWA",latitude:-22.182},{longitude:-64.709,iso_a3:"BMU",latitude:32.336},{longitude:4.664,iso_a3:"BEL",latitude:50.643},{longitude:-68.294,iso_a3:"BES",latitude:12.212},{longitude:-78.014,iso_a3:"BHS",latitude:24.628},{longitude:89.941,iso_a3:"BGD",latitude:24.218},{longitude:-88.602,iso_a3:"BLZ",latitude:17.219},{longitude:17.786,iso_a3:"BIH",latitude:44.169},{longitude:-64.671,iso_a3:"BOL",latitude:-16.715},{longitude:96.041,iso_a3:"MMR",latitude:21.718},{longitude:2.469,iso_a3:"BEN",latitude:10.541},{longitude:28.047,iso_a3:"BLR",latitude:53.54},{longitude:160.109,iso_a3:"SLB",latitude:-9.611},{longitude:-53.089,iso_a3:"BRA",latitude:-10.772},{longitude:90.429,iso_a3:"BTN",latitude:27.415},{longitude:25.231,iso_a3:"BGR",latitude:42.761},{longitude:3.412,iso_a3:"BVT",latitude:-54.422},{longitude:114.591,iso_a3:"BRN",latitude:4.468},{longitude:29.887,iso_a3:"BDI",latitude:-3.356},{longitude:-109.433,iso_a3:"CAN",latitude:59.081},{longitude:104.564,iso_a3:"KHM",latitude:12.714},{longitude:18.665,iso_a3:"TCD",latitude:15.361},{longitude:80.704,iso_a3:"LKA",latitude:7.612},{longitude:15.986,iso_a3:"COG",latitude:-0.055},{longitude:23.654,iso_a3:"COD",latitude:-2.876},{longitude:106.514,iso_a3:"CHN",latitude:33.42},{longitude:-69.433,iso_a3:"CHL",latitude:-23.389},{longitude:-81.198,iso_a3:"CYM",latitude:19.314},{longitude:96.839,iso_a3:"CCK",latitude:-12.173},{longitude:12.277,iso_a3:"CMR",latitude:5.133},{longitude:43.337,iso_a3:"COM",latitude:-11.758},{longitude:-73.076,iso_a3:"COL",latitude:3.9},{longitude:145.623,iso_a3:"MNP",latitude:15.005},{longitude:-83.946,iso_a3:"CRI",latitude:9.971},{longitude:20.483,iso_a3:"CAF",latitude:6.571},{longitude:-77.781,iso_a3:"CUB",latitude:21.297},{longitude:-69.01,iso_a3:"CUW",latitude:12.1833},{longitude:-23.634,iso_a3:"CPV",latitude:15.071},{longitude:-159.782,iso_a3:"COK",latitude:-21.219},{longitude:33.219,iso_a3:"CYP",latitude:35.043},{longitude:9.264,iso_a3:"DNK",latitude:56.058},{longitude:42.516,iso_a3:"DJI",latitude:11.9},{longitude:-61.356,iso_a3:"DMA",latitude:15.475},{longitude:-70.729,iso_a3:"DOM",latitude:19.015},{longitude:-78.497,iso_a3:"ECU",latitude:-1.385},{longitude:29.872,iso_a3:"EGY",latitude:26.494},{longitude:-8.152,iso_a3:"IRL",latitude:53.177},{longitude:10.488,iso_a3:"GNQ",latitude:1.607},{longitude:25.793,iso_a3:"EST",latitude:58.674},{longitude:38.219,iso_a3:"ERI",latitude:16.045},{longitude:-88.866,iso_a3:"SLV",latitude:13.736},{longitude:39.616,iso_a3:"ETH",latitude:8.626},{longitude:15.338,iso_a3:"CZE",latitude:49.743},{longitude:-53.241,iso_a3:"GUF",latitude:3.924},{longitude:26.272,iso_a3:"FIN",latitude:64.504},{longitude:177.974,iso_a3:"FJI",latitude:-17.819},{longitude:-58.694,iso_a3:"FLK",latitude:-51.665},{longitude:158.235,iso_a3:"FSM",latitude:6.883},{longitude:-6.864,iso_a3:"FRO",latitude:62.05},{longitude:-149.462,iso_a3:"PYF",latitude:-17.626},{longitude:2.55,iso_a3:"FRA",latitude:46.565},{longitude:69.117,iso_a3:"ATF",latitude:-49.302},{longitude:-15.386,iso_a3:"GMB",latitude:13.453},{longitude:11.797,iso_a3:"GAB",latitude:-0.591},{longitude:43.518,iso_a3:"GEO",latitude:42.176},{longitude:-1.207,iso_a3:"GHA",latitude:7.96},{longitude:-5.345,iso_a3:"GIB",latitude:36.138},{longitude:-61.678,iso_a3:"GRD",latitude:12.118},{longitude:-2.576,iso_a3:"GGY",latitude:49.459},{longitude:-41.391,iso_a3:"GRL",latitude:74.719},{longitude:9.851,iso_a3:"DEU",latitude:51.11},{longitude:-61.441,iso_a3:"GLP",latitude:16.286},{longitude:144.707,iso_a3:"GUM",latitude:13.385},{longitude:21.766,iso_a3:"GRC",latitude:39.666},{longitude:-90.398,iso_a3:"GTM",latitude:15.256},{longitude:-10.942,iso_a3:"GIN",latitude:10.439},{longitude:-58.974,iso_a3:"GUY",latitude:4.792},{longitude:-72.278,iso_a3:"HTI",latitude:19.142},{longitude:114.129,iso_a3:"HKG",latitude:22.423},{longitude:73.507,iso_a3:"HMD",latitude:-53.111},{longitude:-86.863,iso_a3:"HND",latitude:14.819},{longitude:16.693,iso_a3:"HRV",latitude:45.723},{longitude:19.134,iso_a3:"HUN",latitude:47.07},{longitude:-18.48,iso_a3:"ISL",latitude:64.764},{longitude:114.252,iso_a3:"IDN",latitude:-0.976},{longitude:-4.527,iso_a3:"IMN",latitude:54.229},{longitude:78.5,iso_a3:"IND",latitude:21},{longitude:72.416,iso_a3:"IOT",latitude:-7.335},{longitude:54.301,iso_a3:"IRN",latitude:32.565},{longitude:34.851,iso_a3:"ISR",latitude:31.026},{longitude:12.8,iso_a3:"ITA",latitude:42.7},{longitude:-5.556,iso_a3:"CIV",latitude:7.632},{longitude:43.772,iso_a3:"IRQ",latitude:33.048},{longitude:139.068,iso_a3:"JPN",latitude:36.491},{longitude:-2.129,iso_a3:"JEY",latitude:49.219},{longitude:-77.32,iso_a3:"JAM",latitude:18.151},{longitude:36.319,iso_a3:"JOR",latitude:30.703},{longitude:37.858,iso_a3:"KEN",latitude:.53},{longitude:74.555,iso_a3:"KGZ",latitude:41.465},{longitude:126.451,iso_a3:"PRK",latitude:39.778},{longitude:175.036,iso_a3:"KIR",latitude:-1.508},{longitude:128.103,iso_a3:"KOR",latitude:36.504},{longitude:105.704,iso_a3:"CXR",latitude:-10.444},{longitude:47.376,iso_a3:"KWT",latitude:29.476},{longitude:67.301,iso_a3:"KAZ",latitude:48.16},{longitude:102.471,iso_a3:"LAO",latitude:19.905},{longitude:35.888,iso_a3:"LBN",latitude:33.92},{longitude:25.641,iso_a3:"LVA",latitude:56.858},{longitude:23.897,iso_a3:"LTU",latitude:55.336},{longitude:-9.657,iso_a3:"LBR",latitude:6.682},{longitude:19.491,iso_a3:"SVK",latitude:48.707},{longitude:9.555,iso_a3:"LIE",latitude:47.153},{longitude:28.243,iso_a3:"LSO",latitude:-29.581},{longitude:6.088,iso_a3:"LUX",latitude:49.771},{longitude:18.023,iso_a3:"LBY",latitude:27.044},{longitude:46.706,iso_a3:"MDG",latitude:-19.374},{longitude:-61.021,iso_a3:"MTQ",latitude:14.653},{longitude:113.545,iso_a3:"MAC",latitude:22.2},{longitude:28.599,iso_a3:"MDA",latitude:47.193},{longitude:45.155,iso_a3:"MYT",latitude:-12.777},{longitude:102.876,iso_a3:"MNG",latitude:46.056},{longitude:-62.187,iso_a3:"MSR",latitude:16.736},{longitude:33.808,iso_a3:"MWI",latitude:-13.4},{longitude:19.254,iso_a3:"MNE",latitude:42.792},{longitude:21.698,iso_a3:"MKD",latitude:41.6},{longitude:-3.524,iso_a3:"MLI",latitude:17.35},{longitude:7.412,iso_a3:"MCO",latitude:43.75},{longitude:-5.758,iso_a3:"MAR",latitude:32.706},{longitude:57.583,iso_a3:"MUS",latitude:-20.255},{longitude:-10.332,iso_a3:"MRT",latitude:20.26},{longitude:14.442,iso_a3:"MLT",latitude:35.89},{longitude:57.407,iso_a3:"OMN",latitude:21.656},{longitude:72.92,iso_a3:"MDV",latitude:3.548},{longitude:-102.535,iso_a3:"MEX",latitude:23.951},{longitude:102.195,iso_a3:"MYS",latitude:4.201},{longitude:37.923,iso_a3:"MOZ",latitude:-14.422},{longitude:165.447,iso_a3:"NCL",latitude:-21.359},{longitude:-169.869,iso_a3:"NIU",latitude:-19.052},{longitude:167.953,iso_a3:"NFK",latitude:-29.037},{longitude:9.398,iso_a3:"NER",latitude:17.426},{longitude:166.899,iso_a3:"VUT",latitude:-15.376},{longitude:8.105,iso_a3:"NGA",latitude:9.594},{longitude:5.389,iso_a3:"NLD",latitude:52.077},{longitude:8.74,iso_a3:"NOR",latitude:61.152},{longitude:83.939,iso_a3:"NPL",latitude:28.253},{longitude:166.93,iso_a3:"NRU",latitude:-0.522},{longitude:-55.912,iso_a3:"SUR",latitude:4.127},{longitude:-68.87,iso_a3:"ANT",latitude:12.123},{longitude:-85.034,iso_a3:"NIC",latitude:12.84},{longitude:172.235,iso_a3:"NZL",latitude:-42.634},{longitude:-58.391,iso_a3:"PRY",latitude:-23.236},{longitude:-128.316,iso_a3:"PCN",latitude:-24.366},{longitude:-75.552,iso_a3:"PER",latitude:-9.326},{longitude:69.386,iso_a3:"PAK",latitude:29.967},{longitude:19.401,iso_a3:"POL",latitude:52.125},{longitude:-80.92,iso_a3:"PAN",latitude:8.384},{longitude:-8.058,iso_a3:"PRT",latitude:40.309},{longitude:143.459,iso_a3:"PNG",latitude:-5.949},{longitude:134.57,iso_a3:"PLW",latitude:7.501},{longitude:-14.651,iso_a3:"GNB",latitude:12.125},{longitude:51.191,iso_a3:"QAT",latitude:25.316},{longitude:20.806,iso_a3:"SRB",latitude:44.032},{longitude:55.538,iso_a3:"REU",latitude:-21.122},{longitude:168.963,iso_a3:"MHL",latitude:7.595},{longitude:-63.041,iso_a3:"MAF",latitude:18.094},{longitude:24.969,iso_a3:"ROU",latitude:45.844},{longitude:122.466,iso_a3:"PHL",latitude:11.118},{longitude:-66.466,iso_a3:"PRI",latitude:18.221},{longitude:96.689,iso_a3:"RUS",latitude:61.988},{longitude:29.917,iso_a3:"RWA",latitude:-1.998},{longitude:44.585,iso_a3:"SAU",latitude:24.023},{longitude:-56.325,iso_a3:"SPM",latitude:47.042},{longitude:-62.769,iso_a3:"KNA",latitude:17.34},{longitude:55.474,iso_a3:"SYC",latitude:-4.647},{longitude:23.121,iso_a3:"ZAF",latitude:-30.558},{longitude:-14.881,iso_a3:"SEN",latitude:15.013},{longitude:-5.71,iso_a3:"SHN",latitude:-15.953},{longitude:14.827,iso_a3:"SVN",latitude:46.124},{longitude:-11.792,iso_a3:"SLE",latitude:8.56},{longitude:12.46,iso_a3:"SMR",latitude:43.942},{longitude:103.808,iso_a3:"SGP",latitude:1.351},{longitude:63.05,iso_a3:"SXW",latitude:18.067},{longitude:48.316,iso_a3:"SOM",latitude:9.774},{longitude:-3.649,iso_a3:"ESP",latitude:40.227},{longitude:-60.969,iso_a3:"LCA",latitude:13.898},{longitude:30.05,iso_a3:"SDN",latitude:13.832},{longitude:31.6,iso_a3:"SSD",latitude:4.85},{longitude:18.374,iso_a3:"SJM",latitude:78.83},{longitude:15.27,iso_a3:"SWE",latitude:62.011},{longitude:-36.891,iso_a3:"SGS",latitude:-54.209},{longitude:38.506,iso_a3:"SYR",latitude:35.013},{longitude:7.908,iso_a3:"CHE",latitude:46.861},{longitude:-63.043,iso_a3:"BLM",latitude:18.04},{longitude:-61.253,iso_a3:"TTO",latitude:10.468},{longitude:100.844,iso_a3:"THA",latitude:15.7},{longitude:69.42,iso_a3:"TJK",latitude:38.665},{longitude:-71.95,iso_a3:"TCA",latitude:21.902},{longitude:-171.853,iso_a3:"TKL",latitude:-9.193},{longitude:-175.185,iso_a3:"TON",latitude:-21.202},{longitude:1.081,iso_a3:"TGO",latitude:8.799},{longitude:6.629,iso_a3:"STP",latitude:.201},{longitude:9.596,iso_a3:"TUN",latitude:35.383},{longitude:125.878,iso_a3:"TLS",latitude:-8.822},{longitude:35.179,iso_a3:"TUR",latitude:39.061},{longitude:179.219,iso_a3:"TUV",latitude:-8.514},{longitude:120.946,iso_a3:"TWN",latitude:23.754},{longitude:59.384,iso_a3:"TKM",latitude:39.122},{longitude:34.823,iso_a3:"TZA",latitude:-6.27},{longitude:32.386,iso_a3:"UGA",latitude:1.28},{longitude:-1.6,iso_a3:"GBR",latitude:53},{longitude:31.388,iso_a3:"UKR",latitude:49.016},{longitude:-98.606,iso_a3:"USA",latitude:39.622},{longitude:-1.74,iso_a3:"BFA",latitude:12.278},{longitude:-56.012,iso_a3:"URY",latitude:-32.8},{longitude:63.17,iso_a3:"UZB",latitude:41.75},{longitude:-61.194,iso_a3:"VCT",latitude:13.248},{longitude:-66.166,iso_a3:"VEN",latitude:7.125},{longitude:-64.39,iso_a3:"VGB",latitude:18.483},{longitude:105.314,iso_a3:"VNM",latitude:21.491},{longitude:-64.785,iso_a3:"VIR",latitude:17.741},{longitude:12.451,iso_a3:"VAT",latitude:41.904},{longitude:17.218,iso_a3:"NAM",latitude:-22.133},{longitude:-178.131,iso_a3:"WLF",latitude:-14.289},{longitude:-13.706,iso_a3:"ESH",latitude:24.554},{longitude:-172.414,iso_a3:"WSM",latitude:-13.652},{longitude:31.497,iso_a3:"SWZ",latitude:-26.562},{longitude:48.355,iso_a3:"YEM",latitude:15.807},{longitude:26.32,iso_a3:"ZMB",latitude:-14.614},{longitude:29.872,iso_a3:"ZWE",latitude:-19}])}})}),define("DATAATLAS/views/visual_types/figuratievekaart",["d3","jquery","q","underscore","DATAATLAS/views/dataworld_map","DATAATLAS/views/map_layer_d3","DATAATLAS/models/country_translations_model","DATAATLAS/models/country_points_collection","text!DATAATLAS/templates/legend_choro.html"],function(e,t,n,r,i,s,o,u){"use strict";return i.extend({unit:null,roundValues:!1,stopSizes:[6,10,14],legendSizes:null,circlesInitialized:!1,map:null,dataset:null,initialize:function(e){var n=this;r.bindAll(this,"sizeCircles","initializeCircles","getLegend"),this.countryPoints=new u,i.prototype.initialize.apply(this,arguments);var s={scheme:"redonly",zoomBubbles:!1};this.defaults=r.extend({},this.defaults,s),console.log("initialized figuratievekaart"),t(window).on("resize."+this._id,r.debounce(r.bind(this.onResize,this),300))},onDestroy:function(){t(window).off("resize."+this._id),console.log("Destroying figuratievekaart "+this._id),i.prototype.onDestroy.apply(this,arguments)},onResize:function(){this.positionLegend()},_generate:function(t){var n=this;i.prototype._generate.apply(this,arguments),this.$el.addClass("dataworld-figuratievekaart"),this.map=new s({startingPoint:this.config.centerPoint,$el:this.$el,channel:this.channel,config:this.config});var r=this.config.scheme.split("_");this.scheme=r[0],e.json(this.config.shapefile,function(e,t){n.channel.vent.trigger("DATA_ATLAS:COUNTRY_SHAPES_LOADED",t)}),n.channel.vent.on("DATA_ATLAS:COUNTRY_DRAW_FINISHED",function(e){n.svg=e,n.group=n.svg.select(".zoom").append("g").classed("country-points",!0).classed(n.scheme,!0),n.group.selectAll("circle").data(n.countryPoints.toJSON()).enter().append("circle").attr("r",1).classed("figuratieve-spot",!0)}),n.channel.vent.on("DATA_ATLAS:ACTIVE_COLUMN_CHANGED",n.sizeCircles,n)},initializeCircles:function(){console.log("initializing circles.");var t=this;this.circlesInitialized=!0,this.legendSizes=r.clone(this.stopSizes),this.scale=e.scale.quantile().domain([this.dataset.min,this.dataset.max]).range(e.range(t.stopSizes.length).map(function(e){return"strength-"+e}));var n=this.group.selectAll("circle").sort(function(e,t){return e.data>t.data||r.isUndefined(t.data)?-1:e.data<t.data||r.isUndefined(e.data)?1:0}).each(function(n){var r=t.map.originalProjection([n.longitude,n.latitude]);e.select(this).each(function(e){e.properties={},e.properties[t.config.keyProperty]=e[t.config.keyProperty]}).attr({cx:r[0],cy:r[1]})});this.outlierMaxIsUsed()&&this.group.selectAll(".value-higher-than-max").style("fill",this.config.outlierMaxColor),this.outlierMinIsUsed()&&this.group.selectAll(".value-lower-than-min").style("fill",this.config.outlierMinColor),t.channel.vent.on("DATA_ATLAS:MAP_DRAG_END",t.sizeCircles,t),t.config.countryLabels&&t.initializeTooltips()},initializeTooltips:function(){var e=this,n=new o,i=n.get("countries"),s=e.dataset.get("activeSet");this.group.selectAll("circle").each(function(n){var o=t(this),u=r.findWhere(i,{cc:n[e.config.keyProperty]});u&&(o.tooltip("destroy"),o.attr("title",u[e.config.language]+" - "+e.localizeNumber(s[n[e.config.keyProperty]])+" "+e.getUnitString()),o.tooltip({container:t(e.container).find(".tooltips")[0],placement:"right",html:!0}))})},sizeCircles:function(){console.log("sizing circles....");var t=this;this.circlesInitialized||this.initializeCircles();var n=this.map.getZoom(),i=n.scale(),s=this.dataset.min,o=this.dataset.max,u=e.scale.linear().domain([s,o]).range([t.legendSizes[0],t.legendSizes[t.legendSizes.length-1]]),a=t.dataset.get("activeSet");e.select("g.country-points").selectAll("circle").classed("with-data",function(e){return!r.isNull(e)&&!r.isUndefined(e)&&!r.isNaN(e)}).each(function(n){var i=e.select(this),s=a[n[t.config.keyProperty]],o=t.scale(s);t.outlierMaxIsUsed()&&s>t.dataset.max?(o="strength-501",i.style("fill",t.config.outlierMaxColor)):t.outlierMinIsUsed()&&s<t.dataset.min&&(o="strength-500",i.style("fill",t.config.outlierMinColor)),r.isUndefined(o)||e.select(this).classed(o,!0)}).transition().attr("r",function(e){var n=a[e[t.config.keyProperty]];if(!r.isNull(n)&&!r.isUndefined(n)&&!r.isNaN(n)){var s=u(n)/Math.PI*2;return t.config.zoomBubbles&&(s=s/i*2),s}}).style("stroke-width",function(){return 1/i}).attr("data-country-code",function(e){return a[e[t.config.keyProperty]]}).duration(500).delay(function(e,t){return t+30}),t.channel.vent.trigger("DATA_ATLAS:VISUAL_FINISHED")},outlierMaxIsUsed:function(){return this.config.manualDomain&&!r.isUndefined(this.config.outlierMaxColor)&&!r.isUndefined(this.dataset.manualMax)},outlierMinIsUsed:function(){return this.config.manualDomain&&!r.isUndefined(this.config.outlierMinColor)&&!r.isUndefined(this.dataset.manualMin)},getLegend:function(){console.log("creating legend");var n=this,i=r.clone(n.scale.quantiles()),s;for(var o=0;o<i.length;o++)this.config.roundValues===!0?s=parseInt(i[o]):s=parseFloat(i[o]).toFixed(2),i[o]=s;i.unshift(this.dataset.min),i.push(this.dataset.max),r.isUndefined(this.legendGroup)||this.legendGroup.remove();var u=n.svg.append("g").attr("id","figuratieve-legend");this.legendGroup=u,this.legendSizes=r.clone(this.stopSizes),u.selectAll("circle").data(this.legendSizes).enter().append("circle").attr("r",function(e){return e*2/Math.PI}).attr("class",function(e,t){return"legend-circle strength-"+t}).attr("title",function(e,t){return n.localizeNumber(i[t])+" - "+n.localizeNumber(i[t+1])+" "+n.config.units}).attr("data-toggle","tooltip");if(this.outlierMinIsUsed()){var a=4;this.legendSizes.unshift(a),u.insert("circle",":first-child").attr("r",a*2/Math.PI).attr("class","legend-circle  strength-500").attr("title","Minder dan "+n.localizeNumber(this.dataset.min)+" "+n.config.units).style("fill",this.config.outlierMinColor).attr("data-toggle","tooltip")}if(this.outlierMaxIsUsed()){var a=20;this.legendSizes.push(a),u.append("circle").attr("r",a*2/Math.PI).attr("class","legend-circle value-higher-than-max strength-501").attr("title","Meer dan "+n.localizeNumber(this.dataset.max)+" "+n.config.units).style("fill",this.config.outlierMaxColor).attr("data-toggle","tooltip")}this.legend=u.selectAll(".legend-circle");var f=e.selectAll(".figuratieve-spot"),l=new RegExp("strength-\\d+","g"),c=t(n.container).find(".tooltips")[0],h=t("#figuratieve-legend").find(" circle");return h.off(),h.hover(function(e){e.stopPropagation();var n=t(this).attr("class").match(l);f.classed("dimmed",!0),f.filter("."+n).classed("dimmed",!1)},function(){f.classed("dimmed",!1)}),this.positionLegend(),this.legendGroup.attr("transform","translate(0, -34)"),""},positionLegend:function(){var t=this,n=e.sum(t.legendSizes,function(e){var t=e*2/Math.PI;return t*2+1}),r=this.$el.height()-n,i=e.max(t.legendSizes,function(e){return e/Math.PI*2})+10;this.legend.attr("cx",i).attr("cy",function(e,n){var i=0;return n>0&&(i=t.legendSizes[n]/Math.PI*2+t.legendSizes[n-1]/Math.PI*2+2),r+=i,r}).attr("display","block")}})}),define("DATAATLAS/app",["backbone.marionette","jquery","communicator","DATAATLAS/views/visual_types/choropletenkaart","DATAATLAS/views/visual_types/figuratievekaart"],function(e,t,n,r,i){return e.Controller.extend({initialize:function(e){e.visualsManager.register("choropletenkaart",r),e.visualsManager.register("figuratievekaart",i)}})}),define("DATAATLAS/views/visual_types/bewegingskaart",["backbone","backbone.marionette","d3","jquery","underscore","DATAATLAS/views/dataworld_map","DATAATLAS/views/map_layer_d3","DATAATLAS/models/country_points_collection","text!DATAATLAS/templates/legend_choro.html"],function(e,t,n,r,i,s,o,u,a){"use strict";var f=t.ItemView.extend({template:i.template("<%= html %>"),initialize:function(e){this.vent=e.vent,this.opacity=e.opacity},onRender:function(){var e=this;i.delay(function(){e.vent.on("BEWEGINGSKAART:MAP_CLICKED",function(){e.destroy()},500)}),this.$el.css("opacity",this.opacity)},onDestroy:function(){console.log("destroying popup"),this.vent.off("BEWEGINGSKAART:MAP_CLICKED")}});return s.extend({dataset:null,map:null,initialize:function(e){i.bindAll(this,"draw","svgLine","getLegend"),s.prototype.initialize.apply(this,arguments),this.countriesLatLong=new u},draw:function(){var e=this;console.log("drawing start/end points of movement map..."),this.dataset.calculateDomain(),console.log("min,max:",this.dataset.get("min"),this.dataset.get("max"));var t=n.scale.linear().domain([e.dataset.get("min"),e.dataset.get("max")]).range([.5,2]);this.svg.append("svg:marker").attr("id","markerArrow").attr("viewBox","0 0 10 10").attr("refX","3").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","9").attr("markerHeight","3").attr("orient","auto").append("svg:path").attr("d","M 0 0 L 10 5 L 0 10 z");var r=this.svg.select(".zoom").append("g").attr("class","movement-endpoints");this.channel.vent.on("DATA_ATLAS:MAP_DRAG_END",function(){i.delay(function(){r.selectAll(".movement").style("stroke-width",1.5/e.map.zoom.scale()+"px"),r.selectAll(".bewegings-origin").transition().duration(400).style("stroke-width",1/e.map.zoom.scale()+"px").attr("r",function(t){var r=n.select(this).classed("active")?10:6;return r/e.map.zoom.scale()})},10)}),r.selectAll("circle.bewegings-origin").data(i.uniq(i.pluck(this.dataset.rows,this.fromField))).enter().append("circle").attr("r",4).attr("class","bewegings-origin").attr("data-country-code",function(e){return e}).each(function(t){var r=e.countriesLatLong.findWhere({iso_a3:t});if(r){var i=e.map.originalProjection([r.get("longitude"),r.get("latitude")]);n.select(this).attr({cx:i[0],cy:i[1]})}}).on("click",function(s){r.selectAll("circle.bewegings-origin").classed("active",!1),n.select(this).classed("active",!0),e.movementLines.selectAll("path.movement").remove();var o={};o[e.fromField]=s;var u=i.where(e.dataset.rows,o);i.each(u,function(n){e.movementLines.append("path").attr("data-destination",n[e.toField]).attr("class","movement").attr("style","stroke: rgba(0,0,0,"+t(n[e.activeField])+")")}),e.illustrateMovement(s)}),e.movementLines=r.append("g").attr("id","movement-lines"),this.channel.vent.trigger("DATA_ATLAS:VISUAL_FINISHED")},_generate:function(e){var t=this;s.prototype._generate.apply(this,arguments),this.$el.addClass("dataatlas-movement-map"),this.map=new o({startingPoint:this.config.centerPoint,$el:this.$el,channel:this.channel,config:this.config}),n.json(this.config.shapefile,function(e,n){t.channel.vent.trigger("DATA_ATLAS:COUNTRY_SHAPES_LOADED",n)}),t.channel.vent.on("DATA_ATLAS:COUNTRY_DRAW_FINISHED",function(){t.shapefileDrawn.resolve(),t.svg=n.select("svg.wereldmap-svg"),t.svg.on("click",function(){t.channel.vent.trigger("BEWEGINGSKAART:MAP_CLICKED")}),t.draw()}),this.fromField=i.findWhere(this.dataset.get("fields"),{type:"country_from"}),this.toField=i.findWhere(this.dataset.get("fields"),{type:"country_to"}),this.activeField=i.findWhere(this.dataset.get("fields"),{type:"integer"});try{this.fromField=this.fromField.id,this.toField=this.toField.id,this.activeField=this.activeField.id}catch(r){throw"Unable to generate movement map. There must be a single 'correspondent' country, and a single 'claimant' country."}},getLegend:function(){var e=this,t=this.config.scheme.split("_"),r=parseInt(t[1]),s=t[0],o=n.scale.quantile().domain([this.dataset.get("min"),this.dataset.get("max")]).range(n.range(r)),u=o.quantiles();for(var f=0;f<u.length;f++)u[f]=this.roundValues===!0?u[f].toFixed(0):u[f].toFixed(2);u.unshift(this.dataset.get("min")),u.push(this.dataset.get("max")),this.quantileList=u;var l=i.clone(this.quantileList);i.each(l,function(t,n){l[n]=e.localizeNumber(t)});var c={maxColor:null,minColor:null,minNumber:this.localizeNumber(this.quantileList[0]),quantiles:l,tints:r,scheme:s,showOutliersInLegend:this.config.showOutliersInLegend,unit:this.config.units};return this.dataset.manualMax&&(c.maxColor=this.config.outlierMaxColor),this.dataset.manualMin&&(c.minColor=this.config.outlierMinColor),i.template(a,c)},illustrateMovement:function(t){var s=this,o={choro:!1,"bewegings-destination":!1,"value-higher-than-max":!1,"value-lower-than-min":!1},u=this.config.scheme.split("_"),a=parseInt(u[1]),f=u[0],l=n.range(a).map(function(e){return"choro "+f+e+"-"+a});this.dataset.manualMax&&l.push("choro value-higher-than-max "+f+a+"-"+a),this.dataset.manualMin&&l.unshift("choro value-lower-than-min "+f+9999+"-"+a);var c=n.scale.quantize().domain([this.dataset.get("min"),this.dataset.get("max")]).range(l);for(var h=0;h<=a;h++)o[f+h+"-"+a]=!1;n.selectAll("path.country").classed(o).on("click",null);var p=this.countriesLatLong.findWhere({iso_a3:t}),d=this.map.originalProjection([p.get("longitude"),p.get("latitude")]);s.movementLines.selectAll("path.movement").each(function(t,o){var u=n.select(this),a=u.attr("data-destination"),f=s.countriesLatLong.findWhere({iso_a3:a}),l=s.map.originalProjection([f.get("longitude"),f.get("latitude")]),h=[{x:d[0],y:d[1]},{x:l[0],y:l[1]}];u.attr("d",s.svgLine(h)).style("stroke-width",1/s.map.zoom.scale()+"px");var v=u.node().getTotalLength(),m={},g;m[s.toField]=f.get("iso_a3"),m[s.fromField]=p.get("iso_a3"),g=new e.Model(i.findWhere(s.dataset.get("records"),m)),u.attr("stroke-dasharray",v+" "+v).attr("stroke-dashoffset",v).transition().duration(250*(1+o*.15)).ease("easeInOutQuart").attr("stroke-dashoffset",0).each("start",function(){n.select("path.country-"+r(this).attr("data-destination")).classed("target-country",!0)}).each("end",function(){var e=r(this),t=e.attr("data-destination"),i=c(g.get(s.activeField)),o={"target-country":!1,country:!0,"bewegings-destination":!0};o["country-"+t]=!0,o[i]=!0,n.select("path.country-"+t).classed(o).on("click",function(){s.renderPopup(g)})})})},onDestroy:function(){s.prototype.onDestroy.apply(this,arguments)},renderPopup:function(t){var n=this;this.popupRegion||(this.map.$el.append('<div id="popup-region"></div>'),this.popupRegion=new e.Marionette.Region({el:"#popup-region"}));if(!t.get("html")||t.get("html")=="")return;this.popupRegion.show(new f({model:t,vent:this.channel.vent,opacity:this.config.popupOpacity||1}));var n=this},setLegendBehavior:function(e){e.show();var t=this.config.scheme.split("_"),i=t[0],s=n.select(this.el).selectAll("path.country"),o=new RegExp(i+"\\d+-\\d+","g");e.find("div.swatch").tooltip({placement:"right"}).hover(function(){var e=r(this).attr("class").match(o);s.classed("dimmed",!0),s.filter("."+e).classed("dimmed",!1)},function(){s.classed("dimmed",!1)})},svgLine:function(e,t){var n,r,i,s;t===!0?(n=e[0].x,r=e[0].y):(e[0].x>=e[1].x?(i=e[1].x-e[0].x,n=e[1].x-i*.25):(i=e[1].x-e[0].x,n=e[1].x-i*.25),e[0].y>=e[1].y?(s=e[1].y-e[0].y,r=e[1].y*1.05-s):(s=e[1].y-e[0].y,r=e[0].y*.95+s));var o="M "+e[0].x+", "+e[0].y;return o+=" Q "+n+" "+r+" "+e[1].x+" "+e[1].y,o}})}),define("REM/views/tabs/dataworld/movement_map",["backbone.marionette","REM/views/tabs/base_tab","DATAATLAS/app","DATAATLAS/views/visual_types/bewegingskaart"],function(e,t,n,r){"use strict";return t.extend({template:_.template('<h3>Bewegingskaart</h3><div class="totalvis-instance"data-visual="bewegingskaart"data-dataset="movement"data-id="sewage"></div>'),datasetManager:null,visualsManager:null,channelId:"bewegingskaart",initialize:function(e){window.dataAtlas.configurationOverrides={disablePanZoom:!1,domainMin:null,domainMax:10,keyField:"Country Code",manualDomain:!0,outlierMaxColor:"#800000",scheme:"sequentialorange_5",popupOpacity:.9,showOutliersInLegend:!1,units:"zaken",zoomMin:1,zoomMax:32,zoomWithMouse:!0};var t=this;this.visualsManager=e.visualsManager,this.visualsManager.register("bewegingskaart",r),this.channel=Backbone.Wreqr.radio.channel(this.channelId),this.channel.reqres.setHandler("visual-configuration",function(){return t.config}),new n(e)}})}),require(["jquery","backbone","backbone.marionette","REM/router/router","REM/controllers/VisualsDatasetManager","REM/controllers/VisualsManager","REM/models/budget","REM/recline-extensions/backend/backend.raw","REM/views/tabs/dataworld/movement_map"],function(){}),define("dataatlas",function(){})})();